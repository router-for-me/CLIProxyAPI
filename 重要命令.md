export ANTHROPIC_MODEL=glm-4.6

export ANTHROPIC_SMALL_FAST_MODEL=glm-4.6

export ANTHROPIC_MODEL=claude-sonnet-4-5-20250929

export ANTHROPIC_MODEL=gpt-5-codex-medium

export ANTHROPIC_MODEL=gpt-5-medium

export ANTHROPIC_MODEL=gpt-5-high

export ANTHROPIC_MODEL=gpt-5-mini

export ANTHROPIC_MODEL=grok-code-fast-1





/model gpt-5-medium

/model gpt-5-high

/model gpt-5-codex-medium

/model gpt-5-codex-high


./cli-proxy-api

go build -o cli-proxy-api ./cmd/server

\\wsl.localhost\Ubuntu\home\adam\projects\CLIProxyAPI

curl -H 'Authorization: Bearer adamcf' \
  'http://localhost:53355/v0/management/tps?window=6m&provider=packycode&model=gpt-5-medium'
curl -H 'Authorization: Bearer adamcf' \
  'http://localhost:53355/v0/management/tps?window=6m&provider=packycode&model=gpt-5-codex-medium'



## Zsh 命令速查（必要端点）

提示：默认端口为 53355；如使用自定义端口，请将 53355 替换为实际端口。

目录：
- 构建与启动：go build / ./cli-proxy-api
- 核心端点：/v1/models, /v1/chat/completions, /v1/completions, /v1/responses, /v1/messages
- 管理端点：/v0/management/providers, /models, /tps, /usage, /config.yaml, /logs, /request-log, /debug, /usage-statistics-enabled, /tps-log, /logging-to-file, /codex-api-key, /openai-compatibility, /packycode
- 实用技巧：jq 过滤模型与 owned_by 去重

### 构建与启动

```zsh
# 构建（Linux/macOS）
go build -o cli-proxy-api ./cmd/server

# 启动服务器（默认端口 53355）
./cli-proxy-api
```

### 核心（OpenAI/Claude 兼容）端点

注释约定：每条命令括号内为“方法 + 路径”。

小贴士：流式请求建议加 `-N` 防止 curl 缓冲；JSON 请使用单引号包裹，避免 shell 展开。

```zsh
# 列出模型（GET /v1/models）
curl -H 'Authorization: Bearer sk-dummy' \
  http://localhost:53355/v1/models

# Chat Completions（非流式，POST /v1/chat/completions）
curl -X POST http://localhost:53355/v1/chat/completions \
  -H 'Authorization: Bearer sk-dummy' \
  -H 'Content-Type: application/json' \
  -d '{
    "model": "gpt-5-mini",
    "messages": [{"role":"user","content":"Hello"}],
    "stream": false
  }'

# Chat Completions（流式，SSE，POST /v1/chat/completions）
curl -N -X POST http://localhost:53355/v1/chat/completions \
  -H 'Authorization: Bearer sk-dummy' \
  -H 'Content-Type: application/json' \
  -d '{
    "model": "gpt-5-medium",
    "messages": [{"role":"user","content":"Write a poem"}],
    "stream": true
  }'

# Completions（遗留，内部转换为 chat completions，POST /v1/completions）
curl -X POST http://localhost:53355/v1/completions \
  -H 'Authorization: Bearer sk-dummy' \
  -H 'Content-Type: application/json' \
  -d '{
    "model": "gpt-5-medium",
    "prompt": "Complete this sentence:",
    "max_tokens": 128,
    "temperature": 0.7,
    "stream": false
  }'

# Claude Messages（非流式，POST /v1/messages）
curl -X POST http://localhost:53355/v1/messages \
  -H 'Authorization: Bearer sk-dummy' \
  -H 'Content-Type: application/json' \
  -d '{
    "model": "gpt-5-medium",
    "messages": [{"role":"user","content":"Say hello"}]
  }'

# Claude Messages（流式，POST /v1/messages）
curl -N -X POST http://localhost:53355/v1/messages \
  -H 'Authorization: Bearer sk-dummy' \
  -H 'Content-Type: application/json' \
  -d '{
    "model": "gpt-5-medium",
    "messages": [{"role":"user","content":"Explain streaming"}],
    "stream": true
  }'

# Responses（非流式，POST /v1/responses）
curl -X POST http://localhost:53355/v1/responses \
  -H 'Authorization: Bearer sk-dummy' \
  -H 'Content-Type: application/json' \
  -d '{
    "model": "gpt-5-medium",
    "messages": [{"role":"user","content":"What is AI?"}],
    "stream": false
  }'

# Responses（流式，SSE，POST /v1/responses）
curl -N -X POST http://localhost:53355/v1/responses \
  -H 'Authorization: Bearer sk-dummy' \
  -H 'Content-Type: application/json' \
  -d '{
    "model": "gpt-5-medium",
    "messages": [{"role":"user","content":"Explain quantum computing"}],
    "stream": true
  }'

# Claude Token 计数（POST /v1/messages/count_tokens）
curl -X POST http://localhost:53355/v1/messages/count_tokens \
  -H 'Authorization: Bearer sk-dummy' \
  -H 'Content-Type: application/json' \
  -d '{
    "model": "gpt-5-medium",
    "messages": [{"role":"user","content":"How many tokens?"}]
  }'
```

### 管理端点（启用管理密钥后）

注释约定：每条命令括号内为“方法 + 路径”；若支持多方法，示例中会以最常用的方法给出。

小贴士：管理端默认 404，需在配置 `remote-management.secret-key` 设置密钥后才会注册路由；所有管理请求都需带 `Authorization: Bearer adamcf`。

```zsh
# Providers（GET /v0/management/providers，列出可用提供商）
curl -H 'Authorization: Bearer adamcf' \
  http://localhost:53355/v0/management/providers

# Models（GET /v0/management/models?provider=...，可选按 provider 过滤）
curl -H 'Authorization: Bearer adamcf' \
  'http://localhost:53355/v0/management/models?provider=packycode'

# TPS 聚合（GET /v0/management/tps?window=&provider=&model=，按窗口/provider/model 过滤）
curl -H 'Authorization: Bearer adamcf' \
  'http://localhost:53355/v0/management/tps?window=6m&provider=codex&model=gpt-5-medium'

curl -H 'Authorization: Bearer adamcf' \
  'http://localhost:53355/v0/management/tps?window=10m&provider=packycode&model=gpt-5-medium'


# Usage 统计（GET /v0/management/usage，内存态 JSON）
curl -H 'Authorization: Bearer adamcf' \
  http://localhost:53355/v0/management/usage

# 获取/写入 YAML 配置（GET/PUT /v0/management/config.yaml）
curl -H 'Authorization: Bearer adamcf' \
  http://localhost:53355/v0/management/config.yaml

curl -X PUT -H 'Authorization: Bearer adamcf' \
  -H 'Content-Type: text/yaml' \
  --data-binary @config.yaml \
  http://localhost:53355/v0/management/config.yaml

# 获取最近日志与请求日志开关（GET /v0/management/logs，GET/PUT /v0/management/request-log）
curl -H 'Authorization: Bearer adamcf' \
  http://localhost:53355/v0/management/logs

curl -H 'Authorization: Bearer adamcf' \
  http://localhost:53355/v0/management/request-log

curl -X PUT -H 'Authorization: Bearer adamcf' \
  -H 'Content-Type: application/json' \
  -d '{"request-log":true}' \
  http://localhost:53355/v0/management/request-log

# Debug 开关（GET/PUT/PATCH /v0/management/debug）
curl -H 'Authorization: Bearer adamcf' \
  http://localhost:53355/v0/management/debug

curl -X PUT -H 'Authorization: Bearer adamcf' \
  -H 'Content-Type: application/json' \
  -d '{"debug":true}' \
  http://localhost:53355/v0/management/debug

# Usage 统计开关（GET/PUT/PATCH /v0/management/usage-statistics-enabled）
curl -H 'Authorization: Bearer adamcf' \
  http://localhost:53355/v0/management/usage-statistics-enabled

curl -X PUT -H 'Authorization: Bearer adamcf' \
  -H 'Content-Type: application/json' \
  -d '{"usage-statistics-enabled":false}' \
  http://localhost:53355/v0/management/usage-statistics-enabled

# tps-log（GET/PUT/PATCH /v0/management/tps-log）
curl -H 'Authorization: Bearer adamcf' \
  http://localhost:53355/v0/management/tps-log

curl -X PUT -H 'Authorization: Bearer adamcf' \
  -H 'Content-Type: application/json' \
  -d '{"tps-log":true}' \
  http://localhost:53355/v0/management/tps-log

# logging-to-file（GET/PUT/PATCH /v0/management/logging-to-file）
curl -H 'Authorization: Bearer adamcf' \
  http://localhost:53355/v0/management/logging-to-file

curl -X PUT -H 'Authorization: Bearer adamcf' \
  -H 'Content-Type: application/json' \
  -d '{"logging-to-file":true}' \
  http://localhost:53355/v0/management/logging-to-file

# API Keys（GET/PUT/DELETE /v0/management/*-api-key）
# 以 codex-api-key 为例（其他如 claude-api-key、generative-language-api-key 类似）
curl -H 'Authorization: Bearer adamcf' \
  http://localhost:53355/v0/management/codex-api-key

curl -X PUT -H 'Authorization: Bearer adamcf' \
  -H 'Content-Type: application/json' \
  -d '{"codex-api-key":[{"api-key":"sk-xxx","base-url":"https://example/v1","proxy-url":""}]}' \
  http://localhost:53355/v0/management/codex-api-key

curl -X DELETE -H 'Authorization: Bearer adamcf' \
  'http://localhost:53355/v0/management/codex-api-key?index=0'

# openai-compatibility（GET /v0/management/openai-compatibility，按提供商管理）
curl -H 'Authorization: Bearer adamcf' \
  http://localhost:53355/v0/management/openai-compatibility

# packycode 专属配置（GET/PUT/PATCH /v0/management/packycode）
curl -H 'Authorization: Bearer adamcf' \
  http://localhost:53355/v0/management/packycode

curl -X PUT -H 'Authorization: Bearer adamcf' \
  -H 'Content-Type: application/json' \
  -d '{"packycode":{"enabled":true}}' \
  http://localhost:53355/v0/management/packycode
```