import{_ as s,o as a,c as t,ag as i}from"./chunks/framework.DM0yugQT.js";const k=JSON.parse('{"title":"Auth Refresh Failure Symptom/Fix Table","description":"","frontmatter":{},"headers":[],"relativePath":"operations/auth-refresh-failure-symptom-fix.md","filePath":"operations/auth-refresh-failure-symptom-fix.md","lastUpdated":1771881719000}'),r={name:"operations/auth-refresh-failure-symptom-fix.md"};function n(o,e,h,d,l,p){return a(),t("div",null,[...e[0]||(e[0]=[i(`<h1 id="auth-refresh-failure-symptom-fix-table" tabindex="-1">Auth Refresh Failure Symptom/Fix Table <a class="header-anchor" href="#auth-refresh-failure-symptom-fix-table" aria-label="Permalink to &quot;Auth Refresh Failure Symptom/Fix Table&quot;">​</a></h1><p>Use this table when token refresh is failing for OAuth/session-based providers.</p><table tabindex="0"><thead><tr><th>Symptom</th><th>How to Confirm</th><th>Fix</th></tr></thead><tbody><tr><td>Requests return repeated <code>401</code> after prior success</td><td>Check logs + provider metrics for auth errors</td><td>Trigger manual refresh: <code>POST /v0/management/auths/{provider}/refresh</code></td></tr><tr><td>Manual refresh returns <code>401</code></td><td>Verify management key header</td><td>Use <code>Authorization: Bearer &lt;management-key&gt;</code> or <code>X-Management-Key</code></td></tr><tr><td>Manual refresh returns <code>404</code></td><td>Check if management routes are enabled</td><td>Set <code>remote-management.secret-key</code>, restart service</td></tr><tr><td>Refresh appears to run but token stays expired</td><td>Inspect auth files + provider-specific auth state</td><td>Re-login provider flow to regenerate refresh token</td></tr><tr><td>Refresh failures spike after config change</td><td>Compare active config and recent deploy diff</td><td>Roll back auth/provider block changes, then re-apply safely</td></tr><tr><td><code>iflow executor: token refresh failed</code> (or similar OAuth refresh errors)</td><td>Check auth record has non-empty <code>refresh_token</code> and recent <code>expires_at</code> timestamp</td><td>Follow provider-agnostic sequence: re-login -&gt; management refresh -&gt; one canary <code>/v1/chat/completions</code> before reopening traffic</td></tr><tr><td>Kiro IDC refresh fails with <code>400/401</code> repeatedly (<code>#149</code> scope)</td><td>Confirm <code>auth_method=idc</code> token has <code>client_id</code>, <code>client_secret</code>, <code>region</code>, and <code>refresh_token</code></td><td>Re-login with <code>--kiro-aws-authcode</code> or <code>--kiro-aws-login</code>; verify refreshed token file fields before re-enabling traffic</td></tr><tr><td>Kiro login account selection seems ignored (<code>#102</code> scope)</td><td>Check logs for <code>kiro: using normal browser mode (--no-incognito)</code></td><td>Remove <code>--no-incognito</code> unless reusing an existing session is intended; default incognito mode is required for clean multi-account selection</td></tr><tr><td>Manual status appears stale after refresh (<code>#136</code> scope)</td><td>Compare token file <code>expires_at</code> and management refresh response</td><td>Trigger refresh endpoint, then reload config/watcher if needed and confirm <code>expires_at</code> moved forward</td></tr></tbody></table><h2 id="fast-commands" tabindex="-1">Fast Commands <a class="header-anchor" href="#fast-commands" aria-label="Permalink to &quot;Fast Commands&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check management API is reachable</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8317/v0/management/config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer &lt;management-key&gt;&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> jq</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Trigger a refresh for one provider</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sS</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8317/v0/management/auths/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">provide</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/refresh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer &lt;management-key&gt;&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> jq</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Kiro specific refresh check (replace file name with your auth file)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jq</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{auth_method, region, expires_at, has_refresh_token:(.refresh_token != &quot;&quot;)}&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  auths/kiro-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.json</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Inspect auth file summary</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8317/v0/management/auth-files</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer &lt;management-key&gt;&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> jq</span></span></code></pre></div><h2 id="related" tabindex="-1">Related <a class="header-anchor" href="#related" aria-label="Permalink to &quot;Related&quot;">​</a></h2><ul><li><a href="./provider-outage-triage-quick-guide">Provider Outage Triage Quick Guide</a></li><li><a href="./critical-endpoints-curl-pack">Critical Endpoints Curl Pack</a></li></ul><hr><p>Last reviewed: <code>2026-02-21</code><br> Owner: <code>Auth Runtime On-Call</code><br> Pattern: <code>YYYY-MM-DD</code></p>`,9)])])}const g=s(r,[["render",n]]);export{k as __pageData,g as default};
