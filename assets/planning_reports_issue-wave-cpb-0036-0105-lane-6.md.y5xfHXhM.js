import{_ as o,o as l,c as i,ag as a}from"./chunks/framework.DM0yugQT.js";const m=JSON.parse('{"title":"Issue Wave CPB-0036..0105 Lane 6 Report","description":"","frontmatter":{},"headers":[],"relativePath":"planning/reports/issue-wave-cpb-0036-0105-lane-6.md","filePath":"planning/reports/issue-wave-cpb-0036-0105-lane-6.md","lastUpdated":1771763743000}'),t={name:"planning/reports/issue-wave-cpb-0036-0105-lane-6.md"};function r(s,e,d,n,c,u){return l(),i("div",null,[...e[0]||(e[0]=[a('<h1 id="issue-wave-cpb-0036-0105-lane-6-report" tabindex="-1">Issue Wave CPB-0036..0105 Lane 6 Report <a class="header-anchor" href="#issue-wave-cpb-0036-0105-lane-6-report" aria-label="Permalink to &quot;Issue Wave CPB-0036..0105 Lane 6 Report&quot;">​</a></h1><h2 id="scope" tabindex="-1">Scope <a class="header-anchor" href="#scope" aria-label="Permalink to &quot;Scope&quot;">​</a></h2><ul><li>Lane: 6</li><li>Worktree: <code>/Users/kooshapari/temp-PRODVERCEL/485/kush/cliproxyapi-plusplus-wave-cpb-6</code></li><li>Assigned items in this pass: <code>CPB-0086..CPB-0095</code></li><li>Commit status: no commits created</li></ul><h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary" aria-label="Permalink to &quot;Summary&quot;">​</a></h2><ul><li>Triaged all 10 assigned items.</li><li>Implemented 2 safe quick wins: <ul><li><code>CPB-0090</code>: fix log-dir size enforcement to include nested day subdirectories.</li><li><code>CPB-0095</code>: add regression test to lock <code>response_format</code> -&gt; <code>text.format</code> Codex translation behavior.</li></ul></li><li>Remaining items are either already covered by existing code/tests, or require broader product/feature work than lane-safe changes.</li></ul><h2 id="per-item-status" tabindex="-1">Per-Item Status <a class="header-anchor" href="#per-item-status" aria-label="Permalink to &quot;Per-Item Status&quot;">​</a></h2><h3 id="cpb-0086-codex-usage-limit-reached-429-should-honor-resets-at-resets-in-seconds-as-next-retry-after" tabindex="-1">CPB-0086 - <code>codex: usage_limit_reached (429) should honor resets_at/resets_in_seconds as next_retry_after</code> <a class="header-anchor" href="#cpb-0086-codex-usage-limit-reached-429-should-honor-resets-at-resets-in-seconds-as-next-retry-after" aria-label="Permalink to &quot;CPB-0086 - `codex: usage_limit_reached (429) should honor resets_at/resets_in_seconds as next_retry_after`&quot;">​</a></h3><ul><li>Status: triaged, blocked for safe quick-win in this lane.</li><li>What was found: <ul><li>No concrete handling path was identified in this worktree for <code>usage_limit_reached</code> with <code>resets_at</code> / <code>resets_in_seconds</code> projection to <code>next_retry_after</code>.</li><li>Existing source mapping only appears in planning artifacts.</li></ul></li><li>Lane action: <ul><li>No code change (avoided speculative behavior without upstream fixture/contract).</li></ul></li><li>Evidence: <ul><li>Focused repo search did not surface implementation references outside planning board docs.</li></ul></li></ul><h3 id="cpb-0087-process-compose-hmr-refresh-workflow-for-gemini-web-concerns" tabindex="-1">CPB-0087 - <code>process-compose/HMR refresh workflow</code> for Gemini Web concerns <a class="header-anchor" href="#cpb-0087-process-compose-hmr-refresh-workflow-for-gemini-web-concerns" aria-label="Permalink to &quot;CPB-0087 - `process-compose/HMR refresh workflow` for Gemini Web concerns&quot;">​</a></h3><ul><li>Status: triaged, not implemented (missing runtime surface in this worktree).</li><li>What was found: <ul><li>No <code>process-compose.yaml</code> exists in this lane worktree.</li><li>Gemini Web is documented as supported config in SDK docs, but no local process-compose profile to patch.</li></ul></li><li>Lane action: <ul><li>No code change.</li></ul></li><li>Evidence: <ul><li><code>ls process-compose.yaml</code> -&gt; not found.</li><li><code>docs/sdk-usage.md:171</code> and <code>docs/sdk-usage_CN.md:163</code> reference Gemini Web config behavior.</li></ul></li></ul><h3 id="cpb-0088-fix-claude-token-exchange-blocked-by-cloudflare-managed-challenge" tabindex="-1">CPB-0088 - <code>fix(claude): token exchange blocked by Cloudflare managed challenge</code> <a class="header-anchor" href="#cpb-0088-fix-claude-token-exchange-blocked-by-cloudflare-managed-challenge" aria-label="Permalink to &quot;CPB-0088 - `fix(claude): token exchange blocked by Cloudflare managed challenge`&quot;">​</a></h3><ul><li>Status: triaged as already addressed in codebase.</li><li>What was found: <ul><li>Claude auth transport explicitly uses <code>utls</code> Firefox fingerprint to bypass Anthropic Cloudflare TLS fingerprint checks.</li></ul></li><li>Lane action: <ul><li>No change required.</li></ul></li><li>Evidence: <ul><li><code>pkg/llmproxy/auth/claude/utls_transport.go:18-20</code></li><li><code>pkg/llmproxy/auth/claude/utls_transport.go:103-112</code></li></ul></li></ul><h3 id="cpb-0089-qwen-oauth-fails" tabindex="-1">CPB-0089 - <code>Qwen OAuth fails</code> <a class="header-anchor" href="#cpb-0089-qwen-oauth-fails" aria-label="Permalink to &quot;CPB-0089 - `Qwen OAuth fails`&quot;">​</a></h3><ul><li>Status: triaged, partial confidence; no safe localized patch identified.</li><li>What was found: <ul><li>Qwen auth/executor paths are present and unit tests pass for current covered scenarios.</li><li>No deterministic failing fixture in local tests to patch against.</li></ul></li><li>Lane action: <ul><li>Ran focused tests, no code change.</li></ul></li><li>Evidence: <ul><li><code>go test ./pkg/llmproxy/auth/qwen -count=1</code> -&gt; <code>ok</code></li></ul></li></ul><h3 id="cpb-0090-logs-max-total-size-mb-misses-per-day-subdirectories" tabindex="-1">CPB-0090 - <code>logs-max-total-size-mb</code> misses per-day subdirectories <a class="header-anchor" href="#cpb-0090-logs-max-total-size-mb-misses-per-day-subdirectories" aria-label="Permalink to &quot;CPB-0090 - `logs-max-total-size-mb` misses per-day subdirectories&quot;">​</a></h3><ul><li>Status: fixed in this lane with regression coverage.</li><li>What was found: <ul><li><code>enforceLogDirSizeLimit</code> previously scanned only top-level <code>os.ReadDir(dir)</code> entries.</li><li>Nested log files (for date-based folders) were not counted/deleted.</li></ul></li><li>Safe fix implemented: <ul><li>Switched to <code>filepath.WalkDir</code> recursion and included all nested <code>.log</code>/<code>.log.gz</code> files in total-size enforcement.</li><li>Added targeted regression test that creates nested day directory and verifies oldest nested file is removed.</li></ul></li><li>Changed files: <ul><li><code>pkg/llmproxy/logging/log_dir_cleaner.go</code></li><li><code>pkg/llmproxy/logging/log_dir_cleaner_test.go</code></li></ul></li><li>Evidence: <ul><li><code>pkg/llmproxy/logging/log_dir_cleaner.go:100-131</code></li><li><code>pkg/llmproxy/logging/log_dir_cleaner_test.go:60-85</code></li></ul></li></ul><h3 id="cpb-0091-all-credentials-for-model-claude-sonnet-4-6-are-cooling-down" tabindex="-1">CPB-0091 - <code>All credentials for model claude-sonnet-4-6 are cooling down</code> <a class="header-anchor" href="#cpb-0091-all-credentials-for-model-claude-sonnet-4-6-are-cooling-down" aria-label="Permalink to &quot;CPB-0091 - `All credentials for model claude-sonnet-4-6 are cooling down`&quot;">​</a></h3><ul><li>Status: triaged as already partially covered.</li><li>What was found: <ul><li>Model registry includes cooling-down models in availability listing when suspension is quota-only.</li></ul></li><li>Lane action: <ul><li>No code change.</li></ul></li><li>Evidence: <ul><li><code>pkg/llmproxy/registry/model_registry.go:745-747</code></li></ul></li></ul><h3 id="cpb-0092-add-claude-sonnet-4-6-to-registered-claude-models" tabindex="-1">CPB-0092 - <code>Add claude-sonnet-4-6 to registered Claude models</code> <a class="header-anchor" href="#cpb-0092-add-claude-sonnet-4-6-to-registered-claude-models" aria-label="Permalink to &quot;CPB-0092 - `Add claude-sonnet-4-6 to registered Claude models`&quot;">​</a></h3><ul><li>Status: triaged as already covered.</li><li>What was found: <ul><li>Default OAuth model-alias mappings include Sonnet 4.6 alias entries.</li><li>Related config tests pass.</li></ul></li><li>Lane action: <ul><li>No code change.</li></ul></li><li>Evidence: <ul><li><code>pkg/llmproxy/config/oauth_model_alias_migration.go:56-57</code></li><li><code>go test ./pkg/llmproxy/config -run &#39;OAuthModelAlias&#39; -count=1</code> -&gt; <code>ok</code></li></ul></li></ul><h3 id="cpb-0093-claude-sonnet-4-5-models-are-deprecated-please-remove-from-panel" tabindex="-1">CPB-0093 - <code>Claude Sonnet 4.5 models are deprecated - please remove from panel</code> <a class="header-anchor" href="#cpb-0093-claude-sonnet-4-5-models-are-deprecated-please-remove-from-panel" aria-label="Permalink to &quot;CPB-0093 - `Claude Sonnet 4.5 models are deprecated - please remove from panel`&quot;">​</a></h3><ul><li>Status: triaged, not implemented due compatibility risk.</li><li>What was found: <ul><li>Runtime still maps unknown models to Sonnet 4.5 fallback.</li><li>Removing/deprecating 4.5 from surfaced panel/model fallback likely requires coordinated migration and rollout guardrails.</li></ul></li><li>Lane action: <ul><li>No code change.</li></ul></li><li>Evidence: <ul><li><code>pkg/llmproxy/runtime/executor/kiro_executor.go:1653-1655</code></li></ul></li></ul><h3 id="cpb-0094-gemini-incorrect-renaming-of-parameters-parametersjsonschema" tabindex="-1">CPB-0094 - <code>Gemini incorrect renaming of parameters -&gt; parametersJsonSchema</code> <a class="header-anchor" href="#cpb-0094-gemini-incorrect-renaming-of-parameters-parametersjsonschema" aria-label="Permalink to &quot;CPB-0094 - `Gemini incorrect renaming of parameters -&gt; parametersJsonSchema`&quot;">​</a></h3><ul><li>Status: triaged as already covered with regression tests.</li><li>What was found: <ul><li>Existing executor regression tests assert <code>parametersJsonSchema</code> is renamed to <code>parameters</code> in request build path.</li></ul></li><li>Lane action: <ul><li>No code change.</li></ul></li><li>Evidence: <ul><li><code>pkg/llmproxy/executor/antigravity_executor_buildrequest_test.go:16-18</code></li><li><code>go test ./pkg/llmproxy/runtime/executor -run &#39;AntigravityExecutorBuildRequest&#39; -count=1</code> -&gt; <code>ok</code></li></ul></li></ul><h3 id="cpb-0095-codex-返回-unsupported-parameter-response-format" tabindex="-1">CPB-0095 - <code>codex 返回 Unsupported parameter: response_format</code> <a class="header-anchor" href="#cpb-0095-codex-返回-unsupported-parameter-response-format" aria-label="Permalink to &quot;CPB-0095 - `codex 返回 Unsupported parameter: response_format`&quot;">​</a></h3><ul><li>Status: quick-win hardening completed (regression lock).</li><li>What was found: <ul><li>Translator already maps OpenAI <code>response_format</code> to Codex Responses <code>text.format</code>.</li><li>Missing direct regression test in this file for the exact unsupported-parameter shape.</li></ul></li><li>Safe fix implemented: <ul><li>Added test verifying output payload does not contain <code>response_format</code>, and correctly contains <code>text.format</code> fields.</li></ul></li><li>Changed files: <ul><li><code>pkg/llmproxy/translator/codex/openai/chat-completions/codex_openai_request_test.go</code></li></ul></li><li>Evidence: <ul><li>Mapping code: <code>pkg/llmproxy/translator/codex/openai/chat-completions/codex_openai_request.go:228-253</code></li><li>New test: <code>pkg/llmproxy/translator/codex/openai/chat-completions/codex_openai_request_test.go:160-198</code></li></ul></li></ul><h2 id="test-evidence" tabindex="-1">Test Evidence <a class="header-anchor" href="#test-evidence" aria-label="Permalink to &quot;Test Evidence&quot;">​</a></h2><p>Commands run (focused):</p><ol><li><code>go test ./pkg/llmproxy/logging -run &#39;LogDir|EnforceLogDirSizeLimit&#39; -count=1</code></li></ol><ul><li>Result: <code>ok github.com/router-for-me/CLIProxyAPI/v6/pkg/llmproxy/logging 4.628s</code></li></ul><ol start="2"><li><code>go test ./pkg/llmproxy/translator/codex/openai/chat-completions -run &#39;ConvertOpenAIRequestToCodex|ResponseFormat&#39; -count=1</code></li></ol><ul><li>Result: <code>ok github.com/router-for-me/CLIProxyAPI/v6/pkg/llmproxy/translator/codex/openai/chat-completions 1.869s</code></li></ul><ol start="3"><li><code>go test ./pkg/llmproxy/runtime/executor -run &#39;AntigravityExecutorBuildRequest|KiroExecutor_MapModelToKiro&#39; -count=1</code></li></ol><ul><li>Result: <code>ok github.com/router-for-me/CLIProxyAPI/v6/pkg/llmproxy/runtime/executor 1.172s</code></li></ul><ol start="4"><li><code>go test ./pkg/llmproxy/auth/qwen -count=1</code></li></ol><ul><li>Result: <code>ok github.com/router-for-me/CLIProxyAPI/v6/pkg/llmproxy/auth/qwen 0.730s</code></li></ul><ol start="5"><li><code>go test ./pkg/llmproxy/config -run &#39;OAuthModelAlias&#39; -count=1</code></li></ol><ul><li>Result: <code>ok github.com/router-for-me/CLIProxyAPI/v6/pkg/llmproxy/config 0.869s</code></li></ul><h2 id="files-changed-in-lane-6" tabindex="-1">Files Changed In Lane 6 <a class="header-anchor" href="#files-changed-in-lane-6" aria-label="Permalink to &quot;Files Changed In Lane 6&quot;">​</a></h2><ul><li><code>pkg/llmproxy/logging/log_dir_cleaner.go</code></li><li><code>pkg/llmproxy/logging/log_dir_cleaner_test.go</code></li><li><code>pkg/llmproxy/translator/codex/openai/chat-completions/codex_openai_request_test.go</code></li><li><code>docs/planning/reports/issue-wave-cpb-0036-0105-lane-6.md</code></li></ul>',40)])])}const g=o(t,[["render",r]]);export{m as __pageData,g as default};
