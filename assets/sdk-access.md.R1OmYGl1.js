import{_ as i,o as a,c as e,ag as n}from"./chunks/framework.DM0yugQT.js";const c=JSON.parse('{"title":"@sdk/access SDK Reference","description":"","frontmatter":{},"headers":[],"relativePath":"sdk-access.md","filePath":"sdk-access.md","lastUpdated":1771875003000}'),t={name:"sdk-access.md"};function h(l,s,r,p,k,d){return a(),e("div",null,[...s[0]||(s[0]=[n(`<h1 id="sdk-access-sdk-reference" tabindex="-1">@sdk/access SDK Reference <a class="header-anchor" href="#sdk-access-sdk-reference" aria-label="Permalink to &quot;@sdk/access SDK Reference&quot;">​</a></h1><p>The <code>github.com/router-for-me/CLIProxyAPI/v6/sdk/access</code> package centralizes inbound request authentication for the proxy. It offers a lightweight manager that chains credential providers, so servers can reuse the same access control logic inside or outside the CLI runtime.</p><h2 id="importing" tabindex="-1">Importing <a class="header-anchor" href="#importing" aria-label="Permalink to &quot;Importing&quot;">​</a></h2><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sdkaccess </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/router-for-me/CLIProxyAPI/v6/sdk/access</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Add the module with <code>go get github.com/router-for-me/CLIProxyAPI/v6/sdk/access</code>.</p><h2 id="provider-registry" tabindex="-1">Provider Registry <a class="header-anchor" href="#provider-registry" aria-label="Permalink to &quot;Provider Registry&quot;">​</a></h2><p>Providers are registered globally and then attached to a <code>Manager</code> as a snapshot:</p><ul><li><code>RegisterProvider(type, provider)</code> installs a pre-initialized provider instance.</li><li>Registration order is preserved the first time each <code>type</code> is seen.</li><li><code>RegisteredProviders()</code> returns the providers in that order.</li></ul><h2 id="manager-lifecycle" tabindex="-1">Manager Lifecycle <a class="header-anchor" href="#manager-lifecycle" aria-label="Permalink to &quot;Manager Lifecycle&quot;">​</a></h2><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">manager </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sdkaccess.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NewManager</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">manager.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SetProviders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sdkaccess.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RegisteredProviders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span></code></pre></div><ul><li><code>NewManager</code> constructs an empty manager.</li><li><code>SetProviders</code> replaces the provider slice using a defensive copy.</li><li><code>Providers</code> retrieves a snapshot that can be iterated safely from other goroutines.</li></ul><p>If the manager itself is <code>nil</code> or no providers are configured, the call returns <code>nil, nil</code>, allowing callers to treat access control as disabled.</p><h2 id="authenticating-requests" tabindex="-1">Authenticating Requests <a class="header-anchor" href="#authenticating-requests" aria-label="Permalink to &quot;Authenticating Requests&quot;">​</a></h2><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result, authErr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> manager.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Authenticate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, req)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">switch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> authErr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Authentication succeeded; result describes the provider and principal.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sdkaccess.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IsAuthErrorCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(authErr, sdkaccess.AuthErrorCodeNoCredentials):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // No recognizable credentials were supplied.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sdkaccess.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IsAuthErrorCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(authErr, sdkaccess.AuthErrorCodeInvalidCredential):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Supplied credentials were present but rejected.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Internal/transport failure was returned by a provider.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><code>Manager.Authenticate</code> walks the configured providers in order. It returns on the first success, skips providers that return <code>AuthErrorCodeNotHandled</code>, and aggregates <code>AuthErrorCodeNoCredentials</code> / <code>AuthErrorCodeInvalidCredential</code> for a final result.</p><p>Each <code>Result</code> includes the provider identifier, the resolved principal, and optional metadata (for example, which header carried the credential).</p><h2 id="built-in-config-api-key-provider" tabindex="-1">Built-in <code>config-api-key</code> Provider <a class="header-anchor" href="#built-in-config-api-key-provider" aria-label="Permalink to &quot;Built-in \`config-api-key\` Provider&quot;">​</a></h2><p>The proxy includes one built-in access provider:</p><ul><li><code>config-api-key</code>: Validates API keys declared under top-level <code>api-keys</code>. <ul><li>Credential sources: <code>Authorization: Bearer</code>, <code>X-Goog-Api-Key</code>, <code>X-Api-Key</code>, <code>?key=</code>, <code>?auth_token=</code></li><li>Metadata: <code>Result.Metadata[&quot;source&quot;]</code> is set to the matched source label.</li></ul></li></ul><p>In the CLI server and <code>sdk/cliproxy</code>, this provider is registered automatically based on the loaded configuration.</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">api-keys</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">sk-test-123</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">sk-prod-456</span></span></code></pre></div><h2 id="loading-providers-from-external-go-modules" tabindex="-1">Loading Providers from External Go Modules <a class="header-anchor" href="#loading-providers-from-external-go-modules" aria-label="Permalink to &quot;Loading Providers from External Go Modules&quot;">​</a></h2><p>To consume a provider shipped in another Go module, import it for its registration side effect:</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    _ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/acme/xplatform/sdk/access/providers/partner</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // registers partner-token</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sdkaccess </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/router-for-me/CLIProxyAPI/v6/sdk/access</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>The blank identifier import ensures <code>init</code> runs so <code>sdkaccess.RegisterProvider</code> executes before you call <code>RegisteredProviders()</code> (or before <code>cliproxy.NewBuilder().Build()</code>).</p><h3 id="metadata-and-auditing" tabindex="-1">Metadata and auditing <a class="header-anchor" href="#metadata-and-auditing" aria-label="Permalink to &quot;Metadata and auditing&quot;">​</a></h3><p><code>Result.Metadata</code> carries provider-specific context. The built-in <code>config-api-key</code> provider, for example, stores the credential source (<code>authorization</code>, <code>x-goog-api-key</code>, <code>x-api-key</code>, <code>query-key</code>, <code>query-auth-token</code>). Populate this map in custom providers to enrich logs and downstream auditing.</p><h2 id="writing-custom-providers" tabindex="-1">Writing Custom Providers <a class="header-anchor" href="#writing-custom-providers" aria-label="Permalink to &quot;Writing Custom Providers&quot;">​</a></h2><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> customProvider</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">customProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Identifier</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;my-provider&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">customProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Authenticate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sdkaccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sdkaccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AuthError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    token </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r.Header.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;X-Custom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> token </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, sdkaccess.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NewNotHandledError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> token </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;expected&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, sdkaccess.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NewInvalidCredentialError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sdkaccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Provider:  p.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Identifier</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Principal: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;service-user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Metadata:  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;source&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;x-custom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sdkaccess.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RegisterProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;custom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">customProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>A provider must implement <code>Identifier()</code> and <code>Authenticate()</code>. To make it available to the access manager, call <code>RegisterProvider</code> inside <code>init</code> with an initialized provider instance.</p><h2 id="error-semantics" tabindex="-1">Error Semantics <a class="header-anchor" href="#error-semantics" aria-label="Permalink to &quot;Error Semantics&quot;">​</a></h2><ul><li><code>NewNoCredentialsError()</code> (<code>AuthErrorCodeNoCredentials</code>): no credentials were present or recognized. (HTTP 401)</li><li><code>NewInvalidCredentialError()</code> (<code>AuthErrorCodeInvalidCredential</code>): credentials were present but rejected. (HTTP 401)</li><li><code>NewNotHandledError()</code> (<code>AuthErrorCodeNotHandled</code>): fall through to the next provider.</li><li><code>NewInternalAuthError(message, cause)</code> (<code>AuthErrorCodeInternal</code>): transport/system failure. (HTTP 500)</li></ul><p>Errors propagate immediately to the caller unless they are classified as <code>not_handled</code> / <code>no_credentials</code> / <code>invalid_credential</code> and can be aggregated by the manager.</p><h2 id="integration-with-cliproxy-service" tabindex="-1">Integration with cliproxy Service <a class="header-anchor" href="#integration-with-cliproxy-service" aria-label="Permalink to &quot;Integration with cliproxy Service&quot;">​</a></h2><p><code>sdk/cliproxy</code> wires <code>@sdk/access</code> automatically when you build a CLI service via <code>cliproxy.NewBuilder</code>. Supplying a manager lets you reuse the same instance in your host process:</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">coreCfg, _ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> config.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LoadConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;config.yaml&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">accessManager </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sdkaccess.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NewManager</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">svc, _ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cliproxy.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NewBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  WithConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(coreCfg).</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  WithConfigPath</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;config.yaml&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  WithRequestAccessManager</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(accessManager).</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div><p>Register any custom providers (typically via blank imports) before calling <code>Build()</code> so they are present in the global registry snapshot.</p><h3 id="hot-reloading" tabindex="-1">Hot reloading <a class="header-anchor" href="#hot-reloading" aria-label="Permalink to &quot;Hot reloading&quot;">​</a></h3><p>When configuration changes, refresh any config-backed providers and then reset the manager&#39;s provider chain:</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// configaccess is github.com/router-for-me/CLIProxyAPI/v6/internal/access/config_access</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">configaccess.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">newCfg.SDKConfig)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">accessManager.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SetProviders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sdkaccess.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RegisteredProviders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span></code></pre></div><p>This mirrors the behaviour in <code>internal/access.ApplyAccessProviders</code>, enabling runtime updates without restarting the process.</p>`,41)])])}const E=i(t,[["render",h]]);export{c as __pageData,E as default};
