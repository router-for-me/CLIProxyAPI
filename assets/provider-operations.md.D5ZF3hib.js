import{_ as i,o,c as a,ag as t}from"./chunks/framework.DM0yugQT.js";const h=JSON.parse('{"title":"Provider Operations Runbook","description":"","frontmatter":{},"headers":[],"relativePath":"provider-operations.md","filePath":"provider-operations.md","lastUpdated":1771881719000}'),l={name:"provider-operations.md"};function r(s,e,n,d,c,u){return o(),a("div",null,[...e[0]||(e[0]=[t('<h1 id="provider-operations-runbook" tabindex="-1">Provider Operations Runbook <a class="header-anchor" href="#provider-operations-runbook" aria-label="Permalink to &quot;Provider Operations Runbook&quot;">​</a></h1><p>This runbook is for operators who care about provider uptime, quota health, and routing quality.</p><h2 id="daily-checks" tabindex="-1">Daily Checks <a class="header-anchor" href="#daily-checks" aria-label="Permalink to &quot;Daily Checks&quot;">​</a></h2><ol><li>Health check: <ul><li><code>curl -sS http://localhost:8317/health</code></li></ul></li><li>Model inventory: <ul><li><code>curl -sS http://localhost:8317/v1/models -H &quot;Authorization: Bearer &lt;api-key&gt;&quot; | jq &#39;.data | length&#39;</code></li></ul></li><li>Provider metrics: <ul><li><code>curl -sS http://localhost:8317/v1/metrics/providers | jq</code></li></ul></li><li>Log scan: <ul><li>Verify no sustained bursts of <code>401</code>, <code>403</code>, or <code>429</code>.</li></ul></li><li>Spark eligibility check (Copilot/Codex): <ul><li><code>curl -sS http://localhost:8317/v1/models -H &quot;Authorization: Bearer &lt;api-key&gt;&quot; | jq -r &#39;.data[].id&#39; | rg &#39;gpt-5.3-codex|gpt-5.3-codex-spark&#39;</code></li></ul></li></ol><h2 id="quota-visibility-146-scope" tabindex="-1">Quota Visibility (<code>#146</code> scope) <a class="header-anchor" href="#quota-visibility-146-scope" aria-label="Permalink to &quot;Quota Visibility (`#146` scope)&quot;">​</a></h2><ul><li>Current operational source of truth: <ul><li><code>v1/metrics/providers</code></li><li>Management auth snapshots (<code>/v0/management/auth-files</code>)</li><li>Kiro quota snapshot endpoint: <code>/v0/management/kiro-quota</code> (includes <code>remaining_quota</code>, <code>usage_percentage</code>, <code>quota_exhausted</code>)</li></ul></li><li>Treat repeated <code>429</code> + falling success ratio as quota pressure and rotate capacity accordingly.</li></ul><h3 id="kiro-remaining-quota-probe" tabindex="-1">Kiro Remaining Quota Probe <a class="header-anchor" href="#kiro-remaining-quota-probe" aria-label="Permalink to &quot;Kiro Remaining Quota Probe&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AUTH_KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;replace-with-management-secret&quot;</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8317/v0/management/kiro-quota</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$AUTH_KEY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> jq</span></span></code></pre></div><p>If multiple Kiro credentials exist, map and query by index:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8317/v0/management/auth-files</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$AUTH_KEY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> jq</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;.[] | .auth_index</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> // .index&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://localhost:8317/v0/management/kiro-quota?auth_index=&lt;auth-index&gt;&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$AUTH_KEY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> jq</span></span></code></pre></div><p>Suggested alert policy:</p><ul><li>Warn: any credential returns <code>quota_exhausted=true</code>.</li><li>Warn: <code>429</code> ratio &gt; 5% over 10 minutes.</li><li>Critical: <code>429</code> ratio &gt; 10% over 10 minutes OR steady <code>quota_exhausted=true</code> across top 2 providers.</li><li>Action: enable fallback toggles and rotate to alternate credentials: <ul><li><code>quota-exceeded.switch-project=true</code></li><li><code>quota-exceeded.switch-preview-model=true</code></li></ul></li></ul><h2 id="onboard-a-new-provider" tabindex="-1">Onboard a New Provider <a class="header-anchor" href="#onboard-a-new-provider" aria-label="Permalink to &quot;Onboard a New Provider&quot;">​</a></h2><ol><li>Add provider block in <code>config.yaml</code> (<code>openai-compatibility</code> preferred for OpenAI-style upstreams).</li><li>Add <code>prefix</code> for tenant/workload isolation.</li><li>Add <code>models</code> aliases for client-stable names.</li><li>Validate <code>/v1/models</code> output includes expected IDs.</li><li>Run canary request through the new prefix.</li><li>Monitor <code>v1/metrics/providers</code> for 10-15 minutes before production traffic.</li></ol><h2 id="rotation-and-quota-strategy" tabindex="-1">Rotation and Quota Strategy <a class="header-anchor" href="#rotation-and-quota-strategy" aria-label="Permalink to &quot;Rotation and Quota Strategy&quot;">​</a></h2><ul><li>Configure multiple credentials per provider where supported.</li><li>Keep at least one alternate provider for each critical workload class.</li><li>Use prefixes to separate high-priority traffic from best-effort traffic.</li><li>If one provider is degraded, reroute by updating model prefix policy and aliases.</li></ul><h2 id="incident-playbooks" tabindex="-1">Incident Playbooks <a class="header-anchor" href="#incident-playbooks" aria-label="Permalink to &quot;Incident Playbooks&quot;">​</a></h2><h3 id="repeated-401-403" tabindex="-1">Repeated <code>401/403</code> <a class="header-anchor" href="#repeated-401-403" aria-label="Permalink to &quot;Repeated `401/403`&quot;">​</a></h3><ul><li>Recheck credential validity and token freshness.</li><li>For OAuth providers (<code>kiro</code>, <code>cursor</code>, <code>minimax</code>, <code>roo</code>), verify token files and refresh path.</li><li>Confirm client is hitting intended provider prefix.</li></ul><h3 id="repeated-429" tabindex="-1">Repeated <code>429</code> <a class="header-anchor" href="#repeated-429" aria-label="Permalink to &quot;Repeated `429`&quot;">​</a></h3><ul><li>Add capacity (extra keys/providers) or reduce concurrency.</li><li>Shift traffic to fallback provider prefix.</li><li>Tighten expensive-model exposure with <code>excluded-models</code>.</li></ul><h3 id="wrong-provider-selected" tabindex="-1">Wrong Provider Selected <a class="header-anchor" href="#wrong-provider-selected" aria-label="Permalink to &quot;Wrong Provider Selected&quot;">​</a></h3><ul><li>Inspect <code>force-model-prefix</code> and model naming in requests.</li><li>Verify alias collisions across provider blocks.</li><li>Prefer explicit <code>prefix/model</code> calls for sensitive workloads.</li></ul><h3 id="missing-models-in-v1-models" tabindex="-1">Missing Models in <code>/v1/models</code> <a class="header-anchor" href="#missing-models-in-v1-models" aria-label="Permalink to &quot;Missing Models in `/v1/models`&quot;">​</a></h3><ul><li>Confirm provider block is enabled and auth loaded.</li><li>Check model filters (<code>models</code>, <code>excluded-models</code>) and prefix constraints.</li><li>Verify upstream provider currently serves requested model.</li></ul><h3 id="tool-result-image-translation-regressions" tabindex="-1">Tool-Result Image Translation Regressions <a class="header-anchor" href="#tool-result-image-translation-regressions" aria-label="Permalink to &quot;Tool-Result Image Translation Regressions&quot;">​</a></h3><ul><li>Symptom pattern: tool responses containing image blocks fail after translation between OpenAI-compatible and Claude-style payloads.</li><li>First checks: <ul><li>Reproduce with a non-stream request and compare with stream behavior.</li><li>Inspect request/response logs for payload-shape mismatches around <code>tool_result</code> + image content blocks.</li></ul></li><li>Operational response: <ul><li>Keep one canary scenario that includes image content in tool results.</li><li>Alert when canary success rate drops or <code>4xx</code> translation errors spike for that scenario.</li><li>Route impacted traffic to a known-good provider prefix while triaging translator output.</li></ul></li></ul><h3 id="stream-non-stream-usage-parity-check" tabindex="-1">Stream/Non-Stream Usage Parity Check <a class="header-anchor" href="#stream-non-stream-usage-parity-check" aria-label="Permalink to &quot;Stream/Non-Stream Usage Parity Check&quot;">​</a></h3><ul><li>Goal: confirm token usage fields are consistent between stream and non-stream responses for the same prompt.</li><li>Commands: <ul><li>Non-stream: <ul><li><code>curl -sS http://localhost:8317/v1/responses -H &quot;Authorization: Bearer &lt;api-key&gt;&quot; -H &quot;Content-Type: application/json&quot; -d &#39;{&quot;model&quot;:&quot;gpt-5.1-codex&quot;,&quot;input&quot;:[{&quot;role&quot;:&quot;user&quot;,&quot;content&quot;:&quot;ping&quot;}],&quot;stream&quot;:false}&#39; | tee /tmp/nonstream.json | jq &#39;{input_tokens: .usage.input_tokens, output_tokens: .usage.output_tokens, total_tokens: .usage.total_tokens}&#39;</code></li></ul></li><li>Stream (extract terminal usage event): <ul><li><code>curl -sN http://localhost:8317/v1/responses -H &quot;Authorization: Bearer &lt;api-key&gt;&quot; -H &quot;Content-Type: application/json&quot; -d &#39;{&quot;model&quot;:&quot;gpt-5.1-codex&quot;,&quot;input&quot;:[{&quot;role&quot;:&quot;user&quot;,&quot;content&quot;:&quot;ping&quot;}],&quot;stream&quot;:true}&#39; | rg &#39;^data:&#39; | sed &#39;s/^data: //&#39; | jq -c &#39;select(.usage? != null) | {input_tokens: (.usage.input_tokens // .usage.prompt_tokens), output_tokens: (.usage.output_tokens // .usage.completion_tokens), total_tokens: .usage.total_tokens}&#39; | tail -n 1 | tee /tmp/stream-usage.json</code></li></ul></li><li>Compare: <ul><li><code>diff -u &lt;(jq -S . /tmp/nonstream.json | jq &#39;{input_tokens: .usage.input_tokens, output_tokens: .usage.output_tokens, total_tokens: .usage.total_tokens}&#39;) &lt;(jq -S . /tmp/stream-usage.json)</code></li></ul></li></ul></li><li>Pass criteria: <ul><li><code>diff</code> is empty, or any difference is explainable by provider-side truncation/stream interruption.</li></ul></li></ul><h3 id="iflow-oauth-model-visibility-is-narrower-than-expected" tabindex="-1">iFlow OAuth model visibility is narrower than expected <a class="header-anchor" href="#iflow-oauth-model-visibility-is-narrower-than-expected" aria-label="Permalink to &quot;iFlow OAuth model visibility is narrower than expected&quot;">​</a></h3><ul><li>Symptom: login/auth succeeds, but only a subset of <code>iflow/*</code> models appear or work.</li><li>Immediate checks: <ul><li><code>curl -sS http://localhost:8317/v1/models -H &quot;Authorization: Bearer &lt;api-key&gt;&quot; | jq -r &#39;.data[].id&#39; | rg &#39;^iflow/&#39;</code></li><li>Validate request model is exactly one of the exposed IDs.</li></ul></li><li>Mitigation: <ul><li>Do not assume upstream catalog parity after OAuth login.</li><li>Keep a known-good iFlow canary model and gate rollout on successful canary responses.</li></ul></li></ul><h3 id="iflow-account-errors-shown-in-terminal" tabindex="-1">iFlow account errors shown in terminal <a class="header-anchor" href="#iflow-account-errors-shown-in-terminal" aria-label="Permalink to &quot;iFlow account errors shown in terminal&quot;">​</a></h3><ul><li>Symptom: terminal output shows account-level iFlow errors but requests keep retrying noisily.</li><li>Immediate checks: <ul><li><code>rg -n &quot;iflow|account|retry|cooldown|429|403&quot; logs/*.log</code></li><li><code>curl -sS http://localhost:8317/v1/metrics/providers | jq &#39;.iflow // .providers.iflow&#39;</code></li></ul></li><li>Mitigation: <ul><li>Alert on sustained iFlow error-rate spikes (&gt;5% over 10m).</li><li>Keep one known-good iFlow canary request in non-stream mode.</li><li>Rotate traffic away from iFlow prefix when account-level failures persist beyond cooldown windows.</li></ul></li></ul><h3 id="usage-dashboard-shows-zeros-under-load" tabindex="-1">Usage dashboard shows zeros under load <a class="header-anchor" href="#usage-dashboard-shows-zeros-under-load" aria-label="Permalink to &quot;Usage dashboard shows zeros under load&quot;">​</a></h3><ul><li>Symptom: traffic volume rises but usage counters remain <code>0</code>.</li><li>Immediate checks: <ul><li>Run one non-stream and one stream request against the same model and compare emitted usage fields/log lines.</li><li>Verify provider metrics endpoint still records request/error activity.</li></ul></li><li>Mitigation: <ul><li>Treat missing upstream usage as a provider payload gap, not a transport success signal.</li><li>Keep stream/non-stream parity probes in pre-release checks.</li></ul></li></ul><h3 id="antigravity-cla-cli-support-matrix-cpb-0743" tabindex="-1">Antigravity / CLA CLI support matrix (<code>CPB-0743</code>) <a class="header-anchor" href="#antigravity-cla-cli-support-matrix-cpb-0743" aria-label="Permalink to &quot;Antigravity / CLA CLI support matrix (`CPB-0743`)&quot;">​</a></h3><ul><li>Symptom: <code>antigravity</code> clients intermittently produce empty payloads or different behavior between <code>antigravity-cli</code> and CLIProxyAPI Plus front-end calls.</li><li>Immediate checks: <ul><li>Confirm model coverage: <ul><li><code>curl -sS http://localhost:8317/v1/models -H &quot;Authorization: Bearer &lt;api-key&gt;&quot; | jq -r &#39;.data[].id&#39; | rg &#39;^antigravity/&#39;</code></li></ul></li><li>Confirm supported CLI client class: <ul><li><code>curl -sS http://localhost:8317/v0/management/config -H &quot;Authorization: Bearer &lt;management-secret&gt;&quot; | jq &#39;.providers[] | select(.name==\\&quot;antigravity\\&quot;) | .supported_clients&#39;</code></li></ul></li><li>Confirm request translation path in logs: <ul><li><code>rg -n &quot;antigravity|claude|tool_use|custom_model|request.*model&quot; logs/*.log</code></li></ul></li></ul></li><li>Suggested matrix checks: <ul><li><code>antigravity-cli</code> should map to supported auth-backed model IDs.</li><li>Provider alias mode should keep aliases explicit in <code>/v1/models</code>.</li><li>Tool/callback-heavy workloads should pass through without dropping <code>tool_use</code> boundaries.</li></ul></li><li>Mitigation: <ul><li>If parity is missing, align source request to provider-native model IDs and re-check with a non-stream request first.</li><li>Route unsupported workloads through mapped aliases using <code>ampcode.model-mappings</code> and document temporary exclusion.</li><li>Keep a canary for each supported <code>antigravity/*</code> model with 10-minute trend windows.</li></ul></li></ul><h3 id="copilot-spark-mismatch-gpt-5-3-codex-spark" tabindex="-1">Copilot Spark Mismatch (<code>gpt-5.3-codex-spark</code>) <a class="header-anchor" href="#copilot-spark-mismatch-gpt-5-3-codex-spark" aria-label="Permalink to &quot;Copilot Spark Mismatch (`gpt-5.3-codex-spark`)&quot;">​</a></h3><ul><li>Symptom: plus/team users get <code>400/404 model_not_found</code> for <code>gpt-5.3-codex-spark</code>.</li><li>Immediate action: <ul><li>Confirm presence in <code>GET /v1/models</code> for the exact client API key.</li><li>If absent, route workloads to <code>gpt-5.3-codex</code> and keep Spark disabled for that segment.</li></ul></li><li>Suggested alert thresholds: <ul><li>Warn: Spark error ratio &gt; 2% over 10 minutes.</li><li>Critical: Spark error ratio &gt; 5% over 10 minutes.</li><li>Auto-mitigation: fallback alias to <code>gpt-5.3-codex</code> when critical threshold is crossed.</li></ul></li></ul><h3 id="codex-5-3-integration-path-non-subprocess-first" tabindex="-1">Codex 5.3 integration path (non-subprocess first) <a class="header-anchor" href="#codex-5-3-integration-path-non-subprocess-first" aria-label="Permalink to &quot;Codex 5.3 integration path (non-subprocess first)&quot;">​</a></h3><ul><li>Preferred path: <ul><li>Embed via <code>sdk/cliproxy</code> when the caller owns the runtime process.</li></ul></li><li>HTTP fallback path: <ul><li>Use <code>/v1/*</code> only when crossing process boundaries.</li></ul></li><li>Negotiation checks: <ul><li>Probe <code>/health</code> and <code>/v1/models</code> before enabling codex5.3-specific flows.</li><li>Gate advanced behavior on observed model exposure (<code>gpt-5.3-codex</code>, <code>gpt-5.3-codex-spark</code>).</li></ul></li></ul><h3 id="amp-traffic-does-not-route-through-cliproxyapi" tabindex="-1">Amp traffic does not route through CLIProxyAPI <a class="header-anchor" href="#amp-traffic-does-not-route-through-cliproxyapi" aria-label="Permalink to &quot;Amp traffic does not route through CLIProxyAPI&quot;">​</a></h3><ul><li>Symptom: Amp appears to call upstream directly and proxy logs remain idle.</li><li>Immediate checks: <ul><li>Ensure Amp process has <code>OPENAI_API_BASE=http://127.0.0.1:8317/v1</code>.</li><li>Ensure Amp process has <code>OPENAI_API_KEY=&lt;client-key&gt;</code>.</li><li>Run one direct canary request with identical env and confirm it appears in proxy logs.</li></ul></li><li>Mitigation: <ul><li>Standardize Amp launch wrappers to export proxy env explicitly.</li><li>Add startup validation that fails early when base URL does not target CLIProxyAPI.</li></ul></li></ul><h3 id="windows-duplicate-auth-file-display-safeguards" tabindex="-1">Windows duplicate auth-file display safeguards <a class="header-anchor" href="#windows-duplicate-auth-file-display-safeguards" aria-label="Permalink to &quot;Windows duplicate auth-file display safeguards&quot;">​</a></h3><ul><li>Symptom: auth records appear duplicated in management/UI surfaces on Windows.</li><li>Immediate checks: <ul><li>Confirm auth filename normalization output is stable across refresh/reload cycles.</li><li><code>curl -sS http://localhost:8317/v0/management/auth-files -H &quot;X-Management-Secret: &lt;secret&gt;&quot; | jq &#39;.[].filename&#39; | sort | uniq -c</code></li></ul></li><li>Rollout safety: <ul><li>Gate deployments with one Windows canary that performs add -&gt; refresh -&gt; list -&gt; restart -&gt; list.</li><li>Block promotion when duplicate filename count changes after restart.</li></ul></li></ul><h3 id="metadata-naming-conventions-for-provider-quota-refresh-commands" tabindex="-1">Metadata naming conventions for provider quota/refresh commands <a class="header-anchor" href="#metadata-naming-conventions-for-provider-quota-refresh-commands" aria-label="Permalink to &quot;Metadata naming conventions for provider quota/refresh commands&quot;">​</a></h3><p>Use consistent names across docs, APIs, and operator runbooks:</p><ul><li><code>provider_key</code></li><li><code>model_id</code></li><li><code>quota_remaining</code></li><li><code>quota_reset_seconds</code></li><li><code>refresh_state</code></li></ul><p>Avoid per-tool aliases for these fields in ops docs to keep telemetry queries deterministic.</p><h3 id="truenas-apprise-notification-dx-checks" tabindex="-1">TrueNAS Apprise notification DX checks <a class="header-anchor" href="#truenas-apprise-notification-dx-checks" aria-label="Permalink to &quot;TrueNAS Apprise notification DX checks&quot;">​</a></h3><ul><li>Validate target endpoint formatting before enabling alerts: <ul><li><code>apprise -vv --dry-run &quot;&lt;apprise-url&gt;&quot;</code></li></ul></li><li>Send one canary alert for routing incidents: <ul><li><code>apprise &quot;&lt;apprise-url&gt;&quot; -t &quot;cliproxy canary&quot; -b &quot;provider routing notification check&quot;</code></li></ul></li><li>Keep this notification path non-blocking for request handling; alerts should not gate proxy response paths.</li></ul><h3 id="gemini-thinking-length-control-drift-openai-compatible-clients" tabindex="-1">Gemini thinking-length control drift (OpenAI-compatible clients) <a class="header-anchor" href="#gemini-thinking-length-control-drift-openai-compatible-clients" aria-label="Permalink to &quot;Gemini thinking-length control drift (OpenAI-compatible clients)&quot;">​</a></h3><ul><li>Symptom: client requests a specific thinking level/budget but observed behavior looks unbounded or unchanged.</li><li>Immediate checks: <ul><li>Inspect request/response pair and compare with runtime debug lines: <ul><li><code>thinking: original config from request</code></li><li><code>thinking: processed config to apply</code></li></ul></li><li>Confirm requested model and its thinking-capable alias are exposed in <code>/v1/models</code>.</li></ul></li><li>Suggested alert thresholds: <ul><li>Warn: processed thinking mode mismatch ratio &gt; 2% over 10 minutes.</li><li>Critical: processed thinking mode mismatch ratio &gt; 5% over 10 minutes.</li><li>Warn: reasoning token growth &gt; 25% above baseline for fixed-thinking workloads over 10 minutes.</li></ul></li><li>Mitigation: <ul><li>Force explicit thinking-capable model alias for affected workloads.</li><li>Reduce rollout blast radius by pinning the model suffix/level per workload class.</li><li>Keep one non-stream and one stream canary for each affected client integration.</li></ul></li></ul><h2 id="recommended-production-pattern" tabindex="-1">Recommended Production Pattern <a class="header-anchor" href="#recommended-production-pattern" aria-label="Permalink to &quot;Recommended Production Pattern&quot;">​</a></h2><ol><li>One direct primary provider for latency-critical traffic.</li><li>One aggregator fallback provider for model breadth.</li><li>Prefix-based routing policy per workload class.</li><li>Metrics and alerting tied to error ratio, latency, and provider availability.</li></ol><h2 id="related-docs" tabindex="-1">Related Docs <a class="header-anchor" href="#related-docs" aria-label="Permalink to &quot;Related Docs&quot;">​</a></h2><ul><li><a href="/provider-catalog">Provider Catalog</a></li><li><a href="/provider-usage">Provider Usage</a></li><li><a href="/routing-reference">Routing and Models Reference</a></li><li><a href="/troubleshooting">Troubleshooting</a></li></ul>',57)])])}const m=i(l,[["render",r]]);export{h as __pageData,m as default};
