import{_ as i,o as s,c as a,ag as t}from"./chunks/framework.DM0yugQT.js";const k=JSON.parse('{"title":"Kiro IDC Refresh Rollout Checklist","description":"","frontmatter":{},"headers":[],"relativePath":"operations/kiro-idc-refresh-rollout.md","filePath":"operations/kiro-idc-refresh-rollout.md","lastUpdated":1771844450000}'),o={name:"operations/kiro-idc-refresh-rollout.md"};function l(n,e,r,h,d,c){return s(),a("div",null,[...e[0]||(e[0]=[t(`<h1 id="kiro-idc-refresh-rollout-checklist" tabindex="-1">Kiro IDC Refresh Rollout Checklist <a class="header-anchor" href="#kiro-idc-refresh-rollout-checklist" aria-label="Permalink to &quot;Kiro IDC Refresh Rollout Checklist&quot;">​</a></h1><p>Scope: CP2K-0039 (<code>#136</code> follow-up).</p><p>This guide is for safe rollout of Kiro IDC refresh behavior and compatibility checks.</p><h2 id="rollout-flags-and-switches" tabindex="-1">Rollout Flags and Switches <a class="header-anchor" href="#rollout-flags-and-switches" aria-label="Permalink to &quot;Rollout Flags and Switches&quot;">​</a></h2><ul><li><code>debug: true</code> during canary only; disable after verification.</li><li><code>request-retry</code>: keep bounded retry count to avoid repeated refresh storms.</li><li><code>max-retry-interval</code>: keep retry backoff capped for faster recovery visibility.</li><li><code>remote-management.secret-key</code>: must be set so refresh/status routes are callable.</li></ul><h2 id="migration-sequence" tabindex="-1">Migration Sequence <a class="header-anchor" href="#migration-sequence" aria-label="Permalink to &quot;Migration Sequence&quot;">​</a></h2><ol><li>Canary one environment with <code>debug: true</code>.</li><li>Trigger provider refresh: <code>POST /v0/management/auths/kiro/refresh</code>.</li><li>Confirm token file fields: <code>auth_method</code>, <code>client_id</code>, <code>client_secret</code>, <code>region</code>, <code>refresh_token</code>, <code>expires_at</code>.</li><li>Run one non-stream <code>/v1/chat/completions</code> canary request.</li><li>Run one stream canary request and compare response lifecycle.</li><li>Disable extra debug logging and proceed to broader rollout.</li></ol><h2 id="backward-compatibility-expectations" tabindex="-1">Backward-Compatibility Expectations <a class="header-anchor" href="#backward-compatibility-expectations" aria-label="Permalink to &quot;Backward-Compatibility Expectations&quot;">​</a></h2><ul><li>Refresh payload keeps both camelCase and snake_case token fields for IDC compatibility.</li><li>Refresh result preserves prior <code>refresh_token</code> when upstream omits token rotation.</li><li>Refresh failures include HTTP status and trimmed response body for diagnostics.</li></ul><h2 id="verification-commands" tabindex="-1">Verification Commands <a class="header-anchor" href="#verification-commands" aria-label="Permalink to &quot;Verification Commands&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sS</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8317/v0/management/auths/kiro/refresh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer &lt;management-key&gt;&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> jq</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jq</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{auth_method, region, expires_at, has_refresh_token:(.refresh_token != &quot;&quot;)}&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> auths/kiro-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.json</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sS</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8317/v1/chat/completions</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer &lt;client-key&gt;&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Content-Type: application/json&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;model&quot;:&quot;claude-3-5-sonnet&quot;,&quot;messages&quot;:[{&quot;role&quot;:&quot;user&quot;,&quot;content&quot;:&quot;health ping&quot;}],&quot;stream&quot;:false}&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> jq</span></span></code></pre></div>`,13)])])}const u=i(o,[["render",l]]);export{k as __pageData,u as default};
