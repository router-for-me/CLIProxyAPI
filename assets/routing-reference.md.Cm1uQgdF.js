import{_ as s,o as e,c as a,ag as l}from"./chunks/framework.DM0yugQT.js";const c=JSON.parse('{"title":"Routing and Models Reference","description":"","frontmatter":{},"headers":[],"relativePath":"routing-reference.md","filePath":"routing-reference.md","lastUpdated":1771763743000}'),n={name:"routing-reference.md"};function t(o,i,r,h,d,p){return e(),a("div",null,[...i[0]||(i[0]=[l(`<h1 id="routing-and-models-reference" tabindex="-1">Routing and Models Reference <a class="header-anchor" href="#routing-and-models-reference" aria-label="Permalink to &quot;Routing and Models Reference&quot;">​</a></h1><p>This page explains how <code>cliproxyapi++</code> selects credentials/providers and resolves model names.</p><h2 id="audience-guidance" tabindex="-1">Audience Guidance <a class="header-anchor" href="#audience-guidance" aria-label="Permalink to &quot;Audience Guidance&quot;">​</a></h2><ul><li>Platform operators tuning reliability and quota usage.</li><li>Developers debugging model resolution and fallback behavior.</li></ul><h2 id="request-flow" tabindex="-1">Request Flow <a class="header-anchor" href="#request-flow" aria-label="Permalink to &quot;Request Flow&quot;">​</a></h2><ol><li>Client sends an OpenAI-compatible request to <code>/v1/*</code>.</li><li>API key auth is checked (<code>Authorization: Bearer &lt;client-key&gt;</code>).</li><li>Model name is resolved against configured providers, prefixes, and aliases.</li><li>Credential/provider is chosen by routing strategy.</li><li>Upstream request is translated and executed.</li><li>Response is normalized back to OpenAI-compatible JSON/SSE.</li></ol><p>Endpoint behavior note:</p><ul><li>For Copilot Codex-family models (<code>*codex*</code>, including <code>gpt-5.1-codex-mini</code>), route through <code>/v1/responses</code>.</li><li>For non-Codex Copilot and most other providers, <code>/v1/chat/completions</code> remains the default path.</li></ul><h2 id="routing-controls-in-config-yaml" tabindex="-1">Routing Controls in <code>config.yaml</code> <a class="header-anchor" href="#routing-controls-in-config-yaml" aria-label="Permalink to &quot;Routing Controls in \`config.yaml\`&quot;">​</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">routing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  strategy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;round-robin&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # round-robin | fill-first</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">force-model-prefix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">request-retry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">max-retry-interval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">quota-exceeded</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  switch-project</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  switch-preview-model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span></code></pre></div><p>Notes:</p><ul><li><code>quota-exceeded.switch-project</code> and <code>quota-exceeded.switch-preview-model</code> are the current built-in automatic quota fallback controls.</li><li>There is no generic per-provider auto-disable/auto-enable scheduler yet; for Gemini keys, use model exclusions/aliases plus these fallback toggles.</li></ul><h2 id="model-prefix-and-alias-behavior" tabindex="-1">Model Prefix and Alias Behavior <a class="header-anchor" href="#model-prefix-and-alias-behavior" aria-label="Permalink to &quot;Model Prefix and Alias Behavior&quot;">​</a></h2><ul><li>A credential/provider prefix (for example <code>team-a</code>) can require requests like <code>team-a/model-name</code>.</li><li>With <code>force-model-prefix: true</code>, unprefixed model calls are restricted.</li><li>Per-provider alias mappings can translate client-stable names to upstream names.</li></ul><p>Example alias configuration:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">codex-api-key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">api-key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sk-xxxx&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    models</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt-5-codex&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        alias</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;codex-latest&quot;</span></span></code></pre></div><p>Client request:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;model&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;codex-latest&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}] }</span></span></code></pre></div><h2 id="metrics-and-routing-diagnosis" tabindex="-1">Metrics and Routing Diagnosis <a class="header-anchor" href="#metrics-and-routing-diagnosis" aria-label="Permalink to &quot;Metrics and Routing Diagnosis&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Per-provider rolling stats</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8317/v1/metrics/providers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> jq</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Runtime health</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8317/health</span></span></code></pre></div><p>Use these signals with logs to confirm if retries, throttling, or auth issues are driving fallback.</p><h2 id="common-routing-failure-modes" tabindex="-1">Common Routing Failure Modes <a class="header-anchor" href="#common-routing-failure-modes" aria-label="Permalink to &quot;Common Routing Failure Modes&quot;">​</a></h2><ul><li><code>model_not_found</code>: model alias/prefix not exposed by configured credentials.</li><li>Wrong provider selected: prefix overlap or non-explicit model name.</li><li>High latency spikes: provider degraded; add retries or alternate providers.</li><li>Repeated <code>429</code>: insufficient credential pool for traffic profile.</li><li><code>400</code> on Codex model via chat endpoint: retry with <code>/v1/responses</code> and verify resolved model is Codex-family.</li></ul><h2 id="related-docs" tabindex="-1">Related Docs <a class="header-anchor" href="#related-docs" aria-label="Permalink to &quot;Related Docs&quot;">​</a></h2><ul><li><a href="/provider-usage">Provider Usage</a></li><li><a href="/api/operations">Operations API</a></li><li><a href="/troubleshooting">Troubleshooting</a></li></ul>`,25)])])}const u=s(n,[["render",t]]);export{c as __pageData,u as default};
