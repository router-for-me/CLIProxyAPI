import{_ as o,o as i,c as a,ag as l}from"./chunks/framework.DM0yugQT.js";const m=JSON.parse('{"title":"Issue Wave CPB-0106..0175 Lane 6 Report","description":"","frontmatter":{},"headers":[],"relativePath":"planning/reports/issue-wave-cpb-0106-0175-lane-6.md","filePath":"planning/reports/issue-wave-cpb-0106-0175-lane-6.md","lastUpdated":1771764425000}'),t={name:"planning/reports/issue-wave-cpb-0106-0175-lane-6.md"};function r(n,e,c,s,d,u){return i(),a("div",null,[...e[0]||(e[0]=[l('<h1 id="issue-wave-cpb-0106-0175-lane-6-report" tabindex="-1">Issue Wave CPB-0106..0175 Lane 6 Report <a class="header-anchor" href="#issue-wave-cpb-0106-0175-lane-6-report" aria-label="Permalink to &quot;Issue Wave CPB-0106..0175 Lane 6 Report&quot;">​</a></h1><h2 id="scope" tabindex="-1">Scope <a class="header-anchor" href="#scope" aria-label="Permalink to &quot;Scope&quot;">​</a></h2><ul><li>Lane: 6</li><li>Worktree: <code>/Users/kooshapari/temp-PRODVERCEL/485/kush/cliproxyapi-plusplus-wave-cpb3-6</code></li><li>Assigned items in this pass: <code>CPB-0156..CPB-0165</code></li><li>Commit status: no commits created</li></ul><h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary" aria-label="Permalink to &quot;Summary&quot;">​</a></h2><ul><li>Triaged all 10 assigned items.</li><li>Implemented 2 safe quick wins with focused regression coverage: <ul><li><code>CPB-0160</code>: added unit tests for Vertex Imagen routing/conversion helpers.</li><li><code>CPB-0165</code>: added chat-completions regression coverage for nullable type arrays in tool schemas.</li></ul></li><li>Remaining items were triaged as either already covered by existing code/tests or blocked for this lane because they require broader cross-repo/product changes and/or reproducible upstream fixtures.</li></ul><h2 id="per-item-status" tabindex="-1">Per-Item Status <a class="header-anchor" href="#per-item-status" aria-label="Permalink to &quot;Per-Item Status&quot;">​</a></h2><h3 id="cpb-0156-invalid-json-payload-received-unknown-name-deprecated" tabindex="-1">CPB-0156 - <code>Invalid JSON payload received: Unknown name &quot;deprecated&quot;</code> <a class="header-anchor" href="#cpb-0156-invalid-json-payload-received-unknown-name-deprecated" aria-label="Permalink to &quot;CPB-0156 - `Invalid JSON payload received: Unknown name &quot;deprecated&quot;`&quot;">​</a></h3><ul><li>Status: triaged as likely already mitigated in Gemini tool sanitation path; no new code change.</li><li>What was found: <ul><li>Gemini chat-completions translation sanitizes Google Search tool fields and has regression tests ensuring unsupported keys are removed.</li></ul></li><li>Lane action: <ul><li>No patch (existing behavior/tests already cover this class of upstream schema-key rejection).</li></ul></li><li>Evidence: <ul><li><code>pkg/llmproxy/translator/gemini/openai/chat-completions/gemini_openai_request.go:369</code></li><li><code>pkg/llmproxy/translator/gemini/openai/chat-completions/gemini_openai_request_test.go:10</code></li></ul></li></ul><h3 id="cpb-0157-proxy-prefix-applied-to-tool-choice-name-but-not-tools-name" tabindex="-1">CPB-0157 - <code>proxy_ prefix applied to tool_choice.name but not tools[].name</code> <a class="header-anchor" href="#cpb-0157-proxy-prefix-applied-to-tool-choice-name-but-not-tools-name" aria-label="Permalink to &quot;CPB-0157 - `proxy_ prefix applied to tool_choice.name but not tools[].name`&quot;">​</a></h3><ul><li>Status: triaged as already covered.</li><li>What was found: <ul><li>Prefix logic applies to both <code>tool_choice.name</code> and tool declarations/history.</li><li>Existing tests assert both surfaces.</li></ul></li><li>Lane action: <ul><li>No patch.</li></ul></li><li>Evidence: <ul><li><code>pkg/llmproxy/runtime/executor/claude_executor.go:796</code></li><li><code>pkg/llmproxy/runtime/executor/claude_executor.go:831</code></li><li><code>pkg/llmproxy/runtime/executor/claude_executor_test.go:14</code></li></ul></li></ul><h3 id="cpb-0158-windows-startup-auto-update-command" tabindex="-1">CPB-0158 - <code>Windows startup auto-update command</code> <a class="header-anchor" href="#cpb-0158-windows-startup-auto-update-command" aria-label="Permalink to &quot;CPB-0158 - `Windows startup auto-update command`&quot;">​</a></h3><ul><li>Status: triaged, blocked for safe quick win in this lane.</li><li>What was found: <ul><li>No explicit CLI command surface for a Windows startup auto-update command was identified.</li><li>There is management asset auto-updater logic, but this does not map to the requested command-level feature.</li></ul></li><li>Lane action: <ul><li>No code change.</li></ul></li><li>Evidence: <ul><li><code>pkg/llmproxy/managementasset/updater.go:62</code></li></ul></li></ul><h3 id="cpb-0159-反重力逻辑加载失效-rollout-safety" tabindex="-1">CPB-0159 - <code>反重力逻辑加载失效</code> rollout safety <a class="header-anchor" href="#cpb-0159-反重力逻辑加载失效-rollout-safety" aria-label="Permalink to &quot;CPB-0159 - `反重力逻辑加载失效` rollout safety&quot;">​</a></h3><ul><li>Status: triaged as partially addressed by existing fallback/retry safeguards.</li><li>What was found: <ul><li>Antigravity executor already has base URL fallback and no-capacity retry logic.</li></ul></li><li>Lane action: <ul><li>No code change.</li></ul></li><li>Evidence: <ul><li><code>pkg/llmproxy/executor/antigravity_executor.go:153</code></li><li><code>pkg/llmproxy/executor/antigravity_executor.go:209</code></li><li><code>pkg/llmproxy/executor/antigravity_executor.go:1543</code></li></ul></li></ul><h3 id="cpb-0160-support-openai-image-generations-api-v1-images-generations" tabindex="-1">CPB-0160 - <code>support openai image generations api(/v1/images/generations)</code> <a class="header-anchor" href="#cpb-0160-support-openai-image-generations-api-v1-images-generations" aria-label="Permalink to &quot;CPB-0160 - `support openai image generations api(/v1/images/generations)`&quot;">​</a></h3><ul><li>Status: quick-win hardening completed (unit coverage added for existing Imagen path).</li><li>What was found: <ul><li>Vertex executor has dedicated Imagen handling (<code>predict</code> action, request conversion, response conversion), but had no direct unit tests for these helpers.</li></ul></li><li>Safe fix implemented: <ul><li>Added tests for Imagen action selection, request conversion from content text and options, and response conversion shape.</li></ul></li><li>Changed files: <ul><li><code>pkg/llmproxy/executor/gemini_vertex_executor_test.go</code></li></ul></li><li>Evidence: <ul><li>Runtime helper path: <code>pkg/llmproxy/executor/gemini_vertex_executor.go:38</code></li><li>New tests: <code>pkg/llmproxy/executor/gemini_vertex_executor_test.go:10</code></li></ul></li></ul><h3 id="cpb-0161-account-has-available-credit-but-503-429-occurs-integration-path" tabindex="-1">CPB-0161 - <code>account has available credit but 503/429 occurs</code> integration path <a class="header-anchor" href="#cpb-0161-account-has-available-credit-but-503-429-occurs-integration-path" aria-label="Permalink to &quot;CPB-0161 - `account has available credit but 503/429 occurs` integration path&quot;">​</a></h3><ul><li>Status: triaged, blocked for lane-safe implementation.</li><li>What was found: <ul><li>Existing docs and executors already cover retry/cooldown behavior for <code>429/5xx</code>, but the requested non-subprocess integration contract is broader architectural work.</li></ul></li><li>Lane action: <ul><li>No code change.</li></ul></li><li>Evidence: <ul><li><code>pkg/llmproxy/executor/gemini_executor.go:288</code></li><li><code>pkg/llmproxy/executor/kiro_executor.go:824</code></li><li><code>docs/provider-operations.md:48</code></li></ul></li></ul><h3 id="cpb-0162-openclaw调用cpa中的codex5-2报错" tabindex="-1">CPB-0162 - <code>openclaw调用CPA中的codex5.2报错</code> <a class="header-anchor" href="#cpb-0162-openclaw调用cpa中的codex5-2报错" aria-label="Permalink to &quot;CPB-0162 - `openclaw调用CPA中的codex5.2报错`&quot;">​</a></h3><ul><li>Status: triaged, blocked (no deterministic local repro).</li><li>What was found: <ul><li>Codex executor and <code>gpt-5.2-codex</code> model definitions exist in this worktree, but no failing fixture/test tied to the reported <code>openclaw</code> path was present.</li></ul></li><li>Lane action: <ul><li>No code change to avoid speculative behavior.</li></ul></li><li>Evidence: <ul><li><code>pkg/llmproxy/runtime/executor/codex_executor.go:86</code></li><li><code>pkg/llmproxy/registry/model_definitions.go:317</code></li></ul></li></ul><h3 id="cpb-0163-opus4-6-1m-context-vs-280k-request-size-limit" tabindex="-1">CPB-0163 - <code>opus4.6 1m context vs 280K request-size limit</code> <a class="header-anchor" href="#cpb-0163-opus4-6-1m-context-vs-280k-request-size-limit" aria-label="Permalink to &quot;CPB-0163 - `opus4.6 1m context vs 280K request-size limit`&quot;">​</a></h3><ul><li>Status: triaged, blocked for safe quick win.</li><li>What was found: <ul><li>No single explicit <code>280KB</code> hard-limit constant/path was isolated in this worktree for a safe local patch.</li><li>Related payload-sizing behavior appears distributed (for example token estimation/compression helpers), requiring broader validation.</li></ul></li><li>Lane action: <ul><li>No code change.</li></ul></li><li>Evidence: <ul><li><code>pkg/llmproxy/executor/kiro_executor.go:3624</code></li><li><code>pkg/llmproxy/translator/kiro/claude/tool_compression.go:1</code></li></ul></li></ul><h3 id="cpb-0164-iflow-token-refresh-generic-500-server-busy" tabindex="-1">CPB-0164 - <code>iflow token refresh generic 500 &quot;server busy&quot;</code> <a class="header-anchor" href="#cpb-0164-iflow-token-refresh-generic-500-server-busy" aria-label="Permalink to &quot;CPB-0164 - `iflow token refresh generic 500 &quot;server busy&quot;`&quot;">​</a></h3><ul><li>Status: triaged as already covered.</li><li>What was found: <ul><li>iFlow token refresh already surfaces provider error payload details, including <code>server busy</code>, and has targeted regression coverage.</li></ul></li><li>Lane action: <ul><li>No code change.</li></ul></li><li>Evidence: <ul><li><code>pkg/llmproxy/auth/iflow/iflow_auth.go:165</code></li><li><code>pkg/llmproxy/auth/iflow/iflow_auth_test.go:87</code></li></ul></li></ul><h3 id="cpb-0165-nullable-type-arrays-in-tool-schemas-cause-400-on-antigravity-droid-factory" tabindex="-1">CPB-0165 - <code>Nullable type arrays in tool schemas cause 400 on Antigravity/Droid Factory</code> <a class="header-anchor" href="#cpb-0165-nullable-type-arrays-in-tool-schemas-cause-400-on-antigravity-droid-factory" aria-label="Permalink to &quot;CPB-0165 - `Nullable type arrays in tool schemas cause 400 on Antigravity/Droid Factory`&quot;">​</a></h3><ul><li>Status: quick-win hardening completed.</li><li>What was found: <ul><li>Responses-path nullable schema handling had coverage; chat-completions Gemini path lacked a dedicated regression assertion for nullable arrays.</li></ul></li><li>Safe fix implemented: <ul><li>Added chat-completions test asserting nullable <code>type</code> arrays are not stringified during tool schema conversion.</li></ul></li><li>Changed files: <ul><li><code>pkg/llmproxy/translator/gemini/openai/chat-completions/gemini_openai_request_test.go</code></li></ul></li><li>Evidence: <ul><li>Existing conversion path: <code>pkg/llmproxy/translator/gemini/openai/chat-completions/gemini_openai_request.go:323</code></li><li>New test: <code>pkg/llmproxy/translator/gemini/openai/chat-completions/gemini_openai_request_test.go:91</code></li></ul></li></ul><h2 id="test-evidence" tabindex="-1">Test Evidence <a class="header-anchor" href="#test-evidence" aria-label="Permalink to &quot;Test Evidence&quot;">​</a></h2><p>Commands run (focused):</p><ol><li><code>go test ./pkg/llmproxy/translator/gemini/openai/chat-completions -run &#39;NullableTypeArrays|GoogleSearch|SkipsEmptyAssistantMessage&#39; -count=1</code></li></ol><ul><li>Result: <code>ok github.com/router-for-me/CLIProxyAPI/v6/pkg/llmproxy/translator/gemini/openai/chat-completions 0.667s</code></li></ul><ol start="2"><li><code>go test ./pkg/llmproxy/executor -run &#39;GetVertexActionForImagen|ConvertToImagenRequest|ConvertImagenToGeminiResponse|IFlowExecutorParseSuffix|PreserveReasoningContentInMessages&#39; -count=1</code></li></ol><ul><li>Result: <code>ok github.com/router-for-me/CLIProxyAPI/v6/pkg/llmproxy/executor 1.339s</code></li></ul><ol start="3"><li><code>go test ./pkg/llmproxy/runtime/executor -run &#39;ApplyClaudeToolPrefix|StripClaudeToolPrefix&#39; -count=1</code></li></ol><ul><li>Result: <code>ok github.com/router-for-me/CLIProxyAPI/v6/pkg/llmproxy/runtime/executor 1.164s</code></li></ul><ol start="4"><li><code>go test ./pkg/llmproxy/auth/iflow -run &#39;RefreshTokensProviderErrorPayload|ExchangeCodeForTokens|AuthorizationURL&#39; -count=1</code></li></ol><ul><li>Result: <code>ok github.com/router-for-me/CLIProxyAPI/v6/pkg/llmproxy/auth/iflow 0.659s</code></li></ul><h2 id="files-changed-in-lane-6" tabindex="-1">Files Changed In Lane 6 <a class="header-anchor" href="#files-changed-in-lane-6" aria-label="Permalink to &quot;Files Changed In Lane 6&quot;">​</a></h2><ul><li><code>pkg/llmproxy/translator/gemini/openai/chat-completions/gemini_openai_request_test.go</code></li><li><code>pkg/llmproxy/executor/gemini_vertex_executor_test.go</code></li><li><code>docs/planning/reports/issue-wave-cpb-0106-0175-lane-6.md</code></li></ul>',38)])])}const h=o(t,[["render",r]]);export{m as __pageData,h as default};
