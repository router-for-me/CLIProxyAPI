<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="title.login">CLI Proxy API Management Center</title>
    <link rel="icon" type="image/x-icon" id="favicon-link">
    <style>
/* 全局样式 */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* CSS变量主题系统 */
:root {
    /* 布局尺寸 */
    --navbar-height: 69px;

    /* 亮色主题（默认） */
    --bg-primary: #f5f7fa;
    --bg-secondary: #ffffff;
    --bg-tertiary: #f8f9fb;
    --bg-quaternary: #f7fafc;
    --bg-modal: rgba(0, 0, 0, 0.5);

    /* 侧边栏颜色 */
    --sidebar-bg: #ffffff;
    --sidebar-hover: #f0f2f5;
    --sidebar-active: #e8f4ff;
    --sidebar-border: #e5e7eb;

    --text-primary: #1f2937;
    --text-secondary: #4b5563;
    --text-tertiary: #6b7280;
    --text-quaternary: #9ca3af;
    --text-inverse: white;

    --border-primary: #e5e7eb;
    --border-secondary: #d1d5db;
    --border-focus: #3b82f6;

    --accent-primary: #3b82f6;
    --accent-secondary: #e5e7eb;
    --accent-tertiary: #f3f4f6;
    --primary-color: #3b82f6;
    --primary-hover: #2563eb;
    --card-bg: #ffffff;
    --border-color: #e5e7eb;

    --success-bg: #d1fae5;
    --success-text: #065f46;
    --success-border: #6ee7b7;

    --error-bg: #fee2e2;
    --error-text: #991b1b;
    --error-border: #fca5a5;

    --warning-bg: #fef3c7;
    --warning-text: #92400e;
    --warning-border: #fbbf24;

    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-primary: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-secondary: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --shadow-modal: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

    --glass-bg: rgba(255, 255, 255, 0.95);
    --glass-border: rgba(229, 231, 235, 0.8);
}

/* 暗色主题 */
[data-theme="dark"] {
    --bg-primary: #111827;
    --bg-secondary: #1f2937;
    --bg-tertiary: #1a202c;
    --bg-quaternary: #2d3748;
    --bg-modal: rgba(0, 0, 0, 0.7);

    /* 侧边栏颜色 */
    --sidebar-bg: #1f2937;
    --sidebar-hover: #374151;
    --sidebar-active: #1e3a5f;
    --sidebar-border: #374151;

    --text-primary: #f9fafb;
    --text-secondary: #e5e7eb;
    --text-tertiary: #d1d5db;
    --text-quaternary: #9ca3af;
    --text-inverse: #ffffff;

    --border-primary: #374151;
    --border-secondary: #4b5563;
    --border-focus: #60a5fa;

    --accent-primary: #3b82f6;
    --accent-secondary: #374151;
    --accent-tertiary: #1f2937;
    --primary-color: #60a5fa;
    --primary-hover: #3b82f6;
    --card-bg: #1f2937;
    --border-color: #374151;

    --success-bg: #064e3b;
    --success-text: #6ee7b7;
    --success-border: #059669;

    --error-bg: #7f1d1d;
    --error-text: #fca5a5;
    --error-border: #dc2626;

    --warning-bg: #78350f;
    --warning-text: #fbbf24;
    --warning-border: #f59e0b;

    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
    --shadow-primary: 0 1px 3px 0 rgba(0, 0, 0, 0.3), 0 1px 2px 0 rgba(0, 0, 0, 0.2);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
    --shadow-secondary: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
    --shadow-modal: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.3);

    --glass-bg: rgba(31, 41, 59, 0.95);
    --glass-border: rgba(75, 85, 99, 0.8);
}

/* 登录页面样式 */
.login-container {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg-primary);
    padding: 20px;
}

/* 自动登录加载页面样式 */
.auto-login-content {
    text-align: center;
    padding: 20px;
}

.loading-spinner {
    margin: 0 auto 20px;
    width: 60px;
    height: 60px;
}

.spinner {
    width: 100%;
    height: 100%;
    border: 4px solid #e5e7eb;
    border-top: 4px solid #3b82f6;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% {
        transform: rotate(0deg);
    }

    100% {
        transform: rotate(360deg);
    }
}

.auto-login-content h2 {
    color: var(--text-secondary);
    margin-bottom: 10px;
    font-size: 24px;
    font-weight: 600;
}

.auto-login-content p {
    color: var(--text-tertiary);
    font-size: 16px;
    line-height: 1.5;
}

/* 登录页面头部布局 */
.login-header-top {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 30px;
    position: relative;
}

.login-title {
    width: 100%;
    text-align: center;
    margin-bottom: 30px;
}

/* 头部控制按钮组 */
.header-controls {
    display: flex;
    gap: 8px;
    align-items: center;
    height: 100%;
}

/* 登录页面的控制按钮组样式 */
.login-header-top .header-controls {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 12px;
    padding: 8px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    margin-top: 8px;
    /* 与标题拉开距离，避免遮挡 */
    margin-bottom: 20px;
}

.login-header-top .header-controls:hover {
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    transform: translateY(-1px);
}

[data-theme="dark"] .login-header-top .header-controls {
    background: rgba(30, 41, 59, 0.8);
    border: 1px solid rgba(100, 116, 139, 0.3);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .login-header-top .header-controls:hover {
    background: rgba(30, 41, 59, 0.9);
    border-color: rgba(100, 116, 139, 0.5);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
}

.language-switcher,
.theme-switcher {
    position: relative;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    height: 100%;
}

.language-btn,
.theme-btn {
    padding: 8px 14px;
    font-size: 14px;
    font-weight: 500;
    border-radius: 6px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    color: var(--text-tertiary);
    transition: all 0.3s ease;
    white-space: nowrap;
    backdrop-filter: blur(5px);
    min-height: 36px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
}

.top-navbar .language-btn,
.top-navbar .theme-btn {
    padding: 6px 12px;
    min-height: 36px;
}

.top-navbar-actions .btn,
.top-navbar .language-btn,
.top-navbar .theme-btn {
    display: inline-flex;
    align-items: center;
    height: 36px;
    min-width: 36px;
    justify-content: center;
}

/* 登录页面的按钮样式优化 */
.login-header-top .language-btn,
.login-header-top .theme-btn {
    padding: 8px 12px;
    font-size: 13px;
    height: 36px;
    min-width: 36px;
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: #64748b;
    backdrop-filter: blur(10px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.login-header-top .language-btn:hover,
.login-header-top .theme-btn:hover {
    background: rgba(255, 255, 255, 1);
    border-color: rgba(100, 116, 139, 0.3);
    color: #475569;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

[data-theme="dark"] .login-header-top .language-btn,
[data-theme="dark"] .login-header-top .theme-btn {
    background: rgba(30, 41, 59, 0.9);
    border: 1px solid rgba(100, 116, 139, 0.3);
    color: #94a3b8;
}

[data-theme="dark"] .login-header-top .language-btn:hover,
[data-theme="dark"] .login-header-top .theme-btn:hover {
    background: rgba(51, 65, 85, 0.95);
    border-color: rgba(100, 116, 139, 0.5);
    color: #cbd5e1;
}

.language-btn:hover,
.theme-btn:hover {
    background: var(--accent-secondary);
    border-color: var(--border-secondary);
    color: var(--text-secondary);
}

.language-btn i,
.theme-btn i {
    margin-right: 6px;
}

.theme-btn.active {
    background: var(--accent-primary);
    color: var(--text-inverse);
}

.login-card {
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 40px;
    width: 100%;
    max-width: 500px;
    box-shadow: var(--shadow-secondary);
    border: 1px solid var(--glass-border);
}

.login-header {
    text-align: center;
    margin-bottom: 25px;
}

.login-title {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    color: var(--text-secondary);
    font-size: 1.8rem;
    font-weight: 600;
    margin-bottom: 0;
    line-height: 1.2;
}

#login-logo {
    height: 60px;
    width: auto;
    object-fit: contain;
    border-radius: 6px;
    padding: 2px;
    background: #fff;
    border: 1px solid rgba(15, 23, 42, 0.06);
    box-shadow: 0 1px 2px rgba(15, 23, 42, 0.06);
}

.login-subtitle {
    color: #64748b;
    font-size: 1rem;
    margin: 0;
    text-align: center;
}

.login-body {
    display: flex;
    flex-direction: column;
    gap: 24px;
}

.login-connection-info {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    border-radius: 16px;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

[data-theme="dark"] .login-connection-info {
    background: rgba(30, 41, 59, 0.7);
    border-color: rgba(100, 116, 139, 0.3);
}

.connection-summary {
    display: flex;
    align-items: center;
    gap: 16px;
    color: var(--text-secondary);
}

.connection-summary i {
    font-size: 24px;
    color: var(--primary-color);
}

.connection-url {
    font-size: 16px;
    color: var(--text-secondary);
}

.connection-url-separator {
    margin: 0 8px;
    color: var(--text-tertiary);
}

#login-connection-url {
    font-family: "Fira Code", "Consolas", "Courier New", monospace;
    color: var(--text-primary);
    word-break: break-all;
}

[data-theme="dark"] #login-connection-url {
    color: var(--text-secondary);
}

.login-form {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.login-form .form-group {
    margin-bottom: 25px;
}

.login-form .form-group label {
    display: block;
    margin-bottom: 8px;
    color: var(--text-secondary);
    font-weight: 600;
    font-size: 0.95rem;
}

.login-form .form-hint {
    margin-top: 6px;
    color: #64748b;
    font-size: 12px;
}

.login-form .input-group {
    display: flex;
    gap: 10px;
    align-items: center;
}

.login-form input[type="text"],
.login-form input[type="password"] {
    flex: 1;
    padding: 14px 16px;
    border: 2px solid var(--border-primary);
    border-radius: 10px;
    font-size: 15px;
    transition: all 0.3s ease;
    background: var(--bg-secondary);
    color: var(--text-primary);
}

.login-form input:focus {
    outline: none;
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px var(--border-primary);
}

.login-form .btn-secondary {
    padding: 14px 16px;
    border: 2px solid #e2e8f0;
    background: #f8fafc;
    color: #64748b;
    border-radius: 10px;
    transition: all 0.3s ease;
}

.login-form .btn-secondary:hover {
    background: #e2e8f0;
    border-color: #cbd5e0;
}

.form-actions {
    margin-top: 30px;
    text-align: center;
}

.login-btn {
    width: 100%;
    padding: 16px 24px;
    font-size: 16px;
    font-weight: 600;
    border-radius: 12px;
    background: linear-gradient(135deg, #475569, #334155);
    color: white;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.login-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(51, 65, 85, 0.4);
}

.login-btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
    transform: none;
}

.login-error {
    background: var(--error-bg);
    border: 1px solid var(--error-border);
    color: var(--error-text);
    padding: 12px 16px;
    border-radius: 8px;
    margin-top: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    font-weight: 500;
}

.login-error i {
    color: var(--error-text);
}

/* 响应式设计 - 登录页面 */
@media (max-width: 640px) {
    .login-card {
        padding: 30px 20px;
        margin: 10px;
        max-width: 100%;
    }

    .login-header-top {
        flex-direction: column;
        gap: 20px;
        align-items: center;
        margin-bottom: 30px;
    }

    .header-controls {
        flex-direction: row;
        justify-content: center;
        gap: 8px;
        margin-bottom: 10px;
        /* 在小屏幕上给控制按钮组添加下边距 */
    }

    /* 登录页面小屏幕优化 */
    .login-header-top .header-controls {
        margin: 8px auto 0 auto;
        /* 顶部留白，避免与标题拥挤 */
        background: rgba(255, 255, 255, 0.08);
        padding: 6px;
        border-radius: 10px;
    }

    .login-header-top .language-btn,
    .login-header-top .theme-btn {
        padding: 6px 10px;
        font-size: 12px;
        height: 32px;
        min-width: 32px;
    }

    .language-btn,
    .theme-btn {
        padding: 8px 16px;
        font-size: 13px;
        height: 36px;
        /* 在小屏幕上稍微减小高度 */
    }

    .login-title {
        font-size: 1.5rem;
        flex-direction: column;
        gap: 10px;
        text-align: center;
        justify-content: center;
        margin-bottom: 25px;
    }

    #login-logo {
        height: 50px;
    }

    .login-form .input-group {
        flex-direction: column;
        align-items: stretch;
    }

    .login-form .btn-secondary {
        width: 100%;
        margin-top: 10px;
    }
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
    background: var(--bg-primary);
    min-height: 100vh;
    color: var(--text-primary);
    transition: background-color 0.3s ease, color 0.3s ease;
    overflow-x: hidden;
}

/* 侧边栏样式 */
.layout {
    display: grid;
    grid-template-columns: 240px 1fr;
    min-height: calc(100vh - var(--navbar-height, 69px));
    width: 100%;
    transition: grid-template-columns 0.3s ease;
}

.layout.sidebar-collapsed {
    grid-template-columns: 64px 1fr;
}

.sidebar {
    width: 240px;
    background: var(--sidebar-bg);
    border-right: 1px solid var(--sidebar-border);
    height: calc(100vh - var(--navbar-height, 69px));
    position: sticky;
    top: var(--navbar-height, 69px);
    overflow-y: auto;
    overflow-x: hidden;
    display: flex;
    flex-direction: column;
    z-index: 5;
    box-shadow: var(--shadow-sm);
    transition: all 0.3s ease;
}

.sidebar.collapsed {
    width: 64px;
}

.sidebar.collapsed .nav-item span {
    opacity: 0;
    width: 0;
    overflow: hidden;
    white-space: nowrap;
}

.sidebar.collapsed .nav-item {
    justify-content: center;
    padding: 10px 0;
}

.sidebar.collapsed .nav-item i {
    margin-right: 0;
}

/* 侧边栏切换按钮（桌面端-在顶栏） */
.sidebar-toggle-btn-desktop {
    display: none;
    width: 40px;
    height: 40px;
    border: none;
    background: transparent;
    color: var(--text-primary);
    border-radius: 8px;
    cursor: pointer;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    transition: all 0.2s ease;
    padding: 0;
}

.sidebar-toggle-btn-desktop:hover {
    background: var(--bg-tertiary);
    color: var(--primary-color);
}

.sidebar-toggle-btn-desktop i {
    transition: transform 0.3s ease;
}

.layout.sidebar-collapsed .sidebar-toggle-btn-desktop i {
    transform: rotate(90deg);
}

/* 在大屏幕上显示桌面端切换按钮 */
@media (min-width: 1025px) {
    .sidebar-toggle-btn-desktop {
        display: flex;
    }
}

/* 侧边栏品牌区域 */
.sidebar-brand {
    padding: 24px 20px;
    border-bottom: 1px solid var(--sidebar-border);
    display: flex;
    align-items: center;
    gap: 12px;
    background: var(--sidebar-bg);
}

.sidebar-brand-logo {
    width: 36px;
    height: 36px;
    object-fit: contain;
    border-radius: 8px;
}

.sidebar-brand-text {
    font-size: 18px;
    font-weight: 600;
    color: var(--text-primary);
    line-height: 1.2;
}

/* 侧边栏导航菜单 */
.sidebar .nav-menu {
    flex: 1;
    padding: 16px 12px;
    list-style: none;
}

.sidebar .nav-menu li {
    margin-bottom: 4px;
    position: relative;
}

.sidebar .nav-item {
    display: flex;
    align-items: center;
    padding: 10px 14px;
    color: var(--text-secondary);
    text-decoration: none;
    border-radius: 8px;
    transition: all 0.2s ease;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    position: relative;
}

.sidebar .nav-item:hover {
    background: var(--sidebar-hover);
    color: var(--text-primary);
}

.sidebar .nav-item.active {
    background: var(--sidebar-active);
    color: var(--primary-color);
}

.sidebar .nav-item i {
    margin-right: 12px;
    width: 18px;
    font-size: 16px;
    text-align: center;
    transition: margin 0.3s ease;
}

/* 收起状态时的工具提示 */
.sidebar.collapsed .nav-menu li:hover::after {
    content: attr(data-tooltip);
    position: absolute;
    left: 68px;
    top: 50%;
    transform: translateY(-50%);
    background: var(--bg-secondary);
    color: var(--text-primary);
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 500;
    white-space: nowrap;
    box-shadow: var(--shadow-md);
    border: 1px solid var(--border-primary);
    z-index: 1000;
    pointer-events: none;
    opacity: 0;
    animation: tooltipFadeIn 0.2s ease forwards;
}

@keyframes tooltipFadeIn {
    to {
        opacity: 1;
    }
}

/* 主内容区域包装器 */
.main-wrapper {
    display: flex;
    flex-direction: column;
    background: var(--bg-primary);
    min-height: calc(100vh - var(--navbar-height, 69px));
}

/* 顶部导航栏 */
.top-navbar {
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--border-primary);
    padding: 16px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 200;
    box-shadow: var(--shadow-sm);
    height: var(--navbar-height, 69px);
    min-height: var(--navbar-height, 69px);
    box-sizing: border-box;
}

.top-navbar-left {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
}

.top-navbar-brand {
    display: flex;
    align-items: center;
    gap: 12px;
    max-width: max-content;
    flex-shrink: 0;
}

.top-navbar-brand-logo {
    width: 32px;
    height: 32px;
    object-fit: contain;
    border-radius: 8px;
}

.top-navbar-brand-text {
    font-size: 18px;
    font-weight: 600;
    color: var(--text-primary);
    overflow: visible;
    text-overflow: initial;
    white-space: nowrap;
    line-height: 1;
}

.top-navbar-brand-toggle {
    display: inline-flex;
    align-items: center;
    background: transparent;
    border: none;
    padding: 0;
    margin: 0;
    cursor: pointer;
    font: inherit;
    color: var(--text-primary);
    height: 32px;
}

.top-navbar-brand-toggle:focus-visible {
    outline: 2px solid var(--primary-color);
    outline-offset: 4px;
    border-radius: 8px;
}

.brand-texts {
    position: relative;
    display: inline-flex;
    align-items: center;
    overflow: hidden;
    white-space: nowrap;
    transition: width 0.45s ease;
}

.brand-text {
    display: block;
    white-space: nowrap;
    transition: opacity 0.35s ease;
    line-height: 1.2;
}

.brand-text-short {
    position: absolute;
    left: 0;
    top: 0;
    opacity: 0;
}

.top-navbar-brand-toggle.expanded .brand-text-full {
    opacity: 1;
}

.top-navbar-brand-toggle.expanded .brand-text-short {
    opacity: 0;
}

.top-navbar-brand-toggle.collapsed .brand-text-full {
    opacity: 0;
    position: absolute;
}

.top-navbar-brand-toggle.collapsed .brand-text-short {
    opacity: 1;
    position: relative;
}

@media (max-width: 768px) {
    .top-navbar-brand-toggle {
        pointer-events: none;
        cursor: default;
    }

    .brand-texts {
        transition: none;
    }

    .top-navbar-brand-toggle .brand-text-full {
        display: none;
    }

    .top-navbar-brand-toggle .brand-text-short {
        position: relative;
        opacity: 1;
    }
}

.top-navbar-actions {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-left: auto;
}

.top-navbar-actions>* {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 36px;
    min-width: 44px;
}

.top-navbar .header-controls {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    height: auto;
}

.top-navbar .language-btn,
.top-navbar .theme-btn {
    height: 36px;
    min-height: 36px;
    min-width: 44px;
    padding: 0 12px;
    justify-content: center;
    line-height: 1;
}

.top-navbar-actions .btn {
    height: 36px;
    min-height: 36px;
    min-width: 44px;
    padding: 0 12px;
    justify-content: center;
    line-height: 1;
}

@media (max-width: 768px) {
    .top-navbar {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
        height: auto;
        min-height: var(--navbar-height, 69px);
    }

    .top-navbar-left {
        width: 100%;
        justify-content: flex-start;
    }

    .top-navbar-actions {
        width: 100%;
        flex-wrap: wrap;
        justify-content: flex-end;
        gap: 8px;
        margin-left: 0;
        align-items: center;
    }

    .top-navbar .header-controls {
        width: auto;
        order: 0;
        justify-content: flex-end;
        gap: 8px;
        height: auto;
        align-items: center;
    }

    .top-navbar-actions>* {
        height: 36px;
        min-height: 36px;
        min-width: 44px;
        justify-content: center;
    }

    .top-navbar .language-btn,
    .top-navbar .theme-btn {
        height: 36px;
        min-height: 36px;
        min-width: 44px;
        padding: 0 12px;
        justify-content: center;
        line-height: 1;
    }

    .top-navbar-actions .btn {
        height: 36px;
        min-height: 36px;
        min-width: 44px;
        padding: 0 12px;
        justify-content: center;
        line-height: 1;
    }

    .top-navbar .language-btn i,
    .top-navbar .theme-btn i,
    .top-navbar-actions .btn i {
        margin: 0;
    }
}

.top-navbar .language-btn i,
.top-navbar .theme-btn i {
    margin: 0;
}

.header-actions {
    display: flex;
    gap: 10px;
    align-items: center;
}

.header-actions .btn {
    white-space: nowrap;
}

@media (max-width: 768px) {
    .header-actions .btn span {
        display: none;
    }

    .header-actions .btn {
        padding: 6px 10px;
    }
}

/* 连接信息样式 */
.connection-info {
    display: grid;
    gap: 16px;
}

.info-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 0;
    border-bottom: 1px solid var(--border-primary);
}

.info-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
}

.info-label {
    display: flex;
    align-items: center;
    gap: 10px;
    color: var(--text-primary);
    font-weight: 500;
    font-size: 14px;
}

.info-label i {
    color: var(--text-tertiary);
    width: 18px;
    font-size: 16px;
}

.info-value {
    color: var(--text-secondary);
    font-family: 'Monaco', 'Menlo', 'Consolas', 'Ubuntu Mono', monospace;
    font-size: 13px;
    background: var(--bg-tertiary);
    padding: 6px 12px;
    border-radius: 6px;
    border: 1px solid var(--border-primary);
    max-width: 350px;
    word-break: break-all;
}

.status-indicator {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 14px;
    border-radius: 16px;
    font-size: 13px;
    font-weight: 500;
}

.status-indicator.connected {
    background: var(--success-bg);
    color: var(--success-text);
}

.status-indicator.disconnected {
    background: var(--error-bg);
    color: var(--error-text);
}

.status-indicator.connecting {
    background: var(--warning-bg);
    color: var(--warning-text);
}

/* 响应式设计 - 连接信息 */
@media (max-width: 768px) {
    .info-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }

    .info-value {
        max-width: 100%;
        width: 100%;
    }
}

/* 主内容区域 */
.main-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 24px 32px;
    max-width: 1400px;
    width: 100%;
    margin: 0 auto;
}

/* 内容区域 */
.content-area {
    flex: 1;
    width: 100%;
    display: flex;
    flex-direction: column;
}

.content-section {
    display: none;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.content-section.active {
    display: block;
}

.content-section h2 {
    color: var(--text-primary);
    margin-bottom: 24px;
    font-size: 24px;
    font-weight: 600;
}

/* 卡片样式 */
.card {
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: 12px;
    margin-bottom: 20px;
    box-shadow: var(--shadow-sm);
    overflow: hidden;
    transition: box-shadow 0.2s ease;
}

.card:hover {
    box-shadow: var(--shadow-md);
}

.card-header {
    background: var(--bg-secondary);
    padding: 18px 24px;
    border-bottom: 1px solid var(--border-primary);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.card-header h3 {
    color: var(--text-primary);
    font-size: 16px;
    font-weight: 600;
    display: flex;
    align-items: center;
}

.card-header h3 i {
    color: var(--text-tertiary);
    margin-right: 10px;
    font-size: 18px;
}

.card-content {
    padding: 24px;
}

/* 按钮样式 */
.btn {
    padding: 8px 16px;
    border: 1px solid transparent;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    text-decoration: none;
    min-height: 36px;
    white-space: nowrap;
    outline: none;
}

.btn-primary {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

.btn-primary:hover {
    background: var(--primary-hover);
    border-color: var(--primary-hover);
    box-shadow: 0 2px 6px rgba(59, 130, 246, 0.3);
}

.btn-secondary {
    background: var(--bg-secondary);
    color: var(--text-secondary);
    border-color: var(--border-primary);
}

.btn-secondary:hover {
    background: var(--bg-tertiary);
    border-color: var(--border-secondary);
    color: var(--text-primary);
}

.btn-danger {
    background: #ef4444;
    color: white;
    border-color: #ef4444;
}

.btn-danger:hover {
    background: #dc2626;
    border-color: #dc2626;
    box-shadow: 0 2px 6px rgba(239, 68, 68, 0.3);
}

.btn-success {
    background: #10b981;
    color: white;
    border-color: #10b981;
}

.btn-success:hover {
    background: #059669;
    border-color: #059669;
    box-shadow: 0 2px 6px rgba(16, 185, 129, 0.3);
}

.btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none !important;
}

.btn i {
    font-size: 14px;
}

/* 小按钮样式 - 与stat-badge高度一致 */
.btn-small {
    padding: 4px 12px;
    border: 1px solid transparent;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
    min-height: 28px;
    white-space: nowrap;
}

.btn-small.btn-primary {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

.btn-small.btn-primary:hover {
    background: var(--primary-hover);
    box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
    transform: translateY(-1px);
}

.btn-small.btn-danger {
    background: #ef4444;
    color: white;
    border-color: #ef4444;
}

.btn-small.btn-danger:hover {
    background: #dc2626;
    box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
    transform: translateY(-1px);
}

.btn-small.btn-info {
    background: #06b6d4;
    color: white;
    border-color: #06b6d4;
}

.btn-small.btn-info:hover {
    background: #0891b2;
    box-shadow: 0 2px 4px rgba(6, 182, 212, 0.3);
    transform: translateY(-1px);
}

.btn-small.btn-warning {
    background: #ff9800;
    color: #fff;
    border-color: #ff9800;
    cursor: default;
}

.btn-small.btn-warning:disabled,
.btn-small.btn-warning[disabled] {
    background: #fb8c00;
    border-color: #fb8c00;
    color: #fff;
    opacity: 1;
}

.btn-small i {
    font-size: 13px;
}

/* 响应式调整 */
@media (max-width: 768px) {
    .btn-small {
        padding: 3px 10px;
        font-size: 12px;
        min-height: 26px;
    }
    
    .btn-small i {
        font-size: 12px;
    }
}

/* 表单元素 */
.form-group {
    margin-bottom: 18px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    color: var(--text-primary);
    font-weight: 500;
    font-size: 14px;
}

.form-hint {
    font-size: 13px;
    color: var(--text-tertiary);
    margin: 6px 0 0 0;
    line-height: 1.5;
}

.input-group {
    display: flex;
    gap: 10px;
    align-items: center;
}

input[type="text"],
input[type="password"],
input[type="number"],
input[type="url"],
textarea,
select {
    flex: 1;
    padding: 10px 14px;
    border: 1px solid var(--border-primary);
    border-radius: 6px;
    font-size: 14px;
    transition: all 0.2s ease;
    background: var(--bg-secondary);
    color: var(--text-primary);
    font-family: inherit;
}

input:hover,
textarea:hover,
select:hover {
    border-color: var(--border-secondary);
}

input:focus,
textarea:focus,
select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

input::placeholder,
textarea::placeholder {
    color: var(--text-quaternary);
}

/* 切换开关 */
.toggle-group {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
}

.toggle-switch {
    position: relative;
    display: inline-block;
    width: 44px;
    height: 24px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

/* 配置管理编辑器 */
.editor-actions {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
}

.editor-actions .btn {
    white-space: nowrap;
}

.yaml-editor-container {
    display: flex;
    flex-direction: column;
    gap: 12px;
    min-height: 520px;
}

#config-management .card {
    display: flex;
    flex-direction: column;
    margin-bottom: 12px;
}

#config-management .card-content {
    flex: 1;
    display: flex;
    flex-direction: column;
}

#config-management .yaml-editor-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 520px;
}

.yaml-editor {
    width: 100%;
    border: 1px solid var(--border-primary);
    border-radius: 6px;
    padding: 12px 14px;
    background: var(--bg-secondary);
    color: var(--text-primary);
    overflow-y: auto;
    font-family: 'SFMono-Regular', 'Consolas', 'Liberation Mono', 'Courier New', monospace;
    line-height: 1.5;
    resize: vertical;
}

#config-management .yaml-editor {
    height: 520px;
}

#config-management .CodeMirror {
    height: 520px;
    font-family: 'SFMono-Regular', 'Consolas', 'Liberation Mono', 'Courier New', monospace;
    font-size: 14px;
    line-height: 1.5;
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: 6px;
    overflow: hidden;
}

#config-management .CodeMirror-scroll {
    min-height: 0;
    height: 100%;
    max-height: 100%;
    overflow-y: auto;
    overscroll-behavior: contain;
}

#config-management .CodeMirror.cm-s-default {
    background: var(--bg-secondary);
    color: var(--text-primary);
}

#config-management .CodeMirror-gutters {
    background: var(--bg-secondary);
    border-right: 1px solid var(--border-primary);
}

#config-management .CodeMirror-linenumber {
    color: var(--text-tertiary);
}

#config-management .CodeMirror .CodeMirror-lines {
    padding: 12px;
}

#config-management .CodeMirror .cm-comment {
    color: #6b7280;
}

[data-theme="dark"] #config-management .CodeMirror.cm-s-default {
    background: var(--bg-secondary);
    color: var(--text-primary);
}

[data-theme="dark"] #config-management .CodeMirror-gutters {
    background: var(--bg-secondary);
    border-right: 1px solid var(--border-secondary);
}

[data-theme="dark"] #config-management .CodeMirror .cm-comment {
    color: #9ca3af;
}

#config-management .CodeMirror.cm-readonly {
    opacity: 0.6;
}

@media (max-width: 768px) {
    .yaml-editor-container,
    #config-management .yaml-editor-container {
        min-height: 360px;
    }

    #config-management .yaml-editor,
    #config-management .CodeMirror {
        height: 360px;
    }
}

.editor-status {
    font-size: 13px;
    color: var(--text-quaternary);
    display: flex;
    align-items: center;
    gap: 6px;
    min-height: 18px;
}

.editor-status.success {
    color: #059669;
}

.editor-status.error {
    color: #dc2626;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #d1d5db;
    transition: .3s;
    border-radius: 24px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .3s;
    border-radius: 50%;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
}

input:checked+.slider {
    background: var(--primary-color);
}

input:checked+.slider:before {
    transform: translateX(20px);
}

.toggle-label {
    color: var(--text-primary);
    font-weight: 500;
    font-size: 14px;
}

/* 列表样式 */
.key-list {
    /* 便于一次展示 6 条密钥记录（约 6*80px 高度） */
    max-height: 520px;
    overflow-y: auto;
}


/* API 密钥列表压缩布局 */
.key-table {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.key-table-row {
    display: grid;
    grid-template-columns: 72px 1fr auto;
    column-gap: 14px;
    align-items: center;
    background: var(--bg-quaternary);
    border: 1px solid var(--border-primary);
    border-radius: 10px;
    padding: 10px 12px;
    transition: all 0.2s ease;
}

.key-table-row:hover {
    background: var(--bg-tertiary);
    border-color: var(--border-secondary);
    transform: translateY(-1px);
}

.key-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 32px;
    min-width: 52px;
    padding: 0 12px;
    border-radius: 10px;
    background: var(--bg-secondary);
    color: var(--primary-color);
    font-weight: 700;
    font-size: 14px;
    border: 1px solid var(--border-primary);
    letter-spacing: 0.2px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
}

.key-table-value {
    display: flex;
    flex-direction: column;
    gap: 4px;
    min-width: 0;
    padding: 2px 0;
}

.key-table .item-title {
    margin: 0;
    font-size: 13px;
    color: var(--text-secondary);
}

.key-value {
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: 8px;
    padding: 8px 12px;
    font-family: "SFMono-Regular", Menlo, Consolas, "Liberation Mono", monospace;
    font-size: 13px;
    color: var(--text-primary);
    font-weight: 600;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    line-height: 1.4;
}

.item-actions.compact {
    position: static;
    transform: none;
    gap: 6px;
    justify-content: flex-end;
    justify-self: end;
}

.item-actions.compact .btn {
    min-width: 34px;
    height: 34px;
    padding: 0;
    border-radius: 6px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
}

.item-actions.compact .btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.12);
}

.item-actions.compact .btn i {
    font-size: 14px;
}

@media (max-width: 768px) {
    .key-table-row {
        grid-template-columns: 1fr;
        row-gap: 8px;
    }

    .item-actions.compact {
        justify-content: flex-start;
    }

    .key-badge {
        width: fit-content;
    }

    .key-value {
        white-space: normal;
        word-break: break-all;
    }
}

.file-list {
    /* 认证文件列表填满页面，保留版本信息空间 */
    max-height: calc(100vh - 300px); /* 减去导航栏、padding和版本信息的高度 */
    overflow-y: auto;
    margin-right: -12px; /* 向右扩展 */
    padding-right: 12px; /* 滚动条不贴着最右侧卡片，保持左右边距一致 */
}

/* 认证文件Grid布局 */
.file-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
}

.pagination-controls {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    margin-top: 20px;
    flex-wrap: wrap;
}

.pagination-btn {
    gap: 6px;
    min-width: 120px;
    justify-content: center;
    display: inline-flex;
    align-items: center;
}

.pagination-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.pagination-info {
    font-size: 0.95rem;
    color: var(--text-secondary);
}

/* 响应式：中等屏幕2列 */
@media (max-width: 1400px) {
    .file-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

/* 响应式：小屏幕单列 */
@media (max-width: 768px) {
    .file-grid {
        grid-template-columns: 1fr;
    }
}

/* 带筛选器的卡片头部布局 */
.card-header-with-filter {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
}

.card-header-with-filter .header-left {
    display: flex;
    align-items: center;
    gap: 20px;
    flex: 1;
    flex-wrap: wrap;
}

.card-header-with-filter .header-left h3 {
    margin: 0;
    white-space: nowrap;
}

.oauth-excluded-form {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 14px;
    margin-top: 8px;
}

.oauth-excluded-actions {
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-start;
    gap: 10px;
    margin-top: 12px;
}

.oauth-excluded-scope {
    color: var(--text-secondary);
    font-weight: 600;
    margin: 0;
}

.oauth-excluded-list {
    margin-top: 12px;
}

.oauth-excluded-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 12px;
    align-items: stretch;
}

.oauth-excluded-card {
    height: 100%;
}

.oauth-excluded-card .provider-models {
    margin-top: 6px;
}

.oauth-excluded-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.oauth-excluded-card .item-actions {
    top: 14px;
    right: 14px;
    transform: none;
}

.oauth-excluded-editor-card .item-content {
    padding-right: 0;
}

.oauth-excluded-editor-card textarea {
    min-height: 140px;
}

.oauth-excluded-empty {
    color: var(--text-tertiary);
    font-size: 0.95rem;
}

/* 认证文件工具栏 */
.auth-file-toolbar {
    display: flex;
    flex-wrap: wrap;
    gap: 18px;
    align-items: flex-end;
    margin-bottom: 18px;
}

.auth-file-search-group {
    flex: 1;
    min-width: 240px;
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.auth-file-search-group label,
.auth-file-page-size label {
    font-weight: 600;
    color: var(--text-secondary);
}

.auth-file-search {
    display: flex;
    align-items: center;
    border: 1px solid var(--border-primary);
    border-radius: 10px;
    padding: 0 12px;
    background: var(--bg-secondary);
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.03);
}

[data-theme="dark"] .auth-file-search {
    background: var(--bg-tertiary);
    box-shadow: inset 0 1px 1px rgba(255, 255, 255, 0.04);
}

.auth-file-search i {
    color: var(--text-tertiary);
    margin-right: 8px;
}

.auth-file-search input {
    border: none;
    background: transparent;
    color: var(--text-primary);
    width: 100%;
    padding: 10px 0;
    font-size: 0.95rem;
}

.auth-file-search input:focus {
    outline: none;
}

.auth-file-page-size {
    min-width: 180px;
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.page-size-input {
    display: flex;
    align-items: center;
    gap: 8px;
    border: 1px solid var(--border-primary);
    border-radius: 10px;
    padding: 8px 12px;
    background: var(--bg-quaternary);
}

.page-size-input input {
    width: 80px;
    padding: 6px 8px;
    border: 1px solid var(--border-secondary);
    border-radius: 6px;
    background: var(--bg-primary);
    color: var(--text-primary);
}

.page-size-input span {
    font-size: 0.9rem;
    color: var(--text-tertiary);
}

/* 认证文件筛选按钮 */
.auth-file-filter {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.filter-btn {
    padding: 6px 16px;
    border: 1px solid var(--border-primary);
    background: var(--bg-quaternary);
    color: var(--text-secondary);
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9rem;
    transition: all 0.2s ease;
}

.filter-btn:hover {
    background: var(--bg-tertiary);
    border-color: var(--border-secondary);
}

.filter-btn.active {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

/* 文件类型标签 */
.file-type-badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 600;
    margin-right: 8px;
}

.file-type-badge.qwen {
    background: #e8f5e9;
    color: #2e7d32;
}

[data-theme="dark"] .file-type-badge.qwen {
    background: #1b5e20;
    color: #81c784;
}

.file-type-badge.gemini {
    background: #e3f2fd;
    color: #1565c0;
}

[data-theme="dark"] .file-type-badge.gemini {
    background: #0d47a1;
    color: #64b5f6;
}

.file-type-badge.gemini-cli {
    background: #e7efff;
    color: #1e4fa3;
}

[data-theme="dark"] .file-type-badge.gemini-cli {
    background: #1c3f73;
    color: #a8c7ff;
}

.file-type-badge.aistudio {
    background: #f0f2f5;
    color: #2f343c;
}

[data-theme="dark"] .file-type-badge.aistudio {
    background: #373c42;
    color: #cfd3db;
}

.file-type-badge.claude {
    background: #fce4ec;
    color: #c2185b;
}

[data-theme="dark"] .file-type-badge.claude {
    background: #880e4f;
    color: #f48fb1;
}

.file-type-badge.codex {
    background: #fff3e0;
    color: #ef6c00;
}

[data-theme="dark"] .file-type-badge.codex {
    background: #e65100;
    color: #ffb74d;
}

.file-type-badge.antigravity {
    background: #e0f7fa;
    color: #006064;
}

[data-theme="dark"] .file-type-badge.antigravity {
    background: #004d40;
    color: #80deea;
}

.file-type-badge.iflow {
    background: #f3e5f5;
    color: #7b1fa2;
}

[data-theme="dark"] .file-type-badge.iflow {
    background: #4a148c;
    color: #ce93d8;
}

.file-type-badge.empty {
    background: #f5f5f5;
    color: #616161;
}

[data-theme="dark"] .file-type-badge.empty {
    background: #424242;
    color: #bdbdbd;
}

/* 未知类型通用样式 */
.file-type-badge:not(.qwen):not(.gemini):not(.gemini-cli):not(.aistudio):not(.claude):not(.codex):not(.antigravity):not(.iflow):not(.empty) {
    background: #f0f0f0;
    color: #666666;
    border: 1px dashed #999999;
}

[data-theme="dark"] .file-type-badge:not(.qwen):not(.gemini):not(.gemini-cli):not(.aistudio):not(.claude):not(.codex):not(.antigravity):not(.iflow):not(.empty) {
    background: #3a3a3a;
    color: #aaaaaa;
    border: 1px dashed #666666;
}

/* 虚拟认证文件标记样式 */
.virtual-auth-badge {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
    color: white;
    font-size: 13px;
    padding: 4px 8px;
    border-radius: 12px;
    font-weight: 500;
    text-align: center;
    display: inline-block;
    width: 100%;
    box-shadow: 0 2px 4px rgba(59, 130, 246, 0.25);
    letter-spacing: 0.3px;
}

[data-theme="dark"] .virtual-auth-badge {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
    box-shadow: 0 2px 4px rgba(96, 165, 250, 0.25);
}


.provider-list {
    /* 默认不限制高度，动态设置 */
    min-height: 0;
}

.key-item,
.provider-item,
.file-item {
    background: var(--bg-quaternary);
    border: 1px solid var(--border-primary);
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
    display: flex;
    flex-direction: column;
    transition: all 0.3s ease;
    position: relative;
}

.file-item.hidden {
    display: none;
}

.key-item:hover,
.provider-item:hover,
.file-item:hover {
    background: var(--bg-tertiary);
    border-color: var(--border-secondary);
    transform: translateY(-1px);
}

.item-content {
    flex: 1;
    width: 100%;
}

/* 为 API Keys 和 AI Providers 的项优化按钮位置 */
.key-item .item-content,
.provider-item .item-content {
    padding-right: 120px; /* 为按钮预留空间，防止内容重叠 */
    min-width: 0; /* 确保内容可以正常换行 */
}

.item-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 12px;
    flex-wrap: wrap;
    gap: 10px;
    align-items: flex-start;
}

.item-stats {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    align-items: center;
}

.item-actions {
    display: flex;
    gap: 8px;
    flex-wrap: nowrap;
    align-items: center;
    justify-content: flex-end;
}

/* 认证文件项的底部布局优化 - 确保状态标签和操作按钮垂直对齐 */
.file-item .item-footer {
    align-items: center; /* 垂直居中对齐 */
    gap: 12px; /* 增加状态标签和按钮之间的间距 */
}

.file-item .item-stats {
    align-items: center; /* 状态徽章垂直居中 */
    margin: 0; /* 移除默认外边距 */
}

.file-item .item-actions {
    align-items: center; /* 操作按钮垂直居中 */
    gap: 6px; /* 按钮之间适当间距 */
}

/* API Keys 和 AI Providers 的按钮组 - 绝对定位到右侧垂直居中 */
.key-item .item-actions,
.provider-item .item-actions {
    position: absolute;
    top: 50%;
    right: 15px;
    transform: translateY(-50%);
    gap: 8px;
}

/* 按钮样式优化 */
.key-item .item-actions .btn,
.provider-item .item-actions .btn {
    min-width: 40px;
    height: 40px;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.key-item .item-actions .btn:hover,
.provider-item .item-actions .btn:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

.key-item .item-actions .btn i,
.provider-item .item-actions .btn i {
    font-size: 16px;
    margin: 0;
}

.item-title {
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 6px;
}

.item-meta {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
    margin-bottom: 4px;
}

.item-subtitle {
    color: var(--text-tertiary);
    font-size: 0.9rem;
}

.provider-base-url {
    word-break: break-all;
    overflow-wrap: anywhere;
    white-space: normal;
    display: block;
}

.provider-item .provider-models {
    margin-top: 8px;
    display: flex;
    flex-wrap: wrap;
}

.provider-model-tag {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    background: var(--bg-quinary);
    color: var(--text-secondary);
    border: 1px solid var(--border-secondary);
    border-radius: 14px;
    padding: 4px 10px;
    margin-right: 6px;
    margin-top: 6px;
    font-size: 0.85rem;
}

.provider-item .excluded-models .provider-model-tag {
    background: var(--warning-bg);
    border-color: var(--warning-border);
    color: var(--warning-text);
}

.provider-model-tag .model-name {
    font-weight: 600;
}

.provider-model-tag .model-alias {
    color: var(--text-tertiary);
    font-style: italic;
}

.available-models-status {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--text-secondary);
    font-size: 0.95rem;
    margin-bottom: 10px;
}

.available-models-status.success {
    color: #10b981;
}

.available-models-status.warning {
    color: #d97706;
}

.available-models-status.error {
    color: #dc2626;
}

.available-models-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.available-models-empty {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--text-tertiary);
    padding: 6px 0;
}

.available-models-placeholder {
    color: var(--text-tertiary);
}

.available-model-group {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    padding: 10px 12px;
}

.available-model-group-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.available-model-group-title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
    color: var(--text-primary);
}

.available-model-group-label {
    font-size: 0.95rem;
    letter-spacing: 0.3px;
}

.available-model-group-count {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 999px;
    padding: 2px 8px;
    font-size: 0.85rem;
    color: var(--text-secondary);
}

.available-model-group-body {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.item-value {
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    background: var(--bg-tertiary);
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.85rem;
    color: var(--text-secondary);
    word-break: break-all;
}

/* 状态信息 */
.status-info {
    background: var(--bg-quaternary);
    border-radius: 8px;
    padding: 20px;
}

.status-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--border-primary);
}

.status-item:last-child {
    margin-bottom: 0;
    padding-bottom: 0;
    border-bottom: none;
}

.status-label {
    font-weight: 600;
    color: var(--text-secondary);
}

.status-value {
    color: var(--text-tertiary);
}

.version-check {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.version-check-rows {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 12px;
}

.version-check-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 14px;
    border-radius: 8px;
    background: var(--bg-quaternary);
    border: 1px solid var(--border-primary);
}

.version-check-value {
    font-weight: 600;
    color: var(--text-tertiary);
}

.version-check-actions {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
}

.version-check-result {
    font-weight: 600;
    color: var(--text-secondary);
}

.version-check-result.success {
    color: #10b981;
}

.version-check-result.warning {
    color: #f59e0b;
}

.version-check-result.error {
    color: #ef4444;
}

.version-check-result.info {
    color: var(--text-secondary);
}

.version-check-result.muted {
    color: var(--text-quaternary);
}

/* JSON模态框 */
.json-modal {
    position: fixed;
    z-index: 2000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: var(--bg-modal);
    backdrop-filter: blur(5px);
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.2s ease;
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

.json-modal-content {
    background-color: var(--bg-secondary);
    border-radius: 12px;
    width: 90%;
    max-width: 800px;
    max-height: 90vh;
    box-shadow: var(--shadow-modal);
    display: flex;
    flex-direction: column;
    animation: slideUp 0.3s ease;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.json-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 24px;
    border-bottom: 1px solid var(--border-primary);
}

.json-modal-header h3 {
    margin: 0;
    color: var(--text-secondary);
    font-size: 1.1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
}

.json-modal-close {
    background: none;
    border: none;
    color: var(--text-tertiary);
    font-size: 24px;
    cursor: pointer;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.2s ease;
}

.json-modal-close:hover {
    background: var(--bg-tertiary);
    color: var(--text-secondary);
}

.json-modal-body {
    flex: 1;
    overflow-y: auto;
    padding: 20px 24px;
    min-height: 200px;
    max-height: calc(90vh - 160px);
}

.json-content {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    border-radius: 8px;
    padding: 16px;
    margin: 0;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Courier New', monospace;
    font-size: 13px;
    line-height: 1.6;
    color: var(--text-secondary);
    overflow-x: auto;
    white-space: pre;
}

.json-modal-footer {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    gap: 10px;
    padding: 16px 24px;
    border-top: 1px solid var(--border-primary);
}

@media (max-width: 768px) {
    .json-modal-content {
        width: 95%;
        max-height: 95vh;
    }

    .json-modal-header,
    .json-modal-body,
    .json-modal-footer {
        padding: 16px;
    }

    .json-content {
        font-size: 12px;
        padding: 12px;
    }

    .json-modal-footer {
        flex-wrap: wrap;
    }

    .json-modal-footer .btn {
        flex: 1;
        min-width: 80px;
    }
}

/* 模态框 */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: var(--bg-modal);
    backdrop-filter: blur(5px);
}

.modal-content {
    background-color: var(--bg-secondary);
    margin: 4% auto;
    padding: 0;
    border-radius: 15px;
    width: 90%;
    max-width: 550px;
    max-height: 90vh;
    box-shadow: var(--shadow-modal);
    animation: modalSlideIn 0.3s ease;
    position: relative;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.model-actions-inline {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 10px;
}

.model-discovery-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.4);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1100;
    padding: 18px;
}

.model-discovery-overlay.active {
    display: flex;
}

.model-discovery-card {
    background: var(--bg-secondary);
    color: var(--text-primary);
    width: 95%;
    max-width: 760px;
    max-height: 90vh;
    border-radius: 14px;
    box-shadow: var(--shadow-modal);
    padding: 18px;
    display: flex;
    flex-direction: column;
    gap: 14px;
    overflow: hidden;
}

.model-discovery-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
}

.model-discovery-header h3 {
    margin: 0 0 6px 0;
}

.model-discovery-status {
    min-height: 22px;
    font-size: 0.95rem;
    color: var(--text-secondary);
}

.model-discovery-status.error {
    color: #dc2626;
}

.model-discovery-status.warning {
    color: #d97706;
}

.openai-test-status {
    min-height: 22px;
    font-size: 0.95rem;
    color: var(--text-secondary);
}

.openai-test-status.success {
    color: #16a34a;
}

.openai-test-status.error {
    color: #dc2626;
}

.openai-test-status.warning {
    color: #d97706;
}

.openai-test-group select {
    min-width: 200px;
    padding: 10px 12px;
    border: 1px solid var(--border-primary);
    border-radius: 10px;
    background: var(--bg-secondary);
    color: var(--text-primary);
}

.openai-test-group select:disabled {
    opacity: 0.6;
}

.openai-test-btn-success {
    background: #16a34a !important;
    border-color: #16a34a !important;
    color: #ffffff !important;
}

.openai-test-btn-error {
    background: #dc2626 !important;
    border-color: #dc2626 !important;
    color: #ffffff !important;
}

.model-discovery-list {
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    padding: 8px;
    overflow-y: auto;
    max-height: 46vh;
}

.model-discovery-row {
    display: flex;
    gap: 12px;
    padding: 10px;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.15s ease;
}

.model-discovery-row:hover {
    background: rgba(59, 130, 246, 0.08);
}

.model-discovery-checkbox {
    margin-top: 4px;
}

.model-discovery-meta {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.model-discovery-name {
    font-weight: 700;
    color: var(--text-primary);
}

.model-discovery-alias {
    margin-left: 6px;
    padding: 2px 8px;
    border-radius: 999px;
    background: #eef2ff;
    color: #4338ca;
    font-size: 0.85rem;
    font-weight: 600;
}

.model-discovery-desc {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.model-discovery-empty {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 18px 12px;
    color: var(--text-secondary);
}

[data-theme="dark"] .model-discovery-card {
    background: var(--bg-secondary);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.35);
}

[data-theme="dark"] .model-discovery-list {
    background: var(--bg-secondary);
    border-color: var(--border-color);
}

[data-theme="dark"] .model-discovery-row:hover {
    background: rgba(96, 165, 250, 0.18);
}

[data-theme="dark"] .model-discovery-alias {
    background: #312e81;
    color: #c7d2fe;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-30px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.close {
    color: var(--text-tertiary);
    position: absolute;
    top: 15px;
    right: 20px;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.3s ease;
}

.close:hover,
.close:focus {
    color: var(--text-secondary);
    background-color: var(--bg-tertiary);
}

#modal-body {
    padding: 35px 30px 30px 30px;
    flex: 1;
    min-height: 0;
    overflow-y: auto;
}

/* 模态框标题样式 */
#modal-body h3 {
    color: var(--text-secondary);
    font-size: 1.25rem;
    font-weight: 600;
    margin: 0 0 20px 0;
    text-align: center;
    border-bottom: 2px solid var(--border-primary);
    padding-bottom: 12px;
}

/* 模态框表单组 */
#modal-body .form-group {
    margin-bottom: 16px;
}

#modal-body .form-group label {
    display: block;
    margin-bottom: 6px;
    color: var(--text-secondary);
    font-weight: 600;
    font-size: 14px;
}

#modal-body .form-group input,
#modal-body .form-group textarea {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid var(--border-primary);
    border-radius: 8px;
    font-size: 14px;
    transition: all 0.3s ease;
    background: var(--bg-tertiary);
    color: var(--text-primary);
    font-family: inherit;
}

#modal-body .form-group input:focus,
#modal-body .form-group textarea:focus {
    outline: none;
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px var(--border-primary);
}

#modal-body .form-group textarea {
    resize: vertical;
    min-height: 80px;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 13px;
}

/* 模态框按钮组 */
#modal-body .modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    margin-top: 24px;
    padding-top: 18px;
    border-top: 1px solid var(--border-primary);
}

#modal-body .modal-actions .btn {
    min-width: 80px;
    padding: 10px 20px;
}

/* 通知 */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 20px;
    border-radius: 8px;
    color: white;
    font-weight: 500;
    z-index: 1001;
    transform: translateX(400px);
    transition: all 0.3s ease;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
}

.notification.show {
    transform: translateX(0);
}

.notification.success {
    background: linear-gradient(135deg, #68d391, #38a169);
}

.notification.error {
    background: linear-gradient(135deg, #fc8181, #e53e3e);
}

.notification.info {
    background: linear-gradient(135deg, #63b3ed, #3182ce);
}

/* 响应式设计 */
@media (max-width: 1024px) {
    .layout {
        position: relative;
        grid-template-columns: 1fr;
        min-height: calc(100vh - var(--navbar-height, 69px));
    }

    .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        height: 100vh;
        padding-top: calc(var(--navbar-height, 69px) + 20px);
        transform: translateX(-100%);
        z-index: 150;
        box-shadow: var(--shadow-sm);
        background: var(--sidebar-bg);
        width: 240px !important;
    }

    .sidebar.mobile-open {
        transform: translateX(0);
        box-shadow: var(--shadow-secondary);
    }

    /* 移动端强制恢复侧栏展开状态 */
    .sidebar.collapsed {
        width: 240px !important;
    }

    .sidebar.collapsed .nav-item span {
        opacity: 1 !important;
        width: auto !important;
        overflow: visible !important;
    }

    .sidebar.collapsed .nav-item {
        justify-content: flex-start !important;
        padding: 10px 14px !important;
    }

    .sidebar.collapsed .nav-item i {
        margin-right: 12px !important;
    }

    .main-wrapper {
        margin-left: 0;
        width: 100%;
        min-height: calc(100vh - var(--navbar-height, 69px));
        overflow: hidden;
    }

    .main-content {
        padding: 20px 16px;
    }
}

@media (max-width: 768px) {
    .top-navbar {
        padding: 12px 16px;
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
        height: auto;
        min-height: 60px;
    }

    .top-navbar-title {
        font-size: 18px;
    }

    .top-navbar-left {
        width: 100%;
        justify-content: flex-start;
    }

    .top-navbar-actions {
        gap: 6px;
        flex-wrap: wrap;
        justify-content: flex-end;
        width: 100%;
        margin-left: 0;
    }

    .top-navbar-actions>* {
        height: 36px;
        min-height: 36px;
        min-width: 44px;
    }

    .top-navbar .header-controls {
        height: 36px;
        gap: 8px;
        width: auto;
        order: 0;
        justify-content: flex-end;
    }

    .top-navbar-actions .btn,
    .top-navbar .language-btn,
    .top-navbar .theme-btn {
        height: 36px;
        min-height: 36px;
        min-width: 44px;
        padding: 8px 12px;
    }

    .btn {
        padding: 6px 12px;
        font-size: 13px;
    }

    .card {
        border-radius: 8px;
    }

    .card-header {
        padding: 16px 20px;
    }

    .card-content {
        padding: 20px;
    }

    .input-group {
        flex-direction: column;
        align-items: stretch;
    }

    .card-header {
        flex-direction: column;
        gap: 12px;
        align-items: flex-start;
    }

    .card-header .header-actions {
        width: 100%;
        justify-content: flex-start;
    }

    /* 模态框响应式 */
    .modal-content {
        margin: 5% auto;
        width: 95%;
        max-width: none;
    }

    #modal-body {
        padding: 40px 20px 20px 20px;
    }

    #modal-body h3 {
        font-size: 18px;
        margin-bottom: 16px;
    }

    #modal-body .modal-actions {
        flex-direction: column-reverse;
        gap: 10px;
    }

    #modal-body .modal-actions .btn {
        width: 100%;
        margin: 0;
    }

    .content-section h2 {
        font-size: 20px;
        margin-bottom: 20px;
    }
}

/* 移动端侧边栏遮罩 */
.sidebar-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 120;
}

.sidebar-overlay.active {
    display: block;
}

/* 移动端菜单按钮 */
.mobile-menu-btn {
    display: none;
    width: 40px;
    height: 40px;
    background: transparent;
    border: none;
    padding: 0;
    cursor: pointer;
    color: var(--text-primary);
    font-size: 20px;
    border-radius: 8px;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
}

.mobile-menu-btn:hover {
    background: var(--bg-tertiary);
    color: var(--primary-color);
}

@media (max-width: 1024px) {
    .mobile-menu-btn {
        display: flex;
    }
}

/* 加载动画 */
.loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: #fff;
    animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

/* 空状态 */
.empty-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-tertiary);
}

.empty-state i {
    font-size: 48px;
    margin-bottom: 16px;
    color: var(--border-secondary);
}

.empty-state h3 {
    margin-bottom: 8px;
    color: var(--text-secondary);
}

/* 滚动条样式 */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: var(--bg-tertiary);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: var(--border-secondary);
    border-radius: 4px;
    transition: background 0.2s ease;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--text-quaternary);
}

/* 侧边栏滚动条 */
.sidebar::-webkit-scrollbar {
    width: 6px;
}

.sidebar::-webkit-scrollbar-track {
    background: transparent;
}

.sidebar::-webkit-scrollbar-thumb {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 3px;
}

.sidebar::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 0, 0, 0.2);
}

[data-theme="dark"] .sidebar::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .sidebar::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.2);
}

/* 连接状态指示器 */
.connection-indicator {
    display: inline-block;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    margin-right: 8px;
}

.connection-indicator.connected {
    background-color: #68d391;
    box-shadow: 0 0 8px rgba(104, 211, 145, 0.6);
}

.connection-indicator.disconnected {
    background-color: #fc8181;
    box-shadow: 0 0 8px rgba(252, 129, 129, 0.6);
}

.connection-indicator.connecting {
    background-color: #fbb040;
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0% {
        opacity: 1;
    }

    50% {
        opacity: 0.5;
    }

    100% {
        opacity: 1;
    }
}


/* 使用统计样式 */
.stats-overview {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

@media (max-width: 1200px) {
    .stats-overview {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }
}

@media (max-width: 768px) {
    .stats-overview {
        grid-template-columns: 1fr;
    }
}

.usage-filter-bar {
    display: flex;
    justify-content: flex-start;
    gap: 16px;
    flex-wrap: wrap;
    margin-bottom: 20px;
}

.usage-filter-group {
    display: flex;
    flex-direction: column;
    gap: 6px;
    min-width: 220px;
}

.usage-filter-actions {
    min-width: 260px;
    flex: 1 0 100%;
    order: 0;
}

.chart-line-group {
    flex: 1 1 260px;
    order: 1;
}

.usage-filter-group label {
    font-weight: 600;
    color: var(--text-secondary);
    font-size: 14px;
}

.chart-line-actions {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
}

.chart-line-count {
    padding: 6px 10px;
    border-radius: 20px;
    background: var(--bg-tertiary);
    color: var(--text-secondary);
    font-size: 13px;
    border: 1px solid var(--border-color);
}

.chart-line-hint {
    color: var(--text-secondary);
    font-size: 13px;
}

.chart-line-control {
    display: flex;
    align-items: center;
    gap: 8px;
}

.chart-line-control .model-filter-select {
    flex: 1;
}

.chart-line-delete {
    white-space: nowrap;
}

.chart-line-group.chart-line-hidden {
    display: none;
}

.model-filter-select {
    border: 1px solid var(--border-color);
    border-radius: 10px;
    padding: 10px 14px;
    background: var(--bg-primary);
    color: var(--text-primary);
    min-height: 40px;
    font-size: 14px;
}

.model-filter-select:disabled {
    opacity: 0.7;
    cursor: not-allowed;
}

.stat-card {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 18px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    min-height: 220px;
    transition: all 0.2s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.stat-card:hover {
    border-color: var(--border-primary);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    transform: translateY(-2px);
}

.stat-card-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 12px;
    min-height: 110px;
}

.stat-meta {
    display: flex;
    flex-direction: column;
    gap: 6px;
    flex: 1;
}

.stat-icon {
    width: 44px;
    height: 44px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--primary-color);
    color: white;
    font-size: 18px;
    flex-shrink: 0;
}

.stat-icon.success {
    background: #10b981;
}

.stat-icon.error {
    background: #ef4444;
}

.stat-number {
    font-size: 30px;
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1.1;
}

.stat-label {
    font-size: 13px;
    letter-spacing: 0.2px;
    color: var(--text-secondary);
    text-transform: uppercase;
    font-weight: 600;
}

.stat-subtext {
    font-size: 12px;
    color: var(--text-tertiary);
    line-height: 1.5;
}

.stat-subtext-inline {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
}

.dot-divider {
    color: var(--text-tertiary);
    font-weight: 700;
}

.stat-sparkline {
    height: 90px;
    margin-top: auto;
}

.stat-sparkline canvas {
    width: 100% !important;
    height: 100% !important;
}

.cost-summary-card .stat-icon {
    background: #f59e0b;
}

.charts-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 30px;
}

@media (max-width: 1200px) {
    .charts-container {
        grid-template-columns: 1fr;
    }
}

.chart-card {
    min-height: 400px;
}

.chart-container {
    position: relative;
    height: 300px;
    width: 100%;
}

.chart-controls {
    display: flex;
    gap: 8px;
}

.btn.btn-small {
    padding: 6px 12px;
    font-size: 12px;
    border-radius: 6px;
    border: 1px solid var(--border-color);
    background: var(--card-bg);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn.btn-small:hover {
    border-color: var(--border-primary);
    color: var(--text-primary);
}

.btn.btn-small.active {
    background: var(--primary-color);
    border-color: var(--primary-color);
    color: white;
}

.api-stats-table {
    overflow-x: auto;
}

.stats-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 16px;
}

.stats-table th,
.stats-table td {
    padding: 12px 16px;
    text-align: left;
    border-bottom: 1px solid var(--border-color);
}

.stats-table th {
    background: var(--bg-secondary);
    font-weight: 600;
    color: var(--text-primary);
    font-size: 14px;
}

.stats-table td {
    color: var(--text-secondary);
    font-size: 14px;
}

.stats-table tr:hover {
    background: var(--bg-secondary);
}

.model-details {
    margin-top: 8px;
    padding: 8px 12px;
    background: var(--bg-tertiary);
    border-radius: 6px;
    font-size: 12px;
}

.cost-config-card .card-content {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.model-price-form {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.price-input-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 12px;
}

@media (max-width: 768px) {
    .price-input-grid {
        grid-template-columns: 1fr;
    }
}

.price-form-actions {
    display: flex;
    justify-content: flex-end;
}

.model-price-list {
    margin-top: 6px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.model-price-item {
    cursor: pointer;
}

.model-price-item .item-meta {
    margin-bottom: 0;
    gap: 10px;
}

.chart-placeholder {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: var(--text-tertiary);
    background: var(--bg-primary);
    border: 1px dashed var(--border-color);
    border-radius: 12px;
}

.cost-chart-card {
    grid-column: 1 / -1;
}

.model-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 4px;
    color: var(--text-tertiary);
}

.model-name {
    font-weight: 500;
    color: var(--text-secondary);
}

.loading-placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100px;
    color: var(--text-tertiary);
    font-size: 14px;
}

.no-data-message {
    text-align: center;
    color: var(--text-tertiary);
    font-style: italic;
    padding: 40px;
}

/* 暗色主题适配 */
[data-theme="dark"] .stat-card {
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .stat-card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
}

[data-theme="dark"] .btn.btn-small {
    background: var(--bg-tertiary);
}

/* 版本信息样式 */
.version-footer {
    margin-top: 40px;
    padding: 24px 0;
    border-top: 1px solid var(--border-primary);
    flex-shrink: 0;
}

.version-info {
    text-align: center;
    font-size: 13px;
    color: var(--text-tertiary);
}

.version-info .separator {
    margin: 0 12px;
    color: var(--text-quaternary);
}

.connection-reset-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    white-space: nowrap;
}

.connection-reset-btn i {
    margin: 0;
}

.connection-reset-btn span {
    font-size: 13px;
}

[data-theme="dark"] .connection-reset-btn {
    background: rgba(30, 41, 59, 0.9);
    border-color: rgba(100, 116, 139, 0.4);
    color: #cbd5e1;
}

[data-theme="dark"] .connection-reset-btn:hover {
    background: rgba(51, 65, 85, 0.95);
    border-color: rgba(100, 116, 139, 0.6);
}

.model-input-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 10px;
}

.model-input-row .input-group {
    display: flex;
    gap: 8px;
}

.model-input-row .model-name-input,
.model-input-row .model-alias-input {
    flex: 1;
}

.model-input-row .model-alias-input {
    max-width: 220px;
}

.model-input-row .model-remove-btn {
    align-self: center;
}

.api-key-input-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 10px;
}

.api-key-input-group {
    display: flex;
    gap: 8px;
    width: 100%;
}

.api-key-input-group .api-key-value-input {
    flex: 2;
}

.api-key-input-group .api-key-proxy-input {
    flex: 1;
    min-width: 180px;
}

.api-key-input-group .api-key-remove-btn {
    align-self: center;
}

.api-key-input-list + .btn,
.model-input-list + .btn,
.header-input-list + .btn {
    margin-top: 4px;
    align-self: flex-start;
}

.header-input-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 10px;
}

.header-input-row .header-input-group {
    display: flex;
    align-items: center;
    gap: 8px;
}

.header-key-input {
    flex: 1;
}

.header-value-input {
    flex: 2;
}

.header-separator {
    color: var(--text-tertiary);
}

.header-badges-wrapper {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.header-badge-list {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}

.header-badge {
    background: var(--accent-tertiary);
    border: 1px solid var(--border-primary);
    border-radius: 12px;
    padding: 4px 8px;
    font-size: 12px;
    color: var(--text-secondary);
    display: inline-flex;
    gap: 4px;
}

.header-badge strong {
    font-weight: 600;
    color: var(--text-primary);
}

[data-theme="dark"] .header-badge {
    background: rgba(59, 130, 246, 0.15);
    border-color: rgba(59, 130, 246, 0.3);
    color: var(--text-secondary);
}

[data-theme="dark"] .header-badge strong {
    color: var(--text-secondary);
}

/* Codex OAuth 样式 */
#codex-oauth-content {
    transition: all 0.3s ease;
}

#codex-oauth-url {
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 13px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    color: var(--text-secondary);
}

#codex-oauth-url:focus {
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

#codex-oauth-status {
    font-weight: 500;
    padding: 8px 12px;
    border-radius: 6px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    transition: all 0.3s ease;
}

#codex-oauth-status.success {
    background: var(--success-bg);
    border-color: var(--success-border);
    color: var(--success-text);
}

#codex-oauth-status.error {
    background: var(--error-bg);
    border-color: var(--error-border);
    color: var(--error-text);
}

#codex-oauth-status.warning {
    background: var(--warning-bg);
    border-color: var(--warning-border);
    color: var(--warning-text);
}

/* Codex OAuth 按钮样式 */
#codex-open-link,
#codex-copy-link {
    min-width: 100px;
    white-space: nowrap;
}

#codex-open-link {
    background: var(--primary-color);
    border-color: var(--primary-color);
}

#codex-open-link:hover {
    background: var(--primary-hover);
    border-color: var(--primary-hover);
}

#codex-copy-link {
    background: var(--bg-secondary);
    border-color: var(--border-primary);
    color: var(--text-secondary);
}

#codex-copy-link:hover {
    background: var(--bg-tertiary);
    border-color: var(--border-secondary);
    color: var(--text-primary);
}

/* 响应式设计 - Codex OAuth */
@media (max-width: 768px) {
    #codex-oauth-content .input-group {
        flex-direction: column;
        align-items: stretch;
    }

    #codex-open-link,
    #codex-copy-link {
        width: 100%;
        margin-top: 8px;
    }

    #codex-oauth-url {
        font-size: 12px;
    }
}

/* Anthropic OAuth 样式 */
#anthropic-oauth-content {
    transition: all 0.3s ease;
}

#anthropic-oauth-url {
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 13px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    color: var(--text-secondary);
}

#anthropic-oauth-url:focus {
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

#anthropic-oauth-status {
    font-weight: 500;
    padding: 8px 12px;
    border-radius: 6px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    transition: all 0.3s ease;
}

#anthropic-oauth-status.success {
    background: var(--success-bg);
    border-color: var(--success-border);
    color: var(--success-text);
}

#anthropic-oauth-status.error {
    background: var(--error-bg);
    border-color: var(--error-border);
    color: var(--error-text);
}

#anthropic-oauth-status.warning {
    background: var(--warning-bg);
    border-color: var(--warning-border);
    color: var(--warning-text);
}

/* Anthropic OAuth 按钮样式 */
#anthropic-open-link,
#anthropic-copy-link {
    min-width: 100px;
    white-space: nowrap;
}

#anthropic-open-link {
    background: var(--primary-color);
    border-color: var(--primary-color);
}

#anthropic-open-link:hover {
    background: var(--primary-hover);
    border-color: var(--primary-hover);
}

#anthropic-copy-link {
    background: var(--bg-secondary);
    border-color: var(--border-primary);
    color: var(--text-secondary);
}

#anthropic-copy-link:hover {
    background: var(--bg-tertiary);
    border-color: var(--border-secondary);
    color: var(--text-primary);
}

/* 响应式设计 - Anthropic OAuth */
@media (max-width: 768px) {
    #anthropic-oauth-content .input-group {
        flex-direction: column;
        align-items: stretch;
    }

    #anthropic-open-link,
    #anthropic-copy-link {
        width: 100%;
        margin-top: 8px;
    }

    #anthropic-oauth-url {
        font-size: 12px;
    }
}

/* Gemini CLI OAuth 样式 */
#gemini-cli-oauth-content {
    transition: all 0.3s ease;
}

#gemini-cli-oauth-url {
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 13px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    color: var(--text-secondary);
}

#gemini-cli-oauth-url:focus {
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

#gemini-cli-oauth-status {
    font-weight: 500;
    padding: 8px 12px;
    border-radius: 6px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    transition: all 0.3s ease;
}

#gemini-cli-oauth-status.success {
    background: var(--success-bg);
    border-color: var(--success-border);
    color: var(--success-text);
}

#gemini-cli-oauth-status.error {
    background: var(--error-bg);
    border-color: var(--error-border);
    color: var(--error-text);
}

#gemini-cli-oauth-status.warning {
    background: var(--warning-bg);
    border-color: var(--warning-border);
    color: var(--warning-text);
}

/* Gemini CLI OAuth 按钮样式 */
#gemini-cli-open-link,
#gemini-cli-copy-link {
    min-width: 100px;
    white-space: nowrap;
}

#gemini-cli-open-link {
    background: var(--primary-color);
    border-color: var(--primary-color);
}

#gemini-cli-open-link:hover {
    background: var(--primary-hover);
    border-color: var(--primary-hover);
}

#gemini-cli-copy-link {
    background: var(--bg-secondary);
    border-color: var(--border-primary);
    color: var(--text-secondary);
}

#gemini-cli-copy-link:hover {
    background: var(--bg-tertiary);
    border-color: var(--border-secondary);
    color: var(--text-primary);
}

/* Gemini CLI 项目 ID 输入框样式 */
#gemini-cli-project-id {
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 13px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    color: var(--text-secondary);
}

#gemini-cli-project-id:focus {
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

/* 响应式设计 - Gemini CLI OAuth */
@media (max-width: 768px) {
    #gemini-cli-oauth-content .input-group {
        flex-direction: column;
        align-items: stretch;
    }

    #gemini-cli-open-link,
    #gemini-cli-copy-link {
        width: 100%;
        margin-top: 8px;
    }

    #gemini-cli-oauth-url {
        font-size: 12px;
    }

    #gemini-cli-project-id {
        font-size: 12px;
    }
}

/* Qwen OAuth 样式 */
#qwen-oauth-content {
    transition: all 0.3s ease;
}

#qwen-oauth-url {
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 13px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    color: var(--text-secondary);
}

#qwen-oauth-url:focus {
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

#qwen-oauth-status {
    font-weight: 500;
    padding: 8px 12px;
    border-radius: 6px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    transition: all 0.3s ease;
}

#qwen-oauth-status.success {
    background: var(--success-bg);
    border-color: var(--success-border);
    color: var(--success-text);
}

#qwen-oauth-status.error {
    background: var(--error-bg);
    border-color: var(--error-border);
    color: var(--error-text);
}

#qwen-oauth-status.warning {
    background: var(--warning-bg);
    border-color: var(--warning-border);
    color: var(--warning-text);
}

/* Qwen OAuth 按钮样式 */
#qwen-open-link,
#qwen-copy-link {
    min-width: 100px;
    white-space: nowrap;
}

#qwen-open-link {
    background: var(--primary-color);
    border-color: var(--primary-color);
}

#qwen-open-link:hover {
    background: var(--primary-hover);
    border-color: var(--primary-hover);
}

#qwen-copy-link {
    background: var(--bg-secondary);
    border-color: var(--border-primary);
    color: var(--text-secondary);
}

#qwen-copy-link:hover {
    background: var(--bg-tertiary);
    border-color: var(--border-secondary);
    color: var(--text-primary);
}

/* 响应式设计 - Qwen OAuth */
@media (max-width: 768px) {
    #qwen-oauth-content .input-group {
        flex-direction: column;
        align-items: stretch;
    }

    #qwen-open-link,
    #qwen-copy-link {
        width: 100%;
        margin-top: 8px;
    }

    #qwen-oauth-url {
        font-size: 12px;
    }
}

/* iFlow OAuth 样式 */
#iflow-oauth-content {
    transition: all 0.3s ease;
}

#iflow-oauth-url {
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 13px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    color: var(--text-secondary);
}

#iflow-oauth-url:focus {
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

#iflow-oauth-status {
    font-weight: 500;
    padding: 8px 12px;
    border-radius: 6px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    transition: all 0.3s ease;
}

#iflow-oauth-status.success {
    background: var(--success-bg);
    border-color: var(--success-border);
    color: var(--success-text);
}

#iflow-oauth-status.error {
    background: var(--error-bg);
    border-color: var(--error-border);
    color: var(--error-text);
}

#iflow-oauth-status.warning {
    background: var(--warning-bg);
    border-color: var(--warning-border);
    color: var(--warning-text);
}

/* iFlow OAuth 按钮样式 */
#iflow-open-link,
#iflow-copy-link {
    min-width: 100px;
    white-space: nowrap;
}

#iflow-open-link {
    background: var(--primary-color);
    border-color: var(--primary-color);
}

#iflow-open-link:hover {
    background: var(--primary-hover);
    border-color: var(--primary-hover);
}

#iflow-copy-link {
    background: var(--bg-secondary);
    border-color: var(--border-primary);
    color: var(--text-secondary);
}

#iflow-copy-link:hover {
    background: var(--bg-tertiary);
    border-color: var(--border-secondary);
    color: var(--text-primary);
}

/* 响应式设计 - iFlow OAuth */
@media (max-width: 768px) {
    #iflow-oauth-content .input-group {
        flex-direction: column;
        align-items: stretch;
    }

    #iflow-open-link,
    #iflow-copy-link {
        width: 100%;
        margin-top: 8px;
    }

    #iflow-oauth-url {
        font-size: 12px;
    }
}
/* 日志查看样式 */
.logs-container {
    background: var(--bg-tertiary);
    border-radius: 8px;
    padding: 16px;
    min-height: 500px;
    max-height: calc(100vh - 400px);
    overflow-y: auto;
    font-family: 'Monaco', 'Menlo', 'Consolas', 'Ubuntu Mono', monospace;
}

.logs-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--border-primary);
    font-size: 13px;
    color: var(--text-tertiary);
}

.logs-info span {
    display: flex;
    align-items: center;
    gap: 6px;
}

.logs-text {
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: 6px;
    padding: 16px;
    font-size: 13px;
    line-height: 1.6;
    color: var(--text-secondary);
    font-weight: 600;
    white-space: pre-wrap;
    word-wrap: break-word;
    max-height: calc(100vh - 480px);
    min-height: 450px;
    overflow-y: auto;
    margin: 0;
}

.logs-text .log-line {
    display: block;
    padding: 2px 0;
    margin: 0;
    color: inherit;
}

.logs-text .log-line + .log-line {
    margin-top: 2px;
}

.logs-text .log-status-tag {
    display: inline-block;
    padding: 0 8px;
    margin-right: 6px;
    border-radius: 6px;
    font-weight: 700;
    letter-spacing: 0.3px;
}

.logs-text .log-status-tag.log-status-2xx {
    background: rgba(16, 185, 129, 0.18);
    color: #047857;
}

.logs-text .log-status-tag.log-status-3xx {
    background: rgba(6, 182, 212, 0.2);
    color: #0f766e;
}

.logs-text .log-status-tag.log-status-4xx {
    background: rgba(251, 191, 36, 0.26);
    color: #92400e;
}

.logs-text .log-status-tag.log-status-5xx {
    background: rgba(239, 68, 68, 0.22);
    color: #b91c1c;
}

.logs-text .log-status-tag.log-status-1xx {
    background: rgba(165, 180, 252, 0.22);
    color: #4338ca;
}

/* 日志高亮样式 */

/* 时间戳高亮 */
.logs-text .log-timestamp {
    color: #8b5cf6;
    font-weight: 600;
}

/* 日志级别高亮 */
.logs-text .log-level {
    display: inline-block;
    padding: 1px 6px;
    border-radius: 4px;
    font-weight: 700;
    font-size: 0.95em;
    letter-spacing: 0.5px;
}

.logs-text .log-level-error {
    background: rgba(239, 68, 68, 0.20);
    color: #dc2626;
}

.logs-text .log-level-warn {
    background: rgba(251, 191, 36, 0.25);
    color: #d97706;
}

.logs-text .log-level-info {
    background: rgba(59, 130, 246, 0.20);
    color: #2563eb;
}

.logs-text .log-level-debug {
    background: rgba(107, 114, 128, 0.18);
    color: #6b7280;
}

/* HTTP 方法高亮 */
.logs-text .log-http-method {
    color: #0891b2;
    font-weight: 700;
}

/* 路径/URL 高亮 */
.logs-text .log-path {
    color: #059669;
    text-decoration: underline;
    text-decoration-style: dotted;
    text-decoration-color: rgba(5, 150, 105, 0.3);
}

/* IP 地址高亮 */
.logs-text .log-ip {
    color: #7c3aed;
    font-weight: 600;
}

/* 关键字高亮 - 成功 */
.logs-text .log-keyword-success {
    color: #059669;
    font-weight: 600;
}

/* 关键字高亮 - 错误 */
.logs-text .log-keyword-error {
    color: #dc2626;
    font-weight: 600;
}

/* 关键字高亮 - 警告 */
.logs-text .log-keyword-warn {
    color: #ea580c;
    font-weight: 600;
}

/* 数字和单位高亮 */
.logs-text .log-number-unit {
    color: #db2777;
    font-weight: 600;
}

.logs-text::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

.logs-text::-webkit-scrollbar-track {
    background: var(--bg-tertiary);
    border-radius: 4px;
}

.logs-text::-webkit-scrollbar-thumb {
    background: var(--border-secondary);
    border-radius: 4px;
}

.logs-text::-webkit-scrollbar-thumb:hover {
    background: var(--text-quaternary);
}

/* 空状态和错误状态 */
.logs-container .empty-state,
.logs-container .error-state,
.logs-container .upgrade-notice {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 300px;
    text-align: center;
    color: var(--text-tertiary);
}

.logs-container .empty-state i,
.logs-container .error-state i,
.logs-container .upgrade-notice i {
    font-size: 48px;
    margin-bottom: 16px;
    color: var(--border-secondary);
}

.logs-container .error-state i {
    color: var(--error-text);
}

.logs-container .upgrade-notice i {
    color: var(--primary-color);
}

.logs-container .empty-state p,
.logs-container .error-state p,
.logs-container .upgrade-notice p {
    margin: 4px 0;
    font-size: 14px;
}

.logs-container .empty-state p:first-of-type,
.logs-container .error-state p:first-of-type {
    font-weight: 600;
    color: var(--text-secondary);
    font-size: 16px;
}

.logs-container .upgrade-notice h3 {
    font-weight: 600;
    color: var(--text-secondary);
    font-size: 18px;
    margin-bottom: 8px;
}

.logs-container .upgrade-notice p {
    color: var(--text-tertiary);
    max-width: 500px;
    line-height: 1.6;
}

/* 日志页面头部布局 */
#logs .card-header.logs-header {
    flex-wrap: wrap;
    gap: 12px;
}

.logs-header-main {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
    min-width: 280px;
}

.logs-header-main h3 {
    margin: 0;
}

.logs-search {
    display: flex;
    align-items: center;
    border: 1px solid var(--border-primary);
    border-radius: 10px;
    padding: 0 12px;
    background: var(--bg-secondary);
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.03);
    min-width: 240px;
    max-width: 420px;
    flex: 1;
}

[data-theme="dark"] .logs-search {
    background: var(--bg-tertiary);
    box-shadow: inset 0 1px 1px rgba(255, 255, 255, 0.04);
}

.logs-search i {
    color: var(--text-tertiary);
    margin-right: 8px;
}

.logs-search input {
    border: none;
    background: transparent;
    color: var(--text-primary);
    width: 100%;
    padding: 10px 0;
    font-size: 0.95rem;
}

.logs-search input:focus {
    outline: none;
}

/* 日志页面头部操作区域 */
#logs .card-header .header-actions {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
}

#logs .card-header .header-actions .toggle-group {
    margin-bottom: 0;
}

/* 响应式设计 - 日志查看 */
@media (max-width: 768px) {
    .logs-container {
        min-height: 300px;
        max-height: calc(100vh - 350px);
        padding: 12px;
    }

    .logs-text {
        font-size: 11px;
        padding: 12px;
        max-height: calc(100vh - 430px);
        min-height: 250px;
    }

    .logs-info {
        font-size: 12px;
    }

    #logs .card-header.logs-header {
        align-items: flex-start;
    }

    .logs-header-main {
        width: 100%;
        flex-direction: column;
        align-items: flex-start;
    }

    .logs-search {
        width: 100%;
        max-width: none;
    }

    #logs .card-header .header-actions {
        width: 100%;
        justify-content: flex-start;
    }

    #logs .card-header .header-actions .btn {
        flex: 1;
        min-width: 0;
    }

    #logs .card-header .header-actions .btn span {
        display: none;
    }

    #logs .card-header .header-actions .toggle-group {
        width: 100%;
        justify-content: space-between;
    }
}

/* 暗色主题适配 */
[data-theme="dark"] .logs-text {
    background: rgba(15, 23, 42, 0.5);
    border-color: var(--border-primary);
    color: var(--text-tertiary);
}

[data-theme="dark"] .logs-text .log-status-tag.log-status-2xx {
    background: rgba(16, 185, 129, 0.32);
    color: #6ee7b7;
}

[data-theme="dark"] .logs-text .log-status-tag.log-status-3xx {
    background: rgba(6, 182, 212, 0.34);
    color: #5eead4;
}

[data-theme="dark"] .logs-text .log-status-tag.log-status-4xx {
    background: rgba(251, 191, 36, 0.38);
    color: #fcd34d;
}

[data-theme="dark"] .logs-text .log-status-tag.log-status-5xx {
    background: rgba(239, 68, 68, 0.38);
    color: #fca5a5;
}

[data-theme="dark"] .logs-text .log-status-tag.log-status-1xx {
    background: rgba(165, 180, 252, 0.38);
    color: #c7d2fe;
}

[data-theme="dark"] .logs-container {
    background: rgba(15, 23, 42, 0.3);
}

/* 暗色主题 - 日志高亮样式 */
[data-theme="dark"] .logs-text .log-timestamp {
    color: #c4b5fd;
}

[data-theme="dark"] .logs-text .log-level-error {
    background: rgba(239, 68, 68, 0.32);
    color: #fca5a5;
}

[data-theme="dark"] .logs-text .log-level-warn {
    background: rgba(251, 191, 36, 0.35);
    color: #fbbf24;
}

[data-theme="dark"] .logs-text .log-level-info {
    background: rgba(59, 130, 246, 0.32);
    color: #93c5fd;
}

[data-theme="dark"] .logs-text .log-level-debug {
    background: rgba(107, 114, 128, 0.28);
    color: #9ca3af;
}

[data-theme="dark"] .logs-text .log-http-method {
    color: #22d3ee;
}

[data-theme="dark"] .logs-text .log-path {
    color: #34d399;
    text-decoration-color: rgba(52, 211, 153, 0.3);
}

[data-theme="dark"] .logs-text .log-ip {
    color: #a78bfa;
}

[data-theme="dark"] .logs-text .log-keyword-success {
    color: #34d399;
}

[data-theme="dark"] .logs-text .log-keyword-error {
    color: #f87171;
}

[data-theme="dark"] .logs-text .log-keyword-warn {
    color: #fb923c;
}

[data-theme="dark"] .logs-text .log-number-unit {
    color: #f472b6;
}

/* Vertex AI Credential Import */
.vertex-import-actions {
    text-align: left;
    margin-top: 10px;
}

.vertex-import-result {
    margin-top: 20px;
    border: 1px dashed var(--border-primary);
    border-radius: 12px;
    padding: 16px;
    background: var(--bg-quaternary);
    color: var(--text-primary);
}

.vertex-import-result-header {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
    margin-bottom: 10px;
    color: var(--success-text);
}

.vertex-import-result ul {
    list-style: none;
    margin: 0;
    padding: 0;
}

.vertex-import-result li {
    margin-bottom: 6px;
    font-size: 14px;
    color: var(--text-secondary);
}

.vertex-import-result code {
    background: var(--bg-secondary);
    border-radius: 6px;
    padding: 2px 6px;
    font-size: 13px;
    color: var(--text-primary);
}

[data-theme="dark"] .vertex-import-result {
    border-color: rgba(96, 165, 250, 0.4);
    background: rgba(15, 23, 42, 0.4);
}

[data-theme="dark"] .vertex-import-result code {
    background: rgba(7, 11, 22, 0.8);
    color: #f3f4f6;
}

/* ===== AI提供商统计徽章样式 ===== */

/* 统计信息容器 */
.item-stats {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-top: 8px;
}

/* 统计徽章基础样式 */
.stat-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 500;
    transition: all 0.2s ease;
}

/* 成功统计徽章 */
.stat-badge.stat-success {
    background-color: var(--success-bg);
    color: var(--success-text);
    border: 1px solid var(--success-border);
}

.stat-badge.stat-neutral {
    background-color: var(--bg-tertiary);
    color: var(--text-secondary);
    border: 1px solid var(--border-color);
}

.stat-badge.stat-success i {
    font-size: 13px;
}

/* 失败统计徽章 */
.stat-badge.stat-failure {
    background-color: var(--error-bg);
    color: var(--error-text);
    border: 1px solid var(--error-border);
}

.stat-badge.stat-failure i {
    font-size: 13px;
}

/* 悬停效果 */
.stat-badge:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-sm);
}

/* 暗色主题适配 */
[data-theme="dark"] .stat-badge.stat-success {
    background-color: rgba(6, 78, 59, 0.3);
    color: #6ee7b7;
    border-color: rgba(5, 150, 105, 0.5);
}

[data-theme="dark"] .stat-badge.stat-failure {
    background-color: rgba(153, 27, 27, 0.3);
    color: #fca5a5;
    border-color: rgba(220, 38, 38, 0.5);
}

/* 响应式设计 */
@media (max-width: 768px) {
    .item-stats {
        gap: 6px;
        margin-top: 8px;
    }
    
    .stat-badge {
        padding: 3px 8px;
        font-size: 11px;
    }
    
    .stat-badge i {
        font-size: 11px !important;
    }
}

/* 响应式设计 - API Keys 和 AI Providers 按钮优化 */
@media (max-width: 768px) {
    /* 移动端按钮位置调整 */
    .key-item .item-actions,
    .provider-item .item-actions {
        position: relative;
        top: auto;
        right: auto;
        transform: none;
        margin-top: 12px;
        justify-content: flex-start;
    }

    /* 移动端移除内容右侧内边距 */
    .key-item .item-content,
    .provider-item .item-content {
        padding-right: 0;
    }

    /* 移动端按钮尺寸调整 */
    .key-item .item-actions .btn,
    .provider-item .item-actions .btn {
        min-width: 36px;
        height: 36px;
    }

    .key-item .item-actions .btn:hover,
    .provider-item .item-actions .btn:hover {
        transform: scale(1.05);
    }

    .key-item .item-actions .btn i,
    .provider-item .item-actions .btn i {
        font-size: 14px;
    }
}

#config-management .CodeMirror .CodeMirror-lines {
    padding: 12px;
}

</style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/yaml/yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/comment/comment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    <script>
// 国际化语言包
const i18n = {
    // 语言配置
    currentLanguage: 'zh-CN',
    fallbackLanguage: 'zh-CN',

    // 语言包
    translations: {
        'zh-CN': {
            // 通用
            'common.login': '登录',
            'common.logout': '登出',
            'common.cancel': '取消',
            'common.confirm': '确认',
            'common.save': '保存',
            'common.delete': '删除',
            'common.edit': '编辑',
            'common.add': '添加',
            'common.update': '更新',
            'common.refresh': '刷新',
            'common.close': '关闭',
            'common.success': '成功',
            'common.error': '错误',
            'common.info': '信息',
            'common.warning': '警告',
            'common.loading': '加载中...',
            'common.connecting': '连接中...',
            'common.connected': '已连接',
            'common.disconnected': '未连接',
            'common.connecting_status': '连接中',
            'common.connected_status': '已连接',
            'common.disconnected_status': '未连接',
            'common.yes': '是',
            'common.no': '否',
            'common.optional': '可选',
            'common.required': '必填',
            'common.api_key': '密钥',
            'common.base_url': '地址',
            'common.proxy_url': '代理',
            'common.alias': '别名',
            'common.failure': '失败',
            'common.unknown_error': '未知错误',
            'common.copy': '复制',
            'common.custom_headers_label': '自定义请求头',
            'common.custom_headers_hint': '可选，设置需要附带到请求中的 HTTP 头，名称和值均不能为空。',
            'common.custom_headers_add': '添加请求头',
            'common.custom_headers_key_placeholder': 'Header 名称，例如 X-Custom-Header',
            'common.custom_headers_value_placeholder': 'Header 值',
            'common.model_name_placeholder': '模型名称，例如 claude-3-5-sonnet-20241022',
            'common.model_alias_placeholder': '模型别名 (可选)',

            // 页面标题
            'title.main': 'CLI Proxy API Management Center',
            'title.login': 'CLI Proxy API Management Center',
            'title.abbr': 'CPAMC',

            // 自动登录
            'auto_login.title': '正在自动登录...',
            'auto_login.message': '正在使用本地保存的连接信息尝试连接服务器',

            // 登录页面
            'login.subtitle': '请输入连接信息以访问管理界面',
            'login.connection_title': '连接地址',
            'login.connection_current': '当前地址',
            'login.connection_auto_hint': '系统将自动使用当前访问地址进行连接',
            'login.custom_connection_label': '自定义连接地址:',
            'login.custom_connection_placeholder': '例如: https://example.com:8317',
            'login.custom_connection_hint': '默认使用当前访问地址，若需要可手动输入其他地址。',
            'login.use_current_address': '使用当前地址',
            'login.management_key_label': '管理密钥:',
            'login.management_key_placeholder': '请输入管理密钥',
            'login.connect_button': '连接',
            'login.submit_button': '登录',
            'login.submitting': '连接中...',
            'login.error_title': '登录失败',
            'login.error_required': '请填写完整的连接信息',
            'login.error_invalid': '连接失败，请检查地址和密钥',

            // 头部导航
            'header.check_connection': '检查连接',
            'header.refresh_all': '刷新全部',
            'header.logout': '登出',

            // 连接信息
            'connection.title': '连接信息',
            'connection.server_address': '服务器地址:',
            'connection.management_key': '管理密钥:',
            'connection.status': '连接状态:',

            // 侧边栏导航
            'nav.basic_settings': '基础设置',
            'nav.api_keys': 'API 密钥',
            'nav.ai_providers': 'AI 提供商',
            'nav.auth_files': '认证文件',
            'nav.usage_stats': '使用统计',
            'nav.config_management': '配置管理',
            'nav.logs': '日志查看',
            'nav.system_info': '中心信息',

            // 基础设置
            'basic_settings.title': '基础设置',
            'basic_settings.debug_title': '调试模式',
            'basic_settings.debug_enable': '启用调试模式',
            'basic_settings.proxy_title': '代理设置',
            'basic_settings.proxy_url_label': '代理 URL:',
            'basic_settings.proxy_url_placeholder': '例如: socks5://user:pass@127.0.0.1:1080/',
            'basic_settings.proxy_update': '更新',
            'basic_settings.proxy_clear': '清空',
            'basic_settings.retry_title': '请求重试',
            'basic_settings.retry_count_label': '重试次数:',
            'basic_settings.retry_update': '更新',
            'basic_settings.quota_title': '配额超出行为',
            'basic_settings.quota_switch_project': '自动切换项目',
            'basic_settings.quota_switch_preview': '切换到预览模型',
            'basic_settings.usage_statistics_title': '使用统计',
            'basic_settings.usage_statistics_enable': '启用使用统计',
            'basic_settings.logging_title': '日志记录',
            'basic_settings.logging_to_file_enable': '启用日志记录到文件',
            'basic_settings.request_log_enable': '启用请求日志',
            'basic_settings.ws_auth_title': 'WebSocket 鉴权',
            'basic_settings.ws_auth_enable': '启用 /ws/* 鉴权',

            // API 密钥管理
            'api_keys.title': 'API 密钥管理',
            'api_keys.proxy_auth_title': '代理服务认证密钥',
            'api_keys.add_button': '添加密钥',
            'api_keys.empty_title': '暂无API密钥',
            'api_keys.empty_desc': '点击上方按钮添加第一个密钥',
            'api_keys.item_title': 'API密钥',
            'api_keys.add_modal_title': '添加API密钥',
            'api_keys.add_modal_key_label': 'API密钥:',
            'api_keys.add_modal_key_placeholder': '请输入API密钥',
            'api_keys.edit_modal_title': '编辑API密钥',
            'api_keys.edit_modal_key_label': 'API密钥:',
            'api_keys.delete_confirm': '确定要删除这个API密钥吗？',

            // AI 提供商
            'ai_providers.title': 'AI 提供商配置',
            'ai_providers.gemini_title': 'Gemini API 密钥',
            'ai_providers.gemini_add_button': '添加密钥',
            'ai_providers.gemini_empty_title': '暂无Gemini密钥',
            'ai_providers.gemini_empty_desc': '点击上方按钮添加第一个密钥',
            'ai_providers.gemini_item_title': 'Gemini密钥',
            'ai_providers.gemini_add_modal_title': '添加Gemini API密钥',
            'ai_providers.gemini_add_modal_key_label': 'API密钥',
            'ai_providers.gemini_add_modal_key_placeholder': '输入 Gemini API 密钥',
            'ai_providers.gemini_add_modal_key_hint': '逐条输入密钥，可同时指定可选 Base URL。',
            'ai_providers.gemini_keys_add_btn': '添加密钥',
            'ai_providers.gemini_base_url_placeholder': '可选 Base URL，如 https://generativelanguage.googleapis.com',
            'ai_providers.gemini_edit_modal_title': '编辑Gemini API密钥',
            'ai_providers.gemini_edit_modal_key_label': 'API密钥:',
            'ai_providers.gemini_delete_confirm': '确定要删除这个Gemini密钥吗？',
            'ai_providers.excluded_models_label': '排除的模型 (可选):',
            'ai_providers.excluded_models_placeholder': '用逗号或换行分隔，例如: gemini-1.5-pro, gemini-1.5-flash',
            'ai_providers.excluded_models_hint': '留空表示不过滤；保存时会自动去重并忽略空白。',
            'ai_providers.excluded_models_count': '排除 {count} 个模型',

            'ai_providers.codex_title': 'Codex API 配置',
            'ai_providers.codex_add_button': '添加配置',
            'ai_providers.codex_empty_title': '暂无Codex配置',
            'ai_providers.codex_empty_desc': '点击上方按钮添加第一个配置',
            'ai_providers.codex_item_title': 'Codex配置',
            'ai_providers.codex_add_modal_title': '添加Codex API配置',
            'ai_providers.codex_add_modal_key_label': 'API密钥:',
            'ai_providers.codex_add_modal_key_placeholder': '请输入Codex API密钥',
            'ai_providers.codex_add_modal_url_label': 'Base URL (必填):',
            'ai_providers.codex_add_modal_url_placeholder': '例如: https://api.example.com',
            'ai_providers.codex_add_modal_proxy_label': '代理 URL (可选):',
            'ai_providers.codex_add_modal_proxy_placeholder': '例如: socks5://proxy.example.com:1080',
            'ai_providers.codex_edit_modal_title': '编辑Codex API配置',
            'ai_providers.codex_edit_modal_key_label': 'API密钥:',
            'ai_providers.codex_edit_modal_url_label': 'Base URL (必填):',
            'ai_providers.codex_edit_modal_proxy_label': '代理 URL (可选):',
            'ai_providers.codex_delete_confirm': '确定要删除这个Codex配置吗？',

            'ai_providers.claude_title': 'Claude API 配置',
            'ai_providers.claude_add_button': '添加配置',
            'ai_providers.claude_empty_title': '暂无Claude配置',
            'ai_providers.claude_empty_desc': '点击上方按钮添加第一个配置',
            'ai_providers.claude_item_title': 'Claude配置',
            'ai_providers.claude_add_modal_title': '添加Claude API配置',
            'ai_providers.claude_add_modal_key_label': 'API密钥:',
            'ai_providers.claude_add_modal_key_placeholder': '请输入Claude API密钥',
            'ai_providers.claude_add_modal_url_label': 'Base URL (可选):',
            'ai_providers.claude_add_modal_url_placeholder': '例如: https://api.anthropic.com',
            'ai_providers.claude_add_modal_proxy_label': '代理 URL (可选):',
            'ai_providers.claude_add_modal_proxy_placeholder': '例如: socks5://proxy.example.com:1080',
            'ai_providers.claude_edit_modal_title': '编辑Claude API配置',
            'ai_providers.claude_edit_modal_key_label': 'API密钥:',
            'ai_providers.claude_edit_modal_url_label': 'Base URL (可选):',
            'ai_providers.claude_edit_modal_proxy_label': '代理 URL (可选):',
            'ai_providers.claude_delete_confirm': '确定要删除这个Claude配置吗？',
            'ai_providers.claude_models_label': '自定义模型 (可选):',
            'ai_providers.claude_models_hint': '为空表示使用全部模型；可填写 name[, alias] 以限制或重命名模型。',
            'ai_providers.claude_models_add_btn': '添加模型',
            'ai_providers.claude_models_count': '模型数量',

            'ai_providers.openai_title': 'OpenAI 兼容提供商',
            'ai_providers.openai_add_button': '添加提供商',
            'ai_providers.openai_empty_title': '暂无OpenAI兼容提供商',
            'ai_providers.openai_empty_desc': '点击上方按钮添加第一个提供商',
            'ai_providers.openai_add_modal_title': '添加OpenAI兼容提供商',
            'ai_providers.openai_add_modal_name_label': '提供商名称:',
            'ai_providers.openai_add_modal_name_placeholder': '例如: openrouter',
            'ai_providers.openai_add_modal_url_label': 'Base URL:',
            'ai_providers.openai_add_modal_url_placeholder': '例如: https://openrouter.ai/api/v1',
            'ai_providers.openai_add_modal_keys_label': 'API密钥',
            'ai_providers.openai_edit_modal_keys_label': 'API密钥',
            'ai_providers.openai_keys_hint': '每个密钥可搭配一个可选代理地址，更便于管理。',
            'ai_providers.openai_keys_add_btn': '添加密钥',
            'ai_providers.openai_key_placeholder': '输入 sk- 开头的密钥',
            'ai_providers.openai_proxy_placeholder': '可选代理 URL (如 socks5://...)',
            'ai_providers.openai_add_modal_models_label': '模型列表 (name[, alias] 每行一个):',
            'ai_providers.openai_models_hint': '示例：gpt-4o-mini 或 moonshotai/kimi-k2:free, kimi-k2',
            'ai_providers.openai_model_name_placeholder': '模型名称，如 moonshotai/kimi-k2:free',
            'ai_providers.openai_model_alias_placeholder': '模型别名 (可选)',
            'ai_providers.openai_models_add_btn': '添加模型',
            'ai_providers.openai_models_fetch_button': '从 /v1/models 获取',
            'ai_providers.openai_models_fetch_title': '从 /v1/models 选择模型',
            'ai_providers.openai_models_fetch_hint': '使用上方 Base URL 调用 /v1/models 端点，附带首个 API Key（Bearer）与自定义请求头。',
            'ai_providers.openai_models_fetch_url_label': '请求地址',
            'ai_providers.openai_models_fetch_refresh': '重新获取',
            'ai_providers.openai_models_fetch_loading': '正在从 /v1/models 获取模型列表...',
            'ai_providers.openai_models_fetch_empty': '未获取到模型，请检查端点或鉴权信息。',
            'ai_providers.openai_models_fetch_error': '获取模型失败',
            'ai_providers.openai_models_fetch_back': '返回编辑',
            'ai_providers.openai_models_fetch_apply': '添加所选模型',
            'ai_providers.openai_models_search_label': '搜索模型',
            'ai_providers.openai_models_search_placeholder': '按名称、别名或描述筛选',
            'ai_providers.openai_models_search_empty': '没有匹配的模型，请更换关键字试试。',
            'ai_providers.openai_models_fetch_invalid_url': '请先填写有效的 Base URL',
            'ai_providers.openai_models_fetch_added': '已添加 {count} 个新模型',
            'ai_providers.openai_edit_modal_title': '编辑OpenAI兼容提供商',
            'ai_providers.openai_edit_modal_name_label': '提供商名称:',
            'ai_providers.openai_edit_modal_url_label': 'Base URL:',
            'ai_providers.openai_edit_modal_keys_label': 'API密钥',
            'ai_providers.openai_edit_modal_models_label': '模型列表 (name[, alias] 每行一个):',
            'ai_providers.openai_delete_confirm': '确定要删除这个OpenAI提供商吗？',
            'ai_providers.openai_keys_count': '密钥数量',
            'ai_providers.openai_models_count': '模型数量',
            'ai_providers.openai_test_title': '连通性测试',
            'ai_providers.openai_test_hint': '使用当前配置向 /v1/chat/completions 请求，验证是否可用。',
            'ai_providers.openai_test_model_placeholder': '选择或输入要测试的模型',
            'ai_providers.openai_test_action': '发送测试',
            'ai_providers.openai_test_running': '正在发送测试请求...',
            'ai_providers.openai_test_success': '测试成功，模型可用。',
            'ai_providers.openai_test_failed': '测试失败',
            'ai_providers.openai_test_select_placeholder': '从当前模型列表选择',
            'ai_providers.openai_test_select_empty': '当前未配置模型，可直接输入',


            // 认证文件管理
            'auth_files.title': '认证文件管理',
            'auth_files.title_section': '认证文件',
            'auth_files.description': '这里集中管理 CLI Proxy 支持的所有 JSON 认证文件（如 Qwen、Gemini、Vertex 等），上传后即可在运行时启用相应的 AI 服务。',
            'auth_files.upload_button': '上传文件',
            'auth_files.delete_all_button': '删除全部',
            'auth_files.empty_title': '暂无认证文件',
            'auth_files.empty_desc': '点击上方按钮上传第一个文件',
            'auth_files.search_empty_title': '没有匹配的配置文件',
            'auth_files.search_empty_desc': '请调整筛选条件或清空搜索关键字再试一次。',
            'auth_files.file_size': '大小',
            'auth_files.file_modified': '修改时间',
            'auth_files.download_button': '下载',
            'auth_files.delete_button': '删除',
            'auth_files.delete_confirm': '确定要删除文件',
            'auth_files.delete_all_confirm': '确定要删除所有认证文件吗？此操作不可恢复！',
            'auth_files.delete_filtered_confirm': '确定要删除筛选出的 {type} 认证文件吗？此操作不可恢复！',
            'auth_files.upload_error_json': '只能上传JSON文件',
            'auth_files.upload_success': '文件上传成功',
            'auth_files.download_success': '文件下载成功',
            'auth_files.delete_success': '文件删除成功',
            'auth_files.delete_all_success': '成功删除',
            'auth_files.delete_filtered_success': '成功删除 {count} 个 {type} 认证文件',
            'auth_files.delete_filtered_partial': '{type} 认证文件删除完成，成功 {success} 个，失败 {failed} 个',
            'auth_files.delete_filtered_none': '当前筛选类型 ({type}) 下没有可删除的认证文件',
            'auth_files.files_count': '个文件',
            'auth_files.pagination_prev': '上一页',
            'auth_files.pagination_next': '下一页',
            'auth_files.pagination_info': '第 {current} / {total} 页 · 共 {count} 个文件',
            'auth_files.search_label': '搜索配置文件',
            'auth_files.search_placeholder': '输入名称、类型或提供方关键字',
            'auth_files.page_size_label': '单页数量',
            'auth_files.page_size_unit': '个/页',
            'auth_files.filter_all': '全部',
            'auth_files.filter_qwen': 'Qwen',
            'auth_files.filter_gemini': 'Gemini',
            'auth_files.filter_gemini-cli': 'GeminiCLI',
            'auth_files.filter_aistudio': 'AIStudio',
            'auth_files.filter_claude': 'Claude',
            'auth_files.filter_codex': 'Codex',
            'auth_files.filter_antigravity': 'Antigravity',
            'auth_files.filter_iflow': 'iFlow',
            'auth_files.filter_vertex': 'Vertex',
            'auth_files.filter_empty': '空文件',
            'auth_files.filter_unknown': '其他',
            'auth_files.type_qwen': 'Qwen',
            'auth_files.type_gemini': 'Gemini',
            'auth_files.type_gemini-cli': 'GeminiCLI',
            'auth_files.type_aistudio': 'AIStudio',
            'auth_files.type_claude': 'Claude',
            'auth_files.type_codex': 'Codex',
            'auth_files.type_antigravity': 'Antigravity',
            'auth_files.type_iflow': 'iFlow',
            'auth_files.type_vertex': 'Vertex',
            'auth_files.type_empty': '空文件',
            'auth_files.type_unknown': '其他',
            'vertex_import.title': 'Vertex AI 凭证导入',
            'vertex_import.description': '上传 Google 服务账号 JSON，使用 CLI vertex-import 同步规则写入 auth-dir/vertex-<project>.json。',
            'vertex_import.location_label': '目标区域 (可选)',
            'vertex_import.location_placeholder': 'us-central1',
            'vertex_import.location_hint': '留空表示使用默认区域 us-central1。',
            'vertex_import.file_label': '服务账号密钥 JSON',
            'vertex_import.file_hint': '仅支持 Google Cloud service account key JSON 文件，私钥会自动规范化。',
            'vertex_import.file_placeholder': '尚未选择文件',
            'vertex_import.choose_file': '选择文件',
            'vertex_import.import_button': '导入 Vertex 凭证',
            'vertex_import.file_required': '请先选择 .json 凭证文件',
            'vertex_import.success': 'Vertex 凭证导入成功',
            'vertex_import.result_title': '凭证已保存',
            'vertex_import.result_project': '项目 ID',
            'vertex_import.result_email': '服务账号',
            'vertex_import.result_location': '区域',
            'vertex_import.result_file': '存储文件',

            // OAuth 排除模型
            'oauth_excluded.title': 'OAuth 排除列表',
            'oauth_excluded.description': '按提供商分列展示，点击卡片编辑或删除；支持 * 通配符，范围跟随上方的配置文件过滤标签。',
            'oauth_excluded.add': '新增排除',
            'oauth_excluded.add_title': '新增提供商排除列表',
            'oauth_excluded.edit_title': '编辑 {provider} 的排除列表',
            'oauth_excluded.refresh': '刷新',
            'oauth_excluded.refreshing': '刷新中...',
            'oauth_excluded.provider_label': '提供商',
            'oauth_excluded.provider_auto': '跟随当前过滤',
            'oauth_excluded.provider_placeholder': '例如 gemini-cli / openai',
            'oauth_excluded.provider_hint': '默认选中当前筛选的提供商，也可直接输入或选择其他名称。',
            'oauth_excluded.models_label': '排除的模型',
            'oauth_excluded.models_placeholder': 'gpt-4.1-mini\n*-preview',
            'oauth_excluded.models_hint': '逗号或换行分隔；留空保存将删除该提供商记录；支持 * 通配符。',
            'oauth_excluded.save': '保存/更新',
            'oauth_excluded.saving': '正在保存...',
            'oauth_excluded.save_success': '排除列表已更新',
            'oauth_excluded.save_failed': '更新排除列表失败',
            'oauth_excluded.delete': '删除提供商',
            'oauth_excluded.delete_confirm': '确定要删除 {provider} 的排除列表吗？',
            'oauth_excluded.delete_success': '已删除该提供商的排除列表',
            'oauth_excluded.delete_failed': '删除排除列表失败',
            'oauth_excluded.deleting': '正在删除...',
            'oauth_excluded.no_models': '未配置排除模型',
            'oauth_excluded.model_count': '排除 {count} 个模型',
            'oauth_excluded.list_empty_all': '暂无任何提供商的排除列表，点击“新增排除”创建。',
            'oauth_excluded.list_empty_filtered': '当前筛选下没有排除项，点击“新增排除”添加。',
            'oauth_excluded.disconnected': '请先连接服务器以查看排除列表',
            'oauth_excluded.load_failed': '加载排除列表失败',
            'oauth_excluded.provider_required': '请先填写提供商名称',
            'oauth_excluded.scope_all': '当前范围：全局（显示所有提供商）',
            'oauth_excluded.scope_provider': '当前范围：{provider}',


            // Codex OAuth
            'auth_login.codex_oauth_title': 'Codex OAuth',
            'auth_login.codex_oauth_button': '开始 Codex 登录',
            'auth_login.codex_oauth_hint': '通过 OAuth 流程登录 Codex 服务，自动获取并保存认证文件。',
            'auth_login.codex_oauth_url_label': '授权链接:',
            'auth_login.codex_open_link': '打开链接',
            'auth_login.codex_copy_link': '复制链接',
            'auth_login.codex_oauth_status_waiting': '等待认证中...',
            'auth_login.codex_oauth_status_success': '认证成功！',
            'auth_login.codex_oauth_status_error': '认证失败:',
            'auth_login.codex_oauth_start_error': '启动 Codex OAuth 失败:',
            'auth_login.codex_oauth_polling_error': '检查认证状态失败:',

            // Anthropic OAuth
            'auth_login.anthropic_oauth_title': 'Anthropic OAuth',
            'auth_login.anthropic_oauth_button': '开始 Anthropic 登录',
            'auth_login.anthropic_oauth_hint': '通过 OAuth 流程登录 Anthropic (Claude) 服务，自动获取并保存认证文件。',
            'auth_login.anthropic_oauth_url_label': '授权链接:',
            'auth_login.anthropic_open_link': '打开链接',
            'auth_login.anthropic_copy_link': '复制链接',
            'auth_login.anthropic_oauth_status_waiting': '等待认证中...',
            'auth_login.anthropic_oauth_status_success': '认证成功！',
            'auth_login.anthropic_oauth_status_error': '认证失败:',
            'auth_login.anthropic_oauth_start_error': '启动 Anthropic OAuth 失败:',
            'auth_login.anthropic_oauth_polling_error': '检查认证状态失败:',

            // Antigravity OAuth
            'auth_login.antigravity_oauth_title': 'Antigravity OAuth',
            'auth_login.antigravity_oauth_button': '开始 Antigravity 登录',
            'auth_login.antigravity_oauth_hint': '通过 OAuth 流程登录 Antigravity（Google 账号）服务，自动获取并保存认证文件。',
            'auth_login.antigravity_oauth_url_label': '授权链接:',
            'auth_login.antigravity_open_link': '打开链接',
            'auth_login.antigravity_copy_link': '复制链接',
            'auth_login.antigravity_oauth_status_waiting': '等待认证中...',
            'auth_login.antigravity_oauth_status_success': '认证成功！',
            'auth_login.antigravity_oauth_status_error': '认证失败:',
            'auth_login.antigravity_oauth_start_error': '启动 Antigravity OAuth 失败:',
            'auth_login.antigravity_oauth_polling_error': '检查认证状态失败:',

            // Gemini CLI OAuth
            'auth_login.gemini_cli_oauth_title': 'Gemini CLI OAuth',
            'auth_login.gemini_cli_oauth_button': '开始 Gemini CLI 登录',
            'auth_login.gemini_cli_oauth_hint': '通过 OAuth 流程登录 Google Gemini CLI 服务，自动获取并保存认证文件。',
            'auth_login.gemini_cli_project_id_label': 'Google Cloud 项目 ID (可选):',
            'auth_login.gemini_cli_project_id_placeholder': '输入 Google Cloud 项目 ID (可选)',
            'auth_login.gemini_cli_project_id_hint': '如果指定了项目 ID，将使用该项目的认证信息。',
            'auth_login.gemini_cli_oauth_url_label': '授权链接:',
            'auth_login.gemini_cli_open_link': '打开链接',
            'auth_login.gemini_cli_copy_link': '复制链接',
            'auth_login.gemini_cli_oauth_status_waiting': '等待认证中...',
            'auth_login.gemini_cli_oauth_status_success': '认证成功！',
            'auth_login.gemini_cli_oauth_status_error': '认证失败:',
            'auth_login.gemini_cli_oauth_start_error': '启动 Gemini CLI OAuth 失败:',
            'auth_login.gemini_cli_oauth_polling_error': '检查认证状态失败:',

            // Qwen OAuth
            'auth_login.qwen_oauth_title': 'Qwen OAuth',
            'auth_login.qwen_oauth_button': '开始 Qwen 登录',
            'auth_login.qwen_oauth_hint': '通过设备授权流程登录 Qwen 服务，自动获取并保存认证文件。',
            'auth_login.qwen_oauth_url_label': '授权链接:',
            'auth_login.qwen_open_link': '打开链接',
            'auth_login.qwen_copy_link': '复制链接',
            'auth_login.qwen_oauth_status_waiting': '等待认证中...',
            'auth_login.qwen_oauth_status_success': '认证成功！',
            'auth_login.qwen_oauth_status_error': '认证失败:',
            'auth_login.qwen_oauth_start_error': '启动 Qwen OAuth 失败:',
            'auth_login.qwen_oauth_polling_error': '检查认证状态失败:',
            'auth_login.missing_state': '无法获取认证状态参数',

            // iFlow OAuth
            'auth_login.iflow_oauth_title': 'iFlow OAuth',
            'auth_login.iflow_oauth_button': '开始 iFlow 登录',
            'auth_login.iflow_oauth_hint': '通过 OAuth 流程登录 iFlow 服务，自动获取并保存认证文件。',
            'auth_login.iflow_oauth_local_only': 'iFlow OAuth 仅在本机 (127.0.0.1) 访问时可用，请使用 Cookie 登录。',
            'auth_login.iflow_oauth_url_label': '授权链接:',
            'auth_login.iflow_open_link': '打开链接',
            'auth_login.iflow_copy_link': '复制链接',
            'auth_login.iflow_oauth_status_waiting': '等待认证中...',
            'auth_login.iflow_oauth_status_success': '认证成功！',
            'auth_login.iflow_oauth_status_error': '认证失败:',
            'auth_login.iflow_oauth_start_error': '启动 iFlow OAuth 失败:',
            'auth_login.iflow_oauth_polling_error': '检查认证状态失败:',
            'auth_login.iflow_cookie_title': 'iFlow Cookie 登录',
            'auth_login.iflow_cookie_label': 'Cookie 内容:',
            'auth_login.iflow_cookie_placeholder': '粘贴浏览器中的 Cookie，例如 sessionid=...;',
            'auth_login.iflow_cookie_hint': '直接提交 Cookie 以完成登录（无需打开授权链接），服务端将自动保存凭据。',
            'auth_login.iflow_cookie_button': '提交 Cookie 登录',
            'auth_login.iflow_cookie_status_success': 'Cookie 登录成功，凭据已保存。',
            'auth_login.iflow_cookie_status_error': 'Cookie 登录失败:',
            'auth_login.iflow_cookie_start_error': '提交 Cookie 登录失败:',
            'auth_login.iflow_cookie_required': '请先填写 Cookie 内容',
            'auth_login.iflow_cookie_result_title': 'Cookie 登录结果',
            'auth_login.iflow_cookie_result_email': '账号',
            'auth_login.iflow_cookie_result_expired': '过期时间',
            'auth_login.iflow_cookie_result_path': '保存路径',
            'auth_login.iflow_cookie_result_type': '类型',

            // 使用统计
            'usage_stats.title': '使用统计',
            'usage_stats.total_requests': '总请求数',
            'usage_stats.success_requests': '成功请求',
            'usage_stats.failed_requests': '失败请求',
            'usage_stats.total_tokens': '总Token数',
            'usage_stats.cached_tokens': '缓存 Token 数',
            'usage_stats.reasoning_tokens': '思考 Token 数',
            'usage_stats.rpm_30m': 'RPM（近30分钟）',
            'usage_stats.tpm_30m': 'TPM（近30分钟）',
            'usage_stats.requests_trend': '请求趋势',
            'usage_stats.tokens_trend': 'Token 使用趋势',
            'usage_stats.api_details': 'API 详细统计',
            'usage_stats.by_hour': '按小时',
            'usage_stats.by_day': '按天',
            'usage_stats.refresh': '刷新',
            'usage_stats.chart_line_label_1': '曲线 1',
            'usage_stats.chart_line_label_2': '曲线 2',
            'usage_stats.chart_line_label_3': '曲线 3',
            'usage_stats.chart_line_label_4': '曲线 4',
            'usage_stats.chart_line_label_5': '曲线 5',
            'usage_stats.chart_line_label_6': '曲线 6',
            'usage_stats.chart_line_label_7': '曲线 7',
            'usage_stats.chart_line_label_8': '曲线 8',
            'usage_stats.chart_line_label_9': '曲线 9',
            'usage_stats.chart_line_hidden': '不显示',
            'usage_stats.chart_line_actions_label': '曲线数量',
            'usage_stats.chart_line_add': '增加曲线',
            'usage_stats.chart_line_all': '全部',
            'usage_stats.chart_line_delete': '删除曲线',
            'usage_stats.chart_line_hint': '最多同时显示 9 条模型曲线',
            'usage_stats.no_data': '暂无数据',
            'usage_stats.loading_error': '加载失败',
            'usage_stats.api_endpoint': 'API端点',
            'usage_stats.requests_count': '请求次数',
            'usage_stats.tokens_count': 'Token数量',
            'usage_stats.models': '模型统计',
            'usage_stats.success_rate': '成功率',
            'usage_stats.total_cost': '总花费',
            'usage_stats.total_cost_hint': '基于已设置的模型单价',
            'usage_stats.model_price_title': '模型价格',
            'usage_stats.model_price_reset': '清除价格',
            'usage_stats.model_price_model_label': '选择模型',
            'usage_stats.model_price_select_placeholder': '选择模型',
            'usage_stats.model_price_select_hint': '模型列表来自使用统计明细',
            'usage_stats.model_price_prompt': '提示价格 ($/1M tokens)',
            'usage_stats.model_price_completion': '补全价格 ($/1M tokens)',
            'usage_stats.model_price_save': '保存价格',
            'usage_stats.model_price_empty': '暂未设置任何模型价格',
            'usage_stats.model_price_model': '模型',
            'usage_stats.model_price_saved': '模型价格已保存',
            'usage_stats.model_price_model_required': '请选择要设置价格的模型',
            'usage_stats.cost_trend': '花费统计',
            'usage_stats.cost_axis_label': '花费 ($)',
            'usage_stats.cost_need_price': '请先设置模型价格',
            'usage_stats.cost_need_usage': '暂无使用数据，无法计算花费',
            'usage_stats.cost_no_data': '没有可计算的花费数据',
            'stats.success': '成功',
            'stats.failure': '失败',

            // 日志查看
            'logs.title': '日志查看',
            'logs.refresh_button': '刷新日志',
            'logs.clear_button': '清空日志',
            'logs.download_button': '下载日志',
            'logs.error_log_button': '选择错误日志',
            'logs.error_logs_modal_title': '错误请求日志',
            'logs.error_logs_description': '请选择要下载的错误请求日志文件（仅在关闭请求日志时生成）。',
            'logs.error_logs_empty': '暂无错误请求日志文件',
            'logs.error_logs_load_error': '加载错误日志列表失败',
            'logs.error_logs_size': '大小',
            'logs.error_logs_modified': '最后修改',
            'logs.error_logs_download': '下载',
            'logs.error_log_download_success': '错误日志下载成功',
            'logs.empty_title': '暂无日志记录',
            'logs.empty_desc': '当启用"日志记录到文件"功能后，日志将显示在这里',
            'logs.log_content': '日志内容',
            'logs.loading': '正在加载日志...',
            'logs.load_error': '加载日志失败',
            'logs.clear_confirm': '确定要清空所有日志吗？此操作不可恢复！',
            'logs.clear_success': '日志已清空',
            'logs.download_success': '日志下载成功',
            'logs.auto_refresh': '自动刷新',
            'logs.auto_refresh_enabled': '自动刷新已开启',
            'logs.auto_refresh_disabled': '自动刷新已关闭',
            'logs.search_placeholder': '搜索日志内容或关键字',
            'logs.search_empty_title': '未找到匹配的日志',
            'logs.search_empty_desc': '尝试更换关键字或清空搜索条件。',
            'logs.lines': '行',
            'logs.removed': '已删除',
            'logs.upgrade_required_title': '需要升级 CLI Proxy API',
            'logs.upgrade_required_desc': '当前服务器版本不支持日志查看功能，请升级到最新版本的 CLI Proxy API 以使用此功能。',

            // 配置管理
            'config_management.title': '配置管理',
            'config_management.editor_title': '配置文件',
            'config_management.reload': '重新加载',
            'config_management.save': '保存',
            'config_management.description': '查看并编辑服务器上的 config.yaml 配置文件。保存前请确认语法正确。',
            'config_management.status_idle': '等待操作',
            'config_management.status_loading': '加载配置中...',
            'config_management.status_loaded': '配置已加载',
            'config_management.status_dirty': '有未保存的更改',
            'config_management.status_disconnected': '请先连接服务器以加载配置',
            'config_management.status_load_failed': '加载失败',
            'config_management.status_saving': '正在保存配置...',
            'config_management.status_saved': '配置保存完成',
            'config_management.status_save_failed': '保存失败',
            'config_management.save_success': '配置已保存',
            'config_management.error_yaml_not_supported': '服务器未返回 YAML 格式，请确认 /config.yaml 接口可用',
            'config_management.editor_placeholder': 'key: value',

            // 系统信息
            'system_info.title': '管理中心信息',
            'system_info.connection_status_title': '连接状态',
            'system_info.api_status_label': 'API 状态:',
            'system_info.config_status_label': '配置状态:',
            'system_info.last_update_label': '最后更新:',
            'system_info.cache_data': '缓存数据',
            'system_info.real_time_data': '实时数据',
            'system_info.not_loaded': '未加载',
            'system_info.seconds_ago': '秒前',
            'system_info.models_title': '可用模型列表',
            'system_info.models_desc': '展示 /v1/models 返回的模型，并自动使用服务器保存的 API Key 进行鉴权。',
            'system_info.models_loading': '正在加载可用模型...',
            'system_info.models_empty': '未从 /v1/models 获取到模型数据',
            'system_info.models_error': '获取模型列表失败',
            'system_info.models_count': '可用模型 {count} 个',
            'system_info.version_check_title': '版本检查',
            'system_info.version_check_desc': '调用 /latest-version 接口比对服务器版本，提示是否有可用更新。',
            'system_info.version_current_label': '当前版本',
            'system_info.version_latest_label': '最新版本',
            'system_info.version_check_button': '检查更新',
            'system_info.version_check_idle': '点击检查更新',
            'system_info.version_checking': '正在检查最新版本...',
            'system_info.version_update_available': '有新版本可用：{version}',
            'system_info.version_is_latest': '当前已是最新版本',
            'system_info.version_check_error': '检查更新失败',
            'system_info.version_current_missing': '未获取到服务器版本号，暂无法比对',
            'system_info.version_unknown': '未知',

            // 通知消息
            'notification.debug_updated': '调试设置已更新',
            'notification.proxy_updated': '代理设置已更新',
            'notification.proxy_cleared': '代理设置已清空',
            'notification.retry_updated': '重试设置已更新',
            'notification.quota_switch_project_updated': '项目切换设置已更新',
            'notification.quota_switch_preview_updated': '预览模型切换设置已更新',
            'notification.usage_statistics_updated': '使用统计设置已更新',
            'notification.logging_to_file_updated': '日志记录设置已更新',
            'notification.request_log_updated': '请求日志设置已更新',
            'notification.ws_auth_updated': 'WebSocket 鉴权设置已更新',
            'notification.api_key_added': 'API密钥添加成功',
            'notification.api_key_updated': 'API密钥更新成功',
            'notification.api_key_deleted': 'API密钥删除成功',
            'notification.gemini_key_added': 'Gemini密钥添加成功',
            'notification.gemini_key_updated': 'Gemini密钥更新成功',
            'notification.gemini_key_deleted': 'Gemini密钥删除成功',
            'notification.gemini_multi_input_required': '请先输入至少一个Gemini密钥',
            'notification.gemini_multi_failed': 'Gemini密钥批量添加失败',
            'notification.gemini_multi_summary': 'Gemini批量添加完成：成功 {success}，跳过 {skipped}，失败 {failed}',
            'notification.codex_config_added': 'Codex配置添加成功',
            'notification.codex_config_updated': 'Codex配置更新成功',
            'notification.codex_config_deleted': 'Codex配置删除成功',
            'notification.codex_base_url_required': '请填写Codex Base URL',
            'notification.claude_config_added': 'Claude配置添加成功',
            'notification.claude_config_updated': 'Claude配置更新成功',
            'notification.claude_config_deleted': 'Claude配置删除成功',
            'notification.field_required': '必填字段不能为空',
            'notification.openai_provider_required': '请填写提供商名称和Base URL',
            'notification.openai_provider_added': 'OpenAI提供商添加成功',
            'notification.openai_provider_updated': 'OpenAI提供商更新成功',
            'notification.openai_provider_deleted': 'OpenAI提供商删除成功',
            'notification.openai_model_name_required': '请填写模型名称',
            'notification.openai_test_url_required': '请先填写有效的 Base URL 以进行测试',
            'notification.openai_test_key_required': '请至少填写一个 API 密钥以进行测试',
            'notification.openai_test_model_required': '请选择或输入要测试的模型',
            'notification.data_refreshed': '数据刷新成功',
            'notification.connection_required': '请先建立连接',
            'notification.refresh_failed': '刷新失败',
            'notification.update_failed': '更新失败',
            'notification.add_failed': '添加失败',
            'notification.delete_failed': '删除失败',
            'notification.upload_failed': '上传失败',
            'notification.download_failed': '下载失败',
            'notification.login_failed': '登录失败',
            'notification.please_enter': '请输入',
            'notification.please_fill': '请填写',
            'notification.provider_name_url': '提供商名称和Base URL',
            'notification.api_key': 'API密钥',
            'notification.gemini_api_key': 'Gemini API密钥',
            'notification.codex_api_key': 'Codex API密钥',
            'notification.claude_api_key': 'Claude API密钥',
            'notification.link_copied': '链接已复制到剪贴板',

            // 语言切换
            'language.switch': '语言',
            'language.chinese': '中文',
            'language.english': 'English',

            // 主题切换
            'theme.switch': '主题',
            'theme.light': '亮色',
            'theme.dark': '暗色',
            'theme.switch_to_light': '切换到亮色模式',
            'theme.switch_to_dark': '切换到暗色模式',
            'theme.auto': '跟随系统',

            // 侧边栏
            'sidebar.toggle_expand': '展开侧边栏',
            'sidebar.toggle_collapse': '收起侧边栏',

            // 页脚
            'footer.api_version': 'CLI Proxy API 版本',
            'footer.build_date': '构建时间',
            'footer.version': '管理中心版本',
            'footer.author': '作者'
        },

        'en-US': {
            // Common
            'common.login': 'Login',
            'common.logout': 'Logout',
            'common.cancel': 'Cancel',
            'common.confirm': 'Confirm',
            'common.save': 'Save',
            'common.delete': 'Delete',
            'common.edit': 'Edit',
            'common.add': 'Add',
            'common.update': 'Update',
            'common.refresh': 'Refresh',
            'common.close': 'Close',
            'common.success': 'Success',
            'common.error': 'Error',
            'common.info': 'Info',
            'common.warning': 'Warning',
            'common.loading': 'Loading...',
            'common.connecting': 'Connecting...',
            'common.connected': 'Connected',
            'common.disconnected': 'Disconnected',
            'common.connecting_status': 'Connecting',
            'common.connected_status': 'Connected',
            'common.disconnected_status': 'Disconnected',
            'common.yes': 'Yes',
            'common.no': 'No',
            'common.optional': 'Optional',
            'common.required': 'Required',
            'common.api_key': 'Key',
            'common.base_url': 'Address',
            'common.proxy_url': 'Proxy',
            'common.alias': 'Alias',
            'common.failure': 'Failure',
            'common.unknown_error': 'Unknown error',
            'common.copy': 'Copy',
            'common.custom_headers_label': 'Custom Headers',
            'common.custom_headers_hint': 'Optional HTTP headers to send with the request. Leave blank to remove.',
            'common.custom_headers_add': 'Add Header',
            'common.custom_headers_key_placeholder': 'Header name, e.g. X-Custom-Header',
            'common.custom_headers_value_placeholder': 'Header value',
            'common.model_name_placeholder': 'Model name, e.g. claude-3-5-sonnet-20241022',
            'common.model_alias_placeholder': 'Model alias (optional)',

            // Page titles
            'title.main': 'CLI Proxy API Management Center',
            'title.login': 'CLI Proxy API Management Center',
            'title.abbr': 'CPAMC',

            // Auto login
            'auto_login.title': 'Auto Login in Progress...',
            'auto_login.message': 'Attempting to connect to server using locally saved connection information',

            // Login page
            'login.subtitle': 'Please enter connection information to access the management interface',
            'login.connection_title': 'Connection Address',
            'login.connection_current': 'Current URL',
            'login.connection_auto_hint': 'The system will automatically use the current URL for connection',
            'login.custom_connection_label': 'Custom Connection URL:',
            'login.custom_connection_placeholder': 'Eg: https://example.com:8317',
            'login.custom_connection_hint': 'By default the current URL is used. Override it here if needed.',
            'login.use_current_address': 'Use Current URL',
            'login.management_key_label': 'Management Key:',
            'login.management_key_placeholder': 'Enter the management key',
            'login.connect_button': 'Connect',
            'login.submit_button': 'Login',
            'login.submitting': 'Connecting...',
            'login.error_title': 'Login Failed',
            'login.error_required': 'Please fill in complete connection information',
            'login.error_invalid': 'Connection failed, please check address and key',

            // Header navigation
            'header.check_connection': 'Check Connection',
            'header.refresh_all': 'Refresh All',
            'header.logout': 'Logout',

            // Connection info
            'connection.title': 'Connection Information',
            'connection.server_address': 'Server Address:',
            'connection.management_key': 'Management Key:',
            'connection.status': 'Connection Status:',

            // Sidebar navigation
            'nav.basic_settings': 'Basic Settings',
            'nav.api_keys': 'API Keys',
            'nav.ai_providers': 'AI Providers',
            'nav.auth_files': 'Auth Files',
            'nav.usage_stats': 'Usage Statistics',
            'nav.config_management': 'Config Management',
            'nav.logs': 'Logs Viewer',
            'nav.system_info': 'Management Center Info',

            // Basic settings
            'basic_settings.title': 'Basic Settings',
            'basic_settings.debug_title': 'Debug Mode',
            'basic_settings.debug_enable': 'Enable Debug Mode',
            'basic_settings.proxy_title': 'Proxy Settings',
            'basic_settings.proxy_url_label': 'Proxy URL:',
            'basic_settings.proxy_url_placeholder': 'e.g.: socks5://user:pass@127.0.0.1:1080/',
            'basic_settings.proxy_update': 'Update',
            'basic_settings.proxy_clear': 'Clear',
            'basic_settings.retry_title': 'Request Retry',
            'basic_settings.retry_count_label': 'Retry Count:',
            'basic_settings.retry_update': 'Update',
            'basic_settings.quota_title': 'Quota Exceeded Behavior',
            'basic_settings.quota_switch_project': 'Auto Switch Project',
            'basic_settings.quota_switch_preview': 'Switch to Preview Model',
            'basic_settings.usage_statistics_title': 'Usage Statistics',
            'basic_settings.usage_statistics_enable': 'Enable usage statistics',
            'basic_settings.logging_title': 'Logging',
            'basic_settings.logging_to_file_enable': 'Enable logging to file',
            'basic_settings.request_log_enable': 'Enable request logging',
            'basic_settings.ws_auth_title': 'WebSocket Authentication',
            'basic_settings.ws_auth_enable': 'Require auth for /ws/*',

            // API Keys management
            'api_keys.title': 'API Keys Management',
            'api_keys.proxy_auth_title': 'Proxy Service Authentication Keys',
            'api_keys.add_button': 'Add Key',
            'api_keys.empty_title': 'No API Keys',
            'api_keys.empty_desc': 'Click the button above to add the first key',
            'api_keys.item_title': 'API Key',
            'api_keys.add_modal_title': 'Add API Key',
            'api_keys.add_modal_key_label': 'API Key:',
            'api_keys.add_modal_key_placeholder': 'Please enter API key',
            'api_keys.edit_modal_title': 'Edit API Key',
            'api_keys.edit_modal_key_label': 'API Key:',
            'api_keys.delete_confirm': 'Are you sure you want to delete this API key?',

            // AI Providers
            'ai_providers.title': 'AI Providers Configuration',
            'ai_providers.gemini_title': 'Gemini API Keys',
            'ai_providers.gemini_add_button': 'Add Key',
            'ai_providers.gemini_empty_title': 'No Gemini Keys',
            'ai_providers.gemini_empty_desc': 'Click the button above to add the first key',
            'ai_providers.gemini_item_title': 'Gemini Key',
            'ai_providers.gemini_add_modal_title': 'Add Gemini API Key',
            'ai_providers.gemini_add_modal_key_label': 'API Keys:',
            'ai_providers.gemini_add_modal_key_placeholder': 'Enter Gemini API key',
            'ai_providers.gemini_add_modal_key_hint': 'Add keys one by one and optionally specify a Base URL.',
            'ai_providers.gemini_keys_add_btn': 'Add Key',
            'ai_providers.gemini_base_url_placeholder': 'Optional Base URL, e.g. https://generativelanguage.googleapis.com',
            'ai_providers.gemini_edit_modal_title': 'Edit Gemini API Key',
            'ai_providers.gemini_edit_modal_key_label': 'API Key:',
            'ai_providers.gemini_delete_confirm': 'Are you sure you want to delete this Gemini key?',
            'ai_providers.excluded_models_label': 'Excluded models (optional):',
            'ai_providers.excluded_models_placeholder': 'Comma or newline separated, e.g. gemini-1.5-pro, gemini-1.5-flash',
            'ai_providers.excluded_models_hint': 'Leave empty to allow all models; values are trimmed and deduplicated automatically.',
            'ai_providers.excluded_models_count': 'Excluding {count} models',

            'ai_providers.codex_title': 'Codex API Configuration',
            'ai_providers.codex_add_button': 'Add Configuration',
            'ai_providers.codex_empty_title': 'No Codex Configuration',
            'ai_providers.codex_empty_desc': 'Click the button above to add the first configuration',
            'ai_providers.codex_item_title': 'Codex Configuration',
            'ai_providers.codex_add_modal_title': 'Add Codex API Configuration',
            'ai_providers.codex_add_modal_key_label': 'API Key:',
            'ai_providers.codex_add_modal_key_placeholder': 'Please enter Codex API key',
            'ai_providers.codex_add_modal_url_label': 'Base URL (Required):',
            'ai_providers.codex_add_modal_url_placeholder': 'e.g.: https://api.example.com',
            'ai_providers.codex_add_modal_proxy_label': 'Proxy URL (Optional):',
            'ai_providers.codex_add_modal_proxy_placeholder': 'e.g.: socks5://proxy.example.com:1080',
            'ai_providers.codex_edit_modal_title': 'Edit Codex API Configuration',
            'ai_providers.codex_edit_modal_key_label': 'API Key:',
            'ai_providers.codex_edit_modal_url_label': 'Base URL (Required):',
            'ai_providers.codex_edit_modal_proxy_label': 'Proxy URL (Optional):',
            'ai_providers.codex_delete_confirm': 'Are you sure you want to delete this Codex configuration?',

            'ai_providers.claude_title': 'Claude API Configuration',
            'ai_providers.claude_add_button': 'Add Configuration',
            'ai_providers.claude_empty_title': 'No Claude Configuration',
            'ai_providers.claude_empty_desc': 'Click the button above to add the first configuration',
            'ai_providers.claude_item_title': 'Claude Configuration',
            'ai_providers.claude_add_modal_title': 'Add Claude API Configuration',
            'ai_providers.claude_add_modal_key_label': 'API Key:',
            'ai_providers.claude_add_modal_key_placeholder': 'Please enter Claude API key',
            'ai_providers.claude_add_modal_url_label': 'Base URL (Optional):',
            'ai_providers.claude_add_modal_url_placeholder': 'e.g.: https://api.anthropic.com',
            'ai_providers.claude_add_modal_proxy_label': 'Proxy URL (Optional):',
            'ai_providers.claude_add_modal_proxy_placeholder': 'e.g.: socks5://proxy.example.com:1080',
            'ai_providers.claude_edit_modal_title': 'Edit Claude API Configuration',
            'ai_providers.claude_edit_modal_key_label': 'API Key:',
            'ai_providers.claude_edit_modal_url_label': 'Base URL (Optional):',
            'ai_providers.claude_edit_modal_proxy_label': 'Proxy URL (Optional):',
            'ai_providers.claude_delete_confirm': 'Are you sure you want to delete this Claude configuration?',
            'ai_providers.claude_models_label': 'Custom Models (Optional):',
            'ai_providers.claude_models_hint': 'Leave empty to allow all models, or add name[, alias] entries to limit/alias them.',
            'ai_providers.claude_models_add_btn': 'Add Model',
            'ai_providers.claude_models_count': 'Models Count',

            'ai_providers.openai_title': 'OpenAI Compatible Providers',
            'ai_providers.openai_add_button': 'Add Provider',
            'ai_providers.openai_empty_title': 'No OpenAI Compatible Providers',
            'ai_providers.openai_empty_desc': 'Click the button above to add the first provider',
            'ai_providers.openai_add_modal_title': 'Add OpenAI Compatible Provider',
            'ai_providers.openai_add_modal_name_label': 'Provider Name:',
            'ai_providers.openai_add_modal_name_placeholder': 'e.g.: openrouter',
            'ai_providers.openai_add_modal_url_label': 'Base URL:',
            'ai_providers.openai_add_modal_url_placeholder': 'e.g.: https://openrouter.ai/api/v1',
            'ai_providers.openai_add_modal_keys_label': 'API Keys',
            'ai_providers.openai_edit_modal_keys_label': 'API Keys',
            'ai_providers.openai_keys_hint': 'Add each key separately with an optional proxy URL to keep things organized.',
            'ai_providers.openai_keys_add_btn': 'Add Key',
            'ai_providers.openai_key_placeholder': 'sk-... key',
            'ai_providers.openai_proxy_placeholder': 'Optional proxy URL (e.g. socks5://...)',
            'ai_providers.openai_add_modal_models_label': 'Model List (name[, alias] one per line):',
            'ai_providers.openai_models_hint': 'Example: gpt-4o-mini or moonshotai/kimi-k2:free, kimi-k2',
            'ai_providers.openai_model_name_placeholder': 'Model name, e.g. moonshotai/kimi-k2:free',
            'ai_providers.openai_model_alias_placeholder': 'Model alias (optional)',
            'ai_providers.openai_models_add_btn': 'Add Model',
            'ai_providers.openai_models_fetch_button': 'Fetch via /v1/models',
            'ai_providers.openai_models_fetch_title': 'Pick Models from /v1/models',
            'ai_providers.openai_models_fetch_hint': 'Call the /v1/models endpoint using the Base URL above, sending the first API key as Bearer plus custom headers.',
            'ai_providers.openai_models_fetch_url_label': 'Request URL',
            'ai_providers.openai_models_fetch_refresh': 'Refresh',
            'ai_providers.openai_models_fetch_loading': 'Fetching models from /v1/models...',
            'ai_providers.openai_models_fetch_empty': 'No models returned. Please check the endpoint or auth.',
            'ai_providers.openai_models_fetch_error': 'Failed to fetch models',
            'ai_providers.openai_models_fetch_back': 'Back to edit',
            'ai_providers.openai_models_fetch_apply': 'Add selected models',
            'ai_providers.openai_models_search_label': 'Search models',
            'ai_providers.openai_models_search_placeholder': 'Filter by name, alias, or description',
            'ai_providers.openai_models_search_empty': 'No models match your search. Try a different keyword.',
            'ai_providers.openai_models_fetch_invalid_url': 'Please enter a valid Base URL first',
            'ai_providers.openai_models_fetch_added': '{count} new models added',
            'ai_providers.openai_edit_modal_title': 'Edit OpenAI Compatible Provider',
            'ai_providers.openai_edit_modal_name_label': 'Provider Name:',
            'ai_providers.openai_edit_modal_url_label': 'Base URL:',
            'ai_providers.openai_edit_modal_keys_label': 'API Keys',
            'ai_providers.openai_edit_modal_models_label': 'Model List (name[, alias] one per line):',
            'ai_providers.openai_delete_confirm': 'Are you sure you want to delete this OpenAI provider?',
            'ai_providers.openai_keys_count': 'Keys Count',
            'ai_providers.openai_models_count': 'Models Count',
            'ai_providers.openai_test_title': 'Connection Test',
            'ai_providers.openai_test_hint': 'Send a /v1/chat/completions request with the current settings to verify availability.',
            'ai_providers.openai_test_model_placeholder': 'Model to test',
            'ai_providers.openai_test_action': 'Run Test',
            'ai_providers.openai_test_running': 'Sending test request...',
            'ai_providers.openai_test_success': 'Test succeeded. The model responded.',
            'ai_providers.openai_test_failed': 'Test failed',
            'ai_providers.openai_test_select_placeholder': 'Choose from current models',
            'ai_providers.openai_test_select_empty': 'No models configured, enter manually',


            // Auth files management
            'auth_files.title': 'Auth Files Management',
            'auth_files.title_section': 'Auth Files',
            'auth_files.description': 'Manage all CLI Proxy JSON auth files here (e.g. Qwen, Gemini, Vertex). Uploading a credential immediately enables the corresponding AI integration.',
            'auth_files.upload_button': 'Upload File',
            'auth_files.delete_all_button': 'Delete All',
            'auth_files.empty_title': 'No Auth Files',
            'auth_files.empty_desc': 'Click the button above to upload the first file',
            'auth_files.search_empty_title': 'No matching files',
            'auth_files.search_empty_desc': 'Try changing the filters or clearing the search box.',
            'auth_files.file_size': 'Size',
            'auth_files.file_modified': 'Modified',
            'auth_files.download_button': 'Download',
            'auth_files.delete_button': 'Delete',
            'auth_files.delete_confirm': 'Are you sure you want to delete file',
            'auth_files.delete_all_confirm': 'Are you sure you want to delete all auth files? This operation cannot be undone!',
            'auth_files.delete_filtered_confirm': 'Are you sure you want to delete all {type} auth files? This operation cannot be undone!',
            'auth_files.upload_error_json': 'Only JSON files are allowed',
            'auth_files.upload_success': 'File uploaded successfully',
            'auth_files.download_success': 'File downloaded successfully',
            'auth_files.delete_success': 'File deleted successfully',
            'auth_files.delete_all_success': 'Successfully deleted',
            'auth_files.delete_filtered_success': 'Deleted {count} {type} auth files successfully',
            'auth_files.delete_filtered_partial': '{type} auth files deletion finished: {success} succeeded, {failed} failed',
            'auth_files.delete_filtered_none': 'No deletable auth files under the current filter ({type})',
            'auth_files.files_count': 'files',
            'auth_files.pagination_prev': 'Previous',
            'auth_files.pagination_next': 'Next',
            'auth_files.pagination_info': 'Page {current} / {total} · {count} files',
            'auth_files.search_label': 'Search configs',
            'auth_files.search_placeholder': 'Filter by name, type, or provider',
            'auth_files.page_size_label': 'Per page',
            'auth_files.page_size_unit': 'items',
            'auth_files.filter_all': 'All',
            'auth_files.filter_qwen': 'Qwen',
            'auth_files.filter_gemini': 'Gemini',
            'auth_files.filter_gemini-cli': 'GeminiCLI',
            'auth_files.filter_aistudio': 'AIStudio',
            'auth_files.filter_claude': 'Claude',
            'auth_files.filter_codex': 'Codex',
            'auth_files.filter_antigravity': 'Antigravity',
            'auth_files.filter_iflow': 'iFlow',
            'auth_files.filter_vertex': 'Vertex',
            'auth_files.filter_empty': 'Empty',
            'auth_files.filter_unknown': 'Other',
            'auth_files.type_qwen': 'Qwen',
            'auth_files.type_gemini': 'Gemini',
            'auth_files.type_gemini-cli': 'GeminiCLI',
            'auth_files.type_aistudio': 'AIStudio',
            'auth_files.type_claude': 'Claude',
            'auth_files.type_codex': 'Codex',
            'auth_files.type_antigravity': 'Antigravity',
            'auth_files.type_iflow': 'iFlow',
            'auth_files.type_vertex': 'Vertex',
            'auth_files.type_empty': 'Empty',
            'auth_files.type_unknown': 'Other',
            'vertex_import.title': 'Vertex AI Credential Import',
            'vertex_import.description': 'Upload a Google service account JSON to store it as auth-dir/vertex-<project>.json using the same rules as the CLI vertex-import helper.',
            'vertex_import.location_label': 'Region (optional)',
            'vertex_import.location_placeholder': 'us-central1',
            'vertex_import.location_hint': 'Leave empty to use the default region us-central1.',
            'vertex_import.file_label': 'Service account key JSON',
            'vertex_import.file_hint': 'Only Google Cloud service account key JSON files are accepted.',
            'vertex_import.file_placeholder': 'No file selected',
            'vertex_import.choose_file': 'Choose File',
            'vertex_import.import_button': 'Import Vertex Credential',
            'vertex_import.file_required': 'Select a .json credential file first',
            'vertex_import.success': 'Vertex credential imported successfully',
            'vertex_import.result_title': 'Credential saved',
            'vertex_import.result_project': 'Project ID',
            'vertex_import.result_email': 'Service account',
            'vertex_import.result_location': 'Region',
            'vertex_import.result_file': 'Persisted file',

            // OAuth excluded models
            'oauth_excluded.title': 'OAuth Excluded Models',
            'oauth_excluded.description': 'Per-provider exclusions are shown as cards; click edit to adjust. Wildcards * are supported and the scope follows the auth file filter.',
            'oauth_excluded.add': 'Add Exclusion',
            'oauth_excluded.add_title': 'Add provider exclusion',
            'oauth_excluded.edit_title': 'Edit exclusions for {provider}',
            'oauth_excluded.refresh': 'Refresh',
            'oauth_excluded.refreshing': 'Refreshing...',
            'oauth_excluded.provider_label': 'Provider',
            'oauth_excluded.provider_auto': 'Follow current filter',
            'oauth_excluded.provider_placeholder': 'e.g. gemini-cli',
            'oauth_excluded.provider_hint': 'Defaults to the current filter; pick an existing provider or type a new name.',
            'oauth_excluded.models_label': 'Models to exclude',
            'oauth_excluded.models_placeholder': 'gpt-4.1-mini\n*-preview',
            'oauth_excluded.models_hint': 'Separate by commas or new lines; saving an empty list removes that provider. * wildcards are supported.',
            'oauth_excluded.save': 'Save/Update',
            'oauth_excluded.saving': 'Saving...',
            'oauth_excluded.save_success': 'Excluded models updated',
            'oauth_excluded.save_failed': 'Failed to update excluded models',
            'oauth_excluded.delete': 'Delete Provider',
            'oauth_excluded.delete_confirm': 'Delete the exclusion list for {provider}?',
            'oauth_excluded.delete_success': 'Exclusion list removed',
            'oauth_excluded.delete_failed': 'Failed to delete exclusion list',
            'oauth_excluded.deleting': 'Deleting...',
            'oauth_excluded.no_models': 'No excluded models',
            'oauth_excluded.model_count': '{count} models excluded',
            'oauth_excluded.list_empty_all': 'No exclusions yet—use “Add Exclusion” to create one.',
            'oauth_excluded.list_empty_filtered': 'No exclusions in this scope; click “Add Exclusion” to add.',
            'oauth_excluded.disconnected': 'Connect to the server to view exclusions',
            'oauth_excluded.load_failed': 'Failed to load exclusion list',
            'oauth_excluded.provider_required': 'Please enter a provider first',
            'oauth_excluded.scope_all': 'Scope: All providers',
            'oauth_excluded.scope_provider': 'Scope: {provider}',

            // Codex OAuth
            'auth_login.codex_oauth_title': 'Codex OAuth',
            'auth_login.codex_oauth_button': 'Start Codex Login',
            'auth_login.codex_oauth_hint': 'Login to Codex service through OAuth flow, automatically obtain and save authentication files.',
            'auth_login.codex_oauth_url_label': 'Authorization URL:',
            'auth_login.codex_open_link': 'Open Link',
            'auth_login.codex_copy_link': 'Copy Link',
            'auth_login.codex_oauth_status_waiting': 'Waiting for authentication...',
            'auth_login.codex_oauth_status_success': 'Authentication successful!',
            'auth_login.codex_oauth_status_error': 'Authentication failed:',
            'auth_login.codex_oauth_start_error': 'Failed to start Codex OAuth:',
            'auth_login.codex_oauth_polling_error': 'Failed to check authentication status:',

            // Anthropic OAuth
            'auth_login.anthropic_oauth_title': 'Anthropic OAuth',
            'auth_login.anthropic_oauth_button': 'Start Anthropic Login',
            'auth_login.anthropic_oauth_hint': 'Login to Anthropic (Claude) service through OAuth flow, automatically obtain and save authentication files.',
            'auth_login.anthropic_oauth_url_label': 'Authorization URL:',
            'auth_login.anthropic_open_link': 'Open Link',
            'auth_login.anthropic_copy_link': 'Copy Link',
            'auth_login.anthropic_oauth_status_waiting': 'Waiting for authentication...',
            'auth_login.anthropic_oauth_status_success': 'Authentication successful!',
            'auth_login.anthropic_oauth_status_error': 'Authentication failed:',
            'auth_login.anthropic_oauth_start_error': 'Failed to start Anthropic OAuth:',
            'auth_login.anthropic_oauth_polling_error': 'Failed to check authentication status:',

            // Antigravity OAuth
            'auth_login.antigravity_oauth_title': 'Antigravity OAuth',
            'auth_login.antigravity_oauth_button': 'Start Antigravity Login',
            'auth_login.antigravity_oauth_hint': 'Login to Antigravity service (Google account) through OAuth flow, automatically obtain and save authentication files.',
            'auth_login.antigravity_oauth_url_label': 'Authorization URL:',
            'auth_login.antigravity_open_link': 'Open Link',
            'auth_login.antigravity_copy_link': 'Copy Link',
            'auth_login.antigravity_oauth_status_waiting': 'Waiting for authentication...',
            'auth_login.antigravity_oauth_status_success': 'Authentication successful!',
            'auth_login.antigravity_oauth_status_error': 'Authentication failed:',
            'auth_login.antigravity_oauth_start_error': 'Failed to start Antigravity OAuth:',
            'auth_login.antigravity_oauth_polling_error': 'Failed to check authentication status:',

            // Gemini CLI OAuth
            'auth_login.gemini_cli_oauth_title': 'Gemini CLI OAuth',
            'auth_login.gemini_cli_oauth_button': 'Start Gemini CLI Login',
            'auth_login.gemini_cli_oauth_hint': 'Login to Google Gemini CLI service through OAuth flow, automatically obtain and save authentication files.',
            'auth_login.gemini_cli_project_id_label': 'Google Cloud Project ID (Optional):',
            'auth_login.gemini_cli_project_id_placeholder': 'Enter Google Cloud Project ID (optional)',
            'auth_login.gemini_cli_project_id_hint': 'If a project ID is specified, authentication information for that project will be used.',
            'auth_login.gemini_cli_oauth_url_label': 'Authorization URL:',
            'auth_login.gemini_cli_open_link': 'Open Link',
            'auth_login.gemini_cli_copy_link': 'Copy Link',
            'auth_login.gemini_cli_oauth_status_waiting': 'Waiting for authentication...',
            'auth_login.gemini_cli_oauth_status_success': 'Authentication successful!',
            'auth_login.gemini_cli_oauth_status_error': 'Authentication failed:',
            'auth_login.gemini_cli_oauth_start_error': 'Failed to start Gemini CLI OAuth:',
            'auth_login.gemini_cli_oauth_polling_error': 'Failed to check authentication status:',

            // Qwen OAuth
            'auth_login.qwen_oauth_title': 'Qwen OAuth',
            'auth_login.qwen_oauth_button': 'Start Qwen Login',
            'auth_login.qwen_oauth_hint': 'Login to Qwen service through device authorization flow, automatically obtain and save authentication files.',
            'auth_login.qwen_oauth_url_label': 'Authorization URL:',
            'auth_login.qwen_open_link': 'Open Link',
            'auth_login.qwen_copy_link': 'Copy Link',
            'auth_login.qwen_oauth_status_waiting': 'Waiting for authentication...',
            'auth_login.qwen_oauth_status_success': 'Authentication successful!',
            'auth_login.qwen_oauth_status_error': 'Authentication failed:',
            'auth_login.qwen_oauth_start_error': 'Failed to start Qwen OAuth:',
            'auth_login.qwen_oauth_polling_error': 'Failed to check authentication status:',
            'auth_login.missing_state': 'Unable to retrieve authentication state parameter',

            // iFlow OAuth
            'auth_login.iflow_oauth_title': 'iFlow OAuth',
            'auth_login.iflow_oauth_button': 'Start iFlow Login',
            'auth_login.iflow_oauth_hint': 'Login to iFlow service through OAuth flow, automatically obtain and save authentication files.',
            'auth_login.iflow_oauth_local_only': 'iFlow OAuth is only available from 127.0.0.1 (local machine); please use Cookie login remotely.',
            'auth_login.iflow_oauth_url_label': 'Authorization URL:',
            'auth_login.iflow_open_link': 'Open Link',
            'auth_login.iflow_copy_link': 'Copy Link',
            'auth_login.iflow_oauth_status_waiting': 'Waiting for authentication...',
            'auth_login.iflow_oauth_status_success': 'Authentication successful!',
            'auth_login.iflow_oauth_status_error': 'Authentication failed:',
            'auth_login.iflow_oauth_start_error': 'Failed to start iFlow OAuth:',
            'auth_login.iflow_oauth_polling_error': 'Failed to check authentication status:',
            'auth_login.iflow_cookie_title': 'iFlow Cookie Login',
            'auth_login.iflow_cookie_label': 'Cookie Value:',
            'auth_login.iflow_cookie_placeholder': 'Paste browser cookie, e.g. sessionid=...;',
            'auth_login.iflow_cookie_hint': 'Submit an existing cookie to finish login without opening the authorization link; the credential file will be saved automatically.',
            'auth_login.iflow_cookie_button': 'Submit Cookie Login',
            'auth_login.iflow_cookie_status_success': 'Cookie login succeeded and credentials are saved.',
            'auth_login.iflow_cookie_status_error': 'Cookie login failed:',
            'auth_login.iflow_cookie_start_error': 'Failed to submit cookie login:',
            'auth_login.iflow_cookie_required': 'Please provide the Cookie value first.',
            'auth_login.iflow_cookie_result_title': 'Cookie Login Result',
            'auth_login.iflow_cookie_result_email': 'Account',
            'auth_login.iflow_cookie_result_expired': 'Expires At',
            'auth_login.iflow_cookie_result_path': 'Saved Path',
            'auth_login.iflow_cookie_result_type': 'Type',

            // Usage Statistics
            'usage_stats.title': 'Usage Statistics',
            'usage_stats.total_requests': 'Total Requests',
            'usage_stats.success_requests': 'Success Requests',
            'usage_stats.failed_requests': 'Failed Requests',
            'usage_stats.total_tokens': 'Total Tokens',
            'usage_stats.cached_tokens': 'Cached Tokens',
            'usage_stats.reasoning_tokens': 'Reasoning Tokens',
            'usage_stats.rpm_30m': 'RPM (last 30 min)',
            'usage_stats.tpm_30m': 'TPM (last 30 min)',
            'usage_stats.requests_trend': 'Request Trends',
            'usage_stats.tokens_trend': 'Token Usage Trends',
            'usage_stats.api_details': 'API Details',
            'usage_stats.by_hour': 'By Hour',
            'usage_stats.by_day': 'By Day',
            'usage_stats.refresh': 'Refresh',
            'usage_stats.chart_line_label_1': 'Line 1',
            'usage_stats.chart_line_label_2': 'Line 2',
            'usage_stats.chart_line_label_3': 'Line 3',
            'usage_stats.chart_line_label_4': 'Line 4',
            'usage_stats.chart_line_label_5': 'Line 5',
            'usage_stats.chart_line_label_6': 'Line 6',
            'usage_stats.chart_line_label_7': 'Line 7',
            'usage_stats.chart_line_label_8': 'Line 8',
            'usage_stats.chart_line_label_9': 'Line 9',
            'usage_stats.chart_line_hidden': 'Hide',
            'usage_stats.chart_line_actions_label': 'Lines to display',
            'usage_stats.chart_line_add': 'Add line',
            'usage_stats.chart_line_all': 'All',
            'usage_stats.chart_line_delete': 'Delete line',
            'usage_stats.chart_line_hint': 'Show up to 9 model lines at once',
            'usage_stats.no_data': 'No Data Available',
            'usage_stats.loading_error': 'Loading Failed',
            'usage_stats.api_endpoint': 'API Endpoint',
            'usage_stats.requests_count': 'Request Count',
            'usage_stats.tokens_count': 'Token Count',
            'usage_stats.models': 'Model Statistics',
            'usage_stats.success_rate': 'Success Rate',
            'usage_stats.total_cost': 'Total Cost',
            'usage_stats.total_cost_hint': 'Based on configured model pricing',
            'usage_stats.model_price_title': 'Model Pricing',
            'usage_stats.model_price_reset': 'Clear Prices',
            'usage_stats.model_price_model_label': 'Model',
            'usage_stats.model_price_select_placeholder': 'Choose a model',
            'usage_stats.model_price_select_hint': 'Models come from usage details',
            'usage_stats.model_price_prompt': 'Prompt price ($/1M tokens)',
            'usage_stats.model_price_completion': 'Completion price ($/1M tokens)',
            'usage_stats.model_price_save': 'Save Price',
            'usage_stats.model_price_empty': 'No model prices set',
            'usage_stats.model_price_model': 'Model',
            'usage_stats.model_price_saved': 'Model price saved',
            'usage_stats.model_price_model_required': 'Please choose a model to set pricing',
            'usage_stats.cost_trend': 'Cost Overview',
            'usage_stats.cost_axis_label': 'Cost ($)',
            'usage_stats.cost_need_price': 'Set a model price to view cost stats',
            'usage_stats.cost_need_usage': 'No usage data available to calculate cost',
            'usage_stats.cost_no_data': 'No cost data yet',
            'stats.success': 'Success',
            'stats.failure': 'Failure',

            // Logs viewer
            'logs.title': 'Logs Viewer',
            'logs.refresh_button': 'Refresh Logs',
            'logs.clear_button': 'Clear Logs',
            'logs.download_button': 'Download Logs',
            'logs.error_log_button': 'Select Error Log',
            'logs.error_logs_modal_title': 'Error Request Logs',
            'logs.error_logs_description': 'Pick an error request log file to download (only generated when request logging is off).',
            'logs.error_logs_empty': 'No error request log files found',
            'logs.error_logs_load_error': 'Failed to load error log list',
            'logs.error_logs_size': 'Size',
            'logs.error_logs_modified': 'Last modified',
            'logs.error_logs_download': 'Download',
            'logs.error_log_download_success': 'Error log downloaded successfully',
            'logs.empty_title': 'No Logs Available',
            'logs.empty_desc': 'When "Enable logging to file" is enabled, logs will be displayed here',
            'logs.log_content': 'Log Content',
            'logs.loading': 'Loading logs...',
            'logs.load_error': 'Failed to load logs',
            'logs.clear_confirm': 'Are you sure you want to clear all logs? This action cannot be undone!',
            'logs.clear_success': 'Logs cleared successfully',
            'logs.download_success': 'Logs downloaded successfully',
            'logs.auto_refresh': 'Auto Refresh',
            'logs.auto_refresh_enabled': 'Auto refresh enabled',
            'logs.auto_refresh_disabled': 'Auto refresh disabled',
            'logs.search_placeholder': 'Search logs by content or keyword',
            'logs.search_empty_title': 'No matching logs found',
            'logs.search_empty_desc': 'Try a different keyword or clear the search filter.',
            'logs.lines': 'lines',
            'logs.removed': 'Removed',
            'logs.upgrade_required_title': 'Please Upgrade CLI Proxy API',
            'logs.upgrade_required_desc': 'The current server version does not support the logs viewing feature. Please upgrade to the latest version of CLI Proxy API to use this feature.',

            // Config management
            'config_management.title': 'Config Management',
            'config_management.editor_title': 'Configuration File',
            'config_management.reload': 'Reload',
            'config_management.save': 'Save',
            'config_management.description': 'View and edit the server-side config.yaml file. Validate the syntax before saving.',
            'config_management.status_idle': 'Waiting for action',
            'config_management.status_loading': 'Loading configuration...',
            'config_management.status_loaded': 'Configuration loaded',
            'config_management.status_dirty': 'Unsaved changes',
            'config_management.status_disconnected': 'Connect to the server to load the configuration',
            'config_management.status_load_failed': 'Load failed',
            'config_management.status_saving': 'Saving configuration...',
            'config_management.status_saved': 'Configuration saved',
            'config_management.status_save_failed': 'Save failed',
            'config_management.save_success': 'Configuration saved successfully',
            'config_management.error_yaml_not_supported': 'Server did not return YAML. Verify the /config.yaml endpoint is available.',
            'config_management.editor_placeholder': 'key: value',

            // System info
            'system_info.title': 'Management Center Info',
            'system_info.connection_status_title': 'Connection Status',
            'system_info.api_status_label': 'API Status:',
            'system_info.config_status_label': 'Config Status:',
            'system_info.last_update_label': 'Last Update:',
            'system_info.cache_data': 'Cache Data',
            'system_info.real_time_data': 'Real-time Data',
            'system_info.not_loaded': 'Not Loaded',
            'system_info.seconds_ago': 'seconds ago',
            'system_info.models_title': 'Available Models',
            'system_info.models_desc': 'Shows the /v1/models response and uses saved API keys for auth automatically.',
            'system_info.models_loading': 'Loading available models...',
            'system_info.models_empty': 'No models returned by /v1/models',
            'system_info.models_error': 'Failed to load model list',
            'system_info.models_count': '{count} available models',
            'system_info.version_check_title': 'Update Check',
            'system_info.version_check_desc': 'Call the /latest-version endpoint to compare with the server version and see if an update is available.',
            'system_info.version_current_label': 'Current version',
            'system_info.version_latest_label': 'Latest version',
            'system_info.version_check_button': 'Check for updates',
            'system_info.version_check_idle': 'Click to check for updates',
            'system_info.version_checking': 'Checking for the latest version...',
            'system_info.version_update_available': 'An update is available: {version}',
            'system_info.version_is_latest': 'You are on the latest version',
            'system_info.version_check_error': 'Update check failed',
            'system_info.version_current_missing': 'Server version is unavailable; cannot compare',
            'system_info.version_unknown': 'Unknown',

            // Notification messages
            'notification.debug_updated': 'Debug settings updated',
            'notification.proxy_updated': 'Proxy settings updated',
            'notification.proxy_cleared': 'Proxy settings cleared',
            'notification.retry_updated': 'Retry settings updated',
            'notification.quota_switch_project_updated': 'Project switch settings updated',
            'notification.quota_switch_preview_updated': 'Preview model switch settings updated',
            'notification.usage_statistics_updated': 'Usage statistics settings updated',
            'notification.logging_to_file_updated': 'Logging settings updated',
            'notification.request_log_updated': 'Request logging setting updated',
            'notification.ws_auth_updated': 'WebSocket authentication setting updated',
            'notification.api_key_added': 'API key added successfully',
            'notification.api_key_updated': 'API key updated successfully',
            'notification.api_key_deleted': 'API key deleted successfully',
            'notification.gemini_key_added': 'Gemini key added successfully',
            'notification.gemini_key_updated': 'Gemini key updated successfully',
            'notification.gemini_key_deleted': 'Gemini key deleted successfully',
            'notification.gemini_multi_input_required': 'Please enter at least one Gemini key',
            'notification.gemini_multi_failed': 'Gemini bulk add failed',
            'notification.gemini_multi_summary': 'Gemini bulk add finished: {success} added, {skipped} skipped, {failed} failed',
            'notification.codex_config_added': 'Codex configuration added successfully',
            'notification.codex_config_updated': 'Codex configuration updated successfully',
            'notification.codex_config_deleted': 'Codex configuration deleted successfully',
            'notification.codex_base_url_required': 'Please enter the Codex Base URL',
            'notification.claude_config_added': 'Claude configuration added successfully',
            'notification.claude_config_updated': 'Claude configuration updated successfully',
            'notification.claude_config_deleted': 'Claude configuration deleted successfully',
            'notification.field_required': 'Required fields cannot be empty',
            'notification.openai_provider_required': 'Please fill in provider name and Base URL',
            'notification.openai_provider_added': 'OpenAI provider added successfully',
            'notification.openai_provider_updated': 'OpenAI provider updated successfully',
            'notification.openai_provider_deleted': 'OpenAI provider deleted successfully',
            'notification.openai_model_name_required': 'Model name is required',
            'notification.openai_test_url_required': 'Please provide a valid Base URL before testing',
            'notification.openai_test_key_required': 'Please add at least one API key before testing',
            'notification.openai_test_model_required': 'Please select or enter a model to test',
            'notification.data_refreshed': 'Data refreshed successfully',
            'notification.connection_required': 'Please establish connection first',
            'notification.refresh_failed': 'Refresh failed',
            'notification.update_failed': 'Update failed',
            'notification.add_failed': 'Add failed',
            'notification.delete_failed': 'Delete failed',
            'notification.upload_failed': 'Upload failed',
            'notification.download_failed': 'Download failed',
            'notification.login_failed': 'Login failed',
            'notification.please_enter': 'Please enter',
            'notification.please_fill': 'Please fill',
            'notification.provider_name_url': 'provider name and Base URL',
            'notification.api_key': 'API key',
            'notification.gemini_api_key': 'Gemini API key',
            'notification.codex_api_key': 'Codex API key',
            'notification.claude_api_key': 'Claude API key',
            'notification.link_copied': 'Link copied to clipboard',

            // Language switch
            'language.switch': 'Language',
            'language.chinese': '中文',
            'language.english': 'English',

            // Theme switch
            'theme.switch': 'Theme',
            'theme.light': 'Light',
            'theme.dark': 'Dark',
            'theme.switch_to_light': 'Switch to light mode',
            'theme.switch_to_dark': 'Switch to dark mode',
            'theme.auto': 'Follow system',

            // Sidebar
            'sidebar.toggle_expand': 'Expand sidebar',
            'sidebar.toggle_collapse': 'Collapse sidebar',

            // Footer
            'footer.api_version': 'CLI Proxy API Version',
            'footer.build_date': 'Build Time',
            'footer.version': 'Management UI Version',
            'footer.author': 'Author'
        }
    },

    // 获取翻译文本
    t(key, params = {}) {
        const translation = this.translations[this.currentLanguage]?.[key] ||
            this.translations[this.fallbackLanguage]?.[key] ||
            key;

        // 简单的参数替换
        return translation.replace(/\{(\w+)\}/g, (match, param) => {
            return params[param] || match;
        });
    },

    // 设置语言
    setLanguage(lang) {
        if (this.translations[lang]) {
            this.currentLanguage = lang;
            localStorage.setItem('preferredLanguage', lang);
            this.updatePageLanguage();
            this.updateAllTexts();
        }
    },

    // 更新页面语言属性
    updatePageLanguage() {
        document.documentElement.lang = this.currentLanguage;
    },

    // 更新所有文本
    updateAllTexts() {
        // 更新所有带有 data-i18n 属性的元素
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            const text = this.t(key);

            if (element.tagName === 'INPUT' && (element.type === 'text' || element.type === 'password')) {
                element.placeholder = text;
            } else if (element.tagName === 'TITLE') {
                element.textContent = text;
            } else {
                element.textContent = text;
            }
        });

        // 更新所有包含 data-i18n-placeholder 的输入框占位符
        document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
            const key = element.getAttribute('data-i18n-placeholder');
            element.placeholder = this.t(key);
        });

        // 更新 data-i18n-title
        document.querySelectorAll('[data-i18n-title]').forEach(element => {
            const key = element.getAttribute('data-i18n-title');
            element.title = this.t(key);
        });

        // 更新 data-i18n-tooltip
        document.querySelectorAll('[data-i18n-tooltip]').forEach(element => {
            const key = element.getAttribute('data-i18n-tooltip');
            element.setAttribute('data-tooltip', this.t(key));
        });

        // 更新 data-i18n-text（常用于按钮或标签）
        document.querySelectorAll('[data-i18n-text]').forEach(element => {
            const key = element.getAttribute('data-i18n-text');
            element.textContent = this.t(key);
        });

        // 更新所有带有 data-i18n-html 属性的元素（支持HTML）
        document.querySelectorAll('[data-i18n-html]').forEach(element => {
            const key = element.getAttribute('data-i18n-html');
            const html = this.t(key);
            element.innerHTML = html;
        });
    },

    // 初始化
    init() {
        // 从本地存储获取用户偏好语言
        const savedLanguage = localStorage.getItem('preferredLanguage');
        if (savedLanguage && this.translations[savedLanguage]) {
            this.currentLanguage = savedLanguage;
        } else {
            // 根据浏览器语言自动选择
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('zh')) {
                this.currentLanguage = 'zh-CN';
            } else {
                this.currentLanguage = 'en-US';
            }
        }

        this.updatePageLanguage();
        this.updateAllTexts();
    }
};

// 全局函数，供HTML调用
window.t = (key, params) => i18n.t(key, params);
window.setLanguage = (lang) => i18n.setLanguage(lang);

</script>
</head>

<body>
    <!-- 自动登录加载页面 -->
    <div id="auto-login-loading" class="login-container" style="display: none;">
        <div class="login-card">
            <div class="auto-login-content">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                </div>
                <h2 data-i18n="auto_login.title">正在自动登录...</h2>
                <p data-i18n="auto_login.message">正在使用本地保存的连接信息尝试连接服务器</p>
            </div>
        </div>
    </div>

    <!-- 登录页面 -->
    <div id="login-page" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="login-header-top">
                    <h1 class="login-title">
                        <img id="login-logo" alt="Logo" style="display:none" />
                        <span data-i18n="title.login">CLI Proxy API Management Center</span>
                    </h1>
                    <div class="header-controls">
                        <div class="language-switcher">
                            <button id="language-toggle" class="btn btn-secondary language-btn">
                                <i class="fas fa-globe"></i>
                                <span data-i18n="language.switch">语言</span>
                            </button>
                        </div>
                        <div class="theme-switcher">
                            <button id="theme-toggle" class="btn btn-secondary theme-btn">
                                <i class="fas fa-moon"></i>
                                <span data-i18n="theme.switch">主题</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="login-body">
                <div class="login-connection-info">
                    <div class="connection-summary">
                        <i class="fas fa-link"></i>
                        <div>
                            <h3 data-i18n="login.connection_title">连接地址</h3>
                            <p class="connection-url">
                                <span data-i18n="login.connection_current">当前地址</span>
                                <span class="connection-url-separator">:</span>
                                <span id="login-connection-url">-</span>
                            </p>
                        </div>
                    </div>
                    <p class="form-hint" data-i18n="login.connection_auto_hint">系统将自动使用当前访问地址进行连接</p>
                </div>

                <form class="login-form">
                    <div class="form-group">
                        <label for="login-api-base" data-i18n="login.custom_connection_label">自定义连接地址:</label>
                        <div class="input-group">
                            <input type="text" id="login-api-base" data-i18n-placeholder="login.custom_connection_placeholder">
                            <button type="button" id="login-reset-api-base"
                                class="btn btn-secondary connection-reset-btn">
                                <i class="fas fa-location-arrow"></i>
                                <span data-i18n="login.use_current_address">使用当前地址</span>
                            </button>
                        </div>
                        <p class="form-hint" data-i18n="login.custom_connection_hint">默认使用当前访问地址，若需要可手动输入其他地址。</p>
                    </div>

                    <div class="form-group">
                        <label for="login-management-key" data-i18n="login.management_key_label">管理密钥:</label>
                        <div class="input-group">
                            <input type="password" id="login-management-key" data-i18n-placeholder="login.management_key_placeholder" required>
                            <button type="button" class="btn btn-secondary toggle-key-visibility">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- 连接按钮 -->
            <div class="form-actions">
                <button type="button" id="login-submit" class="btn btn-primary login-btn">
                    <i class="fas fa-plug"></i> <span data-i18n="login.connect_button">Connect</span>
                </button>
            </div>

            <div id="login-error" class="login-error" style="display: none;">
                <i class="fas fa-exclamation-triangle"></i>
                <span id="login-error-message"></span>
            </div>
        </div>
    </div>

    <!-- 主页面 -->
    <div id="main-page" style="display: none;">
        <!-- 顶部导航栏 -->
        <div class="top-navbar">
            <div class="top-navbar-left">
                <button class="mobile-menu-btn" id="mobile-menu-btn">
                    <i class="fas fa-bars"></i>
                </button>
                <button class="sidebar-toggle-btn-desktop" id="sidebar-toggle-btn-desktop" data-i18n-title="sidebar.toggle_collapse">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="top-navbar-brand">
                    <img id="site-logo" class="top-navbar-brand-logo" alt="Logo" style="display:none" />
                    <button class="top-navbar-brand-toggle expanded" id="brand-name-toggle" type="button" aria-label="展开标题">
                        <span class="brand-texts" id="brand-texts">
                            <span class="top-navbar-brand-text brand-text brand-text-full" data-i18n="title.main">CLI Proxy API Management Center</span>
                            <span class="top-navbar-brand-text brand-text brand-text-short" data-i18n="title.abbr">CPAMC</span>
                        </span>
                    </button>
                </div>
            </div>
            <div class="top-navbar-actions">
                <div class="header-controls">
                    <div class="language-switcher">
                        <button id="language-toggle-main" class="btn btn-secondary language-btn">
                            <i class="fas fa-globe"></i>
                        </button>
                    </div>
                    <div class="theme-switcher">
                        <button id="theme-toggle-main" class="btn btn-secondary theme-btn">
                            <i class="fas fa-moon"></i>
                        </button>
                    </div>
                </div>
                <button id="connection-status" class="btn btn-secondary">
                    <i class="fas fa-circle"></i> <span data-i18n="header.check_connection">检查连接</span>
                </button>
                <button id="refresh-all" class="btn btn-primary">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button id="logout-btn" class="btn btn-danger">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>

        <div class="layout" id="layout-container">
            <!-- 侧边栏 -->
            <nav class="sidebar" id="sidebar">
                <!-- 导航菜单 -->
                <ul class="nav-menu">
                    <li data-i18n-tooltip="nav.basic_settings"><a href="#basic-settings" class="nav-item active"
                            data-section="basic-settings">
                            <i class="fas fa-sliders-h"></i> <span data-i18n="nav.basic_settings">基础设置</span>
                        </a></li>
                    <li data-i18n-tooltip="nav.api_keys"><a href="#api-keys" class="nav-item" data-section="api-keys">
                            <i class="fas fa-key"></i> <span data-i18n="nav.api_keys">API 密钥</span>
                        </a></li>
                    <li data-i18n-tooltip="nav.ai_providers"><a href="#ai-providers" class="nav-item" data-section="ai-providers">
                            <i class="fas fa-robot"></i> <span data-i18n="nav.ai_providers">AI 提供商</span>
                        </a></li>
                    <li data-i18n-tooltip="nav.auth_files"><a href="#auth-files" class="nav-item" data-section="auth-files">
                            <i class="fas fa-file-alt"></i> <span data-i18n="nav.auth_files">认证文件</span>
                        </a></li>
                    <li data-i18n-tooltip="nav.usage_stats"><a href="#usage-stats" class="nav-item" data-section="usage-stats">
                            <i class="fas fa-chart-line"></i> <span data-i18n="nav.usage_stats">使用统计</span>
                        </a></li>
                    <li data-i18n-tooltip="nav.config_management"><a href="#config-management" class="nav-item" data-section="config-management">
                            <i class="fas fa-cog"></i> <span data-i18n="nav.config_management">配置管理</span>
                        </a></li>
                    <li id="logs-nav-item" data-i18n-tooltip="nav.logs" style="display: none;"><a href="#logs" class="nav-item" data-section="logs">
                            <i class="fas fa-scroll"></i> <span data-i18n="nav.logs">日志查看</span>
                        </a></li>
                    <li data-i18n-tooltip="nav.system_info"><a href="#system-info" class="nav-item" data-section="system-info">
                            <i class="fas fa-info-circle"></i> <span data-i18n="nav.system_info">中心信息</span>
                        </a></li>
                </ul>
            </nav>

            <!-- 侧边栏遮罩（移动端） -->
            <div class="sidebar-overlay" id="sidebar-overlay"></div>

            <!-- 主内容包装器 -->
            <div class="main-wrapper" id="main-wrapper">
                <!-- 主内容区域 -->
                <div class="main-content">
                    <!-- 内容区域 -->
                    <div class="content-area">
                        <!-- 基础设置 -->
                        <section id="basic-settings" class="content-section active">
                            <h2 data-i18n="basic_settings.title">基础设置</h2>

                            <!-- Debug 设置 -->
                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-bug"></i> <span
                                            data-i18n="basic_settings.debug_title">调试模式</span></h3>
                                </div>
                                <div class="card-content">
                                    <div class="toggle-group">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="debug-toggle">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="toggle-label" data-i18n="basic_settings.debug_enable">启用调试模式</span>
                                    </div>
                                </div>
                            </div>

                            <!-- 代理设置 -->
                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-network-wired"></i> <span
                                            data-i18n="basic_settings.proxy_title">代理设置</span></h3>
                                </div>
                                <div class="card-content">
                                    <div class="form-group">
                                        <label for="proxy-url" data-i18n="basic_settings.proxy_url_label">代理
                                            URL:</label>
                                        <div class="input-group">
                                            <input type="text" id="proxy-url" data-i18n-placeholder="basic_settings.proxy_url_placeholder">
                                            <button id="update-proxy" class="btn btn-primary"
                                                data-i18n="basic_settings.proxy_update">更新</button>
                                            <button id="clear-proxy" class="btn btn-danger"
                                                data-i18n="basic_settings.proxy_clear">清空</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 请求重试设置 -->
                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-redo"></i> <span
                                            data-i18n="basic_settings.retry_title">请求重试</span></h3>
                                </div>
                                <div class="card-content">
                                    <div class="form-group">
                                        <label for="request-retry"
                                            data-i18n="basic_settings.retry_count_label">重试次数:</label>
                                        <div class="input-group">
                                            <input type="number" id="request-retry" min="0" max="10" value="3">
                                            <button id="update-retry" class="btn btn-primary"
                                                data-i18n="basic_settings.retry_update">更新</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 配额超出行为 -->
                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-exclamation-triangle"></i> <span
                                            data-i18n="basic_settings.quota_title">配额超出行为</span></h3>
                                </div>
                                <div class="card-content">
                                    <div class="toggle-group">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="switch-project-toggle">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="toggle-label"
                                            data-i18n="basic_settings.quota_switch_project">自动切换项目</span>
                                    </div>
                                    <div class="toggle-group">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="switch-preview-model-toggle">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="toggle-label"
                                            data-i18n="basic_settings.quota_switch_preview">切换到预览模型</span>
                                    </div>
                                </div>
                            </div>

                            <!-- 使用统计设置 -->
                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-chart-bar"></i> <span
                                            data-i18n="basic_settings.usage_statistics_title">使用统计</span></h3>
                                </div>
                                <div class="card-content">
                                    <div class="toggle-group">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="usage-statistics-enabled-toggle">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="toggle-label"
                                            data-i18n="basic_settings.usage_statistics_enable">启用使用统计</span>
                                    </div>
                                </div>
                            </div>

                            <!-- 日志记录设置 -->
                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-file-alt"></i> <span
                                            data-i18n="basic_settings.logging_title">日志记录</span></h3>
                                </div>
                                <div class="card-content">
                                    <div class="toggle-group">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="logging-to-file-toggle">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="toggle-label"
                                            data-i18n="basic_settings.logging_to_file_enable">启用日志记录到文件</span>
                                    </div>
                                    <div class="toggle-group">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="request-log-toggle">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="toggle-label"
                                            data-i18n="basic_settings.request_log_enable">启用请求日志</span>
                                    </div>
                                </div>
                            </div>

                            <!-- WebSocket 鉴权 -->
                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-shield-alt"></i> <span
                                            data-i18n="basic_settings.ws_auth_title">WebSocket 鉴权</span></h3>
                                </div>
                                <div class="card-content">
                                    <div class="toggle-group">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="ws-auth-toggle">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="toggle-label"
                                            data-i18n="basic_settings.ws_auth_enable">启用 /ws/* 鉴权</span>
                                    </div>
                                </div>
                            </div>

                        </section>

                        <!-- API 密钥管理 -->
                        <section id="api-keys" class="content-section">
                            <h2 data-i18n="api_keys.title">API 密钥管理</h2>

                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-key"></i> <span
                                            data-i18n="api_keys.proxy_auth_title">代理服务认证密钥</span></h3>
                                    <button id="add-api-key" class="btn btn-primary">
                                        <i class="fas fa-plus"></i> <span data-i18n="api_keys.add_button">添加密钥</span>
                                    </button>
                                </div>
                                <div class="card-content">
                                    <div id="api-keys-list" class="key-list"></div>
                                </div>
                            </div>
                        </section>

                        <!-- AI 提供商 -->
                        <section id="ai-providers" class="content-section">
                            <h2 data-i18n="ai_providers.title">AI 提供商配置</h2>

                            <!-- Gemini API Keys -->
                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fab fa-google"></i> <span data-i18n="ai_providers.gemini_title">Gemini
                                            API 密钥</span></h3>
                                    <button id="add-gemini-key" class="btn btn-primary">
                                        <i class="fas fa-plus"></i> <span
                                            data-i18n="ai_providers.gemini_add_button">添加密钥</span>
                                    </button>
                                </div>
                                <div class="card-content">
                                    <div id="gemini-keys-list" class="key-list"></div>
                                </div>
                            </div>

                            <!-- Codex API Keys -->
                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-code"></i> <span data-i18n="ai_providers.codex_title">Codex API
                                            配置</span></h3>
                                    <button id="add-codex-key" class="btn btn-primary">
                                        <i class="fas fa-plus"></i> <span
                                            data-i18n="ai_providers.codex_add_button">添加配置</span>
                                    </button>
                                </div>
                                <div class="card-content">
                                    <div id="codex-keys-list" class="provider-list"></div>
                                </div>
                            </div>

                            <!-- Claude API Keys -->
                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-brain"></i> <span data-i18n="ai_providers.claude_title">Claude
                                            API 配置</span></h3>
                                    <button id="add-claude-key" class="btn btn-primary">
                                        <i class="fas fa-plus"></i> <span
                                            data-i18n="ai_providers.claude_add_button">添加配置</span>
                                    </button>
                                </div>
                                <div class="card-content">
                                    <div id="claude-keys-list" class="provider-list"></div>
                                </div>
                            </div>

                            <!-- OpenAI 兼容提供商 -->
                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-plug"></i> <span data-i18n="ai_providers.openai_title">OpenAI
                                            兼容提供商</span></h3>
                                    <button id="add-openai-provider" class="btn btn-primary">
                                        <i class="fas fa-plus"></i> <span
                                            data-i18n="ai_providers.openai_add_button">添加提供商</span>
                                    </button>
                                </div>
                                <div class="card-content">
                                    <div id="openai-providers-list" class="provider-list"></div>
                                </div>
                            </div>

                            <!-- Vertex AI Credential Import -->
                            <div class="card" id="vertex-import-card">
                                <div class="card-header">
                                    <h3><i class="fas fa-cloud-upload-alt"></i> <span data-i18n="vertex_import.title">Vertex AI 凭证导入</span></h3>
                                </div>
                                <div class="card-content">
                                    <p class="form-hint" data-i18n="vertex_import.description">
                                        上传 Google 服务账号 JSON 并保存为 vertex-<project>.json。
                                    </p>
                                    <div class="form-group">
                                        <label for="vertex-location" data-i18n="vertex_import.location_label">区域 (可选)</label>
                                        <input type="text" id="vertex-location" data-i18n-placeholder="vertex_import.location_placeholder" value="us-central1">
                                        <p class="form-hint" data-i18n="vertex_import.location_hint">留空则使用默认 us-central1。</p>
                                    </div>
                                    <div class="form-group">
                                        <label data-i18n="vertex_import.file_label">服务账号密钥 JSON</label>
                                        <div class="input-group">
                                            <input type="text" id="vertex-file-display" readonly data-i18n-placeholder="vertex_import.file_placeholder" placeholder="尚未选择文件">
                                            <input type="file" id="vertex-file-input" accept=".json" style="display: none;">
                                            <button type="button" id="vertex-select-file" class="btn btn-secondary">
                                                <i class="fas fa-file-upload"></i> <span data-i18n="vertex_import.choose_file">选择文件</span>
                                            </button>
                                        </div>
                                        <p class="form-hint" data-i18n="vertex_import.file_hint">仅支持 Google Cloud service account JSON。</p>
                                    </div>
                                    <div class="form-actions vertex-import-actions">
                                        <button type="button" id="vertex-import-btn" class="btn btn-primary" disabled>
                                            <i class="fas fa-cloud-upload-alt"></i> <span data-i18n="vertex_import.import_button">导入 Vertex 凭证</span>
                                        </button>
                                    </div>
                                    <div id="vertex-import-result" class="vertex-import-result" style="display: none;">
                                        <div class="vertex-import-result-header">
                                            <i class="fas fa-check-circle"></i>
                                            <span data-i18n="vertex_import.result_title">凭证已保存</span>
                                        </div>
                                        <ul>
                                            <li><span data-i18n="vertex_import.result_project">项目 ID</span>: <code id="vertex-result-project">-</code></li>
                                            <li><span data-i18n="vertex_import.result_email">服务账号</span>: <code id="vertex-result-email">-</code></li>
                                            <li><span data-i18n="vertex_import.result_location">区域</span>: <code id="vertex-result-location">-</code></li>
                                            <li><span data-i18n="vertex_import.result_file">存储文件</span>: <code id="vertex-result-file">-</code></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- 认证文件管理 -->
                        <section id="auth-files" class="content-section">
                            <h2 data-i18n="auth_files.title">认证文件管理</h2>

                            <div class="card" style="margin-bottom: 20px;">
                                <div class="card-content">
                                    <p class="form-hint" data-i18n="auth_files.description">
                                        这里管理 Qwen 和 Gemini 的认证配置文件。上传 JSON 格式的认证文件以启用相应的 AI 服务。
                                    </p>
                                </div>
                            </div>

                            <!-- 认证文件 -->
                            <div class="card">
                                <div class="card-header card-header-with-filter">
                                    <div class="header-left">
                                        <h3><i class="fas fa-file-alt"></i> <span
                                                data-i18n="auth_files.title_section">认证文件</span></h3>
                                        <!-- 类型筛选 -->
                                        <div class="auth-file-filter">
                                            <button class="filter-btn active" data-type="all" data-i18n-text="auth_files.filter_all">All</button>
                                            <button class="filter-btn" data-type="qwen" data-i18n-text="auth_files.filter_qwen">Qwen</button>
                                            <button class="filter-btn" data-type="gemini" data-i18n-text="auth_files.filter_gemini">Gemini</button>
                                            <button class="filter-btn" data-type="gemini-cli" data-i18n-text="auth_files.filter_gemini-cli">GeminiCLI</button>
                                            <button class="filter-btn" data-type="aistudio" data-i18n-text="auth_files.filter_aistudio">AIStudio</button>
                                            <button class="filter-btn" data-type="claude" data-i18n-text="auth_files.filter_claude">Claude</button>
                                            <button class="filter-btn" data-type="codex" data-i18n-text="auth_files.filter_codex">Codex</button>
                                            <button class="filter-btn" data-type="antigravity" data-i18n-text="auth_files.filter_antigravity">Antigravity</button>
                                            <button class="filter-btn" data-type="iflow" data-i18n-text="auth_files.filter_iflow">iFlow</button>
                                            <button class="filter-btn" data-type="vertex" data-i18n-text="auth_files.filter_vertex">Vertex</button>
                                            <button class="filter-btn" data-type="empty" data-i18n-text="auth_files.filter_empty">Empty</button>
                                        </div>
                                    </div>
                                    <div class="header-actions">
                                        <button id="upload-auth-file" class="btn btn-primary">
                                            <i class="fas fa-upload"></i> <span
                                                data-i18n="auth_files.upload_button">上传文件</span>
                                        </button>
                                        <button id="delete-all-auth-files" class="btn btn-danger">
                                            <i class="fas fa-trash"></i> <span
                                                data-i18n="auth_files.delete_all_button">删除全部</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-content">
                                    <div class="auth-file-toolbar">
                                        <div class="auth-file-search-group">
                                            <label for="auth-files-search-input"
                                                data-i18n="auth_files.search_label">搜索配置文件</label>
                                            <div class="auth-file-search">
                                                <i class="fas fa-search"></i>
                                                <input type="text" id="auth-files-search-input"
                                                    data-i18n-placeholder="auth_files.search_placeholder"
                                                    placeholder="搜索文件名或类型">
                                            </div>
                                        </div>
                                        <div class="auth-file-page-size">
                                            <label for="auth-files-page-size-input"
                                                data-i18n="auth_files.page_size_label">单页数量</label>
                                            <div class="page-size-input">
                                                <input type="number" id="auth-files-page-size-input" min="3" max="60"
                                                    step="1">
                                                <span data-i18n="auth_files.page_size_unit">个/页</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="auth-files-list" class="file-list file-grid"></div>
                                    <div id="auth-files-pagination" class="pagination-controls" style="display: none;">
                                        <button class="btn btn-secondary pagination-btn" data-action="prev">
                                            <i class="fas fa-chevron-left"></i>
                                            <span data-i18n="auth_files.pagination_prev">上一页</span>
                                        </button>
                                        <div id="auth-files-pagination-info" class="pagination-info">-</div>
                                        <button class="btn btn-secondary pagination-btn" data-action="next">
                                            <span data-i18n="auth_files.pagination_next">下一页</span>
                                            <i class="fas fa-chevron-right"></i>
                                        </button>
                                    </div>
                                    <input type="file" id="auth-file-input" accept=".json" multiple style="display: none;">
                                </div>
                            </div>

                            <!-- OAuth 排除列表 -->
                            <div class="card" id="oauth-excluded-card">
                                <div class="card-header card-header-with-filter">
                                    <div class="header-left">
                                        <h3><i class="fas fa-ban"></i> <span data-i18n="oauth_excluded.title">OAuth 排除列表</span></h3>
                                        <div class="oauth-excluded-scope" id="oauth-excluded-scope"></div>
                                    </div>
                                    <div class="card-actions">
                                        <button id="oauth-excluded-refresh" class="btn btn-secondary">
                                            <i class="fas fa-sync-alt"></i> <span data-i18n="oauth_excluded.refresh">刷新</span>
                                        </button>
                                        <button id="oauth-excluded-add" class="btn btn-primary">
                                            <i class="fas fa-plus"></i> <span data-i18n="oauth_excluded.add">新增排除</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-content">
                                    <p class="form-hint" data-i18n="oauth_excluded.description">为 OAuth/文件凭据配置模型黑名单，支持通配符。</p>
                                    <div id="oauth-excluded-status" class="form-hint subtle"></div>
                                    <div id="oauth-excluded-list" class="oauth-excluded-list oauth-excluded-grid provider-list">
                                        <div class="loading-placeholder" data-i18n="common.loading">正在加载...</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Codex OAuth -->
                            <div class="card" id="codex-oauth-card">
                                <div class="card-header">
                                    <h3><i class="fas fa-code"></i> <span data-i18n="auth_login.codex_oauth_title">Codex
                                            OAuth</span></h3>
                                    <button id="codex-oauth-btn" class="btn btn-primary">
                                        <i class="fas fa-sign-in-alt"></i> <span
                                            data-i18n="auth_login.codex_oauth_button">开始 Codex 登录</span>
                                    </button>
                                </div>
                                <div class="card-content">
                                    <p class="form-hint" style="margin-bottom: 20px;"
                                        data-i18n="auth_login.codex_oauth_hint">
                                        通过 OAuth 流程登录 Codex 服务，自动获取并保存认证文件。
                                    </p>
                                    <div id="codex-oauth-content" style="display: none;">
                                        <div class="form-group">
                                            <label data-i18n="auth_login.codex_oauth_url_label">授权链接:</label>
                                            <div class="input-group">
                                        <input type="text" id="codex-oauth-url" readonly>
                                                <button id="codex-open-link" class="btn btn-primary">
                                                    <i class="fas fa-external-link-alt"></i> <span
                                                        data-i18n="auth_login.codex_open_link">打开链接</span>
                                                </button>
                                                <button id="codex-copy-link" class="btn btn-secondary">
                                                    <i class="fas fa-copy"></i> <span
                                                        data-i18n="auth_login.codex_copy_link">复制链接</span>
                                                </button>
                                            </div>
                                        </div>
                                        <div id="codex-oauth-status" class="form-hint" style="margin-top: 10px;"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Anthropic OAuth -->
                            <div class="card" id="anthropic-oauth-card">
                                <div class="card-header">
                                    <h3><i class="fas fa-brain"></i> <span
                                            data-i18n="auth_login.anthropic_oauth_title">Anthropic OAuth</span></h3>
                                    <button id="anthropic-oauth-btn" class="btn btn-primary">
                                        <i class="fas fa-sign-in-alt"></i> <span
                                            data-i18n="auth_login.anthropic_oauth_button">开始 Anthropic 登录</span>
                                    </button>
                                </div>
                                <div class="card-content">
                                    <p class="form-hint" style="margin-bottom: 20px;"
                                        data-i18n="auth_login.anthropic_oauth_hint">
                                        通过 OAuth 流程登录 Anthropic (Claude) 服务，自动获取并保存认证文件。
                                    </p>
                                    <div id="anthropic-oauth-content" style="display: none;">
                                        <div class="form-group">
                                            <label data-i18n="auth_login.anthropic_oauth_url_label">授权链接:</label>
                                            <div class="input-group">
                                                <input type="text" id="anthropic-oauth-url" readonly>
                                                <button id="anthropic-open-link" class="btn btn-primary">
                                                    <i class="fas fa-external-link-alt"></i> <span
                                                        data-i18n="auth_login.anthropic_open_link">打开链接</span>
                                                </button>
                                                <button id="anthropic-copy-link" class="btn btn-secondary">
                                                    <i class="fas fa-copy"></i> <span
                                                        data-i18n="auth_login.anthropic_copy_link">复制链接</span>
                                                </button>
                                            </div>
                                        </div>
                                        <div id="anthropic-oauth-status" class="form-hint" style="margin-top: 10px;">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Antigravity OAuth -->
                            <div class="card" id="antigravity-oauth-card">
                                <div class="card-header">
                                    <h3><i class="fas fa-rocket"></i> <span
                                            data-i18n="auth_login.antigravity_oauth_title">Antigravity OAuth</span></h3>
                                    <button id="antigravity-oauth-btn" class="btn btn-primary">
                                        <i class="fas fa-sign-in-alt"></i> <span
                                            data-i18n="auth_login.antigravity_oauth_button">开始 Antigravity 登录</span>
                                    </button>
                                </div>
                                <div class="card-content">
                                    <p class="form-hint" style="margin-bottom: 20px;"
                                        data-i18n="auth_login.antigravity_oauth_hint">
                                        通过 OAuth 流程登录 Antigravity（Google 账号）服务，自动获取并保存认证文件。
                                    </p>
                                    <div id="antigravity-oauth-content" style="display: none;">
                                        <div class="form-group">
                                            <label data-i18n="auth_login.antigravity_oauth_url_label">授权链接:</label>
                                            <div class="input-group">
                                                <input type="text" id="antigravity-oauth-url" readonly>
                                                <button id="antigravity-open-link" class="btn btn-primary">
                                                    <i class="fas fa-external-link-alt"></i> <span
                                                        data-i18n="auth_login.antigravity_open_link">打开链接</span>
                                                </button>
                                                <button id="antigravity-copy-link" class="btn btn-secondary">
                                                    <i class="fas fa-copy"></i> <span
                                                        data-i18n="auth_login.antigravity_copy_link">复制链接</span>
                                                </button>
                                            </div>
                                        </div>
                                        <div id="antigravity-oauth-status" class="form-hint" style="margin-top: 10px;">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Gemini CLI OAuth -->
                            <div class="card" id="gemini-cli-oauth-card">
                                <div class="card-header">
                                    <h3><i class="fab fa-google"></i> <span
                                            data-i18n="auth_login.gemini_cli_oauth_title">Gemini CLI OAuth</span></h3>
                                    <button id="gemini-cli-oauth-btn" class="btn btn-primary">
                                        <i class="fas fa-sign-in-alt"></i> <span
                                            data-i18n="auth_login.gemini_cli_oauth_button">开始 Gemini CLI 登录</span>
                                    </button>
                                </div>
                                <div class="card-content">
                                    <p class="form-hint" style="margin-bottom: 20px;"
                                        data-i18n="auth_login.gemini_cli_oauth_hint">
                                        通过 OAuth 流程登录 Google Gemini CLI 服务，自动获取并保存认证文件。
                                    </p>
                                    <div class="form-group" style="margin-bottom: 20px;">
                                        <label for="gemini-cli-project-id"
                                            data-i18n="auth_login.gemini_cli_project_id_label">Google Cloud 项目 ID
                                            (可选):</label>
                                        <input type="text" id="gemini-cli-project-id"
                                            data-i18n-placeholder="auth_login.gemini_cli_project_id_placeholder">
                            <div class="form-hint" data-i18n="auth_login.gemini_cli_project_id_hint">
                                如果指定了项目 ID，将使用该项目的认证信息。
                            </div>
                                    </div>
                                    <div id="gemini-cli-oauth-content" style="display: none;">
                                        <div class="form-group">
                                            <label data-i18n="auth_login.gemini_cli_oauth_url_label">授权链接:</label>
                                            <div class="input-group">
                                                <input type="text" id="gemini-cli-oauth-url" readonly>
                                                <button id="gemini-cli-open-link" class="btn btn-primary">
                                                    <i class="fas fa-external-link-alt"></i> <span
                                                        data-i18n="auth_login.gemini_cli_open_link">打开链接</span>
                                                </button>
                                                <button id="gemini-cli-copy-link" class="btn btn-secondary">
                                                    <i class="fas fa-copy"></i> <span
                                                        data-i18n="auth_login.gemini_cli_copy_link">复制链接</span>
                                                </button>
                                            </div>
                                        </div>
                                        <div id="gemini-cli-oauth-status" class="form-hint" style="margin-top: 10px;">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Qwen OAuth -->
                            <div class="card" id="qwen-oauth-card">
                                <div class="card-header">
                                    <h3><i class="fas fa-robot"></i> <span data-i18n="auth_login.qwen_oauth_title">Qwen
                                            OAuth</span></h3>
                                    <button id="qwen-oauth-btn" class="btn btn-primary">
                                        <i class="fas fa-sign-in-alt"></i> <span
                                            data-i18n="auth_login.qwen_oauth_button">开始 Qwen 登录</span>
                                    </button>
                                </div>
                                <div class="card-content">
                                    <p class="form-hint" style="margin-bottom: 20px;"
                                        data-i18n="auth_login.qwen_oauth_hint">
                                        通过设备授权流程登录 Qwen 服务，自动获取并保存认证文件。
                                    </p>
                                    <div id="qwen-oauth-content" style="display: none;">
                                        <div class="form-group">
                                            <label data-i18n="auth_login.qwen_oauth_url_label">授权链接:</label>
                                            <div class="input-group">
                                                <input type="text" id="qwen-oauth-url" readonly>
                                                <button id="qwen-open-link" class="btn btn-primary">
                                                    <i class="fas fa-external-link-alt"></i> <span
                                                        data-i18n="auth_login.qwen_open_link">打开链接</span>
                                                </button>
                                                <button id="qwen-copy-link" class="btn btn-secondary">
                                                    <i class="fas fa-copy"></i> <span
                                                        data-i18n="auth_login.qwen_copy_link">复制链接</span>
                                                </button>
                                            </div>
                                        </div>
                                        <div id="qwen-oauth-status" class="form-hint" style="margin-top: 10px;"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- iFlow OAuth -->
                            <div class="card" id="iflow-oauth-card">
                                <div class="card-header">
                                    <h3><i class="fas fa-stream"></i> <span
                                            data-i18n="auth_login.iflow_oauth_title">iFlow OAuth</span></h3>
                                    <button id="iflow-oauth-btn" class="btn btn-primary">
                                        <i class="fas fa-sign-in-alt"></i> <span
                                            data-i18n="auth_login.iflow_oauth_button">开始 iFlow 登录</span>
                                    </button>
                                </div>
                                <div class="card-content">
                                    <p class="form-hint" style="margin-bottom: 20px;"
                                        data-i18n="auth_login.iflow_oauth_hint">
                                        通过 OAuth 流程登录 iFlow 服务，自动获取并保存认证文件。
                                    </p>
                                    <div id="iflow-oauth-content" style="display: none;">
                                        <div class="form-group">
                                            <label data-i18n="auth_login.iflow_oauth_url_label">授权链接:</label>
                                            <div class="input-group">
                                                <input type="text" id="iflow-oauth-url" readonly>
                                                <button id="iflow-open-link" class="btn btn-primary">
                                                    <i class="fas fa-external-link-alt"></i> <span
                                                        data-i18n="auth_login.iflow_open_link">打开链接</span>
                                                </button>
                                                <button id="iflow-copy-link" class="btn btn-secondary">
                                                    <i class="fas fa-copy"></i> <span
                                                        data-i18n="auth_login.iflow_copy_link">复制链接</span>
                                                </button>
                                            </div>
                                        </div>
                                        <div id="iflow-oauth-status" class="form-hint" style="margin-top: 10px;"></div>
                                    </div>
                                </div>
                                <div class="card-content" style="border-top: 1px solid var(--border-color); margin-top: 16px; padding-top: 16px;">
                                    <h4 style="margin-bottom: 10px;" data-i18n="auth_login.iflow_cookie_title">iFlow Cookie 登录</h4>
                                    <p class="form-hint" data-i18n="auth_login.iflow_cookie_hint">
                                        直接提交 Cookie 完成登录并保存凭据，无需打开授权链接。
                                    </p>
                                    <div class="form-group">
                                        <label for="iflow-cookie-input" data-i18n="auth_login.iflow_cookie_label">Cookie 内容:</label>
                                        <textarea id="iflow-cookie-input" rows="3" data-i18n-placeholder="auth_login.iflow_cookie_placeholder" placeholder="粘贴浏览器中的 Cookie"></textarea>
                                    </div>
                                    <div class="form-actions">
                                        <button id="iflow-cookie-submit" class="btn btn-primary">
                                            <i class="fas fa-cookie-bite"></i> <span data-i18n="auth_login.iflow_cookie_button">提交 Cookie 登录</span>
                                        </button>
                                    </div>
                                    <div id="iflow-cookie-status" class="form-hint" style="margin-top: 10px;"></div>
                                    <div id="iflow-cookie-result" class="vertex-import-result" style="display: none;">
                                        <div class="vertex-import-result-header">
                                            <i class="fas fa-check-circle"></i>
                                            <span data-i18n="auth_login.iflow_cookie_result_title">Cookie 登录结果</span>
                                        </div>
                                        <ul>
                                            <li><span data-i18n="auth_login.iflow_cookie_result_email">账号</span>: <code id="iflow-cookie-result-email">-</code></li>
                                            <li><span data-i18n="auth_login.iflow_cookie_result_expired">过期时间</span>: <code id="iflow-cookie-result-expired">-</code></li>
                                            <li><span data-i18n="auth_login.iflow_cookie_result_path">保存路径</span>: <code id="iflow-cookie-result-path">-</code></li>
                                            <li><span data-i18n="auth_login.iflow_cookie_result_type">类型</span>: <code id="iflow-cookie-result-type">-</code></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- 日志查看 -->
                        <section id="logs" class="content-section">
                            <h2 data-i18n="logs.title">日志查看</h2>

                            <div class="card">
                                <div class="card-header logs-header">
                                    <div class="logs-header-main">
                                        <h3><i class="fas fa-scroll"></i> <span data-i18n="logs.log_content">日志内容</span></h3>
                                        <div class="logs-search">
                                            <i class="fas fa-search"></i>
                                            <input type="text" id="logs-search-input" aria-label="搜索日志" data-i18n-placeholder="logs.search_placeholder" placeholder="搜索日志...">
                                        </div>
                                    </div>
                                    <div class="header-actions">
                                        <div class="toggle-group" style="margin-right: 15px;">
                                            <label class="toggle-switch" style="margin-right: 5px;">
                                                <input type="checkbox" id="logs-auto-refresh-toggle">
                                                <span class="slider"></span>
                                            </label>
                                            <span class="toggle-label" data-i18n="logs.auto_refresh" style="font-size: 0.9em;">自动刷新</span>
                                        </div>
                                        <button id="refresh-logs" class="btn btn-primary">
                                            <i class="fas fa-sync-alt"></i> <span data-i18n="logs.refresh_button">刷新日志</span>
                                        </button>
                                        <button id="select-error-log" class="btn btn-secondary">
                                            <i class="fas fa-file-circle-exclamation"></i> <span data-i18n="logs.error_log_button">选择错误日志</span>
                                        </button>
                                        <button id="download-logs" class="btn btn-secondary">
                                            <i class="fas fa-download"></i> <span data-i18n="logs.download_button">下载日志</span>
                                        </button>
                                        <button id="clear-logs" class="btn btn-danger">
                                            <i class="fas fa-trash"></i> <span data-i18n="logs.clear_button">清空日志</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-content">
                                    <div id="logs-content" class="logs-container">
                                        <div class="loading-placeholder" data-i18n="logs.loading">正在加载日志...</div>
                                    </div>
                                </div>
                            </div>

                        </section>

                        <!-- 使用统计 -->
                        <section id="usage-stats" class="content-section">
                            <h2 data-i18n="usage_stats.title">使用统计</h2>

                            <!-- 概览统计卡片 -->
                            <div class="stats-overview">
                                <div class="stat-card">
                                    <div class="stat-card-header">
                                        <div class="stat-meta">
                                            <div class="stat-label" data-i18n="usage_stats.total_requests">总请求数</div>
                                            <div class="stat-number" id="total-requests">0</div>
                                            <div class="stat-subtext stat-subtext-inline">
                                                <span><span data-i18n="usage_stats.success_requests">成功请求</span> <span id="success-requests">0</span></span>
                                                <span class="dot-divider">•</span>
                                                <span><span data-i18n="usage_stats.failed_requests">失败请求</span> <span id="failed-requests">0</span></span>
                                            </div>
                                        </div>
                                        <div class="stat-icon">
                                            <i class="fas fa-paper-plane"></i>
                                        </div>
                                    </div>
                                    <div class="stat-sparkline" aria-label="30分钟请求趋势">
                                        <canvas id="requests-sparkline"></canvas>
                                    </div>
                                </div>

                                <div class="stat-card">
                                    <div class="stat-card-header">
                                        <div class="stat-meta">
                                            <div class="stat-label" data-i18n="usage_stats.total_tokens">总Token数</div>
                                            <div class="stat-number" id="total-tokens">0</div>
                                            <div class="stat-subtext">
                                                <span data-i18n="usage_stats.cached_tokens">缓存 Token 数</span>:
                                                <span id="cached-tokens">0</span>
                                            </div>
                                            <div class="stat-subtext">
                                                <span data-i18n="usage_stats.reasoning_tokens">思考 Token 数</span>:
                                                <span id="reasoning-tokens">0</span>
                                            </div>
                                        </div>
                                        <div class="stat-icon">
                                            <i class="fas fa-coins"></i>
                                        </div>
                                    </div>
                                    <div class="stat-sparkline" aria-label="30分钟Token趋势">
                                        <canvas id="tokens-sparkline"></canvas>
                                    </div>
                                </div>

                                <div class="stat-card">
                                    <div class="stat-card-header">
                                        <div class="stat-meta">
                                            <div class="stat-label" data-i18n="usage_stats.rpm_30m">RPM（近30分钟）</div>
                                            <div class="stat-number" id="rpm-30m">0</div>
                                        </div>
                                        <div class="stat-icon">
                                            <i class="fas fa-gauge-high"></i>
                                        </div>
                                    </div>
                                    <div class="stat-sparkline" aria-label="30分钟RPM趋势">
                                        <canvas id="rpm-sparkline"></canvas>
                                    </div>
                                </div>

                                <div class="stat-card">
                                    <div class="stat-card-header">
                                        <div class="stat-meta">
                                            <div class="stat-label" data-i18n="usage_stats.tpm_30m">TPM（近30分钟）</div>
                                            <div class="stat-number" id="tpm-30m">0</div>
                                        </div>
                                        <div class="stat-icon">
                                            <i class="fas fa-stopwatch"></i>
                                        </div>
                                    </div>
                                    <div class="stat-sparkline" aria-label="30分钟TPM趋势">
                                        <canvas id="tpm-sparkline"></canvas>
                                    </div>
                                </div>

                                <div class="stat-card cost-summary-card">
                                    <div class="stat-card-header">
                                        <div class="stat-meta">
                                            <div class="stat-label" data-i18n="usage_stats.total_cost">总花费</div>
                                            <div class="stat-number" id="total-cost">--</div>
                                            <div class="stat-subtext" id="total-cost-hint" data-i18n="usage_stats.total_cost_hint">基于已设置的模型单价</div>
                                        </div>
                                        <div class="stat-icon">
                                            <i class="fas fa-dollar-sign"></i>
                                        </div>
                                    </div>
                                    <div class="stat-sparkline" aria-label="30分钟花费趋势">
                                        <canvas id="cost-sparkline"></canvas>
                                    </div>
                                </div>
                            </div>

                            <!-- 图表曲线选择 -->
                            <div class="usage-filter-bar" id="chart-line-bar">
                                <div class="usage-filter-group usage-filter-actions">
                                    <label data-i18n="usage_stats.chart_line_actions_label">曲线数量</label>
                                    <div class="chart-line-actions">
                                        <button type="button" class="btn btn-small" id="add-chart-line">
                                            <i class="fas fa-plus"></i>
                                            <span data-i18n="usage_stats.chart_line_add">增加曲线</span>
                                        </button>
                                        <span class="chart-line-count" id="chart-line-count">3/9</span>
                                    </div>
                                    <div class="chart-line-hint" data-i18n="usage_stats.chart_line_hint">最多显示 9 条模型曲线</div>
                                </div>
                                <div class="usage-filter-group chart-line-group" data-line-index="0">
                                    <label for="chart-line-select-0" data-i18n="usage_stats.chart_line_label_1">曲线 1</label>
                                    <div class="chart-line-control">
                                        <select id="chart-line-select-0" class="model-filter-select chart-line-select" data-line-index="0" disabled>
                                            <option value="all" data-i18n="usage_stats.chart_line_all">全部</option>
                                        </select>
                                        <button type="button" class="btn btn-small btn-danger chart-line-delete" data-line-index="0">
                                            <i class="fas fa-trash"></i>
                                            <span data-i18n="usage_stats.chart_line_delete">删除</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="usage-filter-group chart-line-group" data-line-index="1">
                                    <label for="chart-line-select-1" data-i18n="usage_stats.chart_line_label_2">曲线 2</label>
                                    <div class="chart-line-control">
                                        <select id="chart-line-select-1" class="model-filter-select chart-line-select" data-line-index="1" disabled>
                                            <option value="all" data-i18n="usage_stats.chart_line_all">全部</option>
                                        </select>
                                        <button type="button" class="btn btn-small btn-danger chart-line-delete" data-line-index="1">
                                            <i class="fas fa-trash"></i>
                                            <span data-i18n="usage_stats.chart_line_delete">删除</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="usage-filter-group chart-line-group" data-line-index="2">
                                    <label for="chart-line-select-2" data-i18n="usage_stats.chart_line_label_3">曲线 3</label>
                                    <div class="chart-line-control">
                                        <select id="chart-line-select-2" class="model-filter-select chart-line-select" data-line-index="2" disabled>
                                            <option value="all" data-i18n="usage_stats.chart_line_all">全部</option>
                                        </select>
                                        <button type="button" class="btn btn-small btn-danger chart-line-delete" data-line-index="2">
                                            <i class="fas fa-trash"></i>
                                            <span data-i18n="usage_stats.chart_line_delete">删除</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="usage-filter-group chart-line-group chart-line-hidden" data-line-index="3">
                                    <label for="chart-line-select-3" data-i18n="usage_stats.chart_line_label_4">曲线 4</label>
                                    <div class="chart-line-control">
                                        <select id="chart-line-select-3" class="model-filter-select chart-line-select" data-line-index="3" disabled>
                                            <option value="all" data-i18n="usage_stats.chart_line_all">全部</option>
                                        </select>
                                        <button type="button" class="btn btn-small btn-danger chart-line-delete" data-line-index="3">
                                            <i class="fas fa-trash"></i>
                                            <span data-i18n="usage_stats.chart_line_delete">删除</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="usage-filter-group chart-line-group chart-line-hidden" data-line-index="4">
                                    <label for="chart-line-select-4" data-i18n="usage_stats.chart_line_label_5">曲线 5</label>
                                    <div class="chart-line-control">
                                        <select id="chart-line-select-4" class="model-filter-select chart-line-select" data-line-index="4" disabled>
                                            <option value="all" data-i18n="usage_stats.chart_line_all">全部</option>
                                        </select>
                                        <button type="button" class="btn btn-small btn-danger chart-line-delete" data-line-index="4">
                                            <i class="fas fa-trash"></i>
                                            <span data-i18n="usage_stats.chart_line_delete">删除</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="usage-filter-group chart-line-group chart-line-hidden" data-line-index="5">
                                    <label for="chart-line-select-5" data-i18n="usage_stats.chart_line_label_6">曲线 6</label>
                                    <div class="chart-line-control">
                                        <select id="chart-line-select-5" class="model-filter-select chart-line-select" data-line-index="5" disabled>
                                            <option value="all" data-i18n="usage_stats.chart_line_all">全部</option>
                                        </select>
                                        <button type="button" class="btn btn-small btn-danger chart-line-delete" data-line-index="5">
                                            <i class="fas fa-trash"></i>
                                            <span data-i18n="usage_stats.chart_line_delete">删除</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="usage-filter-group chart-line-group chart-line-hidden" data-line-index="6">
                                    <label for="chart-line-select-6" data-i18n="usage_stats.chart_line_label_7">曲线 7</label>
                                    <div class="chart-line-control">
                                        <select id="chart-line-select-6" class="model-filter-select chart-line-select" data-line-index="6" disabled>
                                            <option value="all" data-i18n="usage_stats.chart_line_all">全部</option>
                                        </select>
                                        <button type="button" class="btn btn-small btn-danger chart-line-delete" data-line-index="6">
                                            <i class="fas fa-trash"></i>
                                            <span data-i18n="usage_stats.chart_line_delete">删除</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="usage-filter-group chart-line-group chart-line-hidden" data-line-index="7">
                                    <label for="chart-line-select-7" data-i18n="usage_stats.chart_line_label_8">曲线 8</label>
                                    <div class="chart-line-control">
                                        <select id="chart-line-select-7" class="model-filter-select chart-line-select" data-line-index="7" disabled>
                                            <option value="all" data-i18n="usage_stats.chart_line_all">全部</option>
                                        </select>
                                        <button type="button" class="btn btn-small btn-danger chart-line-delete" data-line-index="7">
                                            <i class="fas fa-trash"></i>
                                            <span data-i18n="usage_stats.chart_line_delete">删除</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="usage-filter-group chart-line-group chart-line-hidden" data-line-index="8">
                                    <label for="chart-line-select-8" data-i18n="usage_stats.chart_line_label_9">曲线 9</label>
                                    <div class="chart-line-control">
                                        <select id="chart-line-select-8" class="model-filter-select chart-line-select" data-line-index="8" disabled>
                                            <option value="all" data-i18n="usage_stats.chart_line_all">全部</option>
                                        </select>
                                        <button type="button" class="btn btn-small btn-danger chart-line-delete" data-line-index="8">
                                            <i class="fas fa-trash"></i>
                                            <span data-i18n="usage_stats.chart_line_delete">删除</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- 图表区域 -->
                            <div class="charts-container">
                                <!-- 请求趋势图 -->
                                <div class="card chart-card">
                                    <div class="card-header">
                                        <h3><i class="fas fa-chart-line"></i> <span
                                                data-i18n="usage_stats.requests_trend">请求趋势</span></h3>
                                        <div class="chart-controls">
                                            <button class="btn btn-small" data-period="hour" id="requests-hour-btn">
                                                <span data-i18n="usage_stats.by_hour">按小时</span>
                                            </button>
                                            <button class="btn btn-small active" data-period="day"
                                                id="requests-day-btn">
                                                <span data-i18n="usage_stats.by_day">按天</span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-content">
                                        <div class="chart-container">
                                            <canvas id="requests-chart"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- Token使用趋势图 -->
                                <div class="card chart-card">
                                    <div class="card-header">
                                        <h3><i class="fas fa-chart-area"></i> <span
                                                data-i18n="usage_stats.tokens_trend">Token 使用趋势</span></h3>
                                        <div class="chart-controls">
                                            <button class="btn btn-small" data-period="hour" id="tokens-hour-btn">
                                                <span data-i18n="usage_stats.by_hour">按小时</span>
                                            </button>
                                            <button class="btn btn-small active" data-period="day" id="tokens-day-btn">
                                                <span data-i18n="usage_stats.by_day">按天</span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-content">
                                        <div class="chart-container">
                                            <canvas id="tokens-chart"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <div class="card chart-card cost-chart-card">
                                <div class="card-header">
                                    <h3><i class="fas fa-sack-dollar"></i> <span data-i18n="usage_stats.cost_trend">花费统计</span></h3>
                                    <div class="chart-controls">
                                        <button class="btn btn-small" data-period="hour" id="cost-hour-btn">
                                            <span data-i18n="usage_stats.by_hour">按小时</span>
                                        </button>
                                        <button class="btn btn-small active" data-period="day" id="cost-day-btn">
                                            <span data-i18n="usage_stats.by_day">按天</span>
                                        </button>
                                    </div>
                                </div>
                                    <div class="card-content">
                                        <div class="chart-container">
                                            <canvas id="cost-chart"></canvas>
                                            <div id="cost-chart-placeholder" class="chart-placeholder" data-i18n="usage_stats.cost_need_price">请先设置模型价格</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- API详细统计 -->
                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-list"></i> <span data-i18n="usage_stats.api_details">API
                                            详细统计</span></h3>
                                    <button id="refresh-usage-stats" class="btn btn-primary">
                                        <i class="fas fa-sync-alt"></i> <span data-i18n="usage_stats.refresh">刷新</span>
                                    </button>
                                </div>
                                <div class="card-content">
                                    <div id="api-stats-table" class="api-stats-table">
                                        <div class="loading-placeholder" data-i18n="common.loading">正在加载...</div>
                                    </div>
                                </div>
                            </div>

                            <div class="card cost-config-card">
                                <div class="card-header">
                                    <h3><i class="fas fa-tags"></i> <span data-i18n="usage_stats.model_price_title">模型价格</span></h3>
                                    <div class="card-actions">
                                        <button type="button" id="reset-model-prices" class="btn btn-secondary">
                                            <i class="fas fa-rotate-left"></i> <span data-i18n="usage_stats.model_price_reset">清除价格</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-content">
                                    <form id="model-price-form" class="model-price-form">
                                        <div class="form-group">
                                            <label for="model-price-model-select" data-i18n="usage_stats.model_price_model_label">选择模型</label>
                                            <select id="model-price-model-select" class="model-filter-select">
                                                <option value="" data-i18n="usage_stats.model_price_select_placeholder">选择模型</option>
                                            </select>
                                            <p class="form-hint" data-i18n="usage_stats.model_price_select_hint">模型列表来自使用统计</p>
                                        </div>
                                        <div class="price-input-grid">
                                            <div class="form-group">
                                                <label for="model-price-prompt" data-i18n="usage_stats.model_price_prompt">提示价格 ($/1M tokens)</label>
                                                <input type="number" step="0.0001" min="0" id="model-price-prompt" placeholder="0.0000">
                                            </div>
                                            <div class="form-group">
                                                <label for="model-price-completion" data-i18n="usage_stats.model_price_completion">补全价格 ($/1M tokens)</label>
                                                <input type="number" step="0.0001" min="0" id="model-price-completion" placeholder="0.0000">
                                            </div>
                                        </div>
                                        <div class="price-form-actions">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save"></i> <span data-i18n="usage_stats.model_price_save">保存价格</span>
                                            </button>
                                        </div>
                                    </form>
                                    <div class="model-price-list" id="model-price-list">
                                        <div class="loading-placeholder" data-i18n="common.loading">正在加载...</div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- 配置管理 -->
                        <section id="config-management" class="content-section">
                            <h2 data-i18n="config_management.title">配置管理</h2>

                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-file-code"></i> <span data-i18n="config_management.editor_title">配置文件</span></h3>
                                    <div class="editor-actions">
                                        <button id="config-reload-btn" class="btn btn-secondary">
                                            <i class="fas fa-sync-alt"></i> <span data-i18n="config_management.reload">重新加载</span>
                                        </button>
                                        <button id="config-save-btn" class="btn btn-primary">
                                            <i class="fas fa-save"></i> <span data-i18n="config_management.save">保存</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-content">
                                    <p class="form-hint" data-i18n="config_management.description">查看并编辑服务器上的 config.yaml 配置文件。保存前请确认语法正确。</p>
                                    <div class="yaml-editor-container">
                                        <textarea id="config-editor" class="yaml-editor" spellcheck="false" data-i18n="config_management.editor_placeholder"></textarea>
                                        <div id="config-editor-status" class="editor-status" data-i18n="config_management.status_idle">等待操作</div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- 管理中心信息 -->
                        <section id="system-info" class="content-section">
                            <h2 data-i18n="system_info.title">管理中心信息</h2>

                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-layer-group"></i> <span data-i18n="system_info.models_title">可用模型列表</span></h3>
                                    <button type="button" id="available-models-refresh" class="btn btn-secondary">
                                        <i class="fas fa-sync-alt"></i> <span data-i18n="common.refresh">刷新</span>
                                    </button>
                                </div>
                                <div class="card-content">
                                    <p class="form-hint" data-i18n="system_info.models_desc">展示当前服务返回的 /v1/models 列表（使用服务器保存的 API Key 自动鉴权）。</p>
                                    <div id="available-models-status" class="available-models-status" data-i18n="common.loading">加载中...</div>
                                    <div id="available-models-list" class="available-models-list"></div>
                                </div>
                            </div>

                            <!-- 连接信息卡片 -->
                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-server"></i> <span data-i18n="connection.title">连接信息</span>
                                    </h3>
                                </div>
                                <div class="card-content">
                                    <div class="connection-info">
                                        <div class="info-item">
                                            <div class="info-label">
                                                <i class="fas fa-globe"></i>
                                                <span data-i18n="connection.server_address">服务器地址:</span>
                                            </div>
                                            <div class="info-value" id="display-api-url">-</div>
                                        </div>
                                        <div class="info-item">
                                            <div class="info-label">
                                                <i class="fas fa-circle"></i>
                                                <span data-i18n="connection.status">连接状态:</span>
                                            </div>
                                            <div class="info-value" id="display-connection-status">
                                                <span class="status-indicator disconnected"
                                                    data-i18n="common.disconnected">未连接</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-info-circle"></i> <span
                                            data-i18n="system_info.connection_status_title">连接状态</span></h3>
                                </div>
                                <div class="card-content">
                                    <div id="system-status" class="status-info">
                                        <div class="status-item">
                                            <span class="status-label" data-i18n="system_info.api_status_label">API
                                                状态:</span>
                                            <span id="api-status" class="status-value"
                                                data-i18n="common.disconnected">未连接</span>
                                        </div>
                                        <div class="status-item">
                                            <span class="status-label"
                                                data-i18n="system_info.config_status_label">配置状态:</span>
                                            <span id="config-status" class="status-value"
                                                data-i18n="system_info.not_loaded">未加载</span>
                                        </div>
                                        <div class="status-item">
                                            <span class="status-label"
                                                data-i18n="system_info.last_update_label">最后更新:</span>
                                            <span id="last-update" class="status-value">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <h3><i class="fas fa-arrows-rotate"></i> <span data-i18n="system_info.version_check_title">版本检查</span></h3>
                                </div>
                                <div class="card-content version-check">
                                    <p class="form-hint" data-i18n="system_info.version_check_desc">调用 /latest-version 接口比对服务器版本，提示是否有可用更新。</p>
                                    <div class="version-check-rows">
                                        <div class="version-check-row">
                                            <span class="status-label" data-i18n="system_info.version_current_label">当前版本</span>
                                            <span id="version-check-current" class="version-check-value">-</span>
                                        </div>
                                        <div class="version-check-row">
                                            <span class="status-label" data-i18n="system_info.version_latest_label">最新版本</span>
                                            <span id="version-check-latest" class="version-check-value">-</span>
                                        </div>
                                    </div>
                                    <div class="version-check-actions">
                                        <button type="button" id="version-check-btn" class="btn btn-primary">
                                            <i class="fas fa-search"></i> <span data-i18n="system_info.version_check_button">检查更新</span>
                                        </button>
                                        <span id="version-check-result" class="version-check-result" data-i18n="system_info.version_check_idle">点击检查更新</span>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                    <!-- /内容区域 -->

                    <!-- 版本信息 -->
                    <footer class="version-footer">
                        <div class="version-info">
                            <span data-i18n="footer.api_version">CLI Proxy API 版本</span>:
                            <span id="api-version">-</span>
                            <span class="separator">•</span>
                            <span data-i18n="footer.build_date">构建时间</span>:
                            <span id="api-build-date">-</span>
                            <span class="separator">•</span>
                            <span data-i18n="footer.version">管理中心版本</span>:
                            <span id="ui-version" data-ui-version="v0.5.13">-</span>
                            <span class="separator">•</span>
                            <span data-i18n="footer.author">作者</span>: CLI Proxy API Team
                        </div>
                    </footer>
                </div>
                <!-- /主内容区域 -->
            </div>
            <!-- /主内容包装器 -->
        </div>
        <!-- /主页面 -->

        <!-- 模态框 -->
        <div id="modal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <div id="modal-body"></div>
            </div>
        </div>

        <!-- 通知 -->
        <div id="notification" class="notification"></div>

    </div>

    <script>

// ============ src/modules/theme.js ============
const themeModule = {
    initializeTheme() {
        const savedTheme = localStorage.getItem('preferredTheme');
        if (savedTheme && ['light', 'dark'].includes(savedTheme)) {
            this.currentTheme = savedTheme;
        } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            this.currentTheme = 'dark';
        } else {
            this.currentTheme = 'light';
        }

        this.applyTheme(this.currentTheme);
        this.updateThemeButtons();

        if (window.matchMedia) {
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                if (!localStorage.getItem('preferredTheme')) {
                    this.currentTheme = e.matches ? 'dark' : 'light';
                    this.applyTheme(this.currentTheme);
                    this.updateThemeButtons();
                }
            });
        }
    },

    applyTheme(theme) {
        if (theme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
        } else {
            document.documentElement.removeAttribute('data-theme');
        }
        this.currentTheme = theme;
    },

    toggleTheme() {
        const newTheme = this.currentTheme === 'light' ? 'dark' : 'light';
        this.applyTheme(newTheme);
        this.updateThemeButtons();
        localStorage.setItem('preferredTheme', newTheme);
    },

    updateThemeButtons() {
        const loginThemeBtn = document.getElementById('theme-toggle');
        const mainThemeBtn = document.getElementById('theme-toggle-main');

        const updateButton = (btn) => {
            if (!btn) return;
            const icon = btn.querySelector('i');
            if (this.currentTheme === 'dark') {
                icon.className = 'fas fa-sun';
                btn.title = i18n.t('theme.switch_to_light');
            } else {
                icon.className = 'fas fa-moon';
                btn.title = i18n.t('theme.switch_to_dark');
            }
        };

        updateButton(loginThemeBtn);
        updateButton(mainThemeBtn);
    },

    setupThemeSwitcher() {
        const loginToggle = document.getElementById('theme-toggle');
        const mainToggle = document.getElementById('theme-toggle-main');

        if (loginToggle) {
            loginToggle.addEventListener('click', () => this.toggleTheme());
        }
        if (mainToggle) {
            mainToggle.addEventListener('click', () => this.toggleTheme());
        }
    }
};



// ============ src/modules/navigation.js ============
const navigationModule = {
    setupNavigation() {
        const navItems = document.querySelectorAll('.nav-item');
        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();

                navItems.forEach(nav => nav.classList.remove('active'));
                document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));

                item.classList.add('active');
                const sectionId = item.getAttribute('data-section');
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.add('active');
                }

                if (sectionId === 'config-management') {
                    this.loadConfigFileEditor();
                    this.refreshConfigEditor();
                }
                if (this.events && typeof this.events.emit === 'function') {
                    this.events.emit('navigation:section-activated', { sectionId });
                }
            });
        });
    },

    toggleMobileSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        const layout = document.getElementById('layout-container');
        const mainWrapper = document.getElementById('main-wrapper');

        if (sidebar && overlay) {
            const isOpen = sidebar.classList.toggle('mobile-open');
            overlay.classList.toggle('active');
            if (layout) {
                layout.classList.toggle('sidebar-open', isOpen);
            }
            if (mainWrapper) {
                mainWrapper.classList.toggle('sidebar-open', isOpen);
            }
        }
    },

    closeMobileSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        const layout = document.getElementById('layout-container');
        const mainWrapper = document.getElementById('main-wrapper');

        if (sidebar && overlay) {
            sidebar.classList.remove('mobile-open');
            overlay.classList.remove('active');
            if (layout) {
                layout.classList.remove('sidebar-open');
            }
            if (mainWrapper) {
                mainWrapper.classList.remove('sidebar-open');
            }
        }
    },

    toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const layout = document.getElementById('layout-container');

        if (sidebar && layout) {
            const isCollapsed = sidebar.classList.toggle('collapsed');
            layout.classList.toggle('sidebar-collapsed', isCollapsed);

            localStorage.setItem('sidebarCollapsed', isCollapsed ? 'true' : 'false');

            const toggleBtn = document.getElementById('sidebar-toggle-btn-desktop');
            if (toggleBtn) {
                toggleBtn.setAttribute('data-i18n-title', isCollapsed ? 'sidebar.toggle_expand' : 'sidebar.toggle_collapse');
                toggleBtn.title = i18n.t(isCollapsed ? 'sidebar.toggle_expand' : 'sidebar.toggle_collapse');
            }
        }
    },

    restoreSidebarState() {
        if (window.innerWidth > 1024) {
            const savedState = localStorage.getItem('sidebarCollapsed');
            if (savedState === 'true') {
                const sidebar = document.getElementById('sidebar');
                const layout = document.getElementById('layout-container');

                if (sidebar && layout) {
                    sidebar.classList.add('collapsed');
                    layout.classList.add('sidebar-collapsed');

                    const toggleBtn = document.getElementById('sidebar-toggle-btn-desktop');
                    if (toggleBtn) {
                        toggleBtn.setAttribute('data-i18n-title', 'sidebar.toggle_expand');
                        toggleBtn.title = i18n.t('sidebar.toggle_expand');
                    }
                }
            }
        }
    }
};



// ============ src/modules/language.js ============
const languageModule = {
    setupLanguageSwitcher() {
        const loginToggle = document.getElementById('language-toggle');
        const mainToggle = document.getElementById('language-toggle-main');

        if (loginToggle) {
            loginToggle.addEventListener('click', () => this.toggleLanguage());
        }
        if (mainToggle) {
            mainToggle.addEventListener('click', () => this.toggleLanguage());
        }
    },

    toggleLanguage() {
        if (this.isLanguageRefreshInProgress) {
            return;
        }
        this.isLanguageRefreshInProgress = true;

        const currentLang = i18n.currentLanguage;
        const newLang = currentLang === 'zh-CN' ? 'en-US' : 'zh-CN';
        i18n.setLanguage(newLang);

        this.refreshBrandTitleAfterTextChange();
        this.updateThemeButtons();
        this.updateConnectionStatus();

        if (this.isLoggedIn && this.isConnected && this.events && typeof this.events.emit === 'function') {
            this.events.emit('config:refresh-requested', { forceRefresh: true });
        }

        // 简单释放锁，避免短时间内的重复触发
        setTimeout(() => {
            this.isLanguageRefreshInProgress = false;
        }, 500);
    }
};



// ============ src/utils/secure-storage.js ============
// 简单的浏览器端加密存储封装
// 仅用于避免本地缓存中明文暴露敏感值，无法替代服务端安全控制

const ENC_PREFIX = 'enc::v1::';
const SECRET_SALT = 'cli-proxy-api-webui::secure-storage';

const encoder = typeof TextEncoder !== 'undefined' ? new TextEncoder() : null;
const decoder = typeof TextDecoder !== 'undefined' ? new TextDecoder() : null;

let cachedKeyBytes = null;

function encodeText(text) {
    if (encoder) return encoder.encode(text);
    const result = new Uint8Array(text.length);
    for (let i = 0; i < text.length; i++) {
        result[i] = text.charCodeAt(i) & 0xff;
    }
    return result;
}

function decodeText(bytes) {
    if (decoder) return decoder.decode(bytes);
    let result = '';
    for (let i = 0; i < bytes.length; i++) {
        result += String.fromCharCode(bytes[i]);
    }
    return result;
}

function getKeyBytes() {
    if (cachedKeyBytes) return cachedKeyBytes;
    try {
        const host = typeof window !== 'undefined' ? window.location.host : 'unknown-host';
        const ua = typeof navigator !== 'undefined' ? navigator.userAgent : 'unknown-ua';
        cachedKeyBytes = encodeText(`${SECRET_SALT}|${host}|${ua}`);
    } catch (error) {
        console.warn('Secure storage fallback to plain text:', error);
        cachedKeyBytes = encodeText(SECRET_SALT);
    }
    return cachedKeyBytes;
}

function xorBytes(data, keyBytes) {
    const result = new Uint8Array(data.length);
    for (let i = 0; i < data.length; i++) {
        result[i] = data[i] ^ keyBytes[i % keyBytes.length];
    }
    return result;
}

function toBase64(bytes) {
    let binary = '';
    for (let i = 0; i < bytes.length; i++) {
        binary += String.fromCharCode(bytes[i]);
    }
    return btoa(binary);
}

function fromBase64(base64) {
    const binary = atob(base64);
    const bytes = new Uint8Array(binary.length);
    for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
    }
    return bytes;
}

function encode(value) {
    if (value === null || value === undefined) return value;
    try {
        const keyBytes = getKeyBytes();
        const encrypted = xorBytes(encodeText(String(value)), keyBytes);
        return `${ENC_PREFIX}${toBase64(encrypted)}`;
    } catch (error) {
        console.warn('Secure storage encode fallback:', error);
        return String(value);
    }
}

function decode(payload) {
    if (payload === null || payload === undefined) return payload;
    if (!payload.startsWith(ENC_PREFIX)) {
        return payload;
    }
    try {
        const encodedBody = payload.slice(ENC_PREFIX.length);
        const encrypted = fromBase64(encodedBody);
        const decrypted = xorBytes(encrypted, getKeyBytes());
        return decodeText(decrypted);
    } catch (error) {
        console.warn('Secure storage decode fallback:', error);
        return payload;
    }
}

const secureStorage = {
    setItem(key, value, { encrypt = true } = {}) {
        if (typeof localStorage === 'undefined') return;
        if (value === null || value === undefined) {
            localStorage.removeItem(key);
            return;
        }
        const storedValue = encrypt ? encode(value) : String(value);
        localStorage.setItem(key, storedValue);
    },

    getItem(key, { decrypt = true } = {}) {
        if (typeof localStorage === 'undefined') return null;
        const raw = localStorage.getItem(key);
        if (raw === null) return null;
        return decrypt ? decode(raw) : raw;
    },

    removeItem(key) {
        if (typeof localStorage === 'undefined') return;
        localStorage.removeItem(key);
    },

    migratePlaintextKeys(keys = []) {
        if (typeof localStorage === 'undefined') return;
        keys.forEach((key) => {
            const raw = localStorage.getItem(key);
            if (raw && !String(raw).startsWith(ENC_PREFIX)) {
                this.setItem(key, raw, { encrypt: true });
            }
        });
    }
};



// ============ src/modules/login.js ============


const loginModule = {
    async checkLoginStatus() {
        // 将旧的明文缓存迁移为加密格式
        secureStorage.migratePlaintextKeys(['apiBase', 'apiUrl', 'managementKey']);

        const savedBase = secureStorage.getItem('apiBase');
        const savedKey = secureStorage.getItem('managementKey');
        const wasLoggedIn = localStorage.getItem('isLoggedIn') === 'true';

        if (savedBase && savedKey && wasLoggedIn) {
            try {
                console.log(i18n.t('auto_login.title'));
                this.showAutoLoginLoading();
                await this.attemptAutoLogin(savedBase, savedKey);
                return;
            } catch (error) {
                console.log(`${i18n.t('notification.login_failed')}: ${error.message}`);
                localStorage.removeItem('isLoggedIn');
                this.hideAutoLoginLoading();
            }
        }

        this.showLoginPage();
        this.loadLoginSettings();
    },

    showAutoLoginLoading() {
        document.getElementById('auto-login-loading').style.display = 'flex';
        document.getElementById('login-page').style.display = 'none';
        document.getElementById('main-page').style.display = 'none';
    },

    hideAutoLoginLoading() {
        document.getElementById('auto-login-loading').style.display = 'none';
    },

    async attemptAutoLogin(apiBase, managementKey) {
        try {
            this.setApiBase(apiBase);
            this.setManagementKey(managementKey);

            const savedProxy = localStorage.getItem('proxyUrl');
            if (savedProxy) {
                // 代理设置会在后续的API请求中自动使用
            }

            await this.testConnection();

            this.isLoggedIn = true;
            this.hideAutoLoginLoading();
            this.showMainPage();

            console.log(i18n.t('auto_login.title'));
            return true;
        } catch (error) {
            console.error('自动登录失败:', error);
            this.isLoggedIn = false;
            this.isConnected = false;
            throw error;
        }
    },

    showLoginPage() {
        document.getElementById('login-page').style.display = 'flex';
        document.getElementById('main-page').style.display = 'none';
        this.isLoggedIn = false;
        this.resetBrandTitleState();
        this.updateLoginConnectionInfo();
    },

    showMainPage() {
        document.getElementById('login-page').style.display = 'none';
        document.getElementById('main-page').style.display = 'block';
        this.isLoggedIn = true;
        this.updateConnectionInfo();
        this.startBrandCollapseCycle();
    },

    async login(apiBase, managementKey) {
        try {
            this.setApiBase(apiBase);
            this.setManagementKey(managementKey);

            await this.testConnection();

            this.isLoggedIn = true;
            localStorage.setItem('isLoggedIn', 'true');

            this.showMainPage();
            return true;
        } catch (error) {
            console.error('登录失败:', error);
            throw error;
        }
    },

    logout() {
        this.isLoggedIn = false;
        this.isConnected = false;
        this.clearCache();
        this.stopStatusUpdateTimer();
        this.resetVersionInfo();
        this.setManagementKey('', { persist: false });
        this.oauthExcludedModels = {};
        this._oauthExcludedLoading = false;
        if (typeof this.renderOauthExcludedModels === 'function') {
            this.renderOauthExcludedModels('all');
        }
        if (typeof this.clearAvailableModels === 'function') {
            this.clearAvailableModels('common.disconnected');
        }

        localStorage.removeItem('isLoggedIn');
        secureStorage.removeItem('managementKey');

        this.showLoginPage();
    },

    async handleLogin() {
        const apiBaseInput = document.getElementById('login-api-base');
        const managementKeyInput = document.getElementById('login-management-key');
        const managementKey = managementKeyInput ? managementKeyInput.value.trim() : '';

        if (!managementKey) {
            this.showLoginError(i18n.t('login.error_required'));
            return;
        }

        if (apiBaseInput && apiBaseInput.value.trim()) {
            this.setApiBase(apiBaseInput.value.trim());
        }

        const submitBtn = document.getElementById('login-submit');
        const originalText = submitBtn ? submitBtn.innerHTML : '';

        try {
            if (submitBtn) {
                submitBtn.innerHTML = `<div class=\"loading\"></div> ${i18n.t('login.submitting')}`;
                submitBtn.disabled = true;
            }
            this.hideLoginError();

            this.setManagementKey(managementKey);

            await this.login(this.apiBase, this.managementKey);
        } catch (error) {
            this.showLoginError(`${i18n.t('login.error_title')}: ${error.message}`);
        } finally {
            if (submitBtn) {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }
    },

    toggleLoginKeyVisibility(button) {
        const inputGroup = button.closest('.input-group');
        const keyInput = inputGroup.querySelector('input[type=\"password\"], input[type=\"text\"]');

        if (keyInput.type === 'password') {
            keyInput.type = 'text';
            button.innerHTML = '<i class=\"fas fa-eye-slash\"></i>';
        } else {
            keyInput.type = 'password';
            button.innerHTML = '<i class=\"fas fa-eye\"></i>';
        }
    },

    showLoginError(message) {
        const errorDiv = document.getElementById('login-error');
        const errorMessage = document.getElementById('login-error-message');

        errorMessage.textContent = message;
        errorDiv.style.display = 'flex';
    },

    hideLoginError() {
        const errorDiv = document.getElementById('login-error');
        errorDiv.style.display = 'none';
    },

    updateConnectionInfo() {
        const apiUrlElement = document.getElementById('display-api-url');
        const statusElement = document.getElementById('display-connection-status');

        if (apiUrlElement) {
            apiUrlElement.textContent = this.apiBase || '-';
        }

        if (statusElement) {
            let statusHtml = '';
            if (this.isConnected) {
                statusHtml = `<span class=\"status-indicator connected\"><i class=\"fas fa-circle\"></i> ${i18n.t('common.connected')}</span>`;
            } else {
                statusHtml = `<span class=\"status-indicator disconnected\"><i class=\"fas fa-circle\"></i> ${i18n.t('common.disconnected')}</span>`;
            }
            statusElement.innerHTML = statusHtml;
        }
    },

    loadLoginSettings() {
        const savedBase = secureStorage.getItem('apiBase');
        const savedKey = secureStorage.getItem('managementKey');
        const loginKeyInput = document.getElementById('login-management-key');
        const apiBaseInput = document.getElementById('login-api-base');

        if (savedBase) {
            this.setApiBase(savedBase);
        } else {
            this.setApiBase(this.detectApiBaseFromLocation());
        }

        if (apiBaseInput) {
            apiBaseInput.value = this.apiBase || '';
        }

        if (loginKeyInput && savedKey) {
            loginKeyInput.value = savedKey;
        }
        this.setManagementKey(savedKey || '', { persist: false });

        this.setupLoginAutoSave();
    },

    setupLoginAutoSave() {
        const loginKeyInput = document.getElementById('login-management-key');
        const apiBaseInput = document.getElementById('login-api-base');
        const resetButton = document.getElementById('login-reset-api-base');

        const saveKey = (val) => {
            const trimmed = val.trim();
            if (trimmed) {
                this.setManagementKey(trimmed);
            }
        };
        const saveKeyDebounced = this.debounce(saveKey, 500);

        if (loginKeyInput) {
            loginKeyInput.addEventListener('change', (e) => saveKey(e.target.value));
            loginKeyInput.addEventListener('input', (e) => saveKeyDebounced(e.target.value));
        }

        if (apiBaseInput) {
            const persistBase = (val) => {
                const normalized = this.normalizeBase(val);
                if (normalized) {
                    this.setApiBase(normalized);
                }
            };
            const persistBaseDebounced = this.debounce(persistBase, 500);

            apiBaseInput.addEventListener('change', (e) => persistBase(e.target.value));
            apiBaseInput.addEventListener('input', (e) => persistBaseDebounced(e.target.value));
        }

        if (resetButton) {
            resetButton.addEventListener('click', () => {
                const detected = this.detectApiBaseFromLocation();
                this.setApiBase(detected);
                if (apiBaseInput) {
                    apiBaseInput.value = detected;
                }
            });
        }

        this.updateLoginConnectionInfo();
    },

    updateLoginConnectionInfo() {
        const connectionUrlElement = document.getElementById('login-connection-url');
        const customInput = document.getElementById('login-api-base');
        if (connectionUrlElement) {
            connectionUrlElement.textContent = this.apiBase || '-';
        }
        if (customInput && customInput !== document.activeElement) {
            customInput.value = this.apiBase || '';
        }
    }
};



// ============ src/modules/config-editor.js ============
const configEditorModule = {
    setupConfigEditor() {
        const textarea = document.getElementById('config-editor');
        const saveBtn = document.getElementById('config-save-btn');
        const reloadBtn = document.getElementById('config-reload-btn');
        const statusEl = document.getElementById('config-editor-status');

        this.configEditorElements = {
            textarea,
            editorInstance: null,
            saveBtn,
            reloadBtn,
            statusEl
        };

        if (!textarea || !saveBtn || !reloadBtn || !statusEl) {
            return;
        }

        if (window.CodeMirror) {
            const editorInstance = window.CodeMirror.fromTextArea(textarea, {
                mode: 'yaml',
                theme: 'default',
                lineNumbers: true,
                indentUnit: 2,
                tabSize: 2,
                lineWrapping: true,
                autoCloseBrackets: true,
                extraKeys: {
                    'Ctrl-/': 'toggleComment',
                    'Cmd-/': 'toggleComment'
                }
            });

            editorInstance.on('change', () => {
                this.isConfigEditorDirty = true;
                this.updateConfigEditorStatus('info', i18n.t('config_management.status_dirty'));
            });

            this.configEditorElements.editorInstance = editorInstance;
        } else {
            textarea.addEventListener('input', () => {
                this.isConfigEditorDirty = true;
                this.updateConfigEditorStatus('info', i18n.t('config_management.status_dirty'));
            });
        }

        saveBtn.addEventListener('click', () => this.saveConfigFile());
        reloadBtn.addEventListener('click', () => this.loadConfigFileEditor(true));

        this.refreshConfigEditor();
    },

    updateConfigEditorAvailability() {
        const { textarea, editorInstance, saveBtn, reloadBtn } = this.configEditorElements || {};
        if ((!textarea && !editorInstance) || !saveBtn || !reloadBtn) {
            return;
        }

        const disabled = !this.isConnected;
        if (editorInstance) {
            editorInstance.setOption('readOnly', disabled ? 'nocursor' : false);
            const wrapper = editorInstance.getWrapperElement();
            if (wrapper) {
                wrapper.classList.toggle('cm-readonly', disabled);
            }
        } else if (textarea) {
            textarea.disabled = disabled;
        }

        saveBtn.disabled = disabled;
        reloadBtn.disabled = disabled;

        if (disabled) {
            this.updateConfigEditorStatus('info', i18n.t('config_management.status_disconnected'));
        }

        this.refreshConfigEditor();
        this.lastEditorConnectionState = this.isConnected;
    },

    refreshConfigEditor() {
        const instance = this.configEditorElements && this.configEditorElements.editorInstance;
        if (instance && typeof instance.refresh === 'function') {
            setTimeout(() => instance.refresh(), 0);
        }
    },

    updateConfigEditorStatus(type, message) {
        const statusEl = (this.configEditorElements && this.configEditorElements.statusEl) || document.getElementById('config-editor-status');
        if (!statusEl) {
            return;
        }

        statusEl.textContent = message;
        statusEl.classList.remove('success', 'error');

        if (type === 'success') {
            statusEl.classList.add('success');
        } else if (type === 'error') {
            statusEl.classList.add('error');
        }
    },

    async loadConfigFileEditor(forceRefresh = false) {
        const { textarea, editorInstance, reloadBtn } = this.configEditorElements || {};
        if (!textarea && !editorInstance) {
            return;
        }

        if (!this.isConnected) {
            this.updateConfigEditorStatus('info', i18n.t('config_management.status_disconnected'));
            return;
        }

        if (reloadBtn) {
            reloadBtn.disabled = true;
        }
        this.updateConfigEditorStatus('info', i18n.t('config_management.status_loading'));

        try {
            const yamlText = await this.fetchConfigFile(forceRefresh);

            if (editorInstance) {
                editorInstance.setValue(yamlText || '');
                if (typeof editorInstance.markClean === 'function') {
                    editorInstance.markClean();
                }
            } else if (textarea) {
                textarea.value = yamlText || '';
            }

            this.isConfigEditorDirty = false;
            this.updateConfigEditorStatus('success', i18n.t('config_management.status_loaded'));
            this.refreshConfigEditor();
        } catch (error) {
            console.error('加载配置文件失败:', error);
            this.updateConfigEditorStatus('error', `${i18n.t('config_management.status_load_failed')}: ${error.message}`);
        } finally {
            if (reloadBtn) {
                reloadBtn.disabled = !this.isConnected;
            }
        }
    },

    async fetchConfigFile(forceRefresh = false) {
        if (!forceRefresh && this.configYamlCache) {
            return this.configYamlCache;
        }

        const requestUrl = '/config.yaml';

        try {
            const response = await this.apiClient.requestRaw(requestUrl, {
                method: 'GET',
                headers: {
                    'Accept': 'application/yaml'
                }
            });

            if (!response.ok) {
                const errorText = await response.text().catch(() => '');
                const message = errorText || `HTTP ${response.status}`;
                throw new Error(message);
            }

            const contentType = response.headers.get('content-type') || '';
            if (!/yaml/i.test(contentType)) {
                throw new Error(i18n.t('config_management.error_yaml_not_supported'));
            }

            const text = await response.text();
            this.lastConfigFetchUrl = requestUrl;
            this.configYamlCache = text;
            return text;
        } catch (error) {
            throw error instanceof Error ? error : new Error(String(error));
        }
    },

    async saveConfigFile() {
        const { textarea, editorInstance, saveBtn, reloadBtn } = this.configEditorElements || {};
        if ((!textarea && !editorInstance) || !saveBtn) {
            return;
        }

        if (!this.isConnected) {
            this.updateConfigEditorStatus('error', i18n.t('config_management.status_disconnected'));
            return;
        }

        const yamlText = editorInstance ? editorInstance.getValue() : (textarea ? textarea.value : '');

        saveBtn.disabled = true;
        if (reloadBtn) {
            reloadBtn.disabled = true;
        }
        this.updateConfigEditorStatus('info', i18n.t('config_management.status_saving'));

        try {
            await this.writeConfigFile('/config.yaml', yamlText);
            this.lastConfigFetchUrl = '/config.yaml';
            this.configYamlCache = yamlText;
            this.isConfigEditorDirty = false;
            if (editorInstance && typeof editorInstance.markClean === 'function') {
                editorInstance.markClean();
            }
            this.showNotification(i18n.t('config_management.save_success'), 'success');
            this.updateConfigEditorStatus('success', i18n.t('config_management.status_saved'));
            this.clearCache();
            if (this.events && typeof this.events.emit === 'function') {
                this.events.emit('config:refresh-requested', { forceRefresh: true });
            }
        } catch (error) {
            const errorMessage = `${i18n.t('config_management.status_save_failed')}: ${error.message}`;
            this.updateConfigEditorStatus('error', errorMessage);
            this.showNotification(errorMessage, 'error');
            this.isConfigEditorDirty = true;
        } finally {
            saveBtn.disabled = !this.isConnected;
            if (reloadBtn) {
                reloadBtn.disabled = !this.isConnected;
            }
        }
    },

    async writeConfigFile(endpoint, yamlText) {
        const response = await this.apiClient.requestRaw(endpoint, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/yaml',
                'Accept': 'application/json, text/plain, */*'
            },
            body: yamlText
        });

        if (!response.ok) {
            const contentType = response.headers.get('content-type') || '';
            let errorText = '';
            if (contentType.includes('application/json')) {
                const data = await response.json().catch(() => ({}));
                errorText = data.message || data.error || '';
            } else {
                errorText = await response.text().catch(() => '');
            }
            throw new Error(errorText || `HTTP ${response.status}`);
        }

        const contentType = response.headers.get('content-type') || '';
        if (contentType.includes('application/json')) {
            const data = await response.json().catch(() => null);
            if (data && data.ok === false) {
                throw new Error(data.message || data.error || 'Server rejected the update');
            }
        }
    },

    registerConfigEditorListeners() {
        if (!this.events || typeof this.events.on !== 'function') {
            return;
        }
        this.events.on('data:config-loaded', async (event) => {
            const detail = event?.detail || {};
            try {
                await this.loadConfigFileEditor(detail.forceRefresh || false);
                this.refreshConfigEditor();
            } catch (error) {
                console.error('加载配置文件失败:', error);
            }
        });
    }
};



// ============ src/modules/logs.js ============
const logsModule = {
    toggleLogsNavItem(show) {
        const logsNavItem = document.getElementById('logs-nav-item');
        if (logsNavItem) {
            logsNavItem.style.display = show ? '' : 'none';
        }
    },

    async refreshLogs(incremental = false) {
        const logsContent = document.getElementById('logs-content');
        if (!logsContent) return;

        try {
            if (incremental && !this.latestLogTimestamp) {
                incremental = false;
            }

            if (!incremental) {
                logsContent.innerHTML = '<div class="loading-placeholder" data-i18n="logs.loading">' + i18n.t('logs.loading') + '</div>';
            }

            let url = '/logs';
            const params = new URLSearchParams();

            if (incremental && this.latestLogTimestamp) {
                params.set('after', this.latestLogTimestamp);
            }

            const logFetchLimit = Number.isFinite(this.logFetchLimit) ? this.logFetchLimit : 2500;
            if (logFetchLimit > 0) {
                params.set('limit', logFetchLimit);
            }

            const queryString = params.toString();
            if (queryString) {
                url += `?${queryString}`;
            }

            const response = await this.makeRequest(url, {
                method: 'GET'
            });

            if (response && response.lines) {
                if (response['latest-timestamp']) {
                    this.latestLogTimestamp = response['latest-timestamp'];
                }

                if (incremental && response.lines.length > 0) {
                    this.appendLogs(response.lines, response['line-count'] || 0);
                } else if (!incremental && response.lines.length > 0) {
                    this.renderLogs(response.lines, response['line-count'] || response.lines.length, true);
                } else if (!incremental) {
                    this.latestLogTimestamp = null;
                    this.renderLogs([], 0, false);
                }
            } else if (!incremental) {
                this.latestLogTimestamp = null;
                this.renderLogs([], 0, false);
            }
        } catch (error) {
            console.error('加载日志失败:', error);
            if (!incremental) {
                this.allLogLines = [];
                this.displayedLogLines = [];
                this.latestLogTimestamp = null;
                const is404 = error.message && (error.message.includes('404') || error.message.includes('Not Found'));

                if (is404) {
                    logsContent.innerHTML = '<div class="upgrade-notice"><i class="fas fa-arrow-circle-up"></i><h3 data-i18n="logs.upgrade_required_title">' +
                        i18n.t('logs.upgrade_required_title') + '</h3><p data-i18n="logs.upgrade_required_desc">' +
                        i18n.t('logs.upgrade_required_desc') + '</p></div>';
                } else {
                    logsContent.innerHTML = '<div class="error-state"><i class="fas fa-exclamation-triangle"></i><p data-i18n="logs.load_error">' +
                        i18n.t('logs.load_error') + '</p><p>' + error.message + '</p></div>';
                }
            }
        }
    },

    renderLogs(lines, lineCount, scrollToBottom = true) {
        const logsContent = document.getElementById('logs-content');
        if (!logsContent) return;

        const sourceLines = Array.isArray(lines) ? lines : [];
        const filteredLines = sourceLines.filter(line => !line.includes('/v0/management/'));
        let displayedLines = filteredLines;
        if (filteredLines.length > this.maxDisplayLogLines) {
            const linesToRemove = filteredLines.length - this.maxDisplayLogLines;
            displayedLines = filteredLines.slice(linesToRemove);
        }

        this.allLogLines = displayedLines.slice();

        if (displayedLines.length === 0) {
            this.displayedLogLines = [];
            logsContent.innerHTML = '<div class="empty-state"><i class="fas fa-inbox"></i><p data-i18n="logs.empty_title">' +
                i18n.t('logs.empty_title') + '</p><p data-i18n="logs.empty_desc">' +
                i18n.t('logs.empty_desc') + '</p></div>';
            return;
        }

        const visibleLines = this.filterLogLinesBySearch(displayedLines);
        this.displayedLogLines = visibleLines.slice();

        if (visibleLines.length === 0) {
            logsContent.innerHTML = '<div class="empty-state"><i class="fas fa-search"></i><p data-i18n="logs.search_empty_title">' +
                i18n.t('logs.search_empty_title') + '</p><p data-i18n="logs.search_empty_desc">' +
                i18n.t('logs.search_empty_desc') + '</p></div>';
            return;
        }

        const displayedLineCount = this.displayedLogLines.length;
        logsContent.innerHTML = `
            <div class="logs-info">
                <span><i class="fas fa-list-ol"></i> ${displayedLineCount} ${i18n.t('logs.lines')}</span>
            </div>
            <pre class="logs-text">${this.buildLogsHtml(this.displayedLogLines)}</pre>
        `;

        if (scrollToBottom && !this.logSearchQuery) {
            const logsTextElement = logsContent.querySelector('.logs-text');
            if (logsTextElement) {
                logsTextElement.scrollTop = logsTextElement.scrollHeight;
            }
        }
    },

    appendLogs(newLines, totalLineCount) {
        const logsContent = document.getElementById('logs-content');
        if (!logsContent) return;

        if (!newLines || newLines.length === 0) {
            return;
        }

        const logsTextElement = logsContent.querySelector('.logs-text');
        const logsInfoElement = logsContent.querySelector('.logs-info');

        const filteredNewLines = newLines.filter(line => !line.includes('/v0/management/'));
        if (filteredNewLines.length === 0) {
            return;
        }

        if (!logsTextElement) {
            this.renderLogs(filteredNewLines, totalLineCount || filteredNewLines.length, true);
            return;
        }

        const isAtBottom = logsTextElement.scrollHeight - logsTextElement.scrollTop - logsTextElement.clientHeight < 50;

        const baseLines = Array.isArray(this.allLogLines) && this.allLogLines.length > 0
            ? this.allLogLines
            : (Array.isArray(this.displayedLogLines) ? this.displayedLogLines : []);

        this.allLogLines = baseLines.concat(filteredNewLines);
        if (this.allLogLines.length > this.maxDisplayLogLines) {
            this.allLogLines = this.allLogLines.slice(this.allLogLines.length - this.maxDisplayLogLines);
        }

        const visibleLines = this.filterLogLinesBySearch(this.allLogLines);
        this.displayedLogLines = visibleLines.slice();

        if (visibleLines.length === 0) {
            this.renderLogs(this.allLogLines, this.allLogLines.length, false);
            return;
        }

        logsTextElement.innerHTML = this.buildLogsHtml(this.displayedLogLines);

        if (logsInfoElement) {
            const displayedLines = this.displayedLogLines.length;
            logsInfoElement.innerHTML = `<span><i class="fas fa-list-ol"></i> ${displayedLines} ${i18n.t('logs.lines')}</span>`;
        }

        if (isAtBottom && !this.logSearchQuery) {
            logsTextElement.scrollTop = logsTextElement.scrollHeight;
        }
    },

    filterLogLinesBySearch(lines) {
        const keyword = (this.logSearchQuery || '').toLowerCase();
        if (!keyword) {
            return Array.isArray(lines) ? lines.slice() : [];
        }
        if (!Array.isArray(lines) || lines.length === 0) {
            return [];
        }
        return lines.filter(line => (line || '').toLowerCase().includes(keyword));
    },

    updateLogSearchQuery(value = '') {
        const normalized = (value || '').trim();
        if (this.logSearchQuery === normalized) {
            return;
        }
        this.logSearchQuery = normalized;
        this.applyLogSearchFilter();
    },

    applyLogSearchFilter() {
        const logsContent = document.getElementById('logs-content');
        if (!logsContent) return;
        if (logsContent.querySelector('.upgrade-notice') || logsContent.querySelector('.error-state')) {
            return;
        }
        const baseLines = Array.isArray(this.allLogLines) ? this.allLogLines : [];
        if (baseLines.length === 0 && logsContent.querySelector('.loading-placeholder')) {
            return;
        }
        this.renderLogs(baseLines, baseLines.length, false);
    },

    buildLogsHtml(lines) {
        if (!lines || lines.length === 0) {
            return '';
        }

        return lines.map(line => {
            let processedLine = line.replace(/\[GIN\]\s+\d{4}\/\d{2}\/\d{2}\s+-\s+\d{2}:\d{2}:\d{2}\s+/g, '');
            const highlights = [];

            const statusInfo = this.detectHttpStatus(line);
            if (statusInfo) {
                const statusPattern = new RegExp(`\\b${statusInfo.code}\\b`);
                const match = statusPattern.exec(processedLine);
                if (match) {
                    highlights.push({
                        start: match.index,
                        end: match.index + match[0].length,
                        className: `log-status-tag log-status-${statusInfo.bucket}`,
                        priority: 10
                    });
                }
            }

            const timestampPattern = /\d{4}[-/]\d{2}[-/]\d{2}[T]\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|[+-]\d{2}:\d{2})?|\[\d{2}:\d{2}:\d{2}\]/g;
            let match;
            while ((match = timestampPattern.exec(processedLine)) !== null) {
                highlights.push({
                    start: match.index,
                    end: match.index + match[0].length,
                    className: 'log-timestamp',
                    priority: 5
                });
            }

            const bracketTimestampPattern = /\[\d{4}[-/]\d{2}[-/]\d{2}\s+\d{2}:\d{2}:\d{2}(?:\.\d+)?\]/g;
            while ((match = bracketTimestampPattern.exec(processedLine)) !== null) {
                highlights.push({
                    start: match.index,
                    end: match.index + match[0].length,
                    className: 'log-timestamp',
                    priority: 5
                });
            }

            const levelPattern = /\[(ERROR|ERRO|ERR|FATAL|CRITICAL|CRIT|WARN|WARNING|INFO|DEBUG|TRACE|PANIC)\]/gi;
            while ((match = levelPattern.exec(processedLine)) !== null) {
                const level = match[1].toUpperCase();
                let className = 'log-level';
                if (['ERROR', 'ERRO', 'ERR', 'FATAL', 'CRITICAL', 'CRIT', 'PANIC'].includes(level)) {
                    className += ' log-level-error';
                } else if (['WARN', 'WARNING'].includes(level)) {
                    className += ' log-level-warn';
                } else if (level === 'INFO') {
                    className += ' log-level-info';
                } else if (['DEBUG', 'TRACE'].includes(level)) {
                    className += ' log-level-debug';
                }
                highlights.push({
                    start: match.index,
                    end: match.index + match[0].length,
                    className,
                    priority: 8
                });
            }

            const methodPattern = /\b(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS|CONNECT|TRACE)\b/g;
            while ((match = methodPattern.exec(processedLine)) !== null) {
                highlights.push({
                    start: match.index,
                    end: match.index + match[0].length,
                    className: 'log-http-method',
                    priority: 6
                });
            }

            const urlPattern = /(https?:\/\/[^\s<>"']+)/g;
            while ((match = urlPattern.exec(processedLine)) !== null) {
                highlights.push({
                    start: match.index,
                    end: match.index + match[0].length,
                    className: 'log-path',
                    priority: 4
                });
            }

            const ipPattern = /\b(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})\b/g;
            while ((match = ipPattern.exec(processedLine)) !== null) {
                highlights.push({
                    start: match.index,
                    end: match.index + match[0].length,
                    className: 'log-ip',
                    priority: 7
                });
            }

            const successPattern = /\b(success|successful|succeeded|completed|ok|done|passed)\b/gi;
            while ((match = successPattern.exec(processedLine)) !== null) {
                highlights.push({
                    start: match.index,
                    end: match.index + match[0].length,
                    className: 'log-keyword-success',
                    priority: 3
                });
            }

            const errorPattern = /\b(failed|failure|error|exception|panic|fatal|critical|aborted|denied|refused|timeout|invalid)\b/gi;
            while ((match = errorPattern.exec(processedLine)) !== null) {
                highlights.push({
                    start: match.index,
                    end: match.index + match[0].length,
                    className: 'log-keyword-error',
                    priority: 3
                });
            }

            const headersPattern = /\b(x-[a-z0-9-]+|authorization|content-type|user-agent)\b/gi;
            while ((match = headersPattern.exec(processedLine)) !== null) {
                highlights.push({
                    start: match.index,
                    end: match.index + match[0].length,
                    className: 'log-header-key',
                    priority: 2
                });
            }

            highlights.sort((a, b) => {
                if (a.start === b.start) {
                    return b.priority - a.priority;
                }
                return a.start - b.start;
            });

            let cursor = 0;
            let result = '';

            highlights.forEach((highlight) => {
                if (highlight.start < cursor) {
                    return;
                }

                result += this.escapeHtml(processedLine.slice(cursor, highlight.start));
                result += `<span class="${highlight.className}">${this.escapeHtml(processedLine.slice(highlight.start, highlight.end))}</span>`;
                cursor = highlight.end;
            });

            result += this.escapeHtml(processedLine.slice(cursor));

            return `<span class="log-line">${result}</span>`;
        }).join('');
    },

    detectHttpStatus(line) {
        if (!line) return null;

        const patterns = [
            /\|\s*([1-5]\d{2})\s*\|/,
            /\b([1-5]\d{2})\s*-/,
            /\b(?:GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS|CONNECT|TRACE)\s+\S+\s+([1-5]\d{2})\b/,
            /\b(?:status|code|http)[:\s]+([1-5]\d{2})\b/i,
            /\b([1-5]\d{2})\s+(?:OK|Created|Accepted|No Content|Moved|Found|Bad Request|Unauthorized|Forbidden|Not Found|Method Not Allowed|Internal Server Error|Bad Gateway|Service Unavailable|Gateway Timeout)\b/i
        ];

        for (const pattern of patterns) {
            const match = line.match(pattern);
            if (match) {
                const code = parseInt(match[1], 10);
                if (Number.isNaN(code)) {
                    continue;
                }

                if (code >= 500) {
                    return { code, bucket: '5xx', match: match[1] };
                }
                if (code >= 400) {
                    return { code, bucket: '4xx', match: match[1] };
                }
                if (code >= 300) {
                    return { code, bucket: '3xx', match: match[1] };
                }
                if (code >= 200) {
                    return { code, bucket: '2xx', match: match[1] };
                }
                if (code >= 100) {
                    return { code, bucket: '1xx', match: match[1] };
                }
            }
        }

        return null;
    },

    async openErrorLogsModal() {
        const modalBody = document.getElementById('modal-body');
        if (!modalBody) return;

        modalBody.innerHTML = `
            <h3>${i18n.t('logs.error_logs_modal_title')}</h3>
            <div class="provider-item">
                <div class="item-content">
                    <p class="form-hint">${i18n.t('logs.error_logs_description')}</p>
                    <div class="loading-placeholder">${i18n.t('common.loading')}</div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="manager.closeModal()">${i18n.t('common.close')}</button>
            </div>
        `;
        this.showModal();

        try {
            const response = await this.makeRequest('/request-error-logs', {
                method: 'GET'
            });
            const files = Array.isArray(response?.files) ? response.files.slice() : [];
            if (files.length > 1) {
                files.sort((a, b) => (b.modified || 0) - (a.modified || 0));
            }
            modalBody.innerHTML = this.buildErrorLogsModal(files);
            this.showModal();
            this.bindErrorLogDownloadButtons();
        } catch (error) {
            console.error('加载错误日志列表失败:', error);
            modalBody.innerHTML = `
                <h3>${i18n.t('logs.error_logs_modal_title')}</h3>
                <div class="provider-item">
                    <div class="item-content">
                        <div class="error-state">
                            <i class="fas fa-exclamation-triangle"></i>
                            <p>${i18n.t('logs.error_logs_load_error')}</p>
                            <p>${this.escapeHtml(error.message || '')}</p>
                        </div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="manager.closeModal()">${i18n.t('common.close')}</button>
                </div>
            `;
            this.showNotification(`${i18n.t('logs.error_logs_load_error')}: ${error.message}`, 'error');
        }
    },

    buildErrorLogsModal(files) {
        const listHtml = Array.isArray(files) && files.length > 0
            ? files.map(file => this.buildErrorLogCard(file)).join('')
            : `
                <div class="empty-state">
                    <i class="fas fa-inbox"></i>
                    <h3>${i18n.t('logs.error_logs_empty')}</h3>
                    <p>${i18n.t('logs.error_logs_description')}</p>
                </div>
            `;

        return `
            <h3>${i18n.t('logs.error_logs_modal_title')}</h3>
            <p class="form-hint">${i18n.t('logs.error_logs_description')}</p>
            <div class="provider-list">
                ${listHtml}
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="manager.closeModal()">${i18n.t('common.close')}</button>
            </div>
        `;
    },

    buildErrorLogCard(file) {
        const name = file?.name || '';
        const size = typeof file?.size === 'number' ? this.formatFileSize(file.size) : '-';
        const modified = file?.modified ? this.formatErrorLogTime(file.modified) : '-';
        return `
            <div class="provider-item">
                <div class="item-content">
                    <div class="item-title">${this.escapeHtml(name)}</div>
                    <div class="item-subtitle">${i18n.t('logs.error_logs_size')}: ${this.escapeHtml(size)}</div>
                    <div class="item-subtitle">${i18n.t('logs.error_logs_modified')}: ${this.escapeHtml(modified)}</div>
                </div>
                <div class="item-actions">
                    <button class="btn btn-secondary error-log-download-btn" data-log-name="${this.escapeHtml(name)}">
                        <i class="fas fa-download"></i> ${i18n.t('logs.error_logs_download')}
                    </button>
                </div>
            </div>
        `;
    },

    bindErrorLogDownloadButtons() {
        const modalBody = document.getElementById('modal-body');
        if (!modalBody) return;
        const buttons = modalBody.querySelectorAll('.error-log-download-btn');
        buttons.forEach(button => {
            button.onclick = () => {
                const filename = button.getAttribute('data-log-name');
                if (filename) {
                    this.downloadErrorLog(filename);
                }
            };
        });
    },

    formatErrorLogTime(timestamp) {
        const numeric = Number(timestamp);
        if (!Number.isFinite(numeric) || numeric <= 0) {
            return '-';
        }
        const date = new Date(numeric * 1000);
        if (Number.isNaN(date.getTime())) {
            return '-';
        }
        const locale = i18n?.currentLanguage || undefined;
        return date.toLocaleString(locale);
    },

    async downloadErrorLog(filename) {
        if (!filename) return;
        try {
            const response = await this.apiClient.requestRaw(`/request-error-logs/${encodeURIComponent(filename)}`, {
                method: 'GET'
            });

            if (!response.ok) {
                let errorMessage = `HTTP ${response.status}`;
                try {
                    const errorData = await response.json();
                    if (errorData && errorData.error) {
                        errorMessage = errorData.error;
                    }
                } catch (parseError) {
                    // ignore JSON parse error and use default message
                }
                throw new Error(errorMessage);
            }

            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            this.showNotification(i18n.t('logs.error_log_download_success'), 'success');
        } catch (error) {
            console.error('下载错误日志失败:', error);
            this.showNotification(`${i18n.t('notification.download_failed')}: ${error.message}`, 'error');
        }
    },

    async downloadLogs() {
        try {
            const response = await this.makeRequest('/logs', {
                method: 'GET'
            });

            if (response && response.lines && response.lines.length > 0) {
                const logsText = response.lines.join('\n');
                const blob = new Blob([logsText], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `cli-proxy-api-logs-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.log`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                this.showNotification(i18n.t('logs.download_success'), 'success');
            } else {
                this.showNotification(i18n.t('logs.empty_title'), 'info');
            }
        } catch (error) {
            console.error('下载日志失败:', error);
            this.showNotification(`${i18n.t('notification.download_failed')}: ${error.message}`, 'error');
        }
    },

    async clearLogs() {
        if (!confirm(i18n.t('logs.clear_confirm'))) {
            return;
        }

        try {
            const response = await this.makeRequest('/logs', {
                method: 'DELETE'
            });

            if (response && response.status === 'ok') {
                const removedCount = response.removed || 0;
                const message = `${i18n.t('logs.clear_success')} (${i18n.t('logs.removed')}: ${removedCount} ${i18n.t('logs.lines')})`;
                this.showNotification(message, 'success');
            } else {
                this.showNotification(i18n.t('logs.clear_success'), 'success');
            }

            this.latestLogTimestamp = null;
            await this.refreshLogs(false);
        } catch (error) {
            console.error('清空日志失败:', error);
            this.showNotification(`${i18n.t('notification.delete_failed')}: ${error.message}`, 'error');
        }
    },

    toggleLogsAutoRefresh(enabled) {
        if (enabled) {
            if (this.logsRefreshTimer) {
                clearInterval(this.logsRefreshTimer);
            }
            this.logsRefreshTimer = setInterval(() => {
                const logsSection = document.getElementById('logs');
                if (logsSection && logsSection.classList.contains('active')) {
                    this.refreshLogs(true);
                }
            }, 5000);
            this.showNotification(i18n.t('logs.auto_refresh_enabled'), 'success');
        } else {
            if (this.logsRefreshTimer) {
                clearInterval(this.logsRefreshTimer);
                this.logsRefreshTimer = null;
            }
            this.showNotification(i18n.t('logs.auto_refresh_disabled'), 'info');
        }
    },

    registerLogsListeners() {
        if (!this.events || typeof this.events.on !== 'function') {
            return;
        }
        this.events.on('connection:status-changed', (event) => {
            const detail = event?.detail || {};
            if (detail.isConnected) {
                // 仅在日志页激活时刷新，避免非日志页面触发请求
                const logsSection = document.getElementById('logs');
                if (logsSection && logsSection.classList.contains('active')) {
                    this.refreshLogs(false);
                }
            } else {
                this.latestLogTimestamp = null;
            }
        });
        this.events.on('navigation:section-activated', (event) => {
            const detail = event?.detail || {};
            if (detail.sectionId === 'logs' && this.isConnected) {
                this.refreshLogs(false);
            }
        });
    }
};



// ============ src/modules/api-keys.js ============
const apiKeysModule = {
    // 加载API密钥
    async loadApiKeys() {
        try {
            const data = await this.makeRequest('/api-keys');
            const apiKeysValue = data?.['api-keys'] || [];
            const keys = Array.isArray(apiKeysValue) ? apiKeysValue : [];
            this.renderApiKeys(keys);
        } catch (error) {
            console.error('加载API密钥失败:', error);
        }
    },

    // 渲染API密钥列表
    renderApiKeys(keys) {
        const container = document.getElementById('api-keys-list');

        if (keys.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-key"></i>
                    <h3>${i18n.t('api_keys.empty_title')}</h3>
                    <p>${i18n.t('api_keys.empty_desc')}</p>
                </div>
            `;
            return;
        }

        const rows = keys.map((key, index) => {
            const normalizedKey = typeof key === 'string' ? key : String(key ?? '');
            const maskedDisplay = this.escapeHtml(this.maskApiKey(normalizedKey));
            const keyArgument = encodeURIComponent(normalizedKey);
            return `
                <div class="key-table-row">
                    <div class="key-badge">#${index + 1}</div>
                    <div class="key-table-value">
                        <div class="item-title">${i18n.t('api_keys.item_title')}</div>
                        <div class="key-value">${maskedDisplay}</div>
                    </div>
                    <div class="item-actions compact">
                        <button class="btn btn-secondary" data-action="edit-api-key" data-index="${index}" data-key="${keyArgument}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger" data-action="delete-api-key" data-index="${index}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
        }).join('');

        container.innerHTML = `
            <div class="key-table">
                ${rows}
            </div>
        `;

        this.bindApiKeyListEvents(container);
    },

    // 注意: escapeHtml, maskApiKey, normalizeArrayResponse
    // 现在由 app.js 通过工具模块提供，通过 this 访问

    // 添加一行自定义请求头输入
    addHeaderField(wrapperId, header = {}) {
        const wrapper = document.getElementById(wrapperId);
        if (!wrapper) return;

        const row = document.createElement('div');
        row.className = 'header-input-row';
        const keyValue = typeof header.key === 'string' ? header.key : '';
        const valueValue = typeof header.value === 'string' ? header.value : '';
        row.innerHTML = `
            <div class="input-group header-input-group">
                <input type="text" class="header-key-input" placeholder="${i18n.t('common.custom_headers_key_placeholder')}" value="${this.escapeHtml(keyValue)}">
                <span class="header-separator">:</span>
                <input type="text" class="header-value-input" placeholder="${i18n.t('common.custom_headers_value_placeholder')}" value="${this.escapeHtml(valueValue)}">
                <button type="button" class="btn btn-small btn-danger header-remove-btn"><i class="fas fa-trash"></i></button>
            </div>
        `;

        const removeBtn = row.querySelector('.header-remove-btn');
        if (removeBtn) {
            removeBtn.addEventListener('click', () => {
                wrapper.removeChild(row);
                if (wrapper.childElementCount === 0) {
                    this.addHeaderField(wrapperId);
                }
            });
        }

        wrapper.appendChild(row);
    },

    // 填充自定义请求头输入
    populateHeaderFields(wrapperId, headers = null) {
        const wrapper = document.getElementById(wrapperId);
        if (!wrapper) return;
        wrapper.innerHTML = '';

        const entries = (headers && typeof headers === 'object')
            ? Object.entries(headers).filter(([key, value]) => key && value !== undefined && value !== null)
            : [];

        if (!entries.length) {
            this.addHeaderField(wrapperId);
            return;
        }

        entries.forEach(([key, value]) => this.addHeaderField(wrapperId, { key, value: String(value ?? '') }));
    },

    // 收集自定义请求头输入
    collectHeaderInputs(wrapperId) {
        const wrapper = document.getElementById(wrapperId);
        if (!wrapper) return null;

        const rows = Array.from(wrapper.querySelectorAll('.header-input-row'));
        const headers = {};

        rows.forEach(row => {
            const keyInput = row.querySelector('.header-key-input');
            const valueInput = row.querySelector('.header-value-input');
            const key = keyInput ? keyInput.value.trim() : '';
            const value = valueInput ? valueInput.value.trim() : '';
            if (key && value) {
                headers[key] = value;
            }
        });

        return Object.keys(headers).length ? headers : null;
    },

    addApiKeyEntryField(wrapperId, entry = {}) {
        const wrapper = document.getElementById(wrapperId);
        if (!wrapper) return;

        const row = document.createElement('div');
        row.className = 'api-key-input-row';
        const keyValue = typeof entry?.['api-key'] === 'string' ? entry['api-key'] : '';
        const proxyValue = typeof entry?.['proxy-url'] === 'string' ? entry['proxy-url'] : '';
        row.innerHTML = `
            <div class="input-group api-key-input-group">
                <input type="text" class="api-key-value-input" placeholder="${i18n.t('ai_providers.openai_key_placeholder')}" value="${this.escapeHtml(keyValue)}">
                <input type="text" class="api-key-proxy-input" placeholder="${i18n.t('ai_providers.openai_proxy_placeholder')}" value="${this.escapeHtml(proxyValue)}">
                <button type="button" class="btn btn-small btn-danger api-key-remove-btn"><i class="fas fa-trash"></i></button>
            </div>
        `;

        const removeBtn = row.querySelector('.api-key-remove-btn');
        if (removeBtn) {
            removeBtn.addEventListener('click', () => {
                wrapper.removeChild(row);
                if (wrapper.childElementCount === 0) {
                    this.addApiKeyEntryField(wrapperId);
                }
            });
        }

        wrapper.appendChild(row);
    },

    populateApiKeyEntryFields(wrapperId, entries = []) {
        const wrapper = document.getElementById(wrapperId);
        if (!wrapper) return;
        wrapper.innerHTML = '';

        if (!Array.isArray(entries) || entries.length === 0) {
            this.addApiKeyEntryField(wrapperId);
            return;
        }

        entries.forEach(entry => this.addApiKeyEntryField(wrapperId, entry));
    },

    collectApiKeyEntryInputs(wrapperId) {
        const wrapper = document.getElementById(wrapperId);
        if (!wrapper) return [];

        const rows = Array.from(wrapper.querySelectorAll('.api-key-input-row'));
        const entries = [];

        rows.forEach(row => {
            const keyInput = row.querySelector('.api-key-value-input');
            const proxyInput = row.querySelector('.api-key-proxy-input');
            const key = keyInput ? keyInput.value.trim() : '';
            const proxy = proxyInput ? proxyInput.value.trim() : '';
            if (key) {
                entries.push({ 'api-key': key, 'proxy-url': proxy });
            }
        });

        return entries;
    },

    // 规范化并写入请求头
    applyHeadersToConfig(target, headers) {
        if (!target) {
            return;
        }
        if (headers && typeof headers === 'object' && Object.keys(headers).length) {
            target.headers = { ...headers };
        } else {
            delete target.headers;
        }
    },

    // 渲染请求头徽章
    renderHeaderBadges(headers) {
        if (!headers || typeof headers !== 'object') {
            return '';
        }
        const entries = Object.entries(headers).filter(([key, value]) => key && value !== undefined && value !== null && value !== '');
        if (!entries.length) {
            return '';
        }

        const badges = entries.map(([key, value]) => `
            <span class="header-badge"><strong>${this.escapeHtml(key)}:</strong> ${this.escapeHtml(String(value))}</span>
        `).join('');

        return `
            <div class="item-subtitle header-badges-wrapper">
                <span class="header-badges-label">${i18n.t('common.custom_headers_label')}:</span>
                <div class="header-badge-list">
                    ${badges}
                </div>
            </div>
        `;
    },

    // 构造Codex配置，保持未展示的字段
    buildCodexConfig(apiKey, baseUrl, proxyUrl, original = {}, headers = null, excludedModels = null) {
        const result = {
            ...original,
            'api-key': apiKey,
            'base-url': baseUrl || '',
            'proxy-url': proxyUrl || ''
        };
        this.applyHeadersToConfig(result, headers);
        if (Array.isArray(excludedModels)) {
            result['excluded-models'] = excludedModels;
        }
        return result;
    },

    // 显示添加API密钥模态框
    showAddApiKeyModal() {
        const modal = document.getElementById('modal');
        const modalBody = document.getElementById('modal-body');

        modalBody.innerHTML = `
            <h3>${i18n.t('api_keys.add_modal_title')}</h3>
            <div class="form-group">
                <label for="new-api-key">${i18n.t('api_keys.add_modal_key_label')}</label>
                <input type="text" id="new-api-key" placeholder="${i18n.t('api_keys.add_modal_key_placeholder')}">
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="manager.closeModal()">${i18n.t('common.cancel')}</button>
                <button class="btn btn-primary" onclick="manager.addApiKey()">${i18n.t('common.add')}</button>
            </div>
        `;

        modal.style.display = 'block';
    },

    // 添加API密钥
    async addApiKey() {
        const newKey = document.getElementById('new-api-key').value.trim();

        if (!newKey) {
            this.showNotification(`${i18n.t('notification.please_enter')} ${i18n.t('notification.api_key')}`, 'error');
            return;
        }

        try {
            const data = await this.makeRequest('/api-keys');
            const currentKeys = data['api-keys'] || [];
            currentKeys.push(newKey);

            await this.makeRequest('/api-keys', {
                method: 'PUT',
                body: JSON.stringify(currentKeys)
            });

            this.clearCache('api-keys'); // 仅清除 api-keys 段缓存
            this.closeModal();
            this.loadApiKeys();
            this.showNotification(i18n.t('notification.api_key_added'), 'success');
        } catch (error) {
            this.showNotification(`${i18n.t('notification.add_failed')}: ${error.message}`, 'error');
        }
    },

    // 编辑API密钥
    editApiKey(index, currentKey) {
        const modal = document.getElementById('modal');
        const modalBody = document.getElementById('modal-body');

        modalBody.innerHTML = `
            <h3>${i18n.t('api_keys.edit_modal_title')}</h3>
            <div class="form-group">
                <label for="edit-api-key">${i18n.t('api_keys.edit_modal_key_label')}</label>
                <input type="text" id="edit-api-key" value="${currentKey}">
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="manager.closeModal()">${i18n.t('common.cancel')}</button>
                <button class="btn btn-primary" onclick="manager.updateApiKey(${index})">${i18n.t('common.update')}</button>
            </div>
        `;

        modal.style.display = 'block';
    },

    // 更新API密钥
    async updateApiKey(index) {
        const newKey = document.getElementById('edit-api-key').value.trim();

        if (!newKey) {
            this.showNotification(`${i18n.t('notification.please_enter')} ${i18n.t('notification.api_key')}`, 'error');
            return;
        }

        try {
            await this.makeRequest('/api-keys', {
                method: 'PATCH',
                body: JSON.stringify({ index, value: newKey })
            });

            this.clearCache('api-keys'); // 仅清除 api-keys 段缓存
            this.closeModal();
            this.loadApiKeys();
            this.showNotification(i18n.t('notification.api_key_updated'), 'success');
        } catch (error) {
            this.showNotification(`${i18n.t('notification.update_failed')}: ${error.message}`, 'error');
        }
    },

    // 删除API密钥
    async deleteApiKey(index) {
        if (!confirm(i18n.t('api_keys.delete_confirm'))) return;

        try {
            await this.makeRequest(`/api-keys?index=${index}`, { method: 'DELETE' });
            this.clearCache('api-keys'); // 仅清除 api-keys 段缓存
            this.loadApiKeys();
            this.showNotification(i18n.t('notification.api_key_deleted'), 'success');
        } catch (error) {
            this.showNotification(`${i18n.t('notification.delete_failed')}: ${error.message}`, 'error');
        }
    },

    bindApiKeyListEvents(container = null) {
        if (this.apiKeyListEventsBound) {
            return;
        }
        const listContainer = container || document.getElementById('api-keys-list');
        if (!listContainer) return;

        listContainer.addEventListener('click', (event) => {
            const button = event.target.closest('[data-action][data-index]');
            if (!button || !listContainer.contains(button)) return;

            const action = button.dataset.action;
            const index = Number(button.dataset.index);
            if (!Number.isFinite(index)) return;

            switch (action) {
                case 'edit-api-key': {
                    const rawKey = button.dataset.key || '';
                    let decodedKey = '';
                    try {
                        decodedKey = decodeURIComponent(rawKey);
                    } catch (e) {
                        decodedKey = rawKey;
                    }
                    this.editApiKey(index, decodedKey);
                    break;
                }
                case 'delete-api-key':
                    this.deleteApiKey(index);
                    break;
                default:
                    break;
            }
        });

        this.apiKeyListEventsBound = true;
    }
};



// ============ src/modules/auth-files.js ============
const authFilesModule = {
    // 加载认证文件
    async loadAuthFiles(keyStats = null) {
        try {
            const data = await this.makeRequest('/auth-files');
            if (!keyStats) {
                keyStats = await this.getKeyStats();
            }
            await this.renderAuthFiles(data.files || [], keyStats);
        } catch (error) {
            console.error('加载认证文件失败:', error);
        }
    },

    // 渲染认证文件列表
    async renderAuthFiles(files, keyStats = null) {
        const container = document.getElementById('auth-files-list');
        if (!container) {
            return;
        }

        const allFiles = Array.isArray(files) ? files : [];
        const visibleFiles = allFiles.filter(file => {
            if (!file) return false;
            return this.shouldDisplayDisabledGeminiCli(file) || file.disabled !== true;
        });
        const stats = keyStats || await this.getKeyStats();

        this.cachedAuthFiles = visibleFiles.map(file => ({ ...file }));
        this.authFileStatsCache = stats || { bySource: {}, byAuthIndex: {} };
        this.syncAuthFileControls();

        if (this.cachedAuthFiles.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-file-alt"></i>
                    <h3>${i18n.t('auth_files.empty_title')}</h3>
                    <p>${i18n.t('auth_files.empty_desc')}</p>
                </div>
            `;
            this.updateFilterButtons(new Set(['all']));
            this.bindAuthFileFilterEvents();
            this.applyAuthFileFilterState(false);
            this.authFilesPagination.currentPage = 1;
            this.authFilesPagination.totalPages = 1;
            this.updatePaginationControls(0);
            return;
        }

        const existingTypes = new Set(['all']);
        this.cachedAuthFiles.forEach(file => {
            if (file.type) {
                existingTypes.add(file.type);
            }
        });

        this.updateFilterButtons(existingTypes);
        this.bindAuthFileFilterEvents();
        this.applyAuthFileFilterState(false);
        this.renderAuthFilesPage(this.authFilesPagination.currentPage);
        this.bindAuthFileActionEvents();
    },

    isRuntimeOnlyAuthFile(file) {
        if (!file) return false;
        const runtimeValue = file.runtime_only;
        return runtimeValue === true || runtimeValue === 'true';
    },

    shouldDisplayDisabledGeminiCli(file) {
        if (!file) return false;
        const provider = typeof file.provider === 'string' ? file.provider.toLowerCase() : '';
        const type = typeof file.type === 'string' ? file.type.toLowerCase() : '';
        const isGeminiCli = provider === 'gemini-cli' || type === 'gemini-cli';
        return isGeminiCli && !this.isRuntimeOnlyAuthFile(file);
    },

    resolveAuthFileStats(file, stats = {}) {
        const statsBySource = (stats && stats.bySource) || stats || {};
        const statsByAuthIndex = (stats && stats.byAuthIndex) || {};
        const rawFileName = typeof file?.name === 'string' ? file.name : '';
        const defaultStats = { success: 0, failure: 0 };
        const authIndexKey = this.normalizeAuthIndexValue(file?.auth_index);

        if (authIndexKey && statsByAuthIndex[authIndexKey]) {
            return statsByAuthIndex[authIndexKey];
        }

        if (!rawFileName) {
            return defaultStats;
        }

        const fromName = statsBySource[rawFileName];
        if (fromName && (fromName.success > 0 || fromName.failure > 0)) {
            return fromName;
        }

        let fileStats = fromName || defaultStats;
        if (fileStats.success === 0 && fileStats.failure === 0) {
            const nameWithoutExt = rawFileName.replace(/\.[^/.]+$/, "");

            if (nameWithoutExt && nameWithoutExt !== rawFileName) {
                const candidateNames = new Set([nameWithoutExt]);
                const normalizedName = nameWithoutExt.toLowerCase();
                const typePrefix = typeof file?.type === 'string' ? file.type.trim().toLowerCase() : '';
                const providerPrefix = typeof file?.provider === 'string' ? file.provider.trim().toLowerCase() : '';
                const prefixList = [];

                if (typePrefix) {
                    prefixList.push(`${typePrefix}-`);
                }
                if (providerPrefix && providerPrefix !== typePrefix) {
                    prefixList.push(`${providerPrefix}-`);
                }

                prefixList.forEach(prefix => {
                    if (prefix && normalizedName.startsWith(prefix)) {
                        const trimmed = nameWithoutExt.substring(prefix.length);
                        if (trimmed) {
                            candidateNames.add(trimmed);
                        }
                    }
                });

                for (const candidate of candidateNames) {
                    const candidateStats = statsBySource[candidate];
                    if (candidateStats && (candidateStats.success > 0 || candidateStats.failure > 0)) {
                        fileStats = candidateStats;
                        break;
                    }
                }
            }
        }

        return fileStats || defaultStats;
    },

    normalizeAuthIndexValue(value) {
        if (typeof value === 'number' && Number.isFinite(value)) {
            return value.toString();
        }
        if (typeof value === 'string') {
            const trimmed = value.trim();
            return trimmed ? trimmed : null;
        }
        return null;
    },

    buildAuthFileItemHtml(file) {
        const rawFileName = typeof file?.name === 'string' ? file.name : '';
        const safeFileName = this.escapeHtml(rawFileName);
        const stats = this.authFileStatsCache || {};
        const fileStats = this.resolveAuthFileStats(file, stats);
        const fileType = file.type || 'unknown';
        let typeDisplayKey;
        switch (fileType) {
            case 'qwen':
                typeDisplayKey = 'auth_files.type_qwen';
                break;
            case 'gemini':
                typeDisplayKey = 'auth_files.type_gemini';
                break;
            case 'gemini-cli':
                typeDisplayKey = 'auth_files.type_gemini-cli';
                break;
            case 'aistudio':
                typeDisplayKey = 'auth_files.type_aistudio';
                break;
            case 'claude':
                typeDisplayKey = 'auth_files.type_claude';
                break;
            case 'codex':
                typeDisplayKey = 'auth_files.type_codex';
                break;
            case 'antigravity':
                typeDisplayKey = 'auth_files.type_antigravity';
                break;
            case 'iflow':
                typeDisplayKey = 'auth_files.type_iflow';
                break;
            case 'vertex':
                typeDisplayKey = 'auth_files.type_vertex';
                break;
            case 'empty':
                typeDisplayKey = 'auth_files.type_empty';
                break;
            default:
                typeDisplayKey = 'auth_files.type_unknown';
                break;
        }
        const typeBadge = `<span class="file-type-badge ${fileType}">${i18n.t(typeDisplayKey)}</span>`;
        const isRuntimeOnly = this.isRuntimeOnlyAuthFile(file);
        const shouldShowMainFlag = this.shouldDisplayDisabledGeminiCli(file);
        const mainFlagButton = shouldShowMainFlag ? `
                            <button class="btn-small btn-warning main-flag-btn" title="主" disabled>主</button>` : '';
        const actionsHtml = isRuntimeOnly ? `
                        <div class="item-actions">
                            <span class="virtual-auth-badge">虚拟认证文件</span>
                        </div>` : `
                        <div class="item-actions" data-filename="${safeFileName}">
                            ${mainFlagButton}
                            <button class="btn-small btn-info" data-action="showDetails" title="详细信息">
                                <i class="fas fa-info-circle"></i>
                            </button>
                            <button class="btn-small btn-primary" data-action="download" title="下载">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="btn-small btn-danger" data-action="delete" title="删除">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>`;

        return `
            <div class="file-item" data-file-type="${fileType}" data-file-name="${safeFileName}" ${isRuntimeOnly ? 'data-runtime-only="true"' : ''}>
                <div class="item-content">
                    <div class="item-title">${typeBadge}${safeFileName}</div>
                    <div class="item-meta">
                        <span class="item-subtitle">${i18n.t('auth_files.file_modified')}: ${new Date(file.modtime).toLocaleString(i18n.currentLanguage === 'zh-CN' ? 'zh-CN' : 'en-US')}</span>
                        <span class="item-subtitle">${i18n.t('auth_files.file_size')}: ${this.formatFileSize(file.size)}</span>
                    </div>
                    <div class="item-footer">
                        <div class="item-stats">
                            <span class="stat-badge stat-success">
                                <i class="fas fa-check-circle"></i> ${i18n.t('stats.success')}: ${fileStats.success}
                            </span>
                            <span class="stat-badge stat-failure">
                                <i class="fas fa-times-circle"></i> ${i18n.t('stats.failure')}: ${fileStats.failure}
                            </span>
                        </div>
                        ${actionsHtml}
                    </div>
                </div>
            </div>
        `;
    },

    getFilteredAuthFiles(filterType = this.currentAuthFileFilter) {
        const files = Array.isArray(this.cachedAuthFiles) ? this.cachedAuthFiles : [];
        if (!files.length) {
            return [];
        }

        const typeFilter = (filterType || 'all').toLowerCase();
        const keyword = (this.authFileSearchQuery || '').trim().toLowerCase();

        return files.filter(file => {
            const name = String(file?.name || '').toLowerCase();
            const type = String(file?.type || '').toLowerCase();
            const provider = String(file?.provider || '').toLowerCase();

            if (typeFilter !== 'all') {
                if (!type) return false;
                if (type !== typeFilter) {
                    if (!provider || provider !== typeFilter) {
                        return false;
                    }
                }
            }

            if (!keyword) return true;
            return name.includes(keyword) || type.includes(keyword) || provider.includes(keyword);
        });
    },

    updateAuthFileSearchQuery(value = '') {
        const normalized = (value || '').trim();
        if (this.authFileSearchQuery === normalized) {
            return;
        }
        this.authFileSearchQuery = normalized;
        this.authFilesPagination.currentPage = 1;
        this.renderAuthFilesPage(1);
    },

    updateAuthFilesPageSize(value) {
        const normalized = this.normalizeAuthFilesPageSize(value);
        if (this.authFilesPagination?.pageSize === normalized) {
            this.syncAuthFileControls();
            return;
        }
        this.authFilesPagination.pageSize = normalized;
        this.authFilesPagination.currentPage = 1;
        try {
            localStorage.setItem(this.authFilesPageSizeKey, `${normalized}`);
        } catch (error) {
            console.warn('Failed to persist auth files page size:', error);
        }
        this.syncAuthFileControls();
        this.renderAuthFilesPage(1);
    },

    syncAuthFileControls() {
        const searchInput = document.getElementById('auth-files-search-input');
        if (searchInput && searchInput.value !== this.authFileSearchQuery) {
            searchInput.value = this.authFileSearchQuery;
        }

        const pageSizeInput = document.getElementById('auth-files-page-size-input');
        const targetSize = this.authFilesPagination?.pageSize || 9;
        if (pageSizeInput && parseInt(pageSizeInput.value, 10) !== targetSize) {
            pageSizeInput.value = targetSize;
        }
    },

    bindAuthFilesSearchControl() {
        const searchInput = document.getElementById('auth-files-search-input');
        if (!searchInput) return;

        if (searchInput._authFileSearchListener) {
            searchInput.removeEventListener('input', searchInput._authFileSearchListener);
        }

        const debounced = this.debounce((value) => {
            this.updateAuthFileSearchQuery(value);
        }, 250);

        const listener = (event) => {
            const value = event?.target?.value ?? '';
            debounced(value);
        };

        searchInput._authFileSearchListener = listener;
        searchInput.addEventListener('input', listener);
    },

    bindAuthFilesPageSizeControl() {
        const pageSizeInput = document.getElementById('auth-files-page-size-input');
        if (!pageSizeInput) return;

        if (pageSizeInput._authFilePageSizeListener) {
            pageSizeInput.removeEventListener('change', pageSizeInput._authFilePageSizeListener);
        }

        const listener = (event) => {
            const value = parseInt(event?.target?.value, 10);
            if (!Number.isFinite(value)) {
                return;
            }
            this.updateAuthFilesPageSize(value);
        };

        pageSizeInput._authFilePageSizeListener = listener;
        pageSizeInput.addEventListener('change', listener);

        if (pageSizeInput._authFilePageSizeBlur) {
            pageSizeInput.removeEventListener('blur', pageSizeInput._authFilePageSizeBlur);
        }

        const blurListener = () => {
            if (!pageSizeInput.value) {
                this.syncAuthFileControls();
            }
        };

        pageSizeInput._authFilePageSizeBlur = blurListener;
        pageSizeInput.addEventListener('blur', blurListener);
    },

    renderAuthFilesPage(page = null) {
        const container = document.getElementById('auth-files-list');
        if (!container) return;

        const pageSize = this.authFilesPagination?.pageSize || 9;
        const filteredFiles = this.getFilteredAuthFiles();
        const totalItems = filteredFiles.length;
        const hasCachedFiles = Array.isArray(this.cachedAuthFiles) && this.cachedAuthFiles.length > 0;
        const filterApplied = (this.currentAuthFileFilter && this.currentAuthFileFilter !== 'all');
        const searchApplied = Boolean((this.authFileSearchQuery || '').trim());

        if (totalItems === 0) {
            const titleKey = hasCachedFiles && (filterApplied || searchApplied)
                ? 'auth_files.search_empty_title'
                : 'auth_files.empty_title';
            const descKey = hasCachedFiles && (filterApplied || searchApplied)
                ? 'auth_files.search_empty_desc'
                : 'auth_files.empty_desc';
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-file-alt"></i>
                    <h3>${i18n.t(titleKey)}</h3>
                    <p>${i18n.t(descKey)}</p>
                </div>
            `;
            this.authFilesPagination.currentPage = 1;
            this.updatePaginationControls(0);
            return;
        }

        const maxPages = Math.max(1, Math.ceil(totalItems / pageSize));
        let currentPage = page == null ? (this.authFilesPagination.currentPage || 1) : page;
        if (currentPage > maxPages) {
            currentPage = maxPages;
        }
        if (currentPage < 1) {
            currentPage = 1;
        }
        this.authFilesPagination.currentPage = currentPage;
        this.authFilesPagination.totalPages = maxPages;

        const startIndex = (currentPage - 1) * pageSize;
        const pageFiles = filteredFiles.slice(startIndex, startIndex + pageSize);

        container.innerHTML = pageFiles.map(file => this.buildAuthFileItemHtml(file)).join('');
        this.updatePaginationControls(totalItems);
        this.bindAuthFileActionEvents();
    },

    bindAuthFilesPaginationEvents() {
        const container = document.getElementById('auth-files-pagination');
        if (!container) return;

        const oldListener = container._paginationListener;
        if (oldListener) {
            container.removeEventListener('click', oldListener);
        }

        const listener = (event) => {
            const button = event.target.closest('button[data-action]');
            if (!button || !container.contains(button)) return;
            event.preventDefault();
            const action = button.dataset.action;
            const currentPage = this.authFilesPagination?.currentPage || 1;
            if (action === 'prev') {
                this.renderAuthFilesPage(currentPage - 1);
            } else if (action === 'next') {
                this.renderAuthFilesPage(currentPage + 1);
            }
        };

        container._paginationListener = listener;
        container.addEventListener('click', listener);
    },

    updatePaginationControls(totalItems = 0) {
        const paginationContainer = document.getElementById('auth-files-pagination');
        const infoEl = document.getElementById('auth-files-pagination-info');
        if (!paginationContainer || !infoEl) return;

        const prevBtn = paginationContainer.querySelector('button[data-action=\"prev\"]');
        const nextBtn = paginationContainer.querySelector('button[data-action=\"next\"]');
        const pageSize = this.authFilesPagination?.pageSize || 9;
        const totalPages = this.authFilesPagination?.totalPages || 1;
        const currentPage = Math.min(this.authFilesPagination?.currentPage || 1, totalPages);
        const shouldShow = totalItems > pageSize;

        paginationContainer.style.display = shouldShow ? 'flex' : 'none';

        const infoParams = totalItems === 0
            ? { current: 0, total: 0, count: 0 }
            : { current: currentPage, total: totalPages, count: totalItems };
        infoEl.textContent = i18n.t('auth_files.pagination_info', infoParams);

        if (prevBtn) {
            prevBtn.disabled = currentPage <= 1;
        }
        if (nextBtn) {
            nextBtn.disabled = currentPage >= totalPages;
        }
    },

    updateFilterButtons(existingTypes) {
        const filterContainer = document.querySelector('.auth-file-filter');
        if (!filterContainer) return;

        const predefinedTypes = [
            { type: 'all', labelKey: 'auth_files.filter_all' },
            { type: 'qwen', labelKey: 'auth_files.filter_qwen' },
            { type: 'gemini', labelKey: 'auth_files.filter_gemini' },
            { type: 'gemini-cli', labelKey: 'auth_files.filter_gemini-cli' },
            { type: 'aistudio', labelKey: 'auth_files.filter_aistudio' },
            { type: 'claude', labelKey: 'auth_files.filter_claude' },
            { type: 'codex', labelKey: 'auth_files.filter_codex' },
            { type: 'antigravity', labelKey: 'auth_files.filter_antigravity' },
            { type: 'iflow', labelKey: 'auth_files.filter_iflow' },
            { type: 'vertex', labelKey: 'auth_files.filter_vertex' },
            { type: 'empty', labelKey: 'auth_files.filter_empty' }
        ];

        const existingButtons = filterContainer.querySelectorAll('.filter-btn');
        const existingButtonTypes = new Set();
        existingButtons.forEach(btn => {
            existingButtonTypes.add(btn.dataset.type);
        });

        existingButtons.forEach(btn => {
            const btnType = btn.dataset.type;
            if (existingTypes.has(btnType)) {
                btn.style.display = 'inline-block';
                const match = predefinedTypes.find(item => item.type === btnType);
                if (match) {
                    btn.textContent = i18n.t(match.labelKey);
                    btn.setAttribute('data-i18n-text', match.labelKey);
                }
            } else {
                btn.style.display = 'none';
            }
        });

        const predefinedTypeSet = new Set(predefinedTypes.map(t => t.type));
        existingTypes.forEach(type => {
            if (type !== 'all' && !predefinedTypeSet.has(type) && !existingButtonTypes.has(type)) {
                const btn = document.createElement('button');
                btn.className = 'filter-btn';
                btn.dataset.type = type;

                const match = predefinedTypes.find(item => item.type === type);
                if (match) {
                    btn.setAttribute('data-i18n-text', match.labelKey);
                    btn.textContent = i18n.t(match.labelKey);
                } else {
                    const dynamicKey = `auth_files.filter_${type}`;
                    btn.setAttribute('data-i18n-text', dynamicKey);
                    btn.textContent = this.generateDynamicTypeLabel(type);
                }

                const emptyBtn = filterContainer.querySelector('[data-type=\"empty\"]');
                if (emptyBtn) {
                    filterContainer.insertBefore(btn, emptyBtn);
                } else {
                    filterContainer.appendChild(btn);
                }
            }
        });
    },

    handleFilterClick(clickedBtn, options = {}) {
        if (!clickedBtn) return;
        const { skipRender = false } = options;
        const filterBtns = document.querySelectorAll('.auth-file-filter .filter-btn');

        filterBtns.forEach(b => b.classList.remove('active'));
        clickedBtn.classList.add('active');

        const filterType = clickedBtn.dataset.type;
        this.currentAuthFileFilter = filterType || 'all';

        if (!skipRender) {
            this.authFilesPagination.currentPage = 1;
            this.renderAuthFilesPage(1);
        }

        this.refreshFilterButtonTexts();
        this.renderOauthExcludedModels();
    },

    generateDynamicTypeLabel(type) {
        if (!type) return '';
        const key = `auth_files.type_${type}`;
        const translated = i18n.t(key);
        if (translated && translated !== key) {
            return translated;
        }
        if (type.toLowerCase() === 'iflow') return 'iFlow';
        return type.charAt(0).toUpperCase() + type.slice(1);
    },

    bindAuthFileFilterEvents() {
        const filterContainer = document.querySelector('.auth-file-filter');
        if (!filterContainer) return;

        if (filterContainer._filterListener) {
            filterContainer.removeEventListener('click', filterContainer._filterListener);
        }

        const listener = (event) => {
            const button = event.target.closest('.filter-btn');
            if (!button || !filterContainer.contains(button)) return;
            event.preventDefault();
            this.handleFilterClick(button);
        };

        filterContainer._filterListener = listener;
        filterContainer.addEventListener('click', listener);

        this.refreshFilterButtonTexts();
    },

    applyAuthFileFilterState(shouldRender = false) {
        const filterContainer = document.querySelector('.auth-file-filter');
        if (!filterContainer) return;

        const currentType = this.currentAuthFileFilter || 'all';
        const buttons = filterContainer.querySelectorAll('.filter-btn');
        if (buttons.length === 0) return;

        let targetButton = null;
        buttons.forEach(btn => {
            if (btn.dataset.type === currentType) {
                targetButton = btn;
            }
        });

        if (!targetButton) {
            targetButton = filterContainer.querySelector('.filter-btn[data-type=\"all\"]') || buttons[0];
            if (targetButton) {
                this.currentAuthFileFilter = targetButton.dataset.type || 'all';
            }
        }

        if (targetButton) {
            this.handleFilterClick(targetButton, { skipRender: !shouldRender });
        }
    },

    removeAuthFileElements(filenames = []) {
        if (!Array.isArray(filenames) || filenames.length === 0) {
            return;
        }

        const removalSet = new Set(filenames);
        this.cachedAuthFiles = (this.cachedAuthFiles || []).filter(file => file && !removalSet.has(file.name));

        if (!this.cachedAuthFiles.length) {
            this.authFilesPagination.currentPage = 1;
        }
        this.renderAuthFilesPage(this.authFilesPagination.currentPage);
    },

    refreshFilterButtonTexts() {
        document.querySelectorAll('.auth-file-filter .filter-btn[data-i18n-text]').forEach(btn => {
            const key = btn.getAttribute('data-i18n-text');
            if (key) {
                btn.textContent = i18n.t(key);
            }
        });
    },

    bindAuthFileActionEvents() {
        const container = document.getElementById('auth-files-list');
        if (!container) return;

        const oldListener = container._authFileActionListener;
        if (oldListener) {
            container.removeEventListener('click', oldListener);
        }

        const listener = (e) => {
            const button = e.target.closest('button[data-action]');
            if (!button) return;

            const action = button.dataset.action;
            const actionsContainer = button.closest('.item-actions');
            if (!actionsContainer) return;

            const filename = actionsContainer.dataset.filename;
            if (!filename) return;

            switch (action) {
                case 'showDetails':
                    this.showAuthFileDetails(filename);
                    break;
                case 'download':
                    this.downloadAuthFile(filename);
                    break;
                case 'delete':
                    this.deleteAuthFile(filename);
                    break;
            }
        };

        container._authFileActionListener = listener;
        container.addEventListener('click', listener);
    },

    formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    },

    openVertexFilePicker() {
        const fileInput = document.getElementById('vertex-file-input');
        if (fileInput) {
            fileInput.click();
        }
    },

    handleVertexFileSelection(event) {
        const fileInput = event?.target;
        const file = fileInput?.files?.[0] || null;

        if (fileInput) {
            fileInput.value = '';
        }

        if (file && !file.name.toLowerCase().endsWith('.json')) {
            this.showNotification(i18n.t('vertex_import.file_required'), 'error');
            this.vertexImportState.file = null;
            this.updateVertexFileDisplay();
            this.updateVertexImportButtonState();
            return;
        }

        this.vertexImportState.file = file;
        this.updateVertexFileDisplay(file ? file.name : '');
        this.updateVertexImportButtonState();
    },

    updateVertexFileDisplay(filename = '') {
        const displayInput = document.getElementById('vertex-file-display');
        if (!displayInput) return;
        displayInput.value = filename || '';
    },

    updateVertexImportButtonState() {
        const importBtn = document.getElementById('vertex-import-btn');
        if (!importBtn) return;
        const disabled = !this.vertexImportState.file || this.vertexImportState.loading;
        importBtn.disabled = disabled;
    },

    async importVertexCredential() {
        if (!this.vertexImportState.file) {
            this.showNotification(i18n.t('vertex_import.file_required'), 'error');
            return;
        }

        const locationInput = document.getElementById('vertex-location');
        const location = locationInput ? locationInput.value.trim() : '';
        const formData = new FormData();
        formData.append('file', this.vertexImportState.file, this.vertexImportState.file.name);
        if (location) {
            formData.append('location', location);
        }

        try {
            this.vertexImportState.loading = true;
            this.updateVertexImportButtonState();

            const response = await this.apiClient.requestRaw('/vertex/import', {
                method: 'POST',
                body: formData
            });

            if (!response.ok) {
                let errorMessage = `HTTP ${response.status}`;
                try {
                    const errorData = await response.json();
                    errorMessage = errorData?.message || errorData?.error || errorMessage;
                } catch (parseError) {
                    const text = await response.text();
                    if (text) {
                        errorMessage = text;
                    }
                }
                throw new Error(errorMessage);
            }

            const result = await response.json();
            this.vertexImportState.result = result;
            this.renderVertexImportResult(result);
            this.showNotification(i18n.t('vertex_import.success'), 'success');
            this.vertexImportState.file = null;
            this.updateVertexFileDisplay('');
        } catch (error) {
            console.error('Vertex credential import failed:', error);
            this.showNotification(`${i18n.t('notification.import_failed')}: ${error.message}`, 'error');
        } finally {
            this.vertexImportState.loading = false;
            this.updateVertexImportButtonState();
            const fileInput = document.getElementById('vertex-file-input');
            if (fileInput) {
                fileInput.value = '';
            }
        }
    },

    renderVertexImportResult(result = null) {
        const container = document.getElementById('vertex-import-result');
        const projectEl = document.getElementById('vertex-result-project');
        const emailEl = document.getElementById('vertex-result-email');
        const locationEl = document.getElementById('vertex-result-location');
        const fileEl = document.getElementById('vertex-result-file');
        if (!container || !projectEl || !emailEl || !locationEl || !fileEl) return;

        if (!result) {
            container.style.display = 'none';
            this.vertexImportState.result = null;
            return;
        }

        this.vertexImportState.result = result;
        projectEl.textContent = result.project || '-';
        emailEl.textContent = result.email || '-';
        locationEl.textContent = result.location || '-';
        fileEl.textContent = result.file || '-';
        container.style.display = 'block';
    },

    showAuthFileDetails(filename, content) {
        const file = (this.cachedAuthFiles || []).find(f => f && f.name === filename);
        if (!file) return;

        const stats = this.resolveAuthFileStats(file, this.authFileStatsCache || {});
        const size = typeof file.size === 'number' ? this.formatFileSize(file.size) : '-';
        const provider = file.provider || '-';
        const type = file.type || '-';
        const createdAt = file.created_at ? new Date(file.created_at).toLocaleString('zh-CN') : '-';

        const jsonContent = content || JSON.stringify(file, null, 2);

        // 使用独立的 JSON 弹窗样式，避免被通用 .modal 的 display:none 覆盖
        const modalHtml = `
            <div class="json-modal" id="json-modal">
                <div class="json-modal-content">
                    <div class="json-modal-header">
                        <h3>${this.escapeHtml(filename)}</h3>
                    </div>
                    <div class="json-modal-body">
                        <pre class="json-content">${this.escapeHtml(jsonContent)}</pre>
                    </div>
                    <div class="json-modal-footer">
                        <button class="btn btn-secondary" data-action="copy">
                            <i class="fas fa-copy"></i>
                            ${i18n.t('common.copy')}
                        </button>
                        <button class="btn btn-secondary" data-action="close">
                            ${i18n.t('common.close')}
                        </button>
                    </div>
                </div>
            </div>
        `;

        const oldModal = document.getElementById('json-modal');
        if (oldModal) {
            oldModal.remove();
        }

        document.body.insertAdjacentHTML('beforeend', modalHtml);
        const modal = document.getElementById('json-modal');

        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                this.closeJsonModal();
            }
        });

        this.bindJsonModalEvents(modal);
    },

    bindJsonModalEvents(modal) {
        modal.addEventListener('click', (e) => {
            const button = e.target.closest('button[data-action]');
            if (!button) return;

            const action = button.dataset.action;
            switch (action) {
                case 'copy':
                    this.copyJsonContent();
                    break;
                case 'close':
                    this.closeJsonModal();
                    break;
            }
        });
    },

    closeJsonModal() {
        const modal = document.getElementById('json-modal');
        if (modal) {
            modal.remove();
        }
    },

    copyJsonContent() {
        const jsonContent = document.querySelector('.json-content');
        if (jsonContent) {
            const text = jsonContent.textContent;
            navigator.clipboard.writeText(text).then(() => {
                this.showNotification('内容已复制到剪贴板', 'success');
            }).catch(() => {
                this.showNotification('复制失败', 'error');
            });
        }
    },

    async downloadAuthFile(filename) {
        try {
            const response = await this.apiClient.requestRaw(`/auth-files/download?name=${encodeURIComponent(filename)}`);

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }

            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);

            this.showNotification(i18n.t('auth_files.download_success'), 'success');
        } catch (error) {
            this.showNotification(`${i18n.t('notification.download_failed')}: ${error.message}`, 'error');
        }
    },

    async deleteAuthFile(filename) {
        if (!confirm(`${i18n.t('auth_files.delete_confirm')} "${filename}" 吗？`)) return;

        try {
            await this.makeRequest(`/auth-files?name=${encodeURIComponent(filename)}`, { method: 'DELETE' });
            this.removeAuthFileElements([filename]);
            this.clearCache();
            await this.loadAuthFiles();
            this.showNotification(i18n.t('auth_files.delete_success'), 'success');
        } catch (error) {
            this.showNotification(`${i18n.t('notification.delete_failed')}: ${error.message}`, 'error');
        }
    },

    async deleteAllAuthFiles() {
        const filterType = (this.currentAuthFileFilter || 'all').toLowerCase();
        const isFiltered = filterType !== 'all';
        const typeLabel = this.generateDynamicTypeLabel(filterType);
        const confirmMessage = isFiltered
            ? i18n.t('auth_files.delete_filtered_confirm').replace('{type}', typeLabel)
            : i18n.t('auth_files.delete_all_confirm');

        if (!confirm(confirmMessage)) return;

        try {
            if (!isFiltered) {
                const response = await this.makeRequest('/auth-files?all=true', { method: 'DELETE' });
                const currentNames = (this.cachedAuthFiles || []).map(file => file.name).filter(Boolean);
                if (currentNames.length > 0) {
                    this.removeAuthFileElements(currentNames);
                }
                this.clearCache();
                this.currentAuthFileFilter = 'all';
                await this.loadAuthFiles();
                this.showNotification(`${i18n.t('auth_files.delete_all_success')} ${response.deleted} ${i18n.t('auth_files.files_count')}`, 'success');
                return;
            }

            const deletableFiles = (this.cachedAuthFiles || []).filter(file => {
                if (!file || file.runtime_only) return false;
                const fileType = (file.type || 'unknown').toLowerCase();
                return fileType === filterType;
            });

            if (deletableFiles.length === 0) {
                this.showNotification(i18n.t('auth_files.delete_filtered_none').replace('{type}', typeLabel), 'info');
                return;
            }

            let success = 0;
            let failed = 0;
            const deletedNames = [];

            for (const file of deletableFiles) {
                try {
                    await this.makeRequest(`/auth-files?name=${encodeURIComponent(file.name)}`, { method: 'DELETE' });
                    success++;
                    deletedNames.push(file.name);
                } catch (error) {
                    console.error('删除认证文件失败:', file?.name, error);
                    failed++;
                }
            }

            if (deletedNames.length > 0) {
                this.removeAuthFileElements(deletedNames);
            }

            this.clearCache();
            this.currentAuthFileFilter = 'all';
            await this.loadAuthFiles();

            if (failed === 0) {
                const successMsg = i18n.t('auth_files.delete_filtered_success')
                    .replace('{count}', success)
                    .replace('{type}', typeLabel);
                this.showNotification(successMsg, 'success');
            } else {
                const warningMsg = i18n.t('auth_files.delete_filtered_partial')
                    .replace('{success}', success)
                    .replace('{failed}', failed)
                    .replace('{type}', typeLabel);
                this.showNotification(warningMsg, 'warning');
            }
        } catch (error) {
            this.showNotification(`${i18n.t('notification.delete_failed')}: ${error.message}`, 'error');
        }
    },

    // 触发文件上传选择器
    uploadAuthFile() {
        const authFileInput = document.getElementById('auth-file-input');
        if (authFileInput) {
            authFileInput.click();
        }
    },

    // 处理文件上传
    async handleFileUpload(event) {
        const input = event?.target;
        const files = Array.from(input?.files || []);
        if (input) {
            input.value = '';
        }
        if (!files.length) return;

        const validFiles = [];
        const invalidFiles = [];
        files.forEach(file => {
            if (file && file.name.endsWith('.json')) {
                validFiles.push(file);
            } else if (file) {
                invalidFiles.push(file.name);
            }
        });

        if (invalidFiles.length) {
            this.showNotification(i18n.t('auth_files.upload_error_json'), 'error');
        }
        if (!validFiles.length) return;

        let successCount = 0;
        const failed = [];

        for (const file of validFiles) {
            try {
                await this.uploadSingleAuthFile(file);
                successCount++;
            } catch (error) {
                failed.push({ name: file.name, message: error.message });
            }
        }

        if (successCount > 0) {
            this.clearCache();
            await this.loadAuthFiles();
            const suffix = validFiles.length > 1 ? ` (${successCount}/${validFiles.length})` : '';
            this.showNotification(`${i18n.t('auth_files.upload_success')}${suffix}`, failed.length ? 'warning' : 'success');
        }

        if (failed.length) {
            const details = failed.map(item => `${item.name}: ${item.message}`).join('; ');
            this.showNotification(`${i18n.t('notification.upload_failed')}: ${details}`, 'error');
        }
    },

    async uploadSingleAuthFile(file) {
        const formData = new FormData();
        formData.append('file', file, file.name);

        const response = await this.apiClient.requestRaw('/auth-files', {
            method: 'POST',
            body: formData
        });

        if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(errorData.error || `HTTP ${response.status}`);
        }
    },

    normalizeOauthExcludedMap(payload = {}) {
        const raw = (payload && (payload['oauth-excluded-models'] || payload.items)) || payload || {};
        if (!raw || typeof raw !== 'object') {
            return {};
        }
        const normalized = {};
        Object.entries(raw).forEach(([provider, models]) => {
            const key = typeof provider === 'string' ? provider.trim() : '';
            if (!key) return;
            const list = Array.isArray(models)
                ? models.map(item => String(item || '').trim()).filter(Boolean)
                : [];
            normalized[key.toLowerCase()] = list;
        });
        return normalized;
    },

    resolveOauthExcludedFromConfig(config = null) {
        const sources = [];
        if (config && typeof config === 'object') {
            sources.push(config);
        }
        if (this.configCache && typeof this.configCache === 'object') {
            if (this.configCache['oauth-excluded-models'] !== undefined) {
                sources.push({ 'oauth-excluded-models': this.configCache['oauth-excluded-models'] });
            }
            if (this.configCache['__full__']) {
                sources.push(this.configCache['__full__']);
            }
        }

        for (const source of sources) {
            if (!source || typeof source !== 'object') continue;
            if (Object.prototype.hasOwnProperty.call(source, 'oauth-excluded-models')) {
                return {
                    map: this.normalizeOauthExcludedMap(source),
                    found: true
                };
            }
        }

        return { map: {}, found: false };
    },

    applyOauthExcludedFromConfig(config = null, options = {}) {
        const { render = true } = options || {};
        const { map, found } = this.resolveOauthExcludedFromConfig(config);
        if (!found) {
            return false;
        }

        this.oauthExcludedModels = map;
        this._oauthExcludedLoading = false;
        this.setOauthExcludedStatus('');
        this.updateOauthExcludedButtonsState(false);
        if (render) {
            this.renderOauthExcludedModels();
        }
        return true;
    },

    getFilteredOauthExcludedMap(filterType = this.currentAuthFileFilter) {
        const map = this.oauthExcludedModels || {};
        if (!map || typeof map !== 'object') {
            return {};
        }
        const type = (filterType || 'all').toLowerCase();
        if (type === 'all') {
            return map;
        }
        const result = {};
        Object.entries(map).forEach(([provider, models]) => {
            if ((provider || '').toLowerCase() === type) {
                result[provider] = models;
            }
        });
        return result;
    },

    findOauthExcludedEntry(provider) {
        if (!provider || provider === 'all') {
            return null;
        }
        const normalized = provider.toLowerCase();
        const map = this.oauthExcludedModels || {};
        for (const [key, models] of Object.entries(map)) {
            if ((key || '').toLowerCase() === normalized) {
                return { provider: key, models: Array.isArray(models) ? models : [] };
            }
        }
        return null;
    },

    setOauthExcludedForm(provider = '', models = null) {
        const providerSelect = document.getElementById('oauth-excluded-provider-select');
        const modelsInput = document.getElementById('oauth-excluded-models');

        const normalizedProvider = (provider || '').trim();
        if (providerSelect) {
            const options = Array.from(providerSelect.options || []);
            let match = options.find(opt => (opt.value || '').toLowerCase() === normalizedProvider.toLowerCase());
            if (!match && normalizedProvider) {
                match = new Option(this.generateDynamicTypeLabel(normalizedProvider) || normalizedProvider, normalizedProvider);
                providerSelect.appendChild(match);
            }
            if (normalizedProvider && match) {
                providerSelect.value = match.value;
            } else {
                providerSelect.value = 'auto';
            }
        }

        if (modelsInput && models !== null && models !== undefined) {
            const list = Array.isArray(models) ? models : [];
            modelsInput.value = list.map(item => item || '').join('\n');
        }
    },

    syncOauthExcludedFormWithFilter(overrideModels = false) {
        const filterType = (this.currentAuthFileFilter || 'all').toLowerCase();
        const entry = this.findOauthExcludedEntry(filterType);

        if (filterType === 'all') {
            if (overrideModels) {
                if (entry) {
                    this.setOauthExcludedForm(entry.provider, entry.models);
                } else {
                    this.setOauthExcludedForm('', '');
                }
            }
            return;
        }

        if (overrideModels) {
            this.setOauthExcludedForm(filterType, entry ? entry.models : []);
        } else {
            this.setOauthExcludedForm(filterType);
        }
    },

    getOauthExcludedProviderValue() {
        const providerSelect = document.getElementById('oauth-excluded-provider-select');
        const filterFallback = (this.currentAuthFileFilter && this.currentAuthFileFilter !== 'all')
            ? this.currentAuthFileFilter
            : '';

        let selected = (providerSelect && providerSelect.value) ? providerSelect.value.trim() : '';
        if (!selected || selected === 'auto') {
            return filterFallback;
        }
        return selected;
    },

    refreshOauthProviderOptions() {
        const providerSelect = document.getElementById('oauth-excluded-provider-select');
        if (!providerSelect) return;

        const allowedProviders = ['gemini-cli', 'vertex', 'aistudio', 'antigravity', 'claude', 'codex', 'qwen', 'iflow'];
        const mapProviders = Object.keys(this.oauthExcludedModels || {});
        const filterType = (this.currentAuthFileFilter || '').toLowerCase();
        const providers = Array.from(new Set([...allowedProviders, ...mapProviders].filter(Boolean)));

        const prevValue = providerSelect.value || 'auto';

        providerSelect.innerHTML = '';
        const addOption = (value, textKey, fallbackText = null) => {
            const opt = document.createElement('option');
            opt.value = value;
            if (textKey) {
                opt.setAttribute('data-i18n-text', textKey);
                opt.textContent = i18n.t(textKey);
            } else {
                opt.textContent = fallbackText || value;
            }
            providerSelect.appendChild(opt);
        };

        addOption('auto', 'oauth_excluded.provider_auto');
        providers.sort((a, b) => a.localeCompare(b)).forEach(item => addOption(item, null, this.generateDynamicTypeLabel(item) || item));

        const restoreValue = (() => {
            if (prevValue && Array.from(providerSelect.options).some(opt => opt.value === prevValue)) {
                return prevValue;
            }
            if (filterType && Array.from(providerSelect.options).some(opt => opt.value === filterType)) {
                return filterType;
            }
            return 'auto';
        })();
        providerSelect.value = restoreValue;
    },

    parseOauthExcludedModelsInput(input = '') {
        const tokens = (input || '').split(/[\n,]/).map(token => token.trim()).filter(Boolean);
        const unique = [];
        tokens.forEach(token => {
            if (!unique.includes(token)) {
                unique.push(token);
            }
        });
        return unique;
    },

    openOauthExcludedEditor(provider = '', models = null) {
        const modal = document.getElementById('modal');
        const modalBody = document.getElementById('modal-body');
        if (!modal || !modalBody) return;

        const normalizedProvider = (provider || '').trim();
        const fallbackProvider = normalizedProvider
            || ((this.currentAuthFileFilter && this.currentAuthFileFilter !== 'all') ? this.currentAuthFileFilter : '');
        let targetModels = models;

        if ((targetModels === null || targetModels === undefined) && fallbackProvider) {
            const existing = this.findOauthExcludedEntry(fallbackProvider);
            if (existing) {
                targetModels = existing.models;
            }
        }

        modalBody.innerHTML = `
            <h3>${fallbackProvider
                ? i18n.t('oauth_excluded.edit_title', { provider: this.generateDynamicTypeLabel(fallbackProvider) })
                : i18n.t('oauth_excluded.add_title')
            }</h3>
            <div class="provider-item oauth-excluded-editor-card">
                <div class="item-content">
                    <div class="form-group">
                        <label for="oauth-excluded-provider-select" data-i18n="oauth_excluded.provider_label">${i18n.t('oauth_excluded.provider_label')}</label>
                        <select id="oauth-excluded-provider-select"></select>
                        <p class="form-hint" data-i18n="oauth_excluded.provider_hint">${i18n.t('oauth_excluded.provider_hint')}</p>
                    </div>
                    <div class="form-group">
                        <label for="oauth-excluded-models" data-i18n="oauth_excluded.models_label">${i18n.t('oauth_excluded.models_label')}</label>
                        <textarea id="oauth-excluded-models" rows="5" data-i18n-placeholder="oauth_excluded.models_placeholder" placeholder="${i18n.t('oauth_excluded.models_placeholder')}"></textarea>
                        <p class="form-hint" data-i18n="oauth_excluded.models_hint">${i18n.t('oauth_excluded.models_hint')}</p>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" id="oauth-excluded-save">
                    <i class="fas fa-save"></i> ${i18n.t('oauth_excluded.save')}
                </button>
                <button class="btn btn-danger" id="oauth-excluded-delete">
                    <i class="fas fa-trash"></i> ${i18n.t('oauth_excluded.delete')}
                </button>
                <button class="btn btn-secondary" onclick="manager.closeModal()">
                    ${i18n.t('common.cancel')}
                </button>
            </div>
        `;

        this.refreshOauthProviderOptions();
        this.setOauthExcludedForm(fallbackProvider, targetModels != null ? targetModels : []);
        this.showModal();

        const saveBtn = document.getElementById('oauth-excluded-save');
        if (saveBtn) {
            saveBtn.onclick = () => this.saveOauthExcludedEntry();
        }
        const deleteBtn = document.getElementById('oauth-excluded-delete');
        if (deleteBtn) {
            deleteBtn.onclick = () => this.deleteOauthExcludedEntry();
        }

        const providerSelect = document.getElementById('oauth-excluded-provider-select');
        const syncDeleteState = () => {
            if (deleteBtn) {
                deleteBtn.disabled = !this.getOauthExcludedProviderValue();
            }
        };
        if (providerSelect) {
            providerSelect.addEventListener('change', syncDeleteState);
        }
        syncDeleteState();
        this.updateOauthExcludedButtonsState(false);
    },

    buildOauthExcludedItem(provider, models = []) {
        const providerLabel = this.generateDynamicTypeLabel(provider) || provider;
        const normalizedModels = Array.isArray(models) ? models.filter(Boolean) : [];
        const tags = normalizedModels.length
            ? normalizedModels.map(model => `<span class="provider-model-tag"><span class="model-name">${this.escapeHtml(String(model))}</span></span>`).join('')
            : `<span class="oauth-excluded-empty">${i18n.t('oauth_excluded.no_models')}</span>`;
        const modelCount = normalizedModels.length;

        return `
            <div class="provider-item oauth-excluded-card" data-provider="${this.escapeHtml(provider)}">
                <div class="item-content">
                    <div class="item-title">${this.escapeHtml(providerLabel)}</div>
                    <div class="item-meta">
                        <span class="item-subtitle">
                            ${modelCount > 0
                                ? i18n.t('oauth_excluded.model_count', { count: modelCount })
                                : i18n.t('oauth_excluded.no_models')}
                        </span>
                    </div>
                    <div class="provider-models oauth-excluded-tags">
                        ${tags}
                    </div>
                </div>
                <div class="item-actions">
                    <button class="btn btn-secondary" data-action="edit" data-provider="${this.escapeHtml(provider)}">
                        <i class="fas fa-pen"></i>
                    </button>
                    <button class="btn btn-danger" data-action="delete" data-provider="${this.escapeHtml(provider)}">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        `;
    },

    renderOauthExcludedModels(filterType = this.currentAuthFileFilter) {
        const container = document.getElementById('oauth-excluded-list');
        const scopeEl = document.getElementById('oauth-excluded-scope');
        if (!container) return;

        const currentType = (filterType || 'all').toLowerCase();
        const map = this.getFilteredOauthExcludedMap(currentType);
        const providers = Object.keys(map || {});

        if (scopeEl) {
            const label = currentType === 'all'
                ? i18n.t('oauth_excluded.scope_all')
                : i18n.t('oauth_excluded.scope_provider', { provider: this.generateDynamicTypeLabel(currentType) });
            scopeEl.textContent = label;
        }

        if (!this.isConnected) {
            container.innerHTML = `<div class="oauth-excluded-empty">${i18n.t('oauth_excluded.disconnected')}</div>`;
            return;
        }

        if (this._oauthExcludedLoading) {
            container.innerHTML = `<div class="loading-placeholder">${i18n.t('common.loading')}</div>`;
            return;
        }

        if (!providers.length) {
            const emptyKey = currentType === 'all'
                ? 'oauth_excluded.list_empty_all'
                : 'oauth_excluded.list_empty_filtered';
            container.innerHTML = `<div class="oauth-excluded-empty">${i18n.t(emptyKey)}</div>`;
            return;
        }

        const itemsHtml = providers
            .sort((a, b) => a.localeCompare(b))
            .map(provider => this.buildOauthExcludedItem(provider, map[provider]))
            .join('');
        container.innerHTML = itemsHtml;
        this.refreshOauthProviderOptions();
        this.bindOauthExcludedActionEvents();
    },

    bindOauthExcludedActionEvents() {
        const container = document.getElementById('oauth-excluded-list');
        if (!container) return;

        if (container._oauthExcludedListener) {
            container.removeEventListener('click', container._oauthExcludedListener);
        }

        const listener = (event) => {
            const button = event.target.closest('button[data-action]');
            if (!button || !container.contains(button)) return;
            const provider = button.dataset.provider;
            if (!provider) return;

            const entry = this.findOauthExcludedEntry(provider);
            if (button.dataset.action === 'edit') {
                this.openOauthExcludedEditor(provider, entry ? entry.models : []);
            } else if (button.dataset.action === 'delete') {
                this.deleteOauthExcludedEntry(provider);
            }
        };

        container._oauthExcludedListener = listener;
        container.addEventListener('click', listener);
    },

    updateOauthExcludedButtonsState(isLoading = false) {
        const refreshBtn = document.getElementById('oauth-excluded-refresh');
        const saveBtn = document.getElementById('oauth-excluded-save');
        const deleteBtn = document.getElementById('oauth-excluded-delete');
        const addBtn = document.getElementById('oauth-excluded-add');
        const disabled = isLoading || !this.isConnected;
        [refreshBtn, saveBtn, deleteBtn, addBtn].forEach(btn => {
            if (btn) {
                btn.disabled = disabled;
            }
        });
    },

    setOauthExcludedStatus(message = '') {
        const statusEl = document.getElementById('oauth-excluded-status');
        if (statusEl) {
            statusEl.textContent = message || '';
        }
    },

    async loadOauthExcludedModels(forceRefresh = false) {
        if (!this.isConnected) {
            this.renderOauthExcludedModels();
            this.updateOauthExcludedButtonsState();
            return;
        }

        if (this._oauthExcludedLoading) {
            return;
        }

        this._oauthExcludedLoading = true;
        this.updateOauthExcludedButtonsState(true);
        this.setOauthExcludedStatus(i18n.t('oauth_excluded.refreshing'));
        this.renderOauthExcludedModels();

        try {
            let targetMap = {};
            let hasData = false;

            if (!forceRefresh) {
                const { map, found } = this.resolveOauthExcludedFromConfig();
                if (found) {
                    targetMap = map;
                    hasData = true;
                }
            }

            if (!hasData) {
                try {
                    const configSection = await this.getConfig('oauth-excluded-models', forceRefresh);
                    if (configSection !== undefined) {
                        targetMap = this.normalizeOauthExcludedMap(configSection);
                        hasData = true;
                    }
                } catch (configError) {
                    console.warn('从配置获取 OAuth 排除列表失败，尝试回退接口:', configError);
                }
            }

            if (!hasData) {
                const data = await this.makeRequest('/oauth-excluded-models');
                targetMap = this.normalizeOauthExcludedMap(data);
                hasData = true;
            }

            this.oauthExcludedModels = targetMap;
            this.setOauthExcludedStatus('');
        } catch (error) {
            console.error('加载 OAuth 排除列表失败:', error);
            const message = `${i18n.t('oauth_excluded.load_failed')}: ${error.message}`;
            this.setOauthExcludedStatus(message);
            this.showNotification(message, 'error');
        } finally {
            this._oauthExcludedLoading = false;
            this.updateOauthExcludedButtonsState(false);
            this.renderOauthExcludedModels();
        }
    },

    async saveOauthExcludedEntry() {
        if (!this.isConnected) {
            this.showNotification(i18n.t('notification.connection_required'), 'error');
            return;
        }
        const modelsInput = document.getElementById('oauth-excluded-models');
        if (!modelsInput) return;

        const providerValue = this.getOauthExcludedProviderValue();
        if (!providerValue) {
            this.showNotification(i18n.t('oauth_excluded.provider_required'), 'error');
            return;
        }

        const models = this.parseOauthExcludedModelsInput(modelsInput.value);
        this.updateOauthExcludedButtonsState(true);
        this.setOauthExcludedStatus(i18n.t('oauth_excluded.saving'));

        try {
            await this.makeRequest('/oauth-excluded-models', {
                method: 'PATCH',
                body: JSON.stringify({
                    provider: providerValue,
                    models
                })
            });
            const successKey = models.length === 0 ? 'oauth_excluded.delete_success' : 'oauth_excluded.save_success';
            this.showNotification(i18n.t(successKey), 'success');
            this.clearCache('oauth-excluded-models');
            await this.loadOauthExcludedModels(true);
            this.closeModal();
        } catch (error) {
            this.showNotification(`${i18n.t('oauth_excluded.save_failed')}: ${error.message}`, 'error');
        } finally {
            this.setOauthExcludedStatus('');
            this.updateOauthExcludedButtonsState(false);
        }
    },

    async deleteOauthExcludedEntry(providerOverride = null) {
        if (!this.isConnected) {
            this.showNotification(i18n.t('notification.connection_required'), 'error');
            return;
        }
        const providerValue = (providerOverride || this.getOauthExcludedProviderValue() || '').trim();

        if (!providerValue) {
            this.showNotification(i18n.t('oauth_excluded.provider_required'), 'error');
            return;
        }

        if (!confirm(i18n.t('oauth_excluded.delete_confirm', { provider: providerValue }))) {
            return;
        }

        this.updateOauthExcludedButtonsState(true);
        this.setOauthExcludedStatus(i18n.t('oauth_excluded.deleting'));

        try {
            await this.makeRequest(`/oauth-excluded-models?provider=${encodeURIComponent(providerValue)}`, { method: 'DELETE' });
            this.showNotification(i18n.t('oauth_excluded.delete_success'), 'success');
            this.clearCache('oauth-excluded-models');
            await this.loadOauthExcludedModels(true);
            this.closeModal();
        } catch (error) {
            this.showNotification(`${i18n.t('oauth_excluded.delete_failed')}: ${error.message}`, 'error');
        } finally {
            this.setOauthExcludedStatus('');
            this.updateOauthExcludedButtonsState(false);
        }
    },

    registerAuthFilesListeners() {
        if (!this.events || typeof this.events.on !== 'function') {
            return;
        }
        this.events.on('data:config-loaded', async (event) => {
            const detail = event?.detail || {};
            const config = detail.config || {};
            const keyStats = detail.keyStats || null;
            try {
                await this.loadAuthFiles(keyStats);
            } catch (error) {
                console.error('加载认证文件失败:', error);
            }
            try {
                const applied = this.applyOauthExcludedFromConfig(config, { render: true });
                if (!applied) {
                    await this.loadOauthExcludedModels(true);
                }
            } catch (error) {
                console.error('加载 OAuth 排除列表失败:', error);
            }
        });

        this.events.on('connection:status-changed', (event) => {
            const detail = event?.detail || {};
            this.updateOauthExcludedButtonsState(false);
            if (detail.isConnected) {
                if (!this.applyOauthExcludedFromConfig(null, { render: true })) {
                    this.renderOauthExcludedModels();
                }
            } else {
                this.renderOauthExcludedModels();
            }
        });
    }
};



// ============ src/modules/oauth.js ============
const oauthModule = {
    // ===== Codex OAuth 相关方法 =====

    // 开始 Codex OAuth 流程
    async startCodexOAuth() {
        try {
            const response = await this.makeRequest('/codex-auth-url?is_webui=1');
            const authUrl = response.url;
            const state = this.extractStateFromUrl(authUrl);

            // 显示授权链接
            const urlInput = document.getElementById('codex-oauth-url');
            const content = document.getElementById('codex-oauth-content');
            const status = document.getElementById('codex-oauth-status');

            if (urlInput) {
                urlInput.value = authUrl;
            }
            if (content) {
                content.style.display = 'block';
            }
            if (status) {
                status.textContent = i18n.t('auth_login.codex_oauth_status_waiting');
                status.style.color = 'var(--warning-text)';
            }

            // 开始轮询认证状态
            this.startCodexOAuthPolling(state);

        } catch (error) {
            this.showNotification(`${i18n.t('auth_login.codex_oauth_start_error')} ${error.message}`, 'error');
        }
    },

    // 从 URL 中提取 state 参数
    extractStateFromUrl(url) {
        try {
            const urlObj = new URL(url);
            return urlObj.searchParams.get('state');
        } catch (error) {
            console.error('Failed to extract state from URL:', error);
            return null;
        }
    },

    // 打开 Codex 授权链接
    openCodexLink() {
        const urlInput = document.getElementById('codex-oauth-url');
        if (urlInput && urlInput.value) {
            window.open(urlInput.value, '_blank');
        }
    },

    // 复制 Codex 授权链接
    async copyCodexLink() {
        const urlInput = document.getElementById('codex-oauth-url');
        if (urlInput && urlInput.value) {
            try {
                await navigator.clipboard.writeText(urlInput.value);
                this.showNotification(i18n.t('notification.link_copied'), 'success');
            } catch (error) {
                // 降级方案：使用传统的复制方法
                urlInput.select();
                document.execCommand('copy');
                this.showNotification(i18n.t('notification.link_copied'), 'success');
            }
        }
    },

    // 开始轮询 OAuth 状态
    startCodexOAuthPolling(state) {
        if (!state) {
            this.showNotification(i18n.t('auth_login.missing_state'), 'error');
            return;
        }

        const pollInterval = setInterval(async () => {
            try {
                const response = await this.makeRequest(`/get-auth-status?state=${encodeURIComponent(state)}`);
                const status = response.status;
                const statusElement = document.getElementById('codex-oauth-status');

                if (status === 'ok') {
                    // 认证成功
                    clearInterval(pollInterval);
                    // 隐藏授权链接相关内容，恢复到初始状态
                    this.resetCodexOAuthUI();
                    // 显示成功通知
                    this.showNotification(i18n.t('auth_login.codex_oauth_status_success'), 'success');
                    // 刷新认证文件列表
                    this.loadAuthFiles();
                } else if (status === 'error') {
                    // 认证失败
                    clearInterval(pollInterval);
                    const errorMessage = response.error || 'Unknown error';
                    // 显示错误信息
                    if (statusElement) {
                        statusElement.textContent = `${i18n.t('auth_login.codex_oauth_status_error')} ${errorMessage}`;
                        statusElement.style.color = 'var(--error-text)';
                    }
                    this.showNotification(`${i18n.t('auth_login.codex_oauth_status_error')} ${errorMessage}`, 'error');
                    // 3秒后重置UI，让用户能够重新开始
                    setTimeout(() => {
                        this.resetCodexOAuthUI();
                    }, 3000);
                } else if (status === 'wait') {
                    // 继续等待
                    if (statusElement) {
                        statusElement.textContent = i18n.t('auth_login.codex_oauth_status_waiting');
                        statusElement.style.color = 'var(--warning-text)';
                    }
                }
            } catch (error) {
                clearInterval(pollInterval);
                const statusElement = document.getElementById('codex-oauth-status');
                if (statusElement) {
                    statusElement.textContent = `${i18n.t('auth_login.codex_oauth_polling_error')} ${error.message}`;
                    statusElement.style.color = 'var(--error-text)';
                }
                this.showNotification(`${i18n.t('auth_login.codex_oauth_polling_error')} ${error.message}`, 'error');
                // 3秒后重置UI，让用户能够重新开始
                setTimeout(() => {
                    this.resetCodexOAuthUI();
                }, 3000);
            }
        }, 2000); // 每2秒轮询一次

        // 设置超时，5分钟后停止轮询
        setTimeout(() => {
            clearInterval(pollInterval);
        }, 5 * 60 * 1000);
    },

    // 重置 Codex OAuth UI 到初始状态
    resetCodexOAuthUI() {
        const urlInput = document.getElementById('codex-oauth-url');
        const content = document.getElementById('codex-oauth-content');
        const status = document.getElementById('codex-oauth-status');

        // 清空并隐藏授权链接输入框
        if (urlInput) {
            urlInput.value = '';
        }

        // 隐藏整个授权链接内容区域
        if (content) {
            content.style.display = 'none';
        }

        // 清空状态显示
        if (status) {
            status.textContent = '';
            status.style.color = '';
            status.className = '';
        }
    },

    // ===== Anthropic OAuth 相关方法 =====

    // 开始 Anthropic OAuth 流程
    async startAnthropicOAuth() {
        try {
            const response = await this.makeRequest('/anthropic-auth-url?is_webui=1');
            const authUrl = response.url;
            const state = this.extractStateFromUrl(authUrl);

            // 显示授权链接
            const urlInput = document.getElementById('anthropic-oauth-url');
            const content = document.getElementById('anthropic-oauth-content');
            const status = document.getElementById('anthropic-oauth-status');

            if (urlInput) {
                urlInput.value = authUrl;
            }
            if (content) {
                content.style.display = 'block';
            }
            if (status) {
                status.textContent = i18n.t('auth_login.anthropic_oauth_status_waiting');
                status.style.color = 'var(--warning-text)';
            }

            // 开始轮询认证状态
            this.startAnthropicOAuthPolling(state);

        } catch (error) {
            this.showNotification(`${i18n.t('auth_login.anthropic_oauth_start_error')} ${error.message}`, 'error');
        }
    },

    // 打开 Anthropic 授权链接
    openAnthropicLink() {
        const urlInput = document.getElementById('anthropic-oauth-url');
        if (urlInput && urlInput.value) {
            window.open(urlInput.value, '_blank');
        }
    },

    // 复制 Anthropic 授权链接
    async copyAnthropicLink() {
        const urlInput = document.getElementById('anthropic-oauth-url');
        if (urlInput && urlInput.value) {
            try {
                await navigator.clipboard.writeText(urlInput.value);
                this.showNotification(i18n.t('notification.link_copied'), 'success');
            } catch (error) {
                // 降级方案：使用传统的复制方法
                urlInput.select();
                document.execCommand('copy');
                this.showNotification(i18n.t('notification.link_copied'), 'success');
            }
        }
    },

    // 开始轮询 Anthropic OAuth 状态
    startAnthropicOAuthPolling(state) {
        if (!state) {
            this.showNotification(i18n.t('auth_login.missing_state'), 'error');
            return;
        }

        const pollInterval = setInterval(async () => {
            try {
                const response = await this.makeRequest(`/get-auth-status?state=${encodeURIComponent(state)}`);
                const status = response.status;
                const statusElement = document.getElementById('anthropic-oauth-status');

                if (status === 'ok') {
                    // 认证成功
                    clearInterval(pollInterval);
                    // 隐藏授权链接相关内容，恢复到初始状态
                    this.resetAnthropicOAuthUI();
                    // 显示成功通知
                    this.showNotification(i18n.t('auth_login.anthropic_oauth_status_success'), 'success');
                    // 刷新认证文件列表
                    this.loadAuthFiles();
                } else if (status === 'error') {
                    // 认证失败
                    clearInterval(pollInterval);
                    const errorMessage = response.error || 'Unknown error';
                    // 显示错误信息
                    if (statusElement) {
                        statusElement.textContent = `${i18n.t('auth_login.anthropic_oauth_status_error')} ${errorMessage}`;
                        statusElement.style.color = 'var(--error-text)';
                    }
                    this.showNotification(`${i18n.t('auth_login.anthropic_oauth_status_error')} ${errorMessage}`, 'error');
                    // 3秒后重置UI，让用户能够重新开始
                    setTimeout(() => {
                        this.resetAnthropicOAuthUI();
                    }, 3000);
                } else if (status === 'wait') {
                    // 继续等待
                    if (statusElement) {
                        statusElement.textContent = i18n.t('auth_login.anthropic_oauth_status_waiting');
                        statusElement.style.color = 'var(--warning-text)';
                    }
                }
            } catch (error) {
                clearInterval(pollInterval);
                const statusElement = document.getElementById('anthropic-oauth-status');
                if (statusElement) {
                    statusElement.textContent = `${i18n.t('auth_login.anthropic_oauth_polling_error')} ${error.message}`;
                    statusElement.style.color = 'var(--error-text)';
                }
                this.showNotification(`${i18n.t('auth_login.anthropic_oauth_polling_error')} ${error.message}`, 'error');
                // 3秒后重置UI，让用户能够重新开始
                setTimeout(() => {
                    this.resetAnthropicOAuthUI();
                }, 3000);
            }
        }, 2000); // 每2秒轮询一次

        // 设置超时，5分钟后停止轮询
        setTimeout(() => {
            clearInterval(pollInterval);
        }, 5 * 60 * 1000);
    },

    // 重置 Anthropic OAuth UI 到初始状态
    resetAnthropicOAuthUI() {
        const urlInput = document.getElementById('anthropic-oauth-url');
        const content = document.getElementById('anthropic-oauth-content');
        const status = document.getElementById('anthropic-oauth-status');

        // 清空并隐藏授权链接输入框
        if (urlInput) {
            urlInput.value = '';
        }

        // 隐藏整个授权链接内容区域
        if (content) {
            content.style.display = 'none';
        }

        // 清空状态显示
        if (status) {
            status.textContent = '';
            status.style.color = '';
            status.className = '';
        }
    },

    // ===== Antigravity OAuth 相关方法 =====

    // 开始 Antigravity OAuth 流程
    async startAntigravityOAuth() {
        try {
            const response = await this.makeRequest('/antigravity-auth-url?is_webui=1');
            const authUrl = response.url;
            const state = response.state || this.extractStateFromUrl(authUrl);

            // 显示授权链接
            const urlInput = document.getElementById('antigravity-oauth-url');
            const content = document.getElementById('antigravity-oauth-content');
            const status = document.getElementById('antigravity-oauth-status');

            if (urlInput) {
                urlInput.value = authUrl;
            }
            if (content) {
                content.style.display = 'block';
            }
            if (status) {
                status.textContent = i18n.t('auth_login.antigravity_oauth_status_waiting');
                status.style.color = 'var(--warning-text)';
            }

            // 开始轮询认证状态
            this.startAntigravityOAuthPolling(state);

        } catch (error) {
            this.showNotification(`${i18n.t('auth_login.antigravity_oauth_start_error')} ${error.message}`, 'error');
        }
    },

    // 打开 Antigravity 授权链接
    openAntigravityLink() {
        const urlInput = document.getElementById('antigravity-oauth-url');
        if (urlInput && urlInput.value) {
            window.open(urlInput.value, '_blank');
        }
    },

    // 复制 Antigravity 授权链接
    async copyAntigravityLink() {
        const urlInput = document.getElementById('antigravity-oauth-url');
        if (urlInput && urlInput.value) {
            try {
                await navigator.clipboard.writeText(urlInput.value);
                this.showNotification(i18n.t('notification.link_copied'), 'success');
            } catch (error) {
                urlInput.select();
                document.execCommand('copy');
                this.showNotification(i18n.t('notification.link_copied'), 'success');
            }
        }
    },

    // 开始轮询 Antigravity OAuth 状态
    startAntigravityOAuthPolling(state) {
        if (!state) {
            this.showNotification(i18n.t('auth_login.missing_state'), 'error');
            return;
        }

        const pollInterval = setInterval(async () => {
            try {
                const response = await this.makeRequest(`/get-auth-status?state=${encodeURIComponent(state)}`);
                const status = response.status;
                const statusElement = document.getElementById('antigravity-oauth-status');

                if (status === 'ok') {
                    clearInterval(pollInterval);
                    this.resetAntigravityOAuthUI();
                    this.showNotification(i18n.t('auth_login.antigravity_oauth_status_success'), 'success');
                    this.loadAuthFiles();
                } else if (status === 'error') {
                    clearInterval(pollInterval);
                    const errorMessage = response.error || 'Unknown error';
                    if (statusElement) {
                        statusElement.textContent = `${i18n.t('auth_login.antigravity_oauth_status_error')} ${errorMessage}`;
                        statusElement.style.color = 'var(--error-text)';
                    }
                    this.showNotification(`${i18n.t('auth_login.antigravity_oauth_status_error')} ${errorMessage}`, 'error');
                    setTimeout(() => {
                        this.resetAntigravityOAuthUI();
                    }, 3000);
                } else if (status === 'wait') {
                    if (statusElement) {
                        statusElement.textContent = i18n.t('auth_login.antigravity_oauth_status_waiting');
                        statusElement.style.color = 'var(--warning-text)';
                    }
                }
            } catch (error) {
                clearInterval(pollInterval);
                const statusElement = document.getElementById('antigravity-oauth-status');
                if (statusElement) {
                    statusElement.textContent = `${i18n.t('auth_login.antigravity_oauth_polling_error')} ${error.message}`;
                    statusElement.style.color = 'var(--error-text)';
                }
                this.showNotification(`${i18n.t('auth_login.antigravity_oauth_polling_error')} ${error.message}`, 'error');
                setTimeout(() => {
                    this.resetAntigravityOAuthUI();
                }, 3000);
            }
        }, 2000);

        setTimeout(() => {
            clearInterval(pollInterval);
        }, 5 * 60 * 1000);
    },

    // 重置 Antigravity OAuth UI 到初始状态
    resetAntigravityOAuthUI() {
        const urlInput = document.getElementById('antigravity-oauth-url');
        const content = document.getElementById('antigravity-oauth-content');
        const status = document.getElementById('antigravity-oauth-status');

        if (urlInput) {
            urlInput.value = '';
        }
        if (content) {
            content.style.display = 'none';
        }
        if (status) {
            status.textContent = '';
            status.style.color = '';
            status.className = '';
        }
    },

    // ===== Gemini CLI OAuth 相关方法 =====

    // 开始 Gemini CLI OAuth 流程
    async startGeminiCliOAuth() {
        try {
            const response = await this.makeRequest('/gemini-cli-auth-url?is_webui=1');
            const authUrl = response.url;
            const state = this.extractStateFromUrl(authUrl);

            // 显示授权链接
            const urlInput = document.getElementById('gemini-cli-oauth-url');
            const content = document.getElementById('gemini-cli-oauth-content');
            const status = document.getElementById('gemini-cli-oauth-status');

            if (urlInput) {
                urlInput.value = authUrl;
            }
            if (content) {
                content.style.display = 'block';
            }
            if (status) {
                status.textContent = i18n.t('auth_login.gemini_cli_oauth_status_waiting');
                status.style.color = 'var(--warning-text)';
            }

            // 开始轮询认证状态
            this.startGeminiCliOAuthPolling(state);

        } catch (error) {
            this.showNotification(`${i18n.t('auth_login.gemini_cli_oauth_start_error')} ${error.message}`, 'error');
        }
    },

    // 打开 Gemini CLI 授权链接
    openGeminiCliLink() {
        const urlInput = document.getElementById('gemini-cli-oauth-url');
        if (urlInput && urlInput.value) {
            window.open(urlInput.value, '_blank');
        }
    },

    // 复制 Gemini CLI 授权链接
    async copyGeminiCliLink() {
        const urlInput = document.getElementById('gemini-cli-oauth-url');
        if (urlInput && urlInput.value) {
            try {
                await navigator.clipboard.writeText(urlInput.value);
                this.showNotification(i18n.t('notification.link_copied'), 'success');
            } catch (error) {
                // 降级方案：使用传统的复制方法
                urlInput.select();
                document.execCommand('copy');
                this.showNotification(i18n.t('notification.link_copied'), 'success');
            }
        }
    },

    // 开始轮询 Gemini CLI OAuth 状态
    startGeminiCliOAuthPolling(state) {
        if (!state) {
            this.showNotification(i18n.t('auth_login.missing_state'), 'error');
            return;
        }

        const pollInterval = setInterval(async () => {
            try {
                const response = await this.makeRequest(`/get-auth-status?state=${encodeURIComponent(state)}`);
                const status = response.status;
                const statusElement = document.getElementById('gemini-cli-oauth-status');

                if (status === 'ok') {
                    // 认证成功
                    clearInterval(pollInterval);
                    // 隐藏授权链接相关内容，恢复到初始状态
                    this.resetGeminiCliOAuthUI();
                    // 显示成功通知
                    this.showNotification(i18n.t('auth_login.gemini_cli_oauth_status_success'), 'success');
                    // 刷新认证文件列表
                    this.loadAuthFiles();
                } else if (status === 'error') {
                    // 认证失败
                    clearInterval(pollInterval);
                    const errorMessage = response.error || 'Unknown error';
                    // 显示错误信息
                    if (statusElement) {
                        statusElement.textContent = `${i18n.t('auth_login.gemini_cli_oauth_status_error')} ${errorMessage}`;
                        statusElement.style.color = 'var(--error-text)';
                    }
                    this.showNotification(`${i18n.t('auth_login.gemini_cli_oauth_status_error')} ${errorMessage}`, 'error');
                    // 3秒后重置UI，让用户能够重新开始
                    setTimeout(() => {
                        this.resetGeminiCliOAuthUI();
                    }, 3000);
                } else if (status === 'wait') {
                    // 继续等待
                    if (statusElement) {
                        statusElement.textContent = i18n.t('auth_login.gemini_cli_oauth_status_waiting');
                        statusElement.style.color = 'var(--warning-text)';
                    }
                }
            } catch (error) {
                clearInterval(pollInterval);
                const statusElement = document.getElementById('gemini-cli-oauth-status');
                if (statusElement) {
                    statusElement.textContent = `${i18n.t('auth_login.gemini_cli_oauth_polling_error')} ${error.message}`;
                    statusElement.style.color = 'var(--error-text)';
                }
                this.showNotification(`${i18n.t('auth_login.gemini_cli_oauth_polling_error')} ${error.message}`, 'error');
                // 3秒后重置UI，让用户能够重新开始
                setTimeout(() => {
                    this.resetGeminiCliOAuthUI();
                }, 3000);
            }
        }, 2000); // 每2秒轮询一次

        // 设置超时，5分钟后停止轮询
        setTimeout(() => {
            clearInterval(pollInterval);
        }, 5 * 60 * 1000);
    },

    // 重置 Gemini CLI OAuth UI 到初始状态
    resetGeminiCliOAuthUI() {
        const urlInput = document.getElementById('gemini-cli-oauth-url');
        const content = document.getElementById('gemini-cli-oauth-content');
        const status = document.getElementById('gemini-cli-oauth-status');

        // 清空并隐藏授权链接输入框
        if (urlInput) {
            urlInput.value = '';
        }

        // 隐藏整个授权链接内容区域
        if (content) {
            content.style.display = 'none';
        }

        // 清空状态显示
        if (status) {
            status.textContent = '';
            status.style.color = '';
            status.className = '';
        }
    },

    // ===== Qwen OAuth 相关方法 =====

    // 开始 Qwen OAuth 流程
    async startQwenOAuth() {
        try {
            const response = await this.makeRequest('/qwen-auth-url?is_webui=1');
            const authUrl = response.url;
            const state = this.extractStateFromUrl(authUrl);

            // 显示授权链接
            const urlInput = document.getElementById('qwen-oauth-url');
            const content = document.getElementById('qwen-oauth-content');
            const status = document.getElementById('qwen-oauth-status');

            if (urlInput) {
                urlInput.value = authUrl;
            }
            if (content) {
                content.style.display = 'block';
            }
            if (status) {
                status.textContent = i18n.t('auth_login.qwen_oauth_status_waiting');
                status.style.color = 'var(--warning-text)';
            }

            // 开始轮询认证状态
            this.startQwenOAuthPolling(state);

        } catch (error) {
            this.showNotification(`${i18n.t('auth_login.qwen_oauth_start_error')} ${error.message}`, 'error');
        }
    },

    // 打开 Qwen 授权链接
    openQwenLink() {
        const urlInput = document.getElementById('qwen-oauth-url');
        if (urlInput && urlInput.value) {
            window.open(urlInput.value, '_blank');
        }
    },

    // 复制 Qwen 授权链接
    async copyQwenLink() {
        const urlInput = document.getElementById('qwen-oauth-url');
        if (urlInput && urlInput.value) {
            try {
                await navigator.clipboard.writeText(urlInput.value);
                this.showNotification(i18n.t('notification.link_copied'), 'success');
            } catch (error) {
                // 降级方案：使用传统的复制方法
                urlInput.select();
                document.execCommand('copy');
                this.showNotification(i18n.t('notification.link_copied'), 'success');
            }
        }
    },

    // 开始轮询 Qwen OAuth 状态
    startQwenOAuthPolling(state) {
        if (!state) {
            this.showNotification(i18n.t('auth_login.missing_state'), 'error');
            return;
        }

        const pollInterval = setInterval(async () => {
            try {
                const response = await this.makeRequest(`/get-auth-status?state=${encodeURIComponent(state)}`);
                const status = response.status;
                const statusElement = document.getElementById('qwen-oauth-status');

                if (status === 'ok') {
                    // 认证成功
                    clearInterval(pollInterval);
                    // 隐藏授权链接相关内容，恢复到初始状态
                    this.resetQwenOAuthUI();
                    // 显示成功通知
                    this.showNotification(i18n.t('auth_login.qwen_oauth_status_success'), 'success');
                    // 刷新认证文件列表
                    this.loadAuthFiles();
                } else if (status === 'error') {
                    // 认证失败
                    clearInterval(pollInterval);
                    const errorMessage = response.error || 'Unknown error';
                    // 显示错误信息
                    if (statusElement) {
                        statusElement.textContent = `${i18n.t('auth_login.qwen_oauth_status_error')} ${errorMessage}`;
                        statusElement.style.color = 'var(--error-text)';
                    }
                    this.showNotification(`${i18n.t('auth_login.qwen_oauth_status_error')} ${errorMessage}`, 'error');
                    // 3秒后重置UI，让用户能够重新开始
                    setTimeout(() => {
                        this.resetQwenOAuthUI();
                    }, 3000);
                } else if (status === 'wait') {
                    // 继续等待
                    if (statusElement) {
                        statusElement.textContent = i18n.t('auth_login.qwen_oauth_status_waiting');
                        statusElement.style.color = 'var(--warning-text)';
                    }
                }
            } catch (error) {
                clearInterval(pollInterval);
                const statusElement = document.getElementById('qwen-oauth-status');
                if (statusElement) {
                    statusElement.textContent = `${i18n.t('auth_login.qwen_oauth_polling_error')} ${error.message}`;
                    statusElement.style.color = 'var(--error-text)';
                }
                this.showNotification(`${i18n.t('auth_login.qwen_oauth_polling_error')} ${error.message}`, 'error');
                // 3秒后重置UI，让用户能够重新开始
                setTimeout(() => {
                    this.resetQwenOAuthUI();
                }, 3000);
            }
        }, 2000); // 每2秒轮询一次

        // 设置超时，5分钟后停止轮询
        setTimeout(() => {
            clearInterval(pollInterval);
        }, 5 * 60 * 1000);
    },

    // 重置 Qwen OAuth UI 到初始状态
    resetQwenOAuthUI() {
        const urlInput = document.getElementById('qwen-oauth-url');
        const content = document.getElementById('qwen-oauth-content');
        const status = document.getElementById('qwen-oauth-status');

        // 清空并隐藏授权链接输入框
        if (urlInput) {
            urlInput.value = '';
        }

        // 隐藏整个授权链接内容区域
        if (content) {
            content.style.display = 'none';
        }

        // 清空状态显示
        if (status) {
            status.textContent = '';
            status.style.color = '';
            status.className = '';
        }
    },

    // ===== iFlow OAuth 相关方法 =====

    // 开始 iFlow OAuth 流程
    async startIflowOAuth() {
        if (!this.isIflowOAuthAllowed()) {
            const statusEl = document.getElementById('iflow-oauth-status');
            if (statusEl) {
                statusEl.textContent = i18n.t('auth_login.iflow_oauth_local_only');
                statusEl.style.display = 'block';
                statusEl.style.color = 'var(--warning-text)';
            }
            this.showNotification(i18n.t('auth_login.iflow_oauth_local_only'), 'error');
            return;
        }

        try {
            const response = await this.makeRequest('/iflow-auth-url?is_webui=1');
            const authUrl = response.url;
            const state = this.extractStateFromUrl(authUrl);

            // 显示授权链接
            const urlInput = document.getElementById('iflow-oauth-url');
            const content = document.getElementById('iflow-oauth-content');
            const status = document.getElementById('iflow-oauth-status');

            if (urlInput) {
                urlInput.value = authUrl;
            }
            if (content) {
                content.style.display = 'block';
            }
            if (status) {
                status.textContent = i18n.t('auth_login.iflow_oauth_status_waiting');
                status.style.color = 'var(--warning-text)';
            }

            // 开始轮询认证状态
            this.startIflowOAuthPolling(state);

        } catch (error) {
            this.showNotification(`${i18n.t('auth_login.iflow_oauth_start_error')} ${error.message}`, 'error');
        }
    },

    // 打开 iFlow 授权链接
    openIflowLink() {
        const urlInput = document.getElementById('iflow-oauth-url');
        if (urlInput && urlInput.value) {
            window.open(urlInput.value, '_blank');
        }
    },

    // 复制 iFlow 授权链接
    async copyIflowLink() {
        const urlInput = document.getElementById('iflow-oauth-url');
        if (urlInput && urlInput.value) {
            try {
                await navigator.clipboard.writeText(urlInput.value);
                this.showNotification(i18n.t('notification.link_copied'), 'success');
            } catch (error) {
                // 降级方案：使用传统的复制方法
                urlInput.select();
                document.execCommand('copy');
                this.showNotification(i18n.t('notification.link_copied'), 'success');
            }
        }
    },

    // 开始轮询 iFlow OAuth 状态
    startIflowOAuthPolling(state) {
        if (!state) {
            this.showNotification(i18n.t('auth_login.missing_state'), 'error');
            return;
        }

        const pollInterval = setInterval(async () => {
            try {
                const response = await this.makeRequest(`/get-auth-status?state=${encodeURIComponent(state)}`);
                const status = response.status;
                const statusElement = document.getElementById('iflow-oauth-status');

                if (status === 'ok') {
                    // 认证成功
                    clearInterval(pollInterval);
                    // 隐藏授权链接相关内容，恢复到初始状态
                    this.resetIflowOAuthUI();
                    // 显示成功通知
                    this.showNotification(i18n.t('auth_login.iflow_oauth_status_success'), 'success');
                    // 刷新认证文件列表
                    this.loadAuthFiles();
                } else if (status === 'error') {
                    // 认证失败
                    clearInterval(pollInterval);
                    const errorMessage = response.error || 'Unknown error';
                    // 显示错误信息
                    if (statusElement) {
                        statusElement.textContent = `${i18n.t('auth_login.iflow_oauth_status_error')} ${errorMessage}`;
                        statusElement.style.color = 'var(--error-text)';
                    }
                    this.showNotification(`${i18n.t('auth_login.iflow_oauth_status_error')} ${errorMessage}`, 'error');
                    // 3秒后重置UI，让用户能够重新开始
                    setTimeout(() => {
                        this.resetIflowOAuthUI();
                    }, 3000);
                } else if (status === 'wait') {
                    // 继续等待
                    if (statusElement) {
                        statusElement.textContent = i18n.t('auth_login.iflow_oauth_status_waiting');
                        statusElement.style.color = 'var(--warning-text)';
                    }
                }
            } catch (error) {
                clearInterval(pollInterval);
                const statusElement = document.getElementById('iflow-oauth-status');
                if (statusElement) {
                    statusElement.textContent = `${i18n.t('auth_login.iflow_oauth_polling_error')} ${error.message}`;
                    statusElement.style.color = 'var(--error-text)';
                }
                this.showNotification(`${i18n.t('auth_login.iflow_oauth_polling_error')} ${error.message}`, 'error');
                // 3秒后重置UI，让用户能够重新开始
                setTimeout(() => {
                    this.resetIflowOAuthUI();
                }, 3000);
            }
        }, 2000); // 每2秒轮询一次

        // 设置超时，5分钟后停止轮询
        setTimeout(() => {
            clearInterval(pollInterval);
        }, 5 * 60 * 1000);
    },

    // 重置 iFlow OAuth UI 到初始状态
    resetIflowOAuthUI() {
        const urlInput = document.getElementById('iflow-oauth-url');
        const content = document.getElementById('iflow-oauth-content');
        const status = document.getElementById('iflow-oauth-status');

        // 清空并隐藏授权链接输入框
        if (urlInput) {
            urlInput.value = '';
        }

        // 隐藏整个授权链接内容区域
        if (content) {
            content.style.display = 'none';
        }

        // 清空状态显示
        if (status) {
            status.textContent = '';
            status.style.color = '';
            status.className = '';
        }
    },

    // 提交 iFlow Cookie 登录
    async submitIflowCookieLogin() {
        const cookieInput = document.getElementById('iflow-cookie-input');
        const statusEl = document.getElementById('iflow-cookie-status');
        const submitBtn = document.getElementById('iflow-cookie-submit');
        const cookieValue = cookieInput ? cookieInput.value.trim() : '';

        this.renderIflowCookieResult(null);

        if (!cookieValue) {
            this.showNotification(i18n.t('auth_login.iflow_cookie_required'), 'error');
            if (statusEl) {
                statusEl.textContent = `${i18n.t('auth_login.iflow_cookie_status_error')} ${i18n.t('auth_login.iflow_cookie_required')}`;
                statusEl.style.color = 'var(--error-text)';
            }
            return;
        }

        try {
            if (submitBtn) {
                submitBtn.disabled = true;
            }
            if (statusEl) {
                statusEl.textContent = i18n.t('auth_login.iflow_oauth_status_waiting');
                statusEl.style.color = 'var(--warning-text)';
            }

            const response = await this.makeRequest('/iflow-auth-url', {
                method: 'POST',
                body: JSON.stringify({ cookie: cookieValue })
            });

            this.renderIflowCookieResult(response);
            if (statusEl) {
                statusEl.textContent = i18n.t('auth_login.iflow_cookie_status_success');
                statusEl.style.color = 'var(--success-text)';
            }
            if (cookieInput) {
                cookieInput.value = '';
            }

            this.showNotification(i18n.t('auth_login.iflow_cookie_status_success'), 'success');
            this.loadAuthFiles();
        } catch (error) {
            if (statusEl) {
                statusEl.textContent = `${i18n.t('auth_login.iflow_cookie_status_error')} ${error.message}`;
                statusEl.style.color = 'var(--error-text)';
            }
            this.showNotification(`${i18n.t('auth_login.iflow_cookie_start_error')} ${error.message}`, 'error');
        } finally {
            if (submitBtn) {
                submitBtn.disabled = false;
            }
        }
    },

    renderIflowCookieResult(result = null) {
        const container = document.getElementById('iflow-cookie-result');
        const emailEl = document.getElementById('iflow-cookie-result-email');
        const expiredEl = document.getElementById('iflow-cookie-result-expired');
        const pathEl = document.getElementById('iflow-cookie-result-path');
        const typeEl = document.getElementById('iflow-cookie-result-type');

        if (!container || !emailEl || !expiredEl || !pathEl || !typeEl) {
            return;
        }

        if (!result) {
            container.style.display = 'none';
            emailEl.textContent = '-';
            expiredEl.textContent = '-';
            pathEl.textContent = '-';
            typeEl.textContent = '-';
            return;
        }

        emailEl.textContent = result.email || '-';
        expiredEl.textContent = result.expired || '-';
        pathEl.textContent = result.saved_path || result.savedPath || result.path || '-';
        typeEl.textContent = result.type || '-';
        container.style.display = 'block';
    }
};



// ============ src/modules/usage.js ============
const DEFAULT_MODEL_PRICE_STORAGE_KEY = 'cli-proxy-model-prices-v2';
const LEGACY_MODEL_PRICE_STORAGE_KEY = 'cli-proxy-model-prices';
const TOKENS_PER_PRICE_UNIT = 1_000_000;
const DEFAULT_CHART_LINE_COUNT = 3;
const MIN_CHART_LINE_COUNT = 1;
const ALL_MODELS_VALUE = 'all';

function maskUsageSensitiveValue(value) {
    if (value === null || value === undefined) {
        return '';
    }
    const raw = typeof value === 'string' ? value : String(value);
    if (!raw) {
        return '';
    }
    const maskFn = (this && typeof this.maskApiKey === 'function') ? this.maskApiKey : (v) => v;
    let masked = raw;

    const queryRegex = /([?&])(api[-_]?key|key|token|access_token|authorization)=([^&#\s]+)/ig;
    masked = masked.replace(queryRegex, (full, prefix, keyName, valuePart) => `${prefix}${keyName}=${maskFn(valuePart)}`);

    const headerRegex = /(api[-_]?key|key|token|access[-_]?token|authorization)\s*([:=])\s*([A-Za-z0-9._-]+)/ig;
    masked = masked.replace(headerRegex, (full, keyName, separator, valuePart) => `${keyName}${separator}${maskFn(valuePart)}`);

    const keyLikeRegex = /(sk-[A-Za-z0-9]{6,}|AI[a-zA-Z0-9_-]{6,}|AIza[0-9A-Za-z-_]{8,}|hf_[A-Za-z0-9]{6,}|pk_[A-Za-z0-9]{6,}|rk_[A-Za-z0-9]{6,})/g;
    masked = masked.replace(keyLikeRegex, match => maskFn(match));

    if (masked === raw) {
        const trimmed = raw.trim();
        if (trimmed && !/\s/.test(trimmed)) {
            const looksLikeKey = /^sk-/i.test(trimmed)
                || /^AI/i.test(trimmed)
                || /^AIza/i.test(trimmed)
                || /^hf_/i.test(trimmed)
                || /^pk_/i.test(trimmed)
                || /^rk_/i.test(trimmed)
                || (!/[\\/]/.test(trimmed) && (/\d/.test(trimmed) || trimmed.length >= 10))
                || trimmed.length >= 24;
            if (looksLikeKey) {
                return maskFn(trimmed);
            }
        }
    }

    return masked;
}

// 获取API密钥的统计信息
async function getKeyStats(usageData = null) {
    try {
        let usage = usageData;
        if (!usage) {
            const response = await this.makeRequest('/usage');
            usage = response?.usage || null;
        }

        if (!usage) {
            return { bySource: {}, byAuthIndex: {} };
        }

        const sourceStats = {};
        const authIndexStats = {};
        const ensureBucket = (bucket, key) => {
            if (!bucket[key]) {
                bucket[key] = { success: 0, failure: 0 };
            }
            return bucket[key];
        };
        const normalizeAuthIndex = (value) => {
            if (typeof value === 'number' && Number.isFinite(value)) {
                return value.toString();
            }
            if (typeof value === 'string') {
                const trimmed = value.trim();
                return trimmed ? trimmed : null;
            }
            return null;
        };
        const apis = usage.apis || {};

        Object.values(apis).forEach(apiEntry => {
            const models = apiEntry.models || {};

            Object.values(models).forEach(modelEntry => {
                const details = modelEntry.details || [];

                details.forEach(detail => {
                    const source = this.maskUsageSensitiveValue
                        ? this.maskUsageSensitiveValue(detail.source)
                        : detail.source;
                    const authIndexKey = normalizeAuthIndex(detail?.auth_index);
                    const isFailed = detail.failed === true;

                    if (source) {
                        const bucket = ensureBucket(sourceStats, source);
                        if (isFailed) {
                            bucket.failure += 1;
                        } else {
                            bucket.success += 1;
                        }
                    }

                    if (authIndexKey) {
                        const bucket = ensureBucket(authIndexStats, authIndexKey);
                        if (isFailed) {
                            bucket.failure += 1;
                        } else {
                            bucket.success += 1;
                        }
                    }
                });
            });
        });

        return {
            bySource: sourceStats,
            byAuthIndex: authIndexStats
        };
    } catch (error) {
        console.error('获取统计信息失败:', error);
        return { bySource: {}, byAuthIndex: {} };
    }
}

// 加载使用统计
async function loadUsageStats(usageData = null) {
    try {
        let usage = usageData;
        // 如果没有传入usage数据，则调用API获取
        if (!usage) {
            const response = await this.makeRequest('/usage');
            usage = response?.usage || null;
        }
        this.currentUsageData = usage;
        this.ensureModelPriceState();

        if (!usage) {
            throw new Error('usage payload missing');
        }

        // 更新概览卡片
        this.updateUsageOverview(usage);
        this.renderOverviewSparklines(usage);
        this.updateChartLineSelectors(usage);
        this.renderModelPriceOptions(usage);
        this.renderSavedModelPrices();

        // 读取当前图表周期
        const requestsHourActive = document.getElementById('requests-hour-btn')?.classList.contains('active');
        const tokensHourActive = document.getElementById('tokens-hour-btn')?.classList.contains('active');
        const costHourActive = document.getElementById('cost-hour-btn')?.classList.contains('active');
        const requestsPeriod = requestsHourActive ? 'hour' : 'day';
        const tokensPeriod = tokensHourActive ? 'hour' : 'day';
        const costPeriod = costHourActive ? 'hour' : 'day';

        // 初始化图表（使用当前周期）
        this.initializeRequestsChart(requestsPeriod);
        this.initializeTokensChart(tokensPeriod);
        this.updateCostSummaryAndChart(usage, costPeriod);

        // 更新API详细统计表格
        this.updateApiStatsTable(usage);

    } catch (error) {
        console.error('加载使用统计失败:', error);
        this.currentUsageData = null;
        this.updateChartLineSelectors(null);
        this.ensureModelPriceState();
        this.renderModelPriceOptions(null);
        this.renderSavedModelPrices();
        this.updateCostSummaryAndChart(null);
        this.destroySparklineCharts();

        // 清空概览数据
        ['total-requests', 'success-requests', 'failed-requests', 'total-tokens', 'cached-tokens', 'reasoning-tokens', 'rpm-30m', 'tpm-30m'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.textContent = '-';
        });

        // 清空图表
        if (this.requestsChart) {
            this.requestsChart.destroy();
            this.requestsChart = null;
        }
        if (this.tokensChart) {
            this.tokensChart.destroy();
            this.tokensChart = null;
        }

        const tableElement = document.getElementById('api-stats-table');
        if (tableElement) {
            tableElement.innerHTML = `<div class="no-data-message">${i18n.t('usage_stats.loading_error')}: ${error.message}</div>`;
        }
    }
}

// 更新使用统计概览
function updateUsageOverview(data) {
    const safeData = data || {};
    document.getElementById('total-requests').textContent = safeData.total_requests ?? 0;
    document.getElementById('success-requests').textContent = safeData.success_count ?? 0;
    document.getElementById('failed-requests').textContent = safeData.failure_count ?? 0;
    const totalTokensValue = safeData.total_tokens ?? 0;
    document.getElementById('total-tokens').textContent = this.formatTokensInMillions(totalTokensValue);

    const tokenBreakdown = this.calculateTokenBreakdown(safeData);
    const cachedEl = document.getElementById('cached-tokens');
    const reasoningEl = document.getElementById('reasoning-tokens');
    if (cachedEl) {
        cachedEl.textContent = this.formatTokensInMillions(tokenBreakdown.cachedTokens);
    }
    if (reasoningEl) {
        reasoningEl.textContent = this.formatTokensInMillions(tokenBreakdown.reasoningTokens);
    }

    const recentRate = this.calculateRecentPerMinuteRates(30, safeData);
    document.getElementById('rpm-30m').textContent = this.formatPerMinuteValue(recentRate.rpm);
    document.getElementById('tpm-30m').textContent = this.formatPerMinuteValue(recentRate.tpm);
}

function formatTokensInMillions(value) {
    const num = Number(value);
    if (!Number.isFinite(num)) {
        return '0.00M';
    }
    return `${(num / 1_000_000).toFixed(2)}M`;
}

function formatPerMinuteValue(value) {
    const num = Number(value);
    if (!Number.isFinite(num)) {
        return '0.00';
    }
    const abs = Math.abs(num);
    if (abs >= 1000) {
        return Math.round(num).toLocaleString();
    }
    if (abs >= 100) {
        return num.toFixed(0);
    }
    if (abs >= 10) {
        return num.toFixed(1);
    }
    return num.toFixed(2);
}

function formatCompactNumber(value) {
    const num = Number(value);
    if (!Number.isFinite(num)) {
        return '0';
    }
    const abs = Math.abs(num);
    if (abs >= 1_000_000) {
        return `${(num / 1_000_000).toFixed(1)}M`;
    }
    if (abs >= 1_000) {
        return `${(num / 1_000).toFixed(1)}K`;
    }
    return abs >= 1 ? num.toFixed(0) : num.toFixed(2);
}

function formatCompactNumber(value) {
    const num = Number(value);
    if (!Number.isFinite(num)) {
        return '0';
    }
    const abs = Math.abs(num);
    if (abs >= 1_000_000) {
        return `${(num / 1_000_000).toFixed(1)}M`;
    }
    if (abs >= 1_000) {
        return `${(num / 1_000).toFixed(1)}K`;
    }
    return abs >= 1 ? num.toFixed(0) : num.toFixed(2);
}

function getModelNamesFromUsage(usage) {
    if (!usage) {
        return [];
    }
    const apis = usage.apis || {};
    const names = new Set();
    Object.values(apis).forEach(apiEntry => {
        const models = apiEntry.models || {};
        Object.keys(models).forEach(modelName => {
            if (modelName) {
                names.add(modelName);
            }
        });
    });
    return Array.from(names).sort((a, b) => a.localeCompare(b));
}

function getChartLineMaxCount() {
    const idCount = Array.isArray(this.chartLineSelectIds) ? this.chartLineSelectIds.length : 0;
    const configuredMax = Number(this.chartLineMaxCount);
    const fallback = idCount || DEFAULT_CHART_LINE_COUNT;
    const resolvedMax = Number.isFinite(configuredMax) ? configuredMax : fallback;
    if (idCount > 0) {
        return Math.max(MIN_CHART_LINE_COUNT, Math.min(resolvedMax, idCount));
    }
    return Math.max(MIN_CHART_LINE_COUNT, resolvedMax);
}

function getVisibleChartLineCount() {
    const maxCount = this.getChartLineMaxCount();
    const stored = Number(this.chartLineVisibleCount);
    const base = Number.isFinite(stored)
        ? stored
        : (Array.isArray(this.chartLineSelections) ? this.chartLineSelections.length : DEFAULT_CHART_LINE_COUNT);
    const resolved = Math.min(Math.max(base, MIN_CHART_LINE_COUNT), maxCount);
    this.chartLineVisibleCount = resolved;
    return resolved;
}

function ensureChartLineSelectionLength(targetLength = null) {
    const maxCount = this.getChartLineMaxCount();
    const desiredLength = Math.min(
        Math.max(targetLength ?? this.getVisibleChartLineCount(), MIN_CHART_LINE_COUNT),
        maxCount
    );

    if (!Array.isArray(this.chartLineSelections)) {
        this.chartLineSelections = Array(desiredLength).fill('none');
        return this.chartLineSelections;
    }

    const trimmed = this.chartLineSelections.slice(0, maxCount);
    if (trimmed.length < desiredLength) {
        this.chartLineSelections = [...trimmed, ...Array(desiredLength - trimmed.length).fill('none')];
    } else if (trimmed.length > desiredLength) {
        this.chartLineSelections = trimmed.slice(0, desiredLength);
    } else {
        this.chartLineSelections = trimmed;
    }
    return this.chartLineSelections;
}

function updateChartLineControlsUI() {
    const maxCount = this.getChartLineMaxCount();
    const visibleCount = this.getVisibleChartLineCount();
    const counter = document.getElementById('chart-line-count');
    if (counter) {
        counter.textContent = `${visibleCount}/${maxCount}`;
    }
    const addBtn = document.getElementById('add-chart-line');
    if (addBtn) {
        addBtn.disabled = visibleCount >= maxCount;
    }
    const deleteButtons = document.querySelectorAll('.chart-line-delete');
    if (deleteButtons.length) {
        deleteButtons.forEach(button => {
            const group = button.closest('.chart-line-group');
            const index = Number.parseInt(button.getAttribute('data-line-index'), 10);
            const isVisible = group
                ? !group.classList.contains('chart-line-hidden')
                : (Number.isFinite(index) ? index < visibleCount : true);
            button.disabled = visibleCount <= MIN_CHART_LINE_COUNT || !isVisible;
        });
    }
}

function setChartLineVisibleCount(count) {
    const maxCount = this.getChartLineMaxCount();
    const nextCount = Math.min(Math.max(count, MIN_CHART_LINE_COUNT), maxCount);
    const current = this.getVisibleChartLineCount();
    if (nextCount === current) {
        this.updateChartLineControlsUI();
        return;
    }
    this.chartLineVisibleCount = nextCount;
    this.ensureChartLineSelectionLength(nextCount);
    this.updateChartLineSelectors(this.currentUsageData);
    this.refreshChartsForSelections();
}

function changeChartLineCount(delta = 0) {
    const current = this.getVisibleChartLineCount();
    this.setChartLineVisibleCount(current + delta);
}

function removeChartLine(index) {
    const visibleCount = this.getVisibleChartLineCount();
    const normalizedIndex = Number.parseInt(index, 10);
    if (!Number.isFinite(normalizedIndex) || normalizedIndex < 0 || normalizedIndex >= visibleCount) {
        return;
    }
    if (visibleCount <= MIN_CHART_LINE_COUNT) {
        return;
    }
    const nextSelections = this.ensureChartLineSelectionLength(visibleCount).slice(0, visibleCount);
    nextSelections.splice(normalizedIndex, 1);
    this.chartLineSelections = nextSelections;
    this.chartLineVisibleCount = Math.max(MIN_CHART_LINE_COUNT, visibleCount - 1);
    this.updateChartLineSelectors(this.currentUsageData);
    this.refreshChartsForSelections();
}

function updateChartLineSelectors(usage) {
    const modelNames = this.getModelNamesFromUsage(usage);
    const selectors = this.chartLineSelectIds
        .map(id => document.getElementById(id))
        .filter(Boolean);

    const availableCount = selectors.length || this.getChartLineMaxCount();
    const visibleCount = Math.min(this.getVisibleChartLineCount(), availableCount);
    this.chartLineVisibleCount = visibleCount;
    this.ensureChartLineSelectionLength(visibleCount);
    const wasInitialized = this.chartLineSelectionsInitialized === true;

    if (!selectors.length) {
        this.chartLineSelections = Array(visibleCount).fill('none');
        this.chartLineSelectionsInitialized = false;
        this.updateChartLineControlsUI();
        return;
    }

    const optionsFragment = () => {
        const fragment = document.createDocumentFragment();
        const allOption = document.createElement('option');
        allOption.value = ALL_MODELS_VALUE;
        allOption.textContent = i18n.t('usage_stats.chart_line_all');
        fragment.appendChild(allOption);
        modelNames.forEach(name => {
            const option = document.createElement('option');
            option.value = name;
            option.textContent = name;
            fragment.appendChild(option);
        });
        return fragment;
    };

    const hasModels = modelNames.length > 0;
    selectors.forEach((select, index) => {
        const group = select.closest('.chart-line-group');
        const isVisible = index < visibleCount;
        if (group) {
            group.classList.toggle('chart-line-hidden', !isVisible);
        }
        const deleteBtn = group ? group.querySelector('.chart-line-delete') : null;
        select.innerHTML = '';
        select.appendChild(optionsFragment());
        select.disabled = !isVisible;
        if (deleteBtn) {
            deleteBtn.disabled = !isVisible || visibleCount <= MIN_CHART_LINE_COUNT;
        }
        if (!isVisible) {
            select.value = ALL_MODELS_VALUE;
        }
    });

    if (!hasModels) {
        this.chartLineSelections = Array(visibleCount).fill(ALL_MODELS_VALUE);
        this.chartLineSelectionsInitialized = false;
        selectors.forEach((select, index) => {
            const group = select.closest('.chart-line-group');
            if (group) {
                group.classList.toggle('chart-line-hidden', index >= visibleCount);
            }
            select.value = ALL_MODELS_VALUE;
        });
        this.updateChartLineControlsUI();
        return;
    }

    const nextSelections = this.ensureChartLineSelectionLength(visibleCount).slice(0, visibleCount);

    const validNames = new Set([...modelNames, ALL_MODELS_VALUE]);
    let hasActiveSelection = false;
    for (let i = 0; i < nextSelections.length; i++) {
        const selection = nextSelections[i];
        if (selection && selection !== 'none' && !validNames.has(selection)) {
            nextSelections[i] = ALL_MODELS_VALUE;
        }
        if (nextSelections[i] && nextSelections[i] !== 'none') {
            hasActiveSelection = true;
        }
    }

    const allSelectionsAreAll = nextSelections.length > 0 && nextSelections.every(value => value === ALL_MODELS_VALUE);

    if (!hasActiveSelection || (!wasInitialized && allSelectionsAreAll)) {
        modelNames.slice(0, nextSelections.length).forEach((name, index) => {
            nextSelections[index] = name;
        });
    }

    for (let i = 0; i < nextSelections.length; i++) {
        if (!nextSelections[i] || nextSelections[i] === 'none') {
            nextSelections[i] = modelNames[i % Math.max(modelNames.length, 1)] || ALL_MODELS_VALUE;
        }
    }

    this.chartLineSelections = nextSelections;
    selectors.forEach((select, index) => {
        const value = this.chartLineSelections[index] || ALL_MODELS_VALUE;
        select.value = index < visibleCount ? value : ALL_MODELS_VALUE;
    });
    this.chartLineSelectionsInitialized = hasModels;
    this.updateChartLineControlsUI();
}

function handleChartLineSelectionChange(index, value) {
    const visibleCount = this.getVisibleChartLineCount();
    if (index < 0 || index >= visibleCount) {
        return;
    }
    this.ensureChartLineSelectionLength(visibleCount);
    const normalized = (value && value !== 'none') ? value : ALL_MODELS_VALUE;
    if (this.chartLineSelections[index] === normalized) {
        return;
    }
    this.chartLineSelections[index] = normalized;
    this.refreshChartsForSelections();
}

function refreshChartsForSelections() {
    if (!this.currentUsageData) {
        return;
    }
    const requestsHourActive = document.getElementById('requests-hour-btn')?.classList.contains('active');
    const tokensHourActive = document.getElementById('tokens-hour-btn')?.classList.contains('active');
    const requestsPeriod = requestsHourActive ? 'hour' : 'day';
    const tokensPeriod = tokensHourActive ? 'hour' : 'day';

    if (this.requestsChart) {
        this.requestsChart.data = this.getRequestsChartData(requestsPeriod);
        this.requestsChart.update();
    } else {
        this.initializeRequestsChart(requestsPeriod);
    }

    if (this.tokensChart) {
        this.tokensChart.data = this.getTokensChartData(tokensPeriod);
        this.tokensChart.update();
    } else {
        this.initializeTokensChart(tokensPeriod);
    }
}

function getActiveChartLineSelections() {
    const visibleCount = this.getVisibleChartLineCount();
    const selections = this.ensureChartLineSelectionLength(visibleCount).slice(0, visibleCount);
    return selections
        .map((value, index) => ({ model: value, index }))
        .filter(item => item.model && item.model !== 'none');
}

// 收集所有请求明细，供图表等复用
function collectUsageDetailsFromUsage(usage) {
    if (!usage) {
        return [];
    }
    const apis = usage.apis || {};
    const details = [];
    Object.values(apis).forEach(apiEntry => {
        const models = apiEntry.models || {};
        Object.entries(models).forEach(([modelName, modelEntry]) => {
            const modelDetails = Array.isArray(modelEntry.details) ? modelEntry.details : [];
            modelDetails.forEach(detail => {
                if (detail && detail.timestamp) {
                    details.push({
                        ...detail,
                        __modelName: modelName
                    });
                }
            });
        });
    });
    return details;
}

function collectUsageDetails() {
    return this.collectUsageDetailsFromUsage(this.currentUsageData);
}

function migrateLegacyModelPrices() {
    try {
        if (typeof localStorage === 'undefined') {
            return;
        }
        const storageKey = this.modelPriceStorageKey || DEFAULT_MODEL_PRICE_STORAGE_KEY;
        const hasCurrent = localStorage.getItem(storageKey);
        const legacyRaw = localStorage.getItem(LEGACY_MODEL_PRICE_STORAGE_KEY);

        if (!legacyRaw || hasCurrent) {
            return;
        }

        const parsed = JSON.parse(legacyRaw);
        if (!parsed || typeof parsed !== 'object') {
            return;
        }

        const migrated = {};
        Object.entries(parsed).forEach(([model, price]) => {
            if (!model) return;
            const prompt = Number(price?.prompt);
            const completion = Number(price?.completion);
            const hasPrompt = Number.isFinite(prompt);
            const hasCompletion = Number.isFinite(completion);
            if (!hasPrompt && !hasCompletion) {
                return;
            }
            migrated[model] = {
                prompt: hasPrompt && prompt >= 0 ? prompt * 1000 : 0,
                completion: hasCompletion && completion >= 0 ? completion * 1000 : 0
            };
        });

        if (Object.keys(migrated).length) {
            localStorage.setItem(storageKey, JSON.stringify(migrated));
        }
        localStorage.removeItem(LEGACY_MODEL_PRICE_STORAGE_KEY);
    } catch (error) {
        console.warn('迁移模型价格失败:', error);
    }
}

function ensureModelPriceState() {
    if (this.modelPriceInitialized) {
        return;
    }
    this.modelPriceStorageKey = this.modelPriceStorageKey || DEFAULT_MODEL_PRICE_STORAGE_KEY;
    this.migrateLegacyModelPrices();
    this.modelPrices = this.loadModelPricesFromStorage();
    this.modelPriceInitialized = true;
}

function loadModelPricesFromStorage() {
    const storageKey = this.modelPriceStorageKey || DEFAULT_MODEL_PRICE_STORAGE_KEY;
    try {
        if (typeof localStorage === 'undefined') {
            return {};
        }
        const raw = localStorage.getItem(storageKey);
        if (!raw) {
            return {};
        }
        const parsed = JSON.parse(raw);
        if (!parsed || typeof parsed !== 'object') {
            return {};
        }
        const normalized = {};
        Object.entries(parsed).forEach(([model, price]) => {
            if (!model) return;
            const prompt = Number(price?.prompt);
            const completion = Number(price?.completion);
            if (!Number.isFinite(prompt) && !Number.isFinite(completion)) {
                return;
            }
            normalized[model] = {
                prompt: Number.isFinite(prompt) && prompt >= 0 ? prompt : 0,
                completion: Number.isFinite(completion) && completion >= 0 ? completion : 0
            };
        });
        return normalized;
    } catch (error) {
        console.warn('读取模型价格失败:', error);
        return {};
    }
}

function persistModelPrices(prices = {}) {
    const storageKey = this.modelPriceStorageKey || DEFAULT_MODEL_PRICE_STORAGE_KEY;
    this.modelPrices = prices;
    try {
        if (typeof localStorage === 'undefined') {
            return;
        }
        localStorage.setItem(storageKey, JSON.stringify(prices));
    } catch (error) {
        console.warn('保存模型价格失败:', error);
    }
}

function renderModelPriceOptions(usage = null) {
    const select = document.getElementById('model-price-model-select');
    if (!select) return;
    const models = this.getModelNamesFromUsage(usage);
    const previousValue = select.value;
    select.innerHTML = '';

    const placeholderOption = document.createElement('option');
    placeholderOption.value = '';
    placeholderOption.textContent = i18n.t('usage_stats.model_price_select_placeholder');
    select.appendChild(placeholderOption);

    models.forEach(name => {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        select.appendChild(option);
    });

    select.disabled = models.length === 0;
    if (models.includes(previousValue)) {
        select.value = previousValue;
    } else {
        select.value = '';
    }
    this.prefillModelPriceInputs();
}

function renderSavedModelPrices() {
    const container = document.getElementById('model-price-list');
    if (!container) return;
    const entries = Object.entries(this.modelPrices || {});
    if (!entries.length) {
        container.innerHTML = `<div class="no-data-message">${i18n.t('usage_stats.model_price_empty')}</div>`;
        return;
    }
    const rows = entries.map(([model, price]) => {
        const prompt = Number(price?.prompt) || 0;
        const completion = Number(price?.completion) || 0;
        const safeModel = this.escapeHtml ? this.escapeHtml(model) : model;
        const editArg = JSON.stringify(model).replace(/"/g, '&quot;');
        return `
            <div class="provider-item model-price-item" onclick="manager.handleModelPriceEdit(${editArg})">
                <div class="item-content">
                    <div class="item-title">${safeModel}</div>
                    <div class="item-meta">
                        <span class="stat-badge stat-neutral">${i18n.t('usage_stats.model_price_prompt')}: $${prompt.toFixed(4)} / 1M</span>
                        <span class="stat-badge stat-neutral">${i18n.t('usage_stats.model_price_completion')}: $${completion.toFixed(4)} / 1M</span>
                    </div>
                </div>
                <div class="item-actions">
                    <button class="btn btn-secondary" onclick="event.stopPropagation(); manager.handleModelPriceEdit(${editArg});">
                        <i class="fas fa-edit"></i>
                    </button>
                </div>
            </div>
        `;
    }).join('');

    container.innerHTML = rows;
}

function handleModelPriceEdit(modelName) {
    const model = (modelName || '').trim();
    const select = document.getElementById('model-price-model-select');
    const promptInput = document.getElementById('model-price-prompt');
    const completionInput = document.getElementById('model-price-completion');
    const form = document.getElementById('model-price-form');
    if (!select || !promptInput || !completionInput) {
        return;
    }

    const options = Array.from(select.options).map(opt => opt.value);
    if (model && !options.includes(model)) {
        const opt = document.createElement('option');
        opt.value = model;
        opt.textContent = model;
        select.appendChild(opt);
    }

    select.disabled = false;
    select.value = model;
    const price = this.modelPrices?.[model];
    if (price) {
        promptInput.value = Number.isFinite(price.prompt) ? price.prompt : '';
        completionInput.value = Number.isFinite(price.completion) ? price.completion : '';
    } else {
        promptInput.value = '';
        completionInput.value = '';
    }

    promptInput.focus();
    if (form && typeof form.scrollIntoView === 'function') {
        form.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
}

function prefillModelPriceInputs() {
    const select = document.getElementById('model-price-model-select');
    const promptInput = document.getElementById('model-price-prompt');
    const completionInput = document.getElementById('model-price-completion');
    if (!select || !promptInput || !completionInput) {
        return;
    }
    const model = (select.value || '').trim();
    const price = this.modelPrices?.[model];
    if (price) {
        promptInput.value = Number.isFinite(price.prompt) ? price.prompt : '';
        completionInput.value = Number.isFinite(price.completion) ? price.completion : '';
    } else {
        promptInput.value = '';
        completionInput.value = '';
    }
}

function normalizePriceValue(value) {
    const parsed = Number(value);
    if (!Number.isFinite(parsed) || parsed < 0) {
        return 0;
    }
    return Number(parsed.toFixed(6));
}

function handleModelPriceSubmit() {
    this.ensureModelPriceState();
    const select = document.getElementById('model-price-model-select');
    const promptInput = document.getElementById('model-price-prompt');
    const completionInput = document.getElementById('model-price-completion');
    if (!select || !promptInput || !completionInput) {
        return;
    }

    const model = (select.value || '').trim();
    if (!model) {
        this.showNotification(i18n.t('usage_stats.model_price_model_required'), 'warning');
        return;
    }
    const prompt = this.normalizePriceValue(promptInput.value);
    const completion = this.normalizePriceValue(completionInput.value);

    const next = { ...(this.modelPrices || {}) };
    next[model] = { prompt, completion };
    this.persistModelPrices(next);
    this.renderSavedModelPrices();
    this.updateCostSummaryAndChart(this.currentUsageData, this.getCostChartPeriod());
    this.renderOverviewSparklines(this.currentUsageData);
    this.showNotification(i18n.t('usage_stats.model_price_saved'), 'success');
}

function handleModelPriceReset() {
    this.persistModelPrices({});
    if (typeof localStorage !== 'undefined') {
        const key = this.modelPriceStorageKey || DEFAULT_MODEL_PRICE_STORAGE_KEY;
        try {
            localStorage.removeItem(key);
            localStorage.removeItem(LEGACY_MODEL_PRICE_STORAGE_KEY);
        } catch (error) {
            console.warn('清除模型价格失败:', error);
        }
    }
    this.renderSavedModelPrices();
    this.prefillModelPriceInputs();
    this.updateCostSummaryAndChart(this.currentUsageData, this.getCostChartPeriod());
    this.renderOverviewSparklines(this.currentUsageData);
}

function calculateTokenBreakdown(usage = null) {
    const details = this.collectUsageDetailsFromUsage(usage || this.currentUsageData);
    if (!details.length) {
        return { cachedTokens: 0, reasoningTokens: 0 };
    }

    let cachedTokens = 0;
    let reasoningTokens = 0;

    details.forEach(detail => {
        const tokens = detail?.tokens || {};
        if (typeof tokens.cached_tokens === 'number') {
            cachedTokens += tokens.cached_tokens;
        }
        if (typeof tokens.reasoning_tokens === 'number') {
            reasoningTokens += tokens.reasoning_tokens;
        }
    });

    return { cachedTokens, reasoningTokens };
}

function calculateRecentPerMinuteRates(windowMinutes = 30, usage = null) {
    const details = this.collectUsageDetailsFromUsage(usage || this.currentUsageData);
    const effectiveWindow = Number.isFinite(windowMinutes) && windowMinutes > 0
        ? windowMinutes
        : 30;

    if (!details.length) {
        return { rpm: 0, tpm: 0, windowMinutes: effectiveWindow, requestCount: 0, tokenCount: 0 };
    }

    const now = Date.now();
    const windowStart = now - effectiveWindow * 60 * 1000;
    let requestCount = 0;
    let tokenCount = 0;

    details.forEach(detail => {
        const timestamp = Date.parse(detail.timestamp);
        if (Number.isNaN(timestamp) || timestamp < windowStart) {
            return;
        }
        requestCount += 1;
        tokenCount += this.extractTotalTokens(detail);
    });

    const denominator = effectiveWindow > 0 ? effectiveWindow : 1;
    return {
        rpm: requestCount / denominator,
        tpm: tokenCount / denominator,
        windowMinutes: effectiveWindow,
        requestCount,
        tokenCount
    };
}

function buildRecentWindowSeries(windowMinutes = 30, usage = null, prices = null) {
    const usagePayload = usage || this.currentUsageData;
    const effectiveWindow = Number.isFinite(windowMinutes) && windowMinutes > 0
        ? Math.min(windowMinutes, 720)
        : 30;
    const bucketMs = 60 * 1000;
    const bucketCount = Math.max(1, Math.floor(effectiveWindow));
    const now = Date.now();
    const windowStart = now - bucketCount * bucketMs;
    const labels = Array.from({ length: bucketCount }, (_, index) =>
        this.formatMinuteLabel(new Date(windowStart + index * bucketMs))
    );

    const requestSeries = new Array(bucketCount).fill(0);
    const tokenSeries = new Array(bucketCount).fill(0);
    const costSeries = new Array(bucketCount).fill(0);
    const priceTable = prices || this.modelPrices || {};
    const hasPrices = Object.keys(priceTable).length > 0;

    if (!usagePayload) {
        return {
            labels,
            requests: requestSeries,
            tokens: tokenSeries,
            rpm: requestSeries,
            tpm: tokenSeries,
            cost: costSeries,
            hasPrices
        };
    }

    const details = this.collectUsageDetailsFromUsage(usagePayload);
    const calculateDetailCost = (detail) => {
        if (!hasPrices) {
            return 0;
        }
        const modelName = detail.__modelName || '';
        const price = priceTable[modelName];
        if (!price) {
            return 0;
        }
        const tokens = detail?.tokens || {};
        const promptTokens = Number(tokens.input_tokens) || 0;
        const completionTokens = Number(tokens.output_tokens) || 0;
        const promptCost = (promptTokens / TOKENS_PER_PRICE_UNIT) * (Number(price.prompt) || 0);
        const completionCost = (completionTokens / TOKENS_PER_PRICE_UNIT) * (Number(price.completion) || 0);
        const total = promptCost + completionCost;
        return Number.isFinite(total) && total > 0 ? total : 0;
    };

    details.forEach(detail => {
        const timestamp = Date.parse(detail.timestamp);
        if (Number.isNaN(timestamp) || timestamp < windowStart) {
            return;
        }
        const bucketIndex = Math.min(bucketCount - 1, Math.floor((timestamp - windowStart) / bucketMs));
        if (bucketIndex < 0 || bucketIndex >= bucketCount) {
            return;
        }

        requestSeries[bucketIndex] += 1;
        tokenSeries[bucketIndex] += this.extractTotalTokens(detail);
        costSeries[bucketIndex] += calculateDetailCost(detail);
    });

    return {
        labels,
        requests: requestSeries,
        tokens: tokenSeries,
        rpm: requestSeries,
        tpm: tokenSeries,
        cost: costSeries,
        hasPrices
    };
}

function destroySparklineCharts(targetIds = null) {
    if (!this.sparklineCharts) {
        this.sparklineCharts = {};
    }
    const ids = targetIds && targetIds.length ? targetIds : Object.keys(this.sparklineCharts);
    ids.forEach(id => {
        const chart = this.sparklineCharts[id];
        if (chart && typeof chart.destroy === 'function') {
            chart.destroy();
        }
        delete this.sparklineCharts[id];

        const canvas = document.getElementById(id);
        if (canvas && typeof canvas.getContext === 'function') {
            const ctx = canvas.getContext('2d');
            if (ctx) {
                const width = canvas.width || canvas.clientWidth || 300;
                const height = canvas.height || canvas.clientHeight || 80;
                ctx.clearRect(0, 0, width, height);
            }
        }
    });
}

function renderOverviewSparklines(usage = null) {
    const series = this.buildRecentWindowSeries(30, usage, this.modelPrices);
    const labels = series.labels || [];
    const styleFor = (index = 0) => {
        const fallback = { borderColor: '#3b82f6', backgroundColor: 'rgba(59, 130, 246, 0.15)' };
        if (!Array.isArray(this.chartLineStyles) || !this.chartLineStyles.length) {
            return fallback;
        }
        return this.chartLineStyles[index % this.chartLineStyles.length] || fallback;
    };

    const createSparkline = ({ id, data, styleIndex, requirePrices = false }) => {
        if (requirePrices && !series.hasPrices) {
            this.destroySparklineCharts([id]);
            return;
        }
        const canvas = document.getElementById(id);
        if (!canvas) {
            return;
        }

        const style = styleFor(styleIndex);
        const values = Array.isArray(data) && data.length ? data : [0];
        const maxValue = values.reduce((max, value) => Math.max(max, Number(value) || 0), 0);
        const suggestedMax = maxValue > 0 ? maxValue * 1.2 : 1;

        this.destroySparklineCharts([id]);
        if (!this.sparklineCharts) {
            this.sparklineCharts = {};
        }

        this.sparklineCharts[id] = new Chart(canvas, {
            type: 'line',
            data: {
                labels,
                datasets: [{
                    data: values,
                    borderColor: style.borderColor,
                    backgroundColor: style.backgroundColor,
                    fill: true,
                    tension: 0.35,
                    pointRadius: 0,
                    pointHoverRadius: 3,
                    borderWidth: 2,
                    spanGaps: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: false,
                interaction: { intersect: false, mode: 'index' },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => this.formatCompactNumber(ctx.parsed.y || 0)
                        }
                    }
                },
                layout: { padding: { left: 2, right: 2, top: 6, bottom: 6 } },
                scales: {
                    x: { display: false },
                    y: {
                        display: false,
                        beginAtZero: true,
                        suggestedMin: 0,
                        suggestedMax
                    }
                },
                elements: {
                    line: { borderWidth: 2, tension: 0.35 },
                    point: { radius: 0, hitRadius: 3 }
                }
            }
        });
    };

    createSparkline({ id: 'requests-sparkline', data: series.requests, styleIndex: 0 });
    createSparkline({ id: 'tokens-sparkline', data: series.tokens, styleIndex: 1 });
    createSparkline({ id: 'rpm-sparkline', data: series.rpm, styleIndex: 2 });
    createSparkline({ id: 'tpm-sparkline', data: series.tpm, styleIndex: 3 });
    createSparkline({ id: 'cost-sparkline', data: series.cost, styleIndex: 7, requirePrices: true });
}

function createHourlyBucketMeta() {
    const hourMs = 60 * 60 * 1000;
    const now = new Date();
    const currentHour = new Date(now);
    currentHour.setMinutes(0, 0, 0);

    const earliestBucket = new Date(currentHour);
    earliestBucket.setHours(earliestBucket.getHours() - 23);
    const earliestTime = earliestBucket.getTime();
    const labels = [];
    for (let i = 0; i < 24; i++) {
        const bucketStart = earliestTime + i * hourMs;
        labels.push(this.formatHourLabel(new Date(bucketStart)));
    }

    return {
        labels,
        earliestTime,
        bucketSize: hourMs,
        lastBucketTime: earliestTime + (labels.length - 1) * hourMs
    };
}

function buildHourlySeriesByModel(metric = 'requests') {
    const meta = this.createHourlyBucketMeta();
    const details = this.collectUsageDetails();
    const dataByModel = new Map();
    let hasData = false;

    if (!details.length) {
        return { labels: meta.labels, dataByModel, hasData };
    }

    details.forEach(detail => {
        const timestamp = Date.parse(detail.timestamp);
        if (Number.isNaN(timestamp)) {
            return;
        }

        const normalized = new Date(timestamp);
        normalized.setMinutes(0, 0, 0);
        const bucketStart = normalized.getTime();
        if (bucketStart < meta.earliestTime || bucketStart > meta.lastBucketTime) {
            return;
        }

        const bucketIndex = Math.floor((bucketStart - meta.earliestTime) / meta.bucketSize);
        if (bucketIndex < 0 || bucketIndex >= meta.labels.length) {
            return;
        }

        const modelName = detail.__modelName || 'Unknown';
        if (!dataByModel.has(modelName)) {
            dataByModel.set(modelName, new Array(meta.labels.length).fill(0));
        }

        const bucketValues = dataByModel.get(modelName);
        if (metric === 'tokens') {
            bucketValues[bucketIndex] += this.extractTotalTokens(detail);
        } else {
            bucketValues[bucketIndex] += 1;
        }
        hasData = true;
    });

    return { labels: meta.labels, dataByModel, hasData };
}

function buildDailySeriesByModel(metric = 'requests') {
    const details = this.collectUsageDetails();
    const valuesByModel = new Map();
    const labelsSet = new Set();
    let hasData = false;

    if (!details.length) {
        return { labels: [], dataByModel: new Map(), hasData };
    }

    details.forEach(detail => {
        const timestamp = Date.parse(detail.timestamp);
        if (Number.isNaN(timestamp)) {
            return;
        }
        const dayLabel = this.formatDayLabel(new Date(timestamp));
        if (!dayLabel) {
            return;
        }

        const modelName = detail.__modelName || 'Unknown';
        if (!valuesByModel.has(modelName)) {
            valuesByModel.set(modelName, new Map());
        }
        const modelDayMap = valuesByModel.get(modelName);
        const increment = metric === 'tokens' ? this.extractTotalTokens(detail) : 1;
        modelDayMap.set(dayLabel, (modelDayMap.get(dayLabel) || 0) + increment);
        labelsSet.add(dayLabel);
        hasData = true;
    });

    const labels = Array.from(labelsSet).sort();
    const dataByModel = new Map();
    valuesByModel.forEach((dayMap, modelName) => {
        const series = labels.map(label => dayMap.get(label) || 0);
        dataByModel.set(modelName, series);
    });

    return { labels, dataByModel, hasData };
}

function buildChartDataForMetric(period = 'day', metric = 'requests') {
    const baseSeries = period === 'hour'
        ? this.buildHourlySeriesByModel(metric)
        : this.buildDailySeriesByModel(metric);

    const labels = baseSeries?.labels || [];
    const dataByModel = baseSeries?.dataByModel || new Map();
    const activeSelections = this.getActiveChartLineSelections();
    let allSeriesCache = null;

    const getAllSeries = () => {
        if (allSeriesCache) {
            return allSeriesCache;
        }
        const summed = new Array(labels.length).fill(0);
        dataByModel.forEach(values => {
            values.forEach((value, idx) => {
                summed[idx] = (summed[idx] || 0) + value;
            });
        });
        allSeriesCache = summed;
        return summed;
    };

    const getSeriesForSelection = (selectionValue) => {
        if (selectionValue === ALL_MODELS_VALUE) {
            return getAllSeries();
        }
        return dataByModel.get(selectionValue) || new Array(labels.length).fill(0);
    };

    const datasets = activeSelections.map(selection => {
        const values = getSeriesForSelection(selection.model);
        const style = this.chartLineStyles[selection.index % this.chartLineStyles.length] || this.chartLineStyles[0];
        const label = selection.model === ALL_MODELS_VALUE
            ? i18n.t('usage_stats.chart_line_all')
            : selection.model;
        return {
            label,
            data: values,
            borderColor: style.borderColor,
            backgroundColor: style.backgroundColor,
            fill: false,
            tension: 0.35,
            pointBackgroundColor: style.borderColor,
            pointBorderColor: '#ffffff',
            pointBorderWidth: 2,
            pointRadius: values.some(v => v > 0) ? 4 : 3
        };
    });

    return { labels, datasets };
}

// 统一格式化小时标签
function formatHourLabel(date) {
    if (!(date instanceof Date)) {
        return '';
    }
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const hour = date.getHours().toString().padStart(2, '0');
    return `${month}-${day} ${hour}:00`;
}

function formatMinuteLabel(date) {
    if (!(date instanceof Date)) {
        return '';
    }
    const hour = date.getHours().toString().padStart(2, '0');
    const minute = date.getMinutes().toString().padStart(2, '0');
    return `${hour}:${minute}`;
}

function formatDayLabel(date) {
    if (!(date instanceof Date)) {
        return '';
    }
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    return `${year}-${month}-${day}`;
}

function extractTotalTokens(detail) {
    const tokens = detail?.tokens || {};
    if (typeof tokens.total_tokens === 'number') {
        return tokens.total_tokens;
    }
    const tokenKeys = ['input_tokens', 'output_tokens', 'reasoning_tokens', 'cached_tokens'];
    return tokenKeys.reduce((sum, key) => {
        const value = tokens[key];
        return sum + (typeof value === 'number' ? value : 0);
    }, 0);
}

function formatUsd(value) {
    const num = Number(value);
    if (!Number.isFinite(num)) {
        return '$0.00';
    }
    const fixed = num.toFixed(2);
    const parts = Number(fixed).toLocaleString(undefined, {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    });
    return `$${parts}`;
}

function calculateCostData(prices = null, usage = null, period = 'day') {
    const priceTable = prices || this.modelPrices || {};
    const usagePayload = usage || this.currentUsageData;
    const entries = Object.entries(priceTable || {});
    const result = { totalCost: 0, labels: [], datasets: [] };

    if (!entries.length || !usagePayload) {
        return result;
    }

    const details = this.collectUsageDetailsFromUsage(usagePayload);
    if (!details.length) {
        return result;
    }

    const normalizedDetails = details.map(detail => {
        const modelName = detail.__modelName || 'Unknown';
        const price = priceTable[modelName];
        if (!price) {
            return null;
        }

        const tokens = detail?.tokens || {};
        const promptTokens = Number(tokens.input_tokens) || 0;
        const completionTokens = Number(tokens.output_tokens) || 0;
        const promptCost = (promptTokens / TOKENS_PER_PRICE_UNIT) * (Number(price.prompt) || 0);
        const completionCost = (completionTokens / TOKENS_PER_PRICE_UNIT) * (Number(price.completion) || 0);
        const detailCost = promptCost + completionCost;
        const parsedTimestamp = Date.parse(detail.timestamp);

        if (!Number.isFinite(detailCost) || detailCost <= 0 || Number.isNaN(parsedTimestamp)) {
            return null;
        }

        return { modelName, cost: detailCost, timestamp: parsedTimestamp };
    }).filter(Boolean);

    if (!normalizedDetails.length) {
        return result;
    }

    const totalCost = normalizedDetails.reduce((sum, item) => sum + item.cost, 0);

    if (period === 'hour') {
        const meta = this.createHourlyBucketMeta();
        const dataByModel = new Map();

        normalizedDetails.forEach(({ modelName, cost, timestamp }) => {
            const normalized = new Date(timestamp);
            normalized.setMinutes(0, 0, 0);
            const bucketStart = normalized.getTime();
            if (bucketStart < meta.earliestTime || bucketStart > meta.lastBucketTime) {
                return;
            }
            const bucketIndex = Math.floor((bucketStart - meta.earliestTime) / meta.bucketSize);
            if (bucketIndex < 0 || bucketIndex >= meta.labels.length) {
                return;
            }
            if (!dataByModel.has(modelName)) {
                dataByModel.set(modelName, new Array(meta.labels.length).fill(0));
            }
            const bucketValues = dataByModel.get(modelName);
            bucketValues[bucketIndex] += cost;
        });

        const datasets = [];
        dataByModel.forEach((series, modelName) => {
            datasets.push({ label: modelName, data: series.map(value => Number(value.toFixed(4))) });
        });

        return { totalCost, labels: meta.labels, datasets };
    }

    const labelSet = new Set();
    const costByModelDay = new Map();

    normalizedDetails.forEach(({ modelName, cost, timestamp }) => {
        const dayLabel = this.formatDayLabel(new Date(timestamp));
        if (!dayLabel) {
            return;
        }

        if (!costByModelDay.has(modelName)) {
            costByModelDay.set(modelName, new Map());
        }
        const dayMap = costByModelDay.get(modelName);
        dayMap.set(dayLabel, (dayMap.get(dayLabel) || 0) + cost);
        labelSet.add(dayLabel);
    });

    const labels = Array.from(labelSet).sort();
    const datasets = [];
    costByModelDay.forEach((dayMap, modelName) => {
        const series = labels.map(label => Number((dayMap.get(label) || 0).toFixed(4)));
        datasets.push({ label: modelName, data: series });
    });

    return { totalCost, labels, datasets };
}

function setCostChartPlaceholder(messageKey = null) {
    const placeholder = document.getElementById('cost-chart-placeholder');
    const canvas = document.getElementById('cost-chart');
    if (!placeholder || !canvas) {
        return;
    }
    if (messageKey) {
        placeholder.textContent = i18n.t(messageKey);
        placeholder.style.display = 'flex';
        canvas.style.display = 'none';
    } else {
        placeholder.style.display = 'none';
        canvas.style.display = 'block';
    }
}

function destroyCostChart() {
    if (this.costChart) {
        this.costChart.destroy();
        this.costChart = null;
    }
}

function initializeCostChart(costData, period = 'day') {
    const canvas = document.getElementById('cost-chart');
    if (!canvas) {
        return;
    }
    this.destroyCostChart();

    const datasets = (costData.datasets || []).map((dataset, index) => {
        const style = this.chartLineStyles[index % this.chartLineStyles.length] || this.chartLineStyles[0];
        return {
            ...dataset,
            borderColor: style.borderColor,
            backgroundColor: style.backgroundColor || 'rgba(59, 130, 246, 0.15)',
            fill: true,
            tension: 0.35,
            pointBackgroundColor: style.borderColor,
            pointBorderColor: '#ffffff',
            pointBorderWidth: 2,
            pointRadius: dataset.data.some(v => v > 0) ? 4 : 3
        };
    });

    this.costChart = new Chart(canvas, {
        type: 'line',
        data: {
            labels: costData.labels || [],
            datasets
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                mode: 'index',
                intersect: false
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    align: 'start',
                    labels: {
                        usePointStyle: true
                    }
                },
                tooltip: {
                    callbacks: {
                        label: context => {
                            const label = context.dataset.label || '';
                            const value = Number(context.parsed.y) || 0;
                            return `${label}: ${this.formatUsd(value)}`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: i18n.t(period === 'hour' ? 'usage_stats.by_hour' : 'usage_stats.by_day')
                    }
                },
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: i18n.t('usage_stats.cost_axis_label')
                    },
                    ticks: {
                        callback: (value) => this.formatUsd(value).replace('$', '')
                    }
                }
            },
            elements: {
                line: {
                    borderWidth: 2
                },
                point: {
                    borderWidth: 2
                }
            }
        }
    });
    this.setCostChartPlaceholder(null);
}

function getCostChartPeriod() {
    const costHourActive = document.getElementById('cost-hour-btn')?.classList.contains('active');
    return costHourActive ? 'hour' : 'day';
}

function updateCostSummaryAndChart(usage = null, period = null) {
    this.ensureModelPriceState();
    const totalCostEl = document.getElementById('total-cost');
    const hasPrices = Object.keys(this.modelPrices || {}).length > 0;
    const usagePayload = usage || this.currentUsageData;
    const resolvedPeriod = period || this.getCostChartPeriod();

    if (!hasPrices) {
        if (totalCostEl) {
            totalCostEl.textContent = '--';
        }
        this.destroyCostChart();
        this.setCostChartPlaceholder('usage_stats.cost_need_price');
        return;
    }

    if (!usagePayload) {
        if (totalCostEl) {
            totalCostEl.textContent = '--';
        }
        this.destroyCostChart();
        this.setCostChartPlaceholder('usage_stats.cost_need_usage');
        return;
    }

    const costData = this.calculateCostData(this.modelPrices, usagePayload, resolvedPeriod);
    if (totalCostEl) {
        totalCostEl.textContent = this.formatUsd(costData.totalCost);
    }

    if (!costData.labels.length || !costData.datasets.length) {
        this.destroyCostChart();
        this.setCostChartPlaceholder('usage_stats.cost_no_data');
        return;
    }

    this.initializeCostChart(costData, resolvedPeriod);
}

// 初始化图表
function initializeCharts() {
    const requestsHourActive = document.getElementById('requests-hour-btn')?.classList.contains('active');
    const tokensHourActive = document.getElementById('tokens-hour-btn')?.classList.contains('active');
    const costHourActive = document.getElementById('cost-hour-btn')?.classList.contains('active');
    this.initializeRequestsChart(requestsHourActive ? 'hour' : 'day');
    this.initializeTokensChart(tokensHourActive ? 'hour' : 'day');
    this.updateCostSummaryAndChart(this.currentUsageData, costHourActive ? 'hour' : 'day');
}

// 初始化请求趋势图表
function initializeRequestsChart(period = 'day') {
    const ctx = document.getElementById('requests-chart');
    if (!ctx) return;

    // 销毁现有图表
    if (this.requestsChart) {
        this.requestsChart.destroy();
    }

    const data = this.getRequestsChartData(period);

    this.requestsChart = new Chart(ctx, {
        type: 'line',
        data: data,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                mode: 'index',
                intersect: false
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    align: 'start',
                    labels: {
                        usePointStyle: true
                    }
                }
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: i18n.t(period === 'hour' ? 'usage_stats.by_hour' : 'usage_stats.by_day')
                    }
                },
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: i18n.t('usage_stats.requests_count')
                    }
                }
            },
            elements: {
                line: {
                    tension: 0.35,
                    borderWidth: 2
                },
                point: {
                    borderWidth: 2,
                    radius: 4
                }
            }
        }
    });
}

// 初始化Token使用趋势图表
function initializeTokensChart(period = 'day') {
    const ctx = document.getElementById('tokens-chart');
    if (!ctx) return;

    // 销毁现有图表
    if (this.tokensChart) {
        this.tokensChart.destroy();
    }

    const data = this.getTokensChartData(period);

    this.tokensChart = new Chart(ctx, {
        type: 'line',
        data: data,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                mode: 'index',
                intersect: false
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    align: 'start',
                    labels: {
                        usePointStyle: true
                    }
                }
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: i18n.t(period === 'hour' ? 'usage_stats.by_hour' : 'usage_stats.by_day')
                    }
                },
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: i18n.t('usage_stats.tokens_count')
                    }
                }
            },
            elements: {
                line: {
                    tension: 0.35,
                    borderWidth: 2
                },
                point: {
                    borderWidth: 2,
                    radius: 4
                }
            }
        }
    });
}

// 获取请求图表数据
function getRequestsChartData(period) {
    if (!this.currentUsageData) {
        return { labels: [], datasets: [] };
    }
    return this.buildChartDataForMetric(period, 'requests');
}

// 获取Token图表数据
function getTokensChartData(period) {
    if (!this.currentUsageData) {
        return { labels: [], datasets: [] };
    }
    return this.buildChartDataForMetric(period, 'tokens');
}

// 切换请求图表时间周期
function switchRequestsPeriod(period) {
    // 更新按钮状态
    document.getElementById('requests-hour-btn').classList.toggle('active', period === 'hour');
    document.getElementById('requests-day-btn').classList.toggle('active', period === 'day');

    // 更新图表数据
    if (this.requestsChart) {
        const newData = this.getRequestsChartData(period);
        this.requestsChart.data = newData;
        this.requestsChart.options.scales.x.title.text = i18n.t(period === 'hour' ? 'usage_stats.by_hour' : 'usage_stats.by_day');
        this.requestsChart.update();
    }
}

// 切换Token图表时间周期
function switchTokensPeriod(period) {
    // 更新按钮状态
    document.getElementById('tokens-hour-btn').classList.toggle('active', period === 'hour');
    document.getElementById('tokens-day-btn').classList.toggle('active', period === 'day');

    // 更新图表数据
    if (this.tokensChart) {
        const newData = this.getTokensChartData(period);
        this.tokensChart.data = newData;
        this.tokensChart.options.scales.x.title.text = i18n.t(period === 'hour' ? 'usage_stats.by_hour' : 'usage_stats.by_day');
        this.tokensChart.update();
    }
}

function switchCostPeriod(period) {
    if (period !== 'hour' && period !== 'day') {
        return;
    }
    const hourBtn = document.getElementById('cost-hour-btn');
    const dayBtn = document.getElementById('cost-day-btn');
    if (hourBtn && dayBtn) {
        hourBtn.classList.toggle('active', period === 'hour');
        dayBtn.classList.toggle('active', period === 'day');
    }

    this.updateCostSummaryAndChart(this.currentUsageData, period);
}

// 更新API详细统计表格
function updateApiStatsTable(data) {
    const container = document.getElementById('api-stats-table');
    if (!container) return;

    const apis = data.apis || {};

    if (Object.keys(apis).length === 0) {
        container.innerHTML = `<div class="no-data-message">${i18n.t('usage_stats.no_data')}</div>`;
        return;
    }

    const hasPrices = Object.keys(this.modelPrices || {}).length > 0;
    const calculateEndpointCost = (apiData) => {
        if (!hasPrices) return 0;
        let cost = 0;
        const models = apiData.models || {};
        Object.entries(models).forEach(([modelName, modelData]) => {
            const price = this.modelPrices?.[modelName];
            if (!price) return;
            const details = Array.isArray(modelData.details) ? modelData.details : [];
            details.forEach(detail => {
                const tokens = detail?.tokens || {};
                const promptTokens = Number(tokens.input_tokens) || 0;
                const completionTokens = Number(tokens.output_tokens) || 0;
                const detailCost = (promptTokens / TOKENS_PER_PRICE_UNIT) * (Number(price.prompt) || 0)
                    + (completionTokens / TOKENS_PER_PRICE_UNIT) * (Number(price.completion) || 0);
                if (Number.isFinite(detailCost) && detailCost > 0) {
                    cost += detailCost;
                }
            });
        });
        return Number(cost.toFixed(4));
    };

    let tableHtml = `
        <table class="stats-table">
            <thead>
                <tr>
                    <th>${i18n.t('usage_stats.api_endpoint')}</th>
                    <th>${i18n.t('usage_stats.requests_count')}</th>
                    <th>${i18n.t('usage_stats.tokens_count')}</th>
                    <th>${i18n.t('usage_stats.total_cost')}</th>
                    <th>${i18n.t('usage_stats.models')}</th>
                </tr>
            </thead>
            <tbody>
    `;

    Object.entries(apis).forEach(([endpoint, apiData]) => {
        const totalRequests = apiData.total_requests || 0;
        const endpointCost = calculateEndpointCost(apiData);
        const displayEndpoint = (this.maskUsageSensitiveValue
            ? this.maskUsageSensitiveValue(endpoint)
            : (endpoint ?? '')) || '-';
        const safeEndpoint = this.escapeHtml
            ? this.escapeHtml(displayEndpoint)
            : displayEndpoint;

        // 构建模型详情
        let modelsHtml = '';
        if (apiData.models && Object.keys(apiData.models).length > 0) {
            modelsHtml = '<div class="model-details">';
            Object.entries(apiData.models).forEach(([modelName, modelData]) => {
                const safeModel = this.escapeHtml ? this.escapeHtml(modelName || '') : (modelName || '');
                const modelRequests = modelData.total_requests ?? 0;
                const modelTokens = this.formatTokensInMillions(modelData.total_tokens ?? 0);
                modelsHtml += `
                    <div class="model-item">
                        <span class="model-name">${safeModel}</span>
                        <span>${modelRequests} 请求 / ${modelTokens} tokens</span>
                    </div>
                `;
            });
            modelsHtml += '</div>';
        }

        tableHtml += `
            <tr>
                <td>${safeEndpoint}</td>
                <td>${totalRequests}</td>
                <td>${this.formatTokensInMillions(apiData.total_tokens || 0)}</td>
                <td>${hasPrices && endpointCost > 0 ? this.formatUsd(endpointCost) : '--'}</td>
                <td>${modelsHtml || '-'}</td>
            </tr>
        `;
    });

    tableHtml += '</tbody></table>';
    container.innerHTML = tableHtml;
}

const usageModule = {
    getKeyStats,
    loadUsageStats,
    updateUsageOverview,
    maskUsageSensitiveValue,
    getModelNamesFromUsage,
    getChartLineMaxCount,
    getVisibleChartLineCount,
    ensureChartLineSelectionLength,
    updateChartLineControlsUI,
    setChartLineVisibleCount,
    changeChartLineCount,
    removeChartLine,
    updateChartLineSelectors,
    handleChartLineSelectionChange,
    refreshChartsForSelections,
    getActiveChartLineSelections,
    collectUsageDetailsFromUsage,
    collectUsageDetails,
    migrateLegacyModelPrices,
    ensureModelPriceState,
    loadModelPricesFromStorage,
    persistModelPrices,
    renderModelPriceOptions,
    renderSavedModelPrices,
    handleModelPriceEdit,
    prefillModelPriceInputs,
    normalizePriceValue,
    handleModelPriceSubmit,
    handleModelPriceReset,
    calculateTokenBreakdown,
    calculateRecentPerMinuteRates,
    buildRecentWindowSeries,
    createHourlyBucketMeta,
    buildHourlySeriesByModel,
    buildDailySeriesByModel,
    buildChartDataForMetric,
    formatHourLabel,
    formatMinuteLabel,
    formatTokensInMillions,
    formatPerMinuteValue,
    formatCompactNumber,
    formatDayLabel,
    extractTotalTokens,
    formatUsd,
    calculateCostData,
    getCostChartPeriod,
    setCostChartPlaceholder,
    destroyCostChart,
    destroySparklineCharts,
    renderOverviewSparklines,
    initializeCostChart,
    updateCostSummaryAndChart,
    initializeCharts,
    initializeRequestsChart,
    initializeTokensChart,
    getRequestsChartData,
    getTokensChartData,
    switchRequestsPeriod,
    switchTokensPeriod,
    switchCostPeriod,
    updateApiStatsTable,
    registerUsageListeners
};

// 订阅全局事件，基于配置加载结果渲染使用统计
function registerUsageListeners() {
    if (!this.events || typeof this.events.on !== 'function') {
        return;
    }
    this.events.on('data:config-loaded', (event) => {
        const detail = event?.detail || {};
        const usageData = detail.usageData || null;
        this.loadUsageStats(usageData);
    });
}



// ============ src/modules/settings.js ============
// 设置与开关相关方法模块
// 注意：这些函数依赖于在 CLIProxyManager 实例上提供的 makeRequest/clearCache/showNotification/errorHandler 等基础能力

async function updateDebug(enabled) {
    const previousValue = !enabled;
    try {
        await this.makeRequest('/debug', {
            method: 'PUT',
            body: JSON.stringify({ value: enabled })
        });
        this.clearCache('debug'); // 仅清除 debug 配置段的缓存
        this.showNotification(i18n.t('notification.debug_updated'), 'success');
    } catch (error) {
        this.errorHandler.handleUpdateError(
            error,
            i18n.t('settings.debug_mode') || '调试模式',
            () => document.getElementById('debug-toggle').checked = previousValue
        );
    }
}

async function updateProxyUrl() {
    const proxyUrl = document.getElementById('proxy-url').value.trim();
    const previousValue = document.getElementById('proxy-url').getAttribute('data-previous-value') || '';

    try {
        await this.makeRequest('/proxy-url', {
            method: 'PUT',
            body: JSON.stringify({ value: proxyUrl })
        });
        this.clearCache('proxy-url'); // 仅清除 proxy-url 配置段的缓存
        document.getElementById('proxy-url').setAttribute('data-previous-value', proxyUrl);
        this.showNotification(i18n.t('notification.proxy_updated'), 'success');
    } catch (error) {
        this.errorHandler.handleUpdateError(
            error,
            i18n.t('settings.proxy_url') || '代理设置',
            () => document.getElementById('proxy-url').value = previousValue
        );
    }
}

async function clearProxyUrl() {
    const previousValue = document.getElementById('proxy-url').value;

    try {
        await this.makeRequest('/proxy-url', { method: 'DELETE' });
        document.getElementById('proxy-url').value = '';
        document.getElementById('proxy-url').setAttribute('data-previous-value', '');
        this.clearCache('proxy-url'); // 仅清除 proxy-url 配置段的缓存
        this.showNotification(i18n.t('notification.proxy_cleared'), 'success');
    } catch (error) {
        this.errorHandler.handleUpdateError(
            error,
            i18n.t('settings.proxy_url') || '代理设置',
            () => document.getElementById('proxy-url').value = previousValue
        );
    }
}

async function updateRequestRetry() {
    const retryInput = document.getElementById('request-retry');
    const retryCount = parseInt(retryInput.value);
    const previousValue = retryInput.getAttribute('data-previous-value') || '0';

    try {
        await this.makeRequest('/request-retry', {
            method: 'PUT',
            body: JSON.stringify({ value: retryCount })
        });
        this.clearCache('request-retry'); // 仅清除 request-retry 配置段的缓存
        retryInput.setAttribute('data-previous-value', retryCount.toString());
        this.showNotification(i18n.t('notification.retry_updated'), 'success');
    } catch (error) {
        this.errorHandler.handleUpdateError(
            error,
            i18n.t('settings.request_retry') || '重试设置',
            () => retryInput.value = previousValue
        );
    }
}

async function loadDebugSettings() {
    try {
        const debugValue = await this.getConfig('debug'); // 仅获取 debug 配置段
        if (debugValue !== undefined) {
            document.getElementById('debug-toggle').checked = debugValue;
        }
    } catch (error) {
        this.errorHandler.handleLoadError(error, i18n.t('settings.debug_mode') || '调试设置');
    }
}

async function loadProxySettings() {
    try {
        const proxyUrl = await this.getConfig('proxy-url'); // 仅获取 proxy-url 配置段
        const proxyInput = document.getElementById('proxy-url');
        if (proxyUrl !== undefined) {
            proxyInput.value = proxyUrl || '';
            proxyInput.setAttribute('data-previous-value', proxyUrl || '');
        }
    } catch (error) {
        this.errorHandler.handleLoadError(error, i18n.t('settings.proxy_settings') || '代理设置');
    }
}

async function loadRetrySettings() {
    try {
        const config = await this.getConfig();
        if (config['request-retry'] !== undefined) {
            document.getElementById('request-retry').value = config['request-retry'];
        }
    } catch (error) {
        console.error('加载重试设置失败:', error);
    }
}

async function loadQuotaSettings() {
    try {
        const config = await this.getConfig();
        if (config['quota-exceeded']) {
            if (config['quota-exceeded']['switch-project'] !== undefined) {
                document.getElementById('switch-project-toggle').checked = config['quota-exceeded']['switch-project'];
            }
            if (config['quota-exceeded']['switch-preview-model'] !== undefined) {
                document.getElementById('switch-preview-model-toggle').checked = config['quota-exceeded']['switch-preview-model'];
            }
        }
    } catch (error) {
        console.error('加载配额设置失败:', error);
    }
}

async function loadUsageStatisticsSettings() {
    try {
        const config = await this.getConfig();
        if (config['usage-statistics-enabled'] !== undefined) {
            const usageToggle = document.getElementById('usage-statistics-enabled-toggle');
            if (usageToggle) {
                usageToggle.checked = config['usage-statistics-enabled'];
            }
        }
    } catch (error) {
        console.error('加载使用统计设置失败:', error);
    }
}

async function loadRequestLogSetting() {
    try {
        const config = await this.getConfig();
        if (config['request-log'] !== undefined) {
            const requestLogToggle = document.getElementById('request-log-toggle');
            if (requestLogToggle) {
                requestLogToggle.checked = config['request-log'];
            }
        }
    } catch (error) {
        console.error('加载请求日志设置失败:', error);
    }
}

async function loadWsAuthSetting() {
    try {
        const config = await this.getConfig();
        if (config['ws-auth'] !== undefined) {
            const wsAuthToggle = document.getElementById('ws-auth-toggle');
            if (wsAuthToggle) {
                wsAuthToggle.checked = config['ws-auth'];
            }
        }
    } catch (error) {
        console.error('加载 WebSocket 鉴权设置失败:', error);
    }
}

async function updateUsageStatisticsEnabled(enabled) {
    try {
        await this.makeRequest('/usage-statistics-enabled', {
            method: 'PUT',
            body: JSON.stringify({ value: enabled })
        });
        this.clearCache();
        this.showNotification(i18n.t('notification.usage_statistics_updated'), 'success');
    } catch (error) {
        this.showNotification(`${i18n.t('notification.update_failed')}: ${error.message}`, 'error');
        const usageToggle = document.getElementById('usage-statistics-enabled-toggle');
        if (usageToggle) {
            usageToggle.checked = !enabled;
        }
    }
}

async function updateRequestLog(enabled) {
    try {
        await this.makeRequest('/request-log', {
            method: 'PUT',
            body: JSON.stringify({ value: enabled })
        });
        this.clearCache();
        this.showNotification(i18n.t('notification.request_log_updated'), 'success');
    } catch (error) {
        this.showNotification(`${i18n.t('notification.update_failed')}: ${error.message}`, 'error');
        const requestLogToggle = document.getElementById('request-log-toggle');
        if (requestLogToggle) {
            requestLogToggle.checked = !enabled;
        }
    }
}

async function updateWsAuth(enabled) {
    try {
        await this.makeRequest('/ws-auth', {
            method: 'PUT',
            body: JSON.stringify({ value: enabled })
        });
        this.clearCache();
        this.showNotification(i18n.t('notification.ws_auth_updated'), 'success');
    } catch (error) {
        this.showNotification(`${i18n.t('notification.update_failed')}: ${error.message}`, 'error');
        const wsAuthToggle = document.getElementById('ws-auth-toggle');
        if (wsAuthToggle) {
            wsAuthToggle.checked = !enabled;
        }
    }
}

async function updateLoggingToFile(enabled) {
    try {
        await this.makeRequest('/logging-to-file', {
            method: 'PUT',
            body: JSON.stringify({ value: enabled })
        });
        this.clearCache();
        this.showNotification(i18n.t('notification.logging_to_file_updated'), 'success');
        // 显示或隐藏日志查看栏目
        this.toggleLogsNavItem(enabled);
        // 如果启用了日志记录，自动刷新日志
        if (enabled) {
            setTimeout(() => this.refreshLogs(), 500);
        }
    } catch (error) {
        this.showNotification(`${i18n.t('notification.update_failed')}: ${error.message}`, 'error');
        const loggingToggle = document.getElementById('logging-to-file-toggle');
        if (loggingToggle) {
            loggingToggle.checked = !enabled;
        }
    }
}

async function updateSwitchProject(enabled) {
    try {
        await this.makeRequest('/quota-exceeded/switch-project', {
            method: 'PUT',
            body: JSON.stringify({ value: enabled })
        });
        this.clearCache(); // 清除缓存
        this.showNotification(i18n.t('notification.quota_switch_project_updated'), 'success');
    } catch (error) {
        this.showNotification(`${i18n.t('notification.update_failed')}: ${error.message}`, 'error');
        document.getElementById('switch-project-toggle').checked = !enabled;
    }
}

async function updateSwitchPreviewModel(enabled) {
    try {
        await this.makeRequest('/quota-exceeded/switch-preview-model', {
            method: 'PUT',
            body: JSON.stringify({ value: enabled })
        });
        this.clearCache(); // 清除缓存
        this.showNotification(i18n.t('notification.quota_switch_preview_updated'), 'success');
    } catch (error) {
        this.showNotification(`${i18n.t('notification.update_failed')}: ${error.message}`, 'error');
        document.getElementById('switch-preview-model-toggle').checked = !enabled;
    }
}

// 统一应用配置到界面，供 connection 模块或事件总线调用
async function applySettingsFromConfig(config = {}, keyStats = null) {
    if (!config || typeof config !== 'object') {
        return;
    }

    // 调试设置
    if (config.debug !== undefined) {
        const toggle = document.getElementById('debug-toggle');
        if (toggle) {
            toggle.checked = config.debug;
        }
    }

    // 代理设置
    if (config['proxy-url'] !== undefined) {
        const proxyInput = document.getElementById('proxy-url');
        if (proxyInput) {
            proxyInput.value = config['proxy-url'] || '';
        }
    }

    // 请求重试设置
    if (config['request-retry'] !== undefined) {
        const retryInput = document.getElementById('request-retry');
        if (retryInput) {
            retryInput.value = config['request-retry'];
        }
    }

    // 配额超出行为
    if (config['quota-exceeded']) {
        if (config['quota-exceeded']['switch-project'] !== undefined) {
            const toggle = document.getElementById('switch-project-toggle');
            if (toggle) {
                toggle.checked = config['quota-exceeded']['switch-project'];
            }
        }
        if (config['quota-exceeded']['switch-preview-model'] !== undefined) {
            const toggle = document.getElementById('switch-preview-model-toggle');
            if (toggle) {
                toggle.checked = config['quota-exceeded']['switch-preview-model'];
            }
        }
    }

    if (config['usage-statistics-enabled'] !== undefined) {
        const usageToggle = document.getElementById('usage-statistics-enabled-toggle');
        if (usageToggle) {
            usageToggle.checked = config['usage-statistics-enabled'];
        }
    }

    // 日志记录设置
    if (config['logging-to-file'] !== undefined) {
        const loggingToggle = document.getElementById('logging-to-file-toggle');
        if (loggingToggle) {
            loggingToggle.checked = config['logging-to-file'];
        }
        if (typeof this.toggleLogsNavItem === 'function') {
            this.toggleLogsNavItem(config['logging-to-file']);
        }
    }
    if (config['request-log'] !== undefined) {
        const requestLogToggle = document.getElementById('request-log-toggle');
        if (requestLogToggle) {
            requestLogToggle.checked = config['request-log'];
        }
    }
    if (config['ws-auth'] !== undefined) {
        const wsAuthToggle = document.getElementById('ws-auth-toggle');
        if (wsAuthToggle) {
            wsAuthToggle.checked = config['ws-auth'];
        }
    }

    // API 密钥
    if (config['api-keys'] && typeof this.renderApiKeys === 'function') {
        this.renderApiKeys(config['api-keys']);
    }

    // Gemini keys
    if (typeof this.renderGeminiKeys === 'function') {
        await this.renderGeminiKeys(this.getGeminiKeysFromConfig(config), keyStats);
    }

    // Codex 密钥
    if (typeof this.renderCodexKeys === 'function') {
        await this.renderCodexKeys(Array.isArray(config['codex-api-key']) ? config['codex-api-key'] : [], keyStats);
    }

    // Claude 密钥
    if (typeof this.renderClaudeKeys === 'function') {
        await this.renderClaudeKeys(Array.isArray(config['claude-api-key']) ? config['claude-api-key'] : [], keyStats);
    }

    // OpenAI 兼容提供商
    if (typeof this.renderOpenAIProviders === 'function') {
        await this.renderOpenAIProviders(Array.isArray(config['openai-compatibility']) ? config['openai-compatibility'] : [], keyStats);
    }
}

// 设置模块订阅全局事件，减少与连接层耦合
function registerSettingsListeners() {
    if (!this.events || typeof this.events.on !== 'function') {
        return;
    }
    this.events.on('data:config-loaded', (event) => {
        const detail = event?.detail || {};
        this.applySettingsFromConfig(detail.config || {}, detail.keyStats || null);
    });
}

const settingsModule = {
    updateDebug,
    updateProxyUrl,
    clearProxyUrl,
    updateRequestRetry,
    loadDebugSettings,
    loadProxySettings,
    loadRetrySettings,
    loadQuotaSettings,
    loadUsageStatisticsSettings,
    loadRequestLogSetting,
    loadWsAuthSetting,
    updateUsageStatisticsEnabled,
    updateRequestLog,
    updateWsAuth,
    updateLoggingToFile,
    updateSwitchProject,
    updateSwitchPreviewModel,
    applySettingsFromConfig,
    registerSettingsListeners
};



// ============ src/utils/models.js ============
/**
 * 模型工具函数
 * 提供模型列表的规范化与去重能力
 */
function normalizeModelList(payload, { dedupe = false } = {}) {
    const toModel = (entry) => {
        if (typeof entry === 'string') {
            return { name: entry };
        }
        if (!entry || typeof entry !== 'object') {
            return null;
        }
        const name = entry.id || entry.name || entry.model || entry.value;
        if (!name) return null;

        const alias = entry.alias || entry.display_name || entry.displayName;
        const description = entry.description || entry.note || entry.comment;
        const model = { name: String(name) };
        if (alias && alias !== name) {
            model.alias = String(alias);
        }
        if (description) {
            model.description = String(description);
        }
        return model;
    };

    let models = [];

    if (Array.isArray(payload)) {
        models = payload.map(toModel).filter(Boolean);
    } else if (payload && typeof payload === 'object') {
        if (Array.isArray(payload.data)) {
            models = payload.data.map(toModel).filter(Boolean);
        } else if (Array.isArray(payload.models)) {
            models = payload.models.map(toModel).filter(Boolean);
        }
    }

    if (!dedupe) {
        return models;
    }

    const seen = new Set();
    return models.filter(model => {
        const key = (model?.name || '').toLowerCase();
        if (!key || seen.has(key)) {
            return false;
        }
        seen.add(key);
        return true;
    });
}

const MODEL_CATEGORIES = [
    { id: 'gpt', label: 'GPT', patterns: [/gpt/i, /\bo\d\b/i, /\bo\d+\.?/i, /\bchatgpt/i] },
    { id: 'claude', label: 'Claude', patterns: [/claude/i] },
    { id: 'gemini', label: 'Gemini', patterns: [/gemini/i, /\bgai\b/i] },
    { id: 'kimi', label: 'Kimi', patterns: [/kimi/i] },
    { id: 'qwen', label: 'Qwen', patterns: [/qwen/i] },
    { id: 'glm', label: 'GLM', patterns: [/glm/i, /chatglm/i] },
    { id: 'grok', label: 'Grok', patterns: [/grok/i] },
    { id: 'deepseek', label: 'DeepSeek', patterns: [/deepseek/i] }
];

function matchCategory(text) {
    for (const category of MODEL_CATEGORIES) {
        if (category.patterns.some(pattern => pattern.test(text))) {
            return category.id;
        }
    }
    return null;
}

function classifyModels(models = [], { otherLabel = 'Other' } = {}) {
    const groups = MODEL_CATEGORIES.map(category => ({
        id: category.id,
        label: category.label,
        items: []
    }));

    const otherGroup = { id: 'other', label: otherLabel, items: [] };

    models.forEach(model => {
        const name = (model?.name || '').toString();
        const alias = (model?.alias || '').toString();
        const haystack = `${name} ${alias}`.toLowerCase();
        const matchedId = matchCategory(haystack);
        const target = matchedId ? groups.find(group => group.id === matchedId) : null;

        if (target) {
            target.items.push(model);
        } else {
            otherGroup.items.push(model);
        }
    });

    const populatedGroups = groups.filter(group => group.items.length > 0);
    if (otherGroup.items.length) {
        populatedGroups.push(otherGroup);
    }

    return populatedGroups;
}



// ============ src/modules/ai-providers.js ============
// AI 提供商配置相关方法模块
// 这些函数依赖于 CLIProxyManager 实例上的 makeRequest/getConfig/clearCache/showNotification 等能力，
// 以及 apiKeysModule 中的工具方法（如 applyHeadersToConfig/renderHeaderBadges）。



const getStatsBySource = (stats) => {
    if (stats && typeof stats === 'object' && stats.bySource) {
        return stats.bySource;
    }
    return stats || {};
};

const buildModelEndpoint = (baseUrl) => {
    if (!baseUrl) return '';
    const trimmed = String(baseUrl).trim().replace(/\/+$/g, '');
    if (!trimmed) return '';

    // 如果 base 已以 /v1 结尾，直接拼 /models；否则拼 /v1/models，避免丢失中间路径
    if (trimmed.endsWith('/v1')) {
        return `${trimmed}/models`;
    }
    return `${trimmed}/v1/models`;
};

const buildChatCompletionsEndpoint = (baseUrl) => {
    if (!baseUrl) return '';
    const trimmed = String(baseUrl).trim().replace(/\/+$/g, '');
    if (!trimmed) return '';
    if (trimmed.endsWith('/chat/completions')) {
        return trimmed;
    }
    if (trimmed.endsWith('/v1')) {
        return `${trimmed}/chat/completions`;
    }
    return `${trimmed}/v1/chat/completions`;
};

const normalizeExcludedModels = (input) => {
    const rawList = Array.isArray(input)
        ? input
        : (typeof input === 'string' ? input.split(/[\n,]/) : []);
    const seen = new Set();
    const normalized = [];

    rawList.forEach(item => {
        if (item === undefined || item === null) {
            return;
        }
        const trimmed = String(item).trim();
        if (!trimmed) return;
        const key = trimmed.toLowerCase();
        if (seen.has(key)) return;
        seen.add(key);
        normalized.push(trimmed);
    });

    return normalized;
};

function collectExcludedModels(textareaId) {
    const textarea = document.getElementById(textareaId);
    if (!textarea) return [];
    return normalizeExcludedModels(textarea.value);
}

function setExcludedModelsValue(textareaId, models = []) {
    const textarea = document.getElementById(textareaId);
    if (!textarea) return;
    textarea.value = normalizeExcludedModels(models).join('\n');
}

function renderExcludedModelBadges(models) {
    const normalized = normalizeExcludedModels(models);
    if (!normalized.length) {
        return '';
    }
    const badges = normalized.map(model => `
        <span class="provider-model-tag excluded-model-tag">
            <span class="model-name">${this.escapeHtml(model)}</span>
        </span>
    `).join('');

    return `
            <div class="item-subtitle">${i18n.t('ai_providers.excluded_models_count', { count: normalized.length })}</div>
            <div class="provider-models excluded-models">
                ${badges}
            </div>
        `;
}

async function loadGeminiKeys() {
    try {
        const config = await this.getConfig();
        const keys = this.getGeminiKeysFromConfig(config);
        await this.renderGeminiKeys(keys);
    } catch (error) {
        console.error('加载Gemini密钥失败:', error);
    }
}

function getGeminiKeysFromConfig(config) {
    if (!config) {
        return [];
    }

    const geminiKeys = Array.isArray(config['gemini-api-key']) ? config['gemini-api-key'] : [];
    return geminiKeys;
}

async function renderGeminiKeys(keys, keyStats = null) {
    const container = document.getElementById('gemini-keys-list');
    if (!container) {
        return;
    }
    const normalizedList = (Array.isArray(keys) ? keys : []).map(item => {
        let normalized = null;
        if (item && typeof item === 'object') {
            normalized = { ...item };
        } else if (typeof item === 'string') {
            const trimmed = item.trim();
            if (trimmed) {
                normalized = { 'api-key': trimmed };
            }
        }

        if (normalized && !normalized['base-url'] && normalized['base_url']) {
            normalized['base-url'] = normalized['base_url'];
        }

        return normalized;
    }).filter(config => config && config['api-key']);
    this.cachedGeminiKeys = normalizedList;

    if (normalizedList.length === 0) {
        container.innerHTML = `
                <div class="empty-state">
                    <i class="fab fa-google"></i>
                    <h3>${i18n.t('ai_providers.gemini_empty_title')}</h3>
                    <p>${i18n.t('ai_providers.gemini_empty_desc')}</p>
                </div>
            `;
        return;
    }

    if (!keyStats) {
        keyStats = await this.getKeyStats();
    }
    const statsBySource = getStatsBySource(keyStats);

    container.innerHTML = normalizedList.map((config, index) => {
        const rawKey = config['api-key'] || '';
        const masked = this.maskApiKey(rawKey || '');
        const maskedDisplay = this.escapeHtml(masked);
        const usageStats = (rawKey && (statsBySource[rawKey] || statsBySource[masked])) || { success: 0, failure: 0 };
        const configJson = JSON.stringify(config).replace(/"/g, '&quot;');
        const apiKeyJson = JSON.stringify(rawKey || '').replace(/"/g, '&quot;');
        const baseUrl = config['base-url'] || config['base_url'] || '';
        const excludedModelsHtml = this.renderExcludedModelBadges(config['excluded-models']);
        return `
            <div class="key-item">
                <div class="item-content">
                    <div class="item-title">${i18n.t('ai_providers.gemini_item_title')} #${index + 1}</div>
                    <div class="item-subtitle">${i18n.t('common.api_key')}: ${maskedDisplay}</div>
                    ${baseUrl ? `<div class="item-subtitle">${i18n.t('common.base_url')}: ${this.escapeHtml(baseUrl)}</div>` : ''}
                    ${this.renderHeaderBadges(config.headers)}
                    ${excludedModelsHtml}
                    <div class="item-stats">
                        <span class="stat-badge stat-success">
                            <i class="fas fa-check-circle"></i> ${i18n.t('stats.success')}: ${usageStats.success}
                        </span>
                        <span class="stat-badge stat-failure">
                            <i class="fas fa-times-circle"></i> ${i18n.t('stats.failure')}: ${usageStats.failure}
                        </span>
                    </div>
                </div>
                <div class="item-actions">
                    <button class="btn btn-secondary" onclick="manager.editGeminiKey(${index}, ${configJson})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-danger" onclick="manager.deleteGeminiKey(${apiKeyJson})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        `;
    }).join('');
}

function showAddGeminiKeyModal() {
    const modal = document.getElementById('modal');
    const modalBody = document.getElementById('modal-body');

    modalBody.innerHTML = `
            <h3>${i18n.t('ai_providers.gemini_add_modal_title')}</h3>
            <div class="form-group">
                <label>${i18n.t('ai_providers.gemini_add_modal_key_label')}</label>
                <p class="form-hint">${i18n.t('ai_providers.gemini_add_modal_key_hint')}</p>
                <div id="new-gemini-keys-wrapper" class="api-key-input-list"></div>
                <button type="button" class="btn btn-secondary" onclick="manager.addGeminiKeyField('new-gemini-keys-wrapper')">${i18n.t('ai_providers.gemini_keys_add_btn')}</button>
            </div>
            <div class="form-group">
                <label>${i18n.t('common.custom_headers_label')}</label>
                <p class="form-hint">${i18n.t('common.custom_headers_hint')}</p>
                <div id="new-gemini-headers-wrapper" class="header-input-list"></div>
                <button type="button" class="btn btn-secondary" onclick="manager.addHeaderField('new-gemini-headers-wrapper')">${i18n.t('common.custom_headers_add')}</button>
            </div>
            <div class="form-group">
                <label for="new-gemini-excluded-models">${i18n.t('ai_providers.excluded_models_label')}</label>
                <p class="form-hint">${i18n.t('ai_providers.excluded_models_hint')}</p>
                <textarea id="new-gemini-excluded-models" rows="3" data-i18n-placeholder="ai_providers.excluded_models_placeholder" placeholder="${i18n.t('ai_providers.excluded_models_placeholder')}"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="manager.closeModal()">${i18n.t('common.cancel')}</button>
                <button class="btn btn-primary" onclick="manager.addGeminiKey()">${i18n.t('common.add')}</button>
            </div>
        `;

    modal.style.display = 'block';
    this.populateGeminiKeyFields('new-gemini-keys-wrapper');
    this.populateHeaderFields('new-gemini-headers-wrapper');
    this.setExcludedModelsValue('new-gemini-excluded-models');
}

async function addGeminiKey() {
    const entries = this.collectGeminiKeyFieldInputs('new-gemini-keys-wrapper');
    const headers = this.collectHeaderInputs('new-gemini-headers-wrapper');
    const excludedModels = this.collectExcludedModels('new-gemini-excluded-models');

    if (!entries.length) {
        this.showNotification(i18n.t('notification.gemini_multi_input_required'), 'error');
        return;
    }

    try {
        const data = await this.makeRequest('/gemini-api-key');
        let currentKeys = Array.isArray(data['gemini-api-key']) ? data['gemini-api-key'] : [];
        const existingKeys = new Set(currentKeys.map(item => item && item['api-key']).filter(Boolean));
        const batchSeen = new Set();

        let successCount = 0;
        let skippedCount = 0;
        let failedCount = 0;

        for (const entry of entries) {
            const apiKey = entry['api-key'];
            if (!apiKey) {
                continue;
            }

            if (batchSeen.has(apiKey)) {
                skippedCount++;
                continue;
            }
            batchSeen.add(apiKey);

            if (existingKeys.has(apiKey)) {
                skippedCount++;
                continue;
            }

            const newConfig = { 'api-key': apiKey };
            const baseUrl = entry['base-url'];
            if (baseUrl) {
                newConfig['base-url'] = baseUrl;
            } else {
                delete newConfig['base-url'];
            }
            newConfig['excluded-models'] = excludedModels;
            this.applyHeadersToConfig(newConfig, headers);

            const nextKeys = [...currentKeys, newConfig];

            try {
                await this.makeRequest('/gemini-api-key', {
                    method: 'PUT',
                    body: JSON.stringify(nextKeys)
                });
                currentKeys = nextKeys;
                existingKeys.add(apiKey);
                successCount++;
            } catch (error) {
                failedCount++;
                console.error('Gemini key add failed:', error);
            }
        }

        this.clearCache(); // 清除缓存
        this.closeModal();
        this.loadGeminiKeys();

        if (successCount === 1 && skippedCount === 0 && failedCount === 0) {
            this.showNotification(i18n.t('notification.gemini_key_added'), 'success');
            return;
        }

        const summaryTemplate = i18n.t('notification.gemini_multi_summary');
        const summary = summaryTemplate
            .replace('{success}', successCount)
            .replace('{skipped}', skippedCount)
            .replace('{failed}', failedCount);
        const status = failedCount > 0 ? 'warning' : (successCount > 0 ? 'success' : 'info');
        this.showNotification(summary, status);
    } catch (error) {
        this.showNotification(`${i18n.t('notification.gemini_multi_failed')}: ${error.message}`, 'error');
    }
}

function addGeminiKeyField(wrapperId, entry = {}, options = {}) {
    const wrapper = document.getElementById(wrapperId);
    if (!wrapper) return;

    const row = document.createElement('div');
    row.className = 'api-key-input-row';
    const apiKeyValue = typeof entry?.['api-key'] === 'string' ? entry['api-key'] : '';
    const baseUrlValue = typeof entry?.['base-url'] === 'string'
        ? entry['base-url']
        : (typeof entry?.['base_url'] === 'string' ? entry['base_url'] : '');
    const allowRemoval = options.allowRemoval !== false;
    const removeButtonHtml = allowRemoval
        ? `<button type="button" class="btn btn-small btn-danger gemini-key-remove-btn"><i class="fas fa-trash"></i></button>`
        : '';
    row.innerHTML = `
            <div class="input-group api-key-input-group">
                <input type="text" class="api-key-value-input" placeholder="${i18n.t('ai_providers.gemini_add_modal_key_placeholder')}" value="${this.escapeHtml(apiKeyValue)}">
                <input type="text" class="api-key-proxy-input" placeholder="${i18n.t('ai_providers.gemini_base_url_placeholder')}" value="${this.escapeHtml(baseUrlValue)}">
                ${removeButtonHtml}
            </div>
        `;

    if (allowRemoval) {
        const removeBtn = row.querySelector('.gemini-key-remove-btn');
        if (removeBtn) {
            removeBtn.addEventListener('click', () => {
                wrapper.removeChild(row);
                if (wrapper.childElementCount === 0) {
                    this.addGeminiKeyField(wrapperId, {}, options);
                }
            });
        }
    }

    wrapper.appendChild(row);
}

function populateGeminiKeyFields(wrapperId, entries = [], options = {}) {
    const wrapper = document.getElementById(wrapperId);
    if (!wrapper) return;
    wrapper.innerHTML = '';

    if (!Array.isArray(entries) || entries.length === 0) {
        this.addGeminiKeyField(wrapperId, {}, options);
        return;
    }

    entries.forEach(entry => this.addGeminiKeyField(wrapperId, entry, options));
}

function collectGeminiKeyFieldInputs(wrapperId) {
    const wrapper = document.getElementById(wrapperId);
    if (!wrapper) return [];

    const rows = Array.from(wrapper.querySelectorAll('.api-key-input-row'));
    const entries = [];

    rows.forEach(row => {
        const keyInput = row.querySelector('.api-key-value-input');
        const urlInput = row.querySelector('.api-key-proxy-input');
        const apiKey = keyInput ? keyInput.value.trim() : '';
        const baseUrl = urlInput ? urlInput.value.trim() : '';
        if (apiKey) {
            entries.push({ 'api-key': apiKey, 'base-url': baseUrl });
        }
    });

    return entries;
}

function editGeminiKey(index, config) {
    const modal = document.getElementById('modal');
    const modalBody = document.getElementById('modal-body');
    this.currentGeminiEditConfig = config || {};

    modalBody.innerHTML = `
            <h3>${i18n.t('ai_providers.gemini_edit_modal_title')}</h3>
            <div class="form-group">
                <label>${i18n.t('ai_providers.gemini_edit_modal_key_label')}</label>
                <div id="edit-gemini-keys-wrapper" class="api-key-input-list"></div>
            </div>
            <div class="form-group">
                <label>${i18n.t('common.custom_headers_label')}</label>
                <p class="form-hint">${i18n.t('common.custom_headers_hint')}</p>
                <div id="edit-gemini-headers-wrapper" class="header-input-list"></div>
                <button type="button" class="btn btn-secondary" onclick="manager.addHeaderField('edit-gemini-headers-wrapper')">${i18n.t('common.custom_headers_add')}</button>
            </div>
            <div class="form-group">
                <label for="edit-gemini-excluded-models">${i18n.t('ai_providers.excluded_models_label')}</label>
                <p class="form-hint">${i18n.t('ai_providers.excluded_models_hint')}</p>
                <textarea id="edit-gemini-excluded-models" rows="3" data-i18n-placeholder="ai_providers.excluded_models_placeholder" placeholder="${i18n.t('ai_providers.excluded_models_placeholder')}"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="manager.closeModal()">${i18n.t('common.cancel')}</button>
                <button class="btn btn-primary" onclick="manager.updateGeminiKey(${index})">${i18n.t('common.update')}</button>
            </div>
        `;

    modal.style.display = 'block';
    this.populateGeminiKeyFields('edit-gemini-keys-wrapper', [config], { allowRemoval: false });
    this.populateHeaderFields('edit-gemini-headers-wrapper', config.headers || null);
    this.setExcludedModelsValue('edit-gemini-excluded-models', config['excluded-models'] || []);
}

async function updateGeminiKey(index) {
    const entries = this.collectGeminiKeyFieldInputs('edit-gemini-keys-wrapper');
    if (!entries.length) {
        this.showNotification(i18n.t('notification.please_enter') + ' ' + i18n.t('notification.gemini_api_key'), 'error');
        return;
    }
    const entry = entries[0];
    const newKey = entry['api-key'];
    const baseUrl = entry['base-url'] || '';
    const headers = this.collectHeaderInputs('edit-gemini-headers-wrapper');
    const excludedModels = this.collectExcludedModels('edit-gemini-excluded-models');

    if (!newKey) {
        this.showNotification(i18n.t('notification.please_enter') + ' ' + i18n.t('notification.gemini_api_key'), 'error');
        return;
    }

    try {
        const existingConfig = (this.cachedGeminiKeys && this.cachedGeminiKeys[index]) || this.currentGeminiEditConfig || {};
        const newConfig = { ...existingConfig, 'api-key': newKey };
        if (baseUrl) {
            newConfig['base-url'] = baseUrl;
        } else {
            delete newConfig['base-url'];
        }
        newConfig['excluded-models'] = excludedModels;
        this.applyHeadersToConfig(newConfig, headers);

        await this.makeRequest('/gemini-api-key', {
            method: 'PATCH',
            body: JSON.stringify({ index, value: newConfig })
        });

        this.clearCache(); // 清除缓存
        this.closeModal();
        this.loadGeminiKeys();
        this.currentGeminiEditConfig = null;
        this.showNotification(i18n.t('notification.gemini_key_updated'), 'success');
    } catch (error) {
        this.showNotification(`${i18n.t('notification.update_failed')}: ${error.message}`, 'error');
    }
}

async function deleteGeminiKey(apiKey) {
    if (!confirm(i18n.t('ai_providers.gemini_delete_confirm'))) return;

    try {
        await this.makeRequest(`/gemini-api-key?api-key=${encodeURIComponent(apiKey)}`, { method: 'DELETE' });
        this.clearCache(); // 清除缓存
        this.loadGeminiKeys();
        this.showNotification(i18n.t('notification.gemini_key_deleted'), 'success');
    } catch (error) {
        this.showNotification(`${i18n.t('notification.delete_failed')}: ${error.message}`, 'error');
    }
}

// Codex providers
async function loadCodexKeys() {
    try {
        const config = await this.getConfig();
        const keys = Array.isArray(config['codex-api-key']) ? config['codex-api-key'] : [];
        await this.renderCodexKeys(keys);
    } catch (error) {
        console.error('加载Codex密钥失败:', error);
    }
}

async function renderCodexKeys(keys, keyStats = null) {
    const container = document.getElementById('codex-keys-list');
    if (!container) {
        return;
    }
    const list = Array.isArray(keys) ? keys : [];

    if (list.length === 0) {
        container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-code"></i>
                    <h3>${i18n.t('ai_providers.codex_empty_title')}</h3>
                    <p>${i18n.t('ai_providers.codex_empty_desc')}</p>
                </div>
            `;
        return;
    }

    // 使用传入的keyStats，如果没有则获取一次
    if (!keyStats) {
        keyStats = await this.getKeyStats();
    }
    const statsBySource = getStatsBySource(keyStats);

    container.innerHTML = list.map((config, index) => {
        const rawKey = config['api-key'] || '';
        const masked = this.maskApiKey(rawKey || '');
        const maskedDisplay = this.escapeHtml(masked);
        const usageStats = (rawKey && (statsBySource[rawKey] || statsBySource[masked])) || { success: 0, failure: 0 };
        const deleteArg = JSON.stringify(rawKey).replace(/"/g, '&quot;');
        const excludedModelsHtml = this.renderExcludedModelBadges(config['excluded-models']);
        return `
            <div class="provider-item">
                <div class="item-content">
                    <div class="item-title">${i18n.t('ai_providers.codex_item_title')} #${index + 1}</div>
                    <div class="item-subtitle">${i18n.t('common.api_key')}: ${maskedDisplay}</div>
                    ${config['base-url'] ? `<div class="item-subtitle">${i18n.t('common.base_url')}: ${this.escapeHtml(config['base-url'])}</div>` : ''}
                    ${config['proxy-url'] ? `<div class="item-subtitle">${i18n.t('common.proxy_url')}: ${this.escapeHtml(config['proxy-url'])}</div>` : ''}
                    ${this.renderHeaderBadges(config.headers)}
                    ${excludedModelsHtml}
                    <div class="item-stats">
                        <span class="stat-badge stat-success">
                            <i class="fas fa-check-circle"></i> ${i18n.t('stats.success')}: ${usageStats.success}
                        </span>
                        <span class="stat-badge stat-failure">
                            <i class="fas fa-times-circle"></i> ${i18n.t('stats.failure')}: ${usageStats.failure}
                        </span>
                    </div>
                </div>
                <div class="item-actions">
                    <button class="btn btn-secondary" onclick="manager.editCodexKey(${index}, ${JSON.stringify(config).replace(/\"/g, '&quot;')})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-danger" onclick="manager.deleteCodexKey(${deleteArg})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        `;
    }).join('');
}

function showAddCodexKeyModal() {
    const modal = document.getElementById('modal');
    const modalBody = document.getElementById('modal-body');

    modalBody.innerHTML = `
            <h3>${i18n.t('ai_providers.codex_add_modal_title')}</h3>
            <div class="form-group">
                <label for="new-codex-key">${i18n.t('ai_providers.codex_add_modal_key_label')}</label>
                <input type="text" id="new-codex-key" placeholder="${i18n.t('ai_providers.codex_add_modal_key_placeholder')}">
            </div>
            <div class="form-group">
                <label for="new-codex-url">${i18n.t('ai_providers.codex_add_modal_url_label')}</label>
                <input type="text" id="new-codex-url" placeholder="${i18n.t('ai_providers.codex_add_modal_url_placeholder')}" required>
            </div>
            <div class="form-group">
                <label for="new-codex-proxy">${i18n.t('ai_providers.codex_add_modal_proxy_label')}</label>
                <input type="text" id="new-codex-proxy" placeholder="${i18n.t('ai_providers.codex_add_modal_proxy_placeholder')}">
            </div>
            <div class="form-group">
                <label for="new-codex-excluded-models">${i18n.t('ai_providers.excluded_models_label')}</label>
                <p class="form-hint">${i18n.t('ai_providers.excluded_models_hint')}</p>
                <textarea id="new-codex-excluded-models" rows="3" data-i18n-placeholder="ai_providers.excluded_models_placeholder" placeholder="${i18n.t('ai_providers.excluded_models_placeholder')}"></textarea>
            </div>
            <div class="form-group">
                <label>${i18n.t('common.custom_headers_label')}</label>
                <p class="form-hint">${i18n.t('common.custom_headers_hint')}</p>
                <div id="new-codex-headers-wrapper" class="header-input-list"></div>
                <button type="button" class="btn btn-secondary" onclick="manager.addHeaderField('new-codex-headers-wrapper')">${i18n.t('common.custom_headers_add')}</button>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="manager.closeModal()">${i18n.t('common.cancel')}</button>
                <button class="btn btn-primary" onclick="manager.addCodexKey()">${i18n.t('common.add')}</button>
            </div>
        `;

    modal.style.display = 'block';
    this.populateHeaderFields('new-codex-headers-wrapper');
    this.setExcludedModelsValue('new-codex-excluded-models');
}

async function addCodexKey() {
    const apiKey = document.getElementById('new-codex-key').value.trim();
    const baseUrl = document.getElementById('new-codex-url').value.trim();
    const proxyUrl = document.getElementById('new-codex-proxy').value.trim();
    const headers = this.collectHeaderInputs('new-codex-headers-wrapper');
    const excludedModels = this.collectExcludedModels('new-codex-excluded-models');

    if (!apiKey) {
        this.showNotification(i18n.t('notification.field_required'), 'error');
        return;
    }
    if (!baseUrl) {
        this.showNotification(i18n.t('notification.codex_base_url_required'), 'error');
        return;
    }

    try {
        const data = await this.makeRequest('/codex-api-key');
        const currentKeys = this.normalizeArrayResponse(data, 'codex-api-key').map(item => ({ ...item }));

        const newConfig = this.buildCodexConfig(apiKey, baseUrl, proxyUrl, {}, headers, excludedModels);

        currentKeys.push(newConfig);

        await this.makeRequest('/codex-api-key', {
            method: 'PUT',
            body: JSON.stringify(currentKeys)
        });

        this.clearCache(); // 清除缓存
        this.closeModal();
        this.loadCodexKeys();
        this.showNotification(i18n.t('notification.codex_config_added'), 'success');
    } catch (error) {
        this.showNotification(`${i18n.t('notification.add_failed')}: ${error.message}`, 'error');
    }
}

function editCodexKey(index, config) {
    const modal = document.getElementById('modal');
    const modalBody = document.getElementById('modal-body');

    modalBody.innerHTML = `
            <h3>${i18n.t('ai_providers.codex_edit_modal_title')}</h3>
            <div class="form-group">
                <label for="edit-codex-key">${i18n.t('ai_providers.codex_edit_modal_key_label')}</label>
                <input type="text" id="edit-codex-key" value="${config['api-key']}">
            </div>
            <div class="form-group">
                <label for="edit-codex-url">${i18n.t('ai_providers.codex_edit_modal_url_label')}</label>
                <input type="text" id="edit-codex-url" value="${config['base-url'] || ''}" required>
            </div>
            <div class="form-group">
                <label for="edit-codex-proxy">${i18n.t('ai_providers.codex_edit_modal_proxy_label')}</label>
                <input type="text" id="edit-codex-proxy" value="${config['proxy-url'] || ''}">
            </div>
            <div class="form-group">
                <label for="edit-codex-excluded-models">${i18n.t('ai_providers.excluded_models_label')}</label>
                <p class="form-hint">${i18n.t('ai_providers.excluded_models_hint')}</p>
                <textarea id="edit-codex-excluded-models" rows="3" data-i18n-placeholder="ai_providers.excluded_models_placeholder" placeholder="${i18n.t('ai_providers.excluded_models_placeholder')}"></textarea>
            </div>
            <div class="form-group">
                <label>${i18n.t('common.custom_headers_label')}</label>
                <p class="form-hint">${i18n.t('common.custom_headers_hint')}</p>
                <div id="edit-codex-headers-wrapper" class="header-input-list"></div>
                <button type="button" class="btn btn-secondary" onclick="manager.addHeaderField('edit-codex-headers-wrapper')">${i18n.t('common.custom_headers_add')}</button>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="manager.closeModal()">${i18n.t('common.cancel')}</button>
                <button class="btn btn-primary" onclick="manager.updateCodexKey(${index})">${i18n.t('common.update')}</button>
            </div>
        `;

    modal.style.display = 'block';
    this.populateHeaderFields('edit-codex-headers-wrapper', config.headers || null);
    this.setExcludedModelsValue('edit-codex-excluded-models', config['excluded-models'] || []);
}

async function updateCodexKey(index) {
    const apiKey = document.getElementById('edit-codex-key').value.trim();
    const baseUrl = document.getElementById('edit-codex-url').value.trim();
    const proxyUrl = document.getElementById('edit-codex-proxy').value.trim();
    const headers = this.collectHeaderInputs('edit-codex-headers-wrapper');
    const excludedModels = this.collectExcludedModels('edit-codex-excluded-models');

    if (!apiKey) {
        this.showNotification(i18n.t('notification.field_required'), 'error');
        return;
    }
    if (!baseUrl) {
        this.showNotification(i18n.t('notification.codex_base_url_required'), 'error');
        return;
    }

    try {
        const listResponse = await this.makeRequest('/codex-api-key');
        const currentList = this.normalizeArrayResponse(listResponse, 'codex-api-key');

        if (!Array.isArray(currentList) || index < 0 || index >= currentList.length) {
            throw new Error('Invalid codex configuration index');
        }

        const original = currentList[index] ? { ...currentList[index] } : {};
        const newConfig = this.buildCodexConfig(apiKey, baseUrl, proxyUrl, original, headers, excludedModels);

        await this.makeRequest('/codex-api-key', {
            method: 'PATCH',
            body: JSON.stringify({ index, value: newConfig })
        });

        this.clearCache(); // 清除缓存
        this.closeModal();
        this.loadCodexKeys();
        this.showNotification(i18n.t('notification.codex_config_updated'), 'success');
    } catch (error) {
        this.showNotification(`${i18n.t('notification.update_failed')}: ${error.message}`, 'error');
    }
}

async function deleteCodexKey(apiKey) {
    if (!confirm(i18n.t('ai_providers.codex_delete_confirm'))) return;

    try {
        await this.makeRequest(`/codex-api-key?api-key=${encodeURIComponent(apiKey)}`, { method: 'DELETE' });
        this.clearCache(); // 清除缓存
        this.loadCodexKeys();
        this.showNotification(i18n.t('notification.codex_config_deleted'), 'success');
    } catch (error) {
        this.showNotification(`${i18n.t('notification.delete_failed')}: ${error.message}`, 'error');
    }
}

// Claude providers
async function loadClaudeKeys() {
    try {
        const config = await this.getConfig();
        const keys = Array.isArray(config['claude-api-key']) ? config['claude-api-key'] : [];
        await this.renderClaudeKeys(keys);
    } catch (error) {
        console.error('加载Claude密钥失败:', error);
    }
}

async function renderClaudeKeys(keys, keyStats = null) {
    const container = document.getElementById('claude-keys-list');
    if (!container) {
        return;
    }
    const list = Array.isArray(keys) ? keys : [];

    if (list.length === 0) {
        container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-brain"></i>
                    <h3>${i18n.t('ai_providers.claude_empty_title')}</h3>
                    <p>${i18n.t('ai_providers.claude_empty_desc')}</p>
                </div>
            `;
        return;
    }

    // 使用传入的keyStats，如果没有则获取一次
    if (!keyStats) {
        keyStats = await this.getKeyStats();
    }
    const statsBySource = getStatsBySource(keyStats);

    container.innerHTML = list.map((config, index) => {
        const rawKey = config['api-key'] || '';
        const masked = this.maskApiKey(rawKey || '');
        const maskedDisplay = this.escapeHtml(masked);
        const usageStats = (rawKey && (statsBySource[rawKey] || statsBySource[masked])) || { success: 0, failure: 0 };
        const deleteArg = JSON.stringify(rawKey).replace(/"/g, '&quot;');
        const models = Array.isArray(config.models) ? config.models : [];
        const modelsCountHtml = models.length
            ? `<div class="item-subtitle">${i18n.t('ai_providers.claude_models_count')}: ${models.length}</div>`
            : '';
        const modelsBadgesHtml = this.renderModelBadges(models);
        return `
            <div class="provider-item">
                <div class="item-content">
                    <div class="item-title">${i18n.t('ai_providers.claude_item_title')} #${index + 1}</div>
                    <div class="item-subtitle">${i18n.t('common.api_key')}: ${maskedDisplay}</div>
                    ${config['base-url'] ? `<div class="item-subtitle">${i18n.t('common.base_url')}: ${this.escapeHtml(config['base-url'])}</div>` : ''}
                    ${config['proxy-url'] ? `<div class="item-subtitle">${i18n.t('common.proxy_url')}: ${this.escapeHtml(config['proxy-url'])}</div>` : ''}
                    ${this.renderHeaderBadges(config.headers)}
                    ${modelsCountHtml}
                    ${modelsBadgesHtml}
                    <div class="item-stats">
                        <span class="stat-badge stat-success">
                            <i class="fas fa-check-circle"></i> ${i18n.t('stats.success')}: ${usageStats.success}
                        </span>
                        <span class="stat-badge stat-failure">
                            <i class="fas fa-times-circle"></i> ${i18n.t('stats.failure')}: ${usageStats.failure}
                        </span>
                    </div>
                </div>
                <div class="item-actions">
                    <button class="btn btn-secondary" onclick="manager.editClaudeKey(${index}, ${JSON.stringify(config).replace(/\"/g, '&quot;')})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-danger" onclick="manager.deleteClaudeKey(${deleteArg})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        `;
    }).join('');
}

function showAddClaudeKeyModal() {
    const modal = document.getElementById('modal');
    const modalBody = document.getElementById('modal-body');

    modalBody.innerHTML = `
            <h3>${i18n.t('ai_providers.claude_add_modal_title')}</h3>
            <div class="form-group">
                <label for="new-claude-key">${i18n.t('ai_providers.claude_add_modal_key_label')}</label>
                <input type="text" id="new-claude-key" placeholder="${i18n.t('ai_providers.claude_add_modal_key_placeholder')}">
            </div>
            <div class="form-group">
                <label for="new-claude-url">${i18n.t('ai_providers.claude_add_modal_url_label')}</label>
                <input type="text" id="new-claude-url" placeholder="${i18n.t('ai_providers.claude_add_modal_url_placeholder')}">
            </div>
            <div class="form-group">
                <label for="new-claude-proxy">${i18n.t('ai_providers.claude_add_modal_proxy_label')}</label>
                <input type="text" id="new-claude-proxy" placeholder="${i18n.t('ai_providers.claude_add_modal_proxy_placeholder')}">
            </div>
            <div class="form-group">
                <label>${i18n.t('common.custom_headers_label')}</label>
                <p class="form-hint">${i18n.t('common.custom_headers_hint')}</p>
                <div id="new-claude-headers-wrapper" class="header-input-list"></div>
                <button type="button" class="btn btn-secondary" onclick="manager.addHeaderField('new-claude-headers-wrapper')">${i18n.t('common.custom_headers_add')}</button>
            </div>
            <div class="form-group">
                <label>${i18n.t('ai_providers.claude_models_label')}</label>
                <p class="form-hint">${i18n.t('ai_providers.claude_models_hint')}</p>
                <div id="new-claude-models-wrapper" class="model-input-list"></div>
                <button type="button" class="btn btn-secondary" onclick="manager.addModelField('new-claude-models-wrapper')">${i18n.t('ai_providers.claude_models_add_btn')}</button>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="manager.closeModal()">${i18n.t('common.cancel')}</button>
                <button class="btn btn-primary" onclick="manager.addClaudeKey()">${i18n.t('common.add')}</button>
            </div>
        `;

    modal.style.display = 'block';
    this.populateHeaderFields('new-claude-headers-wrapper');
    this.populateModelFields('new-claude-models-wrapper');
}

async function addClaudeKey() {
    const apiKey = document.getElementById('new-claude-key').value.trim();
    const baseUrl = document.getElementById('new-claude-url').value.trim();
    const proxyUrl = document.getElementById('new-claude-proxy').value.trim();
    const headers = this.collectHeaderInputs('new-claude-headers-wrapper');
    const models = this.collectModelInputs('new-claude-models-wrapper');

    if (!apiKey) {
        this.showNotification(i18n.t('notification.field_required'), 'error');
        return;
    }

    try {
        const data = await this.makeRequest('/claude-api-key');
        const currentKeys = data['claude-api-key'] || [];

        const newConfig = { 'api-key': apiKey };
        if (baseUrl) {
            newConfig['base-url'] = baseUrl;
        }
        if (proxyUrl) {
            newConfig['proxy-url'] = proxyUrl;
        }
        this.applyHeadersToConfig(newConfig, headers);
        if (models.length) {
            newConfig.models = models;
        }

        currentKeys.push(newConfig);

        await this.makeRequest('/claude-api-key', {
            method: 'PUT',
            body: JSON.stringify(currentKeys)
        });

        this.clearCache(); // 清除缓存
        this.closeModal();
        this.loadClaudeKeys();
        this.showNotification(i18n.t('notification.claude_config_added'), 'success');
    } catch (error) {
        this.showNotification(`${i18n.t('notification.add_failed')}: ${error.message}`, 'error');
    }
}

function editClaudeKey(index, config) {
    const modal = document.getElementById('modal');
    const modalBody = document.getElementById('modal-body');

    modalBody.innerHTML = `
            <h3>${i18n.t('ai_providers.claude_edit_modal_title')}</h3>
            <div class="form-group">
                <label for="edit-claude-key">${i18n.t('ai_providers.claude_edit_modal_key_label')}</label>
                <input type="text" id="edit-claude-key" value="${config['api-key']}">
            </div>
            <div class="form-group">
                <label for="edit-claude-url">${i18n.t('ai_providers.claude_edit_modal_url_label')}</label>
                <input type="text" id="edit-claude-url" value="${config['base-url'] || ''}">
            </div>
            <div class="form-group">
                <label for="edit-claude-proxy">${i18n.t('ai_providers.claude_edit_modal_proxy_label')}</label>
                <input type="text" id="edit-claude-proxy" value="${config['proxy-url'] || ''}">
            </div>
            <div class="form-group">
                <label>${i18n.t('common.custom_headers_label')}</label>
                <p class="form-hint">${i18n.t('common.custom_headers_hint')}</p>
                <div id="edit-claude-headers-wrapper" class="header-input-list"></div>
                <button type="button" class="btn btn-secondary" onclick="manager.addHeaderField('edit-claude-headers-wrapper')">${i18n.t('common.custom_headers_add')}</button>
            </div>
            <div class="form-group">
                <label>${i18n.t('ai_providers.claude_models_label')}</label>
                <p class="form-hint">${i18n.t('ai_providers.claude_models_hint')}</p>
                <div id="edit-claude-models-wrapper" class="model-input-list"></div>
                <button type="button" class="btn btn-secondary" onclick="manager.addModelField('edit-claude-models-wrapper')">${i18n.t('ai_providers.claude_models_add_btn')}</button>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="manager.closeModal()">${i18n.t('common.cancel')}</button>
                <button class="btn btn-primary" onclick="manager.updateClaudeKey(${index})">${i18n.t('common.update')}</button>
            </div>
        `;

    modal.style.display = 'block';
    this.populateHeaderFields('edit-claude-headers-wrapper', config.headers || null);
    this.populateModelFields('edit-claude-models-wrapper', Array.isArray(config.models) ? config.models : []);
}

async function updateClaudeKey(index) {
    const apiKey = document.getElementById('edit-claude-key').value.trim();
    const baseUrl = document.getElementById('edit-claude-url').value.trim();
    const proxyUrl = document.getElementById('edit-claude-proxy').value.trim();
    const headers = this.collectHeaderInputs('edit-claude-headers-wrapper');
    const models = this.collectModelInputs('edit-claude-models-wrapper');

    if (!apiKey) {
        this.showNotification(i18n.t('notification.field_required'), 'error');
        return;
    }

    try {
        const newConfig = { 'api-key': apiKey };
        if (baseUrl) {
            newConfig['base-url'] = baseUrl;
        }
        if (proxyUrl) {
            newConfig['proxy-url'] = proxyUrl;
        }
        this.applyHeadersToConfig(newConfig, headers);
        if (models.length) {
            newConfig.models = models;
        }

        await this.makeRequest('/claude-api-key', {
            method: 'PATCH',
            body: JSON.stringify({ index, value: newConfig })
        });

        this.clearCache(); // 清除缓存
        this.closeModal();
        this.loadClaudeKeys();
        this.showNotification(i18n.t('notification.claude_config_updated'), 'success');
    } catch (error) {
        this.showNotification(`${i18n.t('notification.update_failed')}: ${error.message}`, 'error');
    }
}

async function deleteClaudeKey(apiKey) {
    if (!confirm(i18n.t('ai_providers.claude_delete_confirm'))) return;

    try {
        await this.makeRequest(`/claude-api-key?api-key=${encodeURIComponent(apiKey)}`, { method: 'DELETE' });
        this.clearCache(); // 清除缓存
        this.loadClaudeKeys();
        this.showNotification(i18n.t('notification.claude_config_deleted'), 'success');
    } catch (error) {
        this.showNotification(`${i18n.t('notification.delete_failed')}: ${error.message}`, 'error');
    }
}

// OpenAI compatible providers
async function loadOpenAIProviders() {
    try {
        const config = await this.getConfig();
        const providers = Array.isArray(config['openai-compatibility']) ? config['openai-compatibility'] : [];
        await this.renderOpenAIProviders(providers);
    } catch (error) {
        console.error('加载OpenAI提供商失败:', error);
    }
}

async function renderOpenAIProviders(providers, keyStats = null) {
    const container = document.getElementById('openai-providers-list');
    if (!container) {
        return;
    }
    const list = Array.isArray(providers) ? providers : [];

    if (list.length === 0) {
        container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-plug"></i>
                    <h3>${i18n.t('ai_providers.openai_empty_title')}</h3>
                    <p>${i18n.t('ai_providers.openai_empty_desc')}</p>
                </div>
            `;
        // 重置样式
        container.style.maxHeight = '';
        container.style.overflowY = '';
        return;
    }

    // 根据提供商数量设置滚动条
    if (list.length > 5) {
        container.style.maxHeight = '400px';
        container.style.overflowY = 'auto';
    } else {
        container.style.maxHeight = '';
        container.style.overflowY = '';
    }

    // 使用传入的keyStats，如果没有则获取一次
    if (!keyStats) {
        keyStats = await this.getKeyStats();
    }
    const statsBySource = getStatsBySource(keyStats);

    container.innerHTML = list.map((provider, index) => {
        const item = typeof provider === 'object' && provider !== null ? provider : {};

        // 处理两种API密钥格式：新的 api-key-entries 和旧的 api-keys
        let apiKeyEntries = [];
        if (Array.isArray(item['api-key-entries'])) {
            // 新格式：{api-key: "...", proxy-url: "..."}
            apiKeyEntries = item['api-key-entries'];
        } else if (Array.isArray(item['api-keys'])) {
            // 旧格式：简单的字符串数组
            apiKeyEntries = item['api-keys'].map(key => ({ 'api-key': key }));
        }

        const models = Array.isArray(item.models) ? item.models : [];
        const name = item.name || '';
        const baseUrl = item['base-url'] || '';

        let totalSuccess = 0;
        let totalFailure = 0;

        apiKeyEntries.forEach(entry => {
            const key = entry && entry['api-key'] ? entry['api-key'] : '';
            if (!key) return;
            const masked = this.maskApiKey(key);
            const usageStats = statsBySource[key] || statsBySource[masked] || { success: 0, failure: 0 };
            totalSuccess += usageStats.success;
            totalFailure += usageStats.failure;
        });

        const deleteArg = JSON.stringify(name).replace(/"/g, '&quot;');
        return `
            <div class="provider-item">
                <div class="item-content">
                    <div class="item-title">${this.escapeHtml(name)}</div>
                    <div class="item-subtitle provider-base-url" title="${this.escapeHtml(baseUrl)}">${i18n.t('common.base_url')}: ${this.escapeHtml(baseUrl)}</div>
                    ${this.renderHeaderBadges(item.headers)}
                    <div class="item-subtitle">${i18n.t('ai_providers.openai_keys_count')}: ${apiKeyEntries.length}</div>
                    <div class="item-subtitle">${i18n.t('ai_providers.openai_models_count')}: ${models.length}</div>
                    ${this.renderModelBadges(models)}
                    <div class="item-stats">
                        <span class="stat-badge stat-success">
                            <i class="fas fa-check-circle"></i> ${i18n.t('stats.success')}: ${totalSuccess}
                        </span>
                        <span class="stat-badge stat-failure">
                            <i class="fas fa-times-circle"></i> ${i18n.t('stats.failure')}: ${totalFailure}
                        </span>
                    </div>
                </div>
                <div class="item-actions">
                    <button class="btn btn-secondary" onclick="manager.editOpenAIProvider(${index}, ${JSON.stringify(item).replace(/\"/g, '&quot;')})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-danger" onclick="manager.deleteOpenAIProvider(${deleteArg})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        `;
    }).join('');
}

const getOpenAIContext = (mode = 'new') => {
    const isEdit = mode === 'edit';
    return {
        mode: isEdit ? 'edit' : 'new',
        baseUrlInputId: isEdit ? 'edit-provider-url' : 'new-provider-url',
        apiKeyWrapperId: isEdit ? 'edit-openai-keys-wrapper' : 'new-openai-keys-wrapper',
        headerWrapperId: isEdit ? 'edit-openai-headers-wrapper' : 'new-openai-headers-wrapper',
        modelWrapperId: isEdit ? 'edit-provider-models-wrapper' : 'new-provider-models-wrapper'
    };
};

function ensureOpenAIModelDiscoveryCard(manager) {
    let overlay = document.getElementById('openai-model-discovery');
    if (overlay) {
        return overlay;
    }

    overlay = document.createElement('div');
    overlay.id = 'openai-model-discovery';
    overlay.className = 'model-discovery-overlay';
    overlay.innerHTML = `
        <div class="model-discovery-card">
            <div class="model-discovery-header">
                <div class="model-discovery-title">
                    <h3>${i18n.t('ai_providers.openai_models_fetch_title')}</h3>
                    <p class="form-hint">${i18n.t('ai_providers.openai_models_fetch_hint')}</p>
                </div>
                <button type="button" class="btn btn-secondary" id="openai-model-discovery-back">${i18n.t('ai_providers.openai_models_fetch_back')}</button>
            </div>
            <div class="form-group">
                <label>${i18n.t('ai_providers.openai_models_fetch_url_label')}</label>
                <div class="input-group">
                    <input type="text" id="openai-model-discovery-url" readonly>
                    <button type="button" class="btn btn-secondary" id="openai-model-discovery-refresh">${i18n.t('ai_providers.openai_models_fetch_refresh')}</button>
                </div>
            </div>
            <div class="form-group">
                <label for="openai-model-discovery-search">${i18n.t('ai_providers.openai_models_search_label')}</label>
                <input type="text" id="openai-model-discovery-search" placeholder="${i18n.t('ai_providers.openai_models_search_placeholder')}">
            </div>
            <div id="openai-model-discovery-status" class="model-discovery-status"></div>
            <div id="openai-model-discovery-list" class="model-discovery-list"></div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="openai-model-discovery-cancel">${i18n.t('common.cancel')}</button>
                <button class="btn btn-primary" id="openai-model-discovery-apply">${i18n.t('ai_providers.openai_models_fetch_apply')}</button>
            </div>
        </div>
    `;

    document.body.appendChild(overlay);

    const bind = (id, handler) => {
        const el = document.getElementById(id);
        if (el) {
            el.addEventListener('click', handler);
        }
    };

    bind('openai-model-discovery-back', () => manager.closeOpenAIModelDiscovery());
    bind('openai-model-discovery-cancel', () => manager.closeOpenAIModelDiscovery());
    bind('openai-model-discovery-refresh', () => manager.refreshOpenAIModelDiscovery());
    bind('openai-model-discovery-apply', () => manager.applyOpenAIModelDiscoverySelection());
    const searchInput = document.getElementById('openai-model-discovery-search');
    if (searchInput) {
        searchInput.addEventListener('input', (event) => {
            const query = event?.target?.value || '';
            manager.setOpenAIModelDiscoverySearch(query);
        });
    }

    return overlay;
}

function setOpenAIModelDiscoveryStatus(message = '', type = 'info') {
    const status = document.getElementById('openai-model-discovery-status');
    if (!status) return;
    status.textContent = message;
    status.className = `model-discovery-status ${type}`;
}

function setOpenAIModelDiscoverySearch(query = '') {
    if (!this.openAIModelDiscoveryContext) return;
    const normalized = (query || '').trim();
    this.openAIModelDiscoveryContext.modelSearchQuery = normalized;
    const models = this.openAIModelDiscoveryContext.discoveredModels || [];
    this.renderOpenAIModelDiscoveryList(models);
}

function renderOpenAIModelDiscoveryList(models = []) {
    const list = document.getElementById('openai-model-discovery-list');
    if (!list) return;

    const context = this.openAIModelDiscoveryContext || {};
    const filter = (context.modelSearchQuery || '').trim().toLowerCase();
    const filtered = models
        .map((model, index) => ({ model, index }))
        .filter(({ model }) => {
            if (!filter) return true;
            const name = (model?.name || '').toLowerCase();
            const alias = (model?.alias || '').toLowerCase();
            const desc = (model?.description || '').toLowerCase();
            return name.includes(filter) || alias.includes(filter) || desc.includes(filter);
        });

    if (!models.length) {
        list.innerHTML = `
            <div class="model-discovery-empty">
                <i class="fas fa-box-open"></i>
                <span>${i18n.t('ai_providers.openai_models_fetch_empty')}</span>
            </div>
        `;
        return;
    }

    if (!filtered.length) {
        list.innerHTML = `
            <div class="model-discovery-empty">
                <i class="fas fa-search"></i>
                <span>${i18n.t('ai_providers.openai_models_search_empty')}</span>
            </div>
        `;
        return;
    }

    list.innerHTML = filtered.map(({ model, index }) => {
        const name = this.escapeHtml(model?.name || '');
        const alias = model?.alias ? `<span class="model-discovery-alias">${this.escapeHtml(model.alias)}</span>` : '';
        const desc = model?.description ? `<div class="model-discovery-desc">${this.escapeHtml(model.description)}</div>` : '';
        return `
            <label class="model-discovery-row">
                <input type="checkbox" class="model-discovery-checkbox" data-model-index="${index}">
                <div class="model-discovery-meta">
                    <div class="model-discovery-name">${name} ${alias}</div>
                    ${desc}
                </div>
            </label>
        `;
    }).join('');
}

function openOpenAIModelDiscovery(mode = 'new') {
    const context = getOpenAIContext(mode);
    const baseInput = document.getElementById(context.baseUrlInputId);
    const baseUrl = baseInput ? baseInput.value.trim() : '';

    if (!baseUrl) {
        this.showNotification(i18n.t('ai_providers.openai_models_fetch_invalid_url'), 'error');
        return;
    }

    const endpoint = buildModelEndpoint(baseUrl);
    if (!endpoint) {
        this.showNotification(i18n.t('ai_providers.openai_models_fetch_invalid_url'), 'error');
        return;
    }

    const apiKeyEntries = this.collectApiKeyEntryInputs(context.apiKeyWrapperId);
    const firstKey = Array.isArray(apiKeyEntries) ? apiKeyEntries.find(entry => entry && entry['api-key']) : null;
    const headers = this.collectHeaderInputs(context.headerWrapperId) || {};

    if (firstKey && !headers.Authorization && !headers.authorization) {
        headers.Authorization = `Bearer ${firstKey['api-key']}`;
    }

    ensureOpenAIModelDiscoveryCard(this).classList.add('active');
    this.openAIModelDiscoveryContext = {
        ...context,
        endpoint,
        headers,
        discoveredModels: [],
        modelSearchQuery: ''
    };

    const urlInput = document.getElementById('openai-model-discovery-url');
    if (urlInput) {
        urlInput.value = endpoint;
    }
    const searchInput = document.getElementById('openai-model-discovery-search');
    if (searchInput) {
        searchInput.value = '';
    }

    this.renderOpenAIModelDiscoveryList([]);
    this.setOpenAIModelDiscoveryStatus(i18n.t('ai_providers.openai_models_fetch_loading'), 'info');
    this.refreshOpenAIModelDiscovery();
}

async function refreshOpenAIModelDiscovery() {
    const context = this.openAIModelDiscoveryContext;
    if (!context || !context.endpoint) {
        return;
    }

    this.setOpenAIModelDiscoveryStatus(i18n.t('ai_providers.openai_models_fetch_loading'), 'info');
    const list = document.getElementById('openai-model-discovery-list');
    if (list) {
        list.innerHTML = '<div class="model-discovery-empty"><i class="fas fa-spinner fa-spin"></i></div>';
    }

    try {
        let response;
        let usedSimpleRequest = false;

        try {
            // 首先尝试正常的带自定义headers的请求
            response = await fetch(context.endpoint, {
                headers: context.headers || {}
            });
        } catch (error) {
            // 如果fetch失败(通常是CORS预检失败),尝试简单GET请求
            console.warn('Normal fetch failed, trying simple GET request:', error);
            usedSimpleRequest = true;
            response = await fetch(context.endpoint, {
                method: 'GET',
                mode: 'cors',
                credentials: 'omit'
                // 不发送自定义headers,避免触发OPTIONS预检
            });
        }

        if (!response.ok) {
            throw new Error(`${response.status} ${response.statusText}`);
        }

        let data;
        try {
            data = await response.json();
        } catch (err) {
            const text = await response.text();
            throw new Error(text || err.message || 'Invalid JSON');
        }

        const models = normalizeModelList(data);
        context.discoveredModels = models;

        this.renderOpenAIModelDiscoveryList(models);
        if (!models.length) {
            this.setOpenAIModelDiscoveryStatus(i18n.t('ai_providers.openai_models_fetch_empty'), 'warning');
        } else {
            if (usedSimpleRequest) {
                // 如果使用了简单请求,提示用户
                console.info('Models fetched using simple request (without custom headers)');
            }
            this.setOpenAIModelDiscoveryStatus('', 'info');
        }
    } catch (error) {
        context.discoveredModels = [];
        this.renderOpenAIModelDiscoveryList([]);
        this.setOpenAIModelDiscoveryStatus(`${i18n.t('ai_providers.openai_models_fetch_error')}: ${error.message}`, 'error');
    }
}

function applyOpenAIModelDiscoverySelection() {
    const context = this.openAIModelDiscoveryContext;
    if (!context || !Array.isArray(context.discoveredModels) || !context.discoveredModels.length) {
        this.closeOpenAIModelDiscovery();
        return;
    }

    const list = document.getElementById('openai-model-discovery-list');
    if (!list) {
        this.closeOpenAIModelDiscovery();
        return;
    }

    const selectedIndices = Array.from(list.querySelectorAll('.model-discovery-checkbox:checked'))
        .map(input => Number.parseInt(input.getAttribute('data-model-index') || '-1', 10))
        .filter(index => Number.isFinite(index) && index >= 0 && index < context.discoveredModels.length);

    const selectedModels = selectedIndices.map(index => context.discoveredModels[index]);
    if (!selectedModels.length) {
        this.closeOpenAIModelDiscovery();
        return;
    }

    const existing = this.collectModelInputs(context.modelWrapperId);
    const mergedMap = new Map();
    existing.forEach(model => {
        if (model && model.name) {
            mergedMap.set(model.name, { ...model });
        }
    });

    let addedCount = 0;
    selectedModels.forEach(model => {
        const name = model && model.name;
        if (!name) return;
        if (!mergedMap.has(name)) {
            mergedMap.set(name, { name, ...(model.alias ? { alias: model.alias } : {}) });
            addedCount++;
        }
    });

    this.populateModelFields(context.modelWrapperId, Array.from(mergedMap.values()));
    if (context.mode === 'edit' && typeof this.populateOpenAITestModelOptions === 'function') {
        this.populateOpenAITestModelOptions(Array.from(mergedMap.values()), { preserveInput: true });
    }
    this.closeOpenAIModelDiscovery();

    if (addedCount > 0) {
        const template = i18n.t('ai_providers.openai_models_fetch_added');
        const message = template.replace('{count}', addedCount);
        this.showNotification(message, 'success');
    }
}

function closeOpenAIModelDiscovery() {
    const overlay = document.getElementById('openai-model-discovery');
    if (overlay) {
        overlay.classList.remove('active');
    }
    this.openAIModelDiscoveryContext = null;
}

function populateOpenAITestModelOptions(models = [], { preserveInput = true } = {}) {
    const select = document.getElementById('openai-test-model-select');
    const input = document.getElementById('openai-test-model-input');
    if (!select) return;

    const names = [];
    const seen = new Set();
    (Array.isArray(models) ? models : []).forEach(model => {
        const name = model?.name ? String(model.name).trim() : '';
        if (!name || seen.has(name)) return;
        seen.add(name);
        names.push(name);
    });

    if (!names.length) {
        select.disabled = true;
        select.innerHTML = `<option value="">${i18n.t('ai_providers.openai_test_select_empty')}</option>`;
        if (input && !preserveInput) {
            input.value = '';
        }
        return;
    }

    select.disabled = false;
    const placeholder = `<option value="">${i18n.t('ai_providers.openai_test_select_placeholder')}</option>`;
    const options = names.map(name => `<option value="${this.escapeHtml(name)}">${this.escapeHtml(name)}</option>`).join('');
    select.innerHTML = `${placeholder}${options}`;

    if (input) {
        if (!preserveInput || !input.value) {
            const firstName = names[0];
            if (firstName) {
                input.value = firstName;
                select.value = firstName;
                return;
            }
        }

        const current = input.value.trim();
        if (current && names.includes(current)) {
            select.value = current;
        } else {
            select.value = '';
        }
    }
}

function setOpenAITestStatus(message = '', type = 'info') {
    const statusEl = document.getElementById('openai-test-status');
    if (!statusEl) return;
    statusEl.textContent = message || '';
    statusEl.className = `openai-test-status ${type || ''}`.trim();
}

const setOpenAITestButtonState = (state = 'idle') => {
    const button = document.getElementById('openai-test-button');
    if (!button) return;
    button.disabled = state === 'loading';
    button.classList.remove('openai-test-btn-success', 'openai-test-btn-error');

    switch (state) {
        case 'loading':
            button.innerHTML = `<i class="fas fa-spinner fa-spin"></i>`;
            break;
        case 'success':
            button.classList.add('openai-test-btn-success');
            button.innerHTML = `<i class="fas fa-check"></i>`;
            break;
        case 'error':
            button.classList.add('openai-test-btn-error');
            button.innerHTML = `<i class="fas fa-times"></i>`;
            break;
        default:
            button.innerHTML = `<i class="fas fa-stethoscope"></i> ${i18n.t('ai_providers.openai_test_action')}`;
            break;
    }
};

async function testOpenAIProviderConnection() {
    const baseUrlInput = document.getElementById('edit-provider-url');
    const baseUrl = baseUrlInput ? baseUrlInput.value.trim() : '';
    if (!baseUrl) {
        const message = i18n.t('notification.openai_test_url_required');
        this.setOpenAITestStatus(message, 'error');
        this.showNotification(message, 'error');
        return;
    }

    const endpoint = buildChatCompletionsEndpoint(baseUrl);
    if (!endpoint) {
        const message = i18n.t('notification.openai_test_url_required');
        this.setOpenAITestStatus(message, 'error');
        this.showNotification(message, 'error');
        return;
    }

    const apiKeyEntries = this.collectApiKeyEntryInputs('edit-openai-keys-wrapper');
    const firstKeyEntry = Array.isArray(apiKeyEntries) ? apiKeyEntries.find(entry => entry && entry['api-key']) : null;
    if (!firstKeyEntry) {
        const message = i18n.t('notification.openai_test_key_required');
        this.setOpenAITestStatus(message, 'error');
        this.showNotification(message, 'error');
        return;
    }

    const models = this.collectModelInputs('edit-provider-models-wrapper');
    this.populateOpenAITestModelOptions(models);

    const modelInput = document.getElementById('openai-test-model-input');
    let modelName = modelInput ? modelInput.value.trim() : '';
    if (!modelName) {
        const firstModel = Array.isArray(models) ? models.find(model => model && model.name) : null;
        if (firstModel && firstModel.name) {
            modelName = firstModel.name;
            if (modelInput) {
                modelInput.value = firstModel.name;
            }
        }
    }

    if (!modelName) {
        const message = i18n.t('notification.openai_test_model_required');
        this.setOpenAITestStatus(message, 'error');
        this.showNotification(message, 'error');
        return;
    }

    const customHeaders = this.collectHeaderInputs('edit-openai-headers-wrapper') || {};
    const headers = {
        'Content-Type': 'application/json',
        ...customHeaders
    };
    if (!headers.Authorization && !headers.authorization) {
        headers.Authorization = `Bearer ${firstKeyEntry['api-key']}`;
    }

    this.setOpenAITestStatus('', 'info');
    setOpenAITestButtonState('loading');

    try {
        const response = await fetch(endpoint, {
            method: 'POST',
            headers,
            body: JSON.stringify({
                model: modelName,
                messages: [{ role: 'user', content: 'Hi' }],
                stream: false,
                max_tokens: 5
            })
        });

        const rawText = await response.text();

        if (!response.ok) {
            let errorMessage = `${response.status} ${response.statusText}`;
            try {
                const parsed = rawText ? JSON.parse(rawText) : null;
                errorMessage = parsed?.error?.message || parsed?.message || errorMessage;
            } catch (error) {
                if (rawText) {
                    errorMessage = rawText;
                }
            }
            throw new Error(errorMessage);
        }

        this.setOpenAITestStatus('', 'info');
        setOpenAITestButtonState('success');
    } catch (error) {
        this.setOpenAITestStatus(`${i18n.t('ai_providers.openai_test_failed')}: ${error.message}`, 'error');
        setOpenAITestButtonState('error');
    }
}

function showAddOpenAIProviderModal() {
    const modal = document.getElementById('modal');
    const modalBody = document.getElementById('modal-body');

    modalBody.innerHTML = `
            <h3>${i18n.t('ai_providers.openai_add_modal_title')}</h3>
            <div class="form-group">
                <label for="new-provider-name">${i18n.t('ai_providers.openai_add_modal_name_label')}</label>
                <input type="text" id="new-provider-name" placeholder="${i18n.t('ai_providers.openai_add_modal_name_placeholder')}">
            </div>
            <div class="form-group">
                <label for="new-provider-url">${i18n.t('ai_providers.openai_add_modal_url_label')}</label>
                <input type="text" id="new-provider-url" placeholder="${i18n.t('ai_providers.openai_add_modal_url_placeholder')}">
            </div>
            <div class="form-group">
                <label>${i18n.t('ai_providers.openai_add_modal_keys_label')}</label>
                <p class="form-hint">${i18n.t('ai_providers.openai_keys_hint')}</p>
                <div id="new-openai-keys-wrapper" class="api-key-input-list"></div>
                <button type="button" class="btn btn-secondary" onclick="manager.addApiKeyEntryField('new-openai-keys-wrapper')">${i18n.t('ai_providers.openai_keys_add_btn')}</button>
            </div>
            <div class="form-group">
                <label>${i18n.t('common.custom_headers_label')}</label>
                <p class="form-hint">${i18n.t('common.custom_headers_hint')}</p>
                <div id="new-openai-headers-wrapper" class="header-input-list"></div>
                <button type="button" class="btn btn-secondary" onclick="manager.addHeaderField('new-openai-headers-wrapper')">${i18n.t('common.custom_headers_add')}</button>
            </div>
            <div class="form-group">
                <label>${i18n.t('ai_providers.openai_add_modal_models_label')}</label>
                <p class="form-hint">${i18n.t('ai_providers.openai_models_hint')}</p>
                <div id="new-provider-models-wrapper" class="model-input-list"></div>
                <div class="model-actions-inline">
                    <button type="button" class="btn btn-secondary" onclick="manager.addModelField('new-provider-models-wrapper')">${i18n.t('ai_providers.openai_models_add_btn')}</button>
                    <button type="button" class="btn btn-secondary" onclick="manager.openOpenAIModelDiscovery('new')">
                        <i class="fas fa-download"></i> ${i18n.t('ai_providers.openai_models_fetch_button')}
                    </button>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="manager.closeModal()">${i18n.t('common.cancel')}</button>
                <button class="btn btn-primary" onclick="manager.addOpenAIProvider()">${i18n.t('common.add')}</button>
            </div>
        `;

    modal.style.display = 'block';
    this.populateModelFields('new-provider-models-wrapper', []);
    this.populateHeaderFields('new-openai-headers-wrapper');
    this.populateApiKeyEntryFields('new-openai-keys-wrapper');
}

async function addOpenAIProvider() {
    const name = document.getElementById('new-provider-name').value.trim();
    const baseUrl = document.getElementById('new-provider-url').value.trim();
    const apiKeyEntries = this.collectApiKeyEntryInputs('new-openai-keys-wrapper');
    const models = this.collectModelInputs('new-provider-models-wrapper');
    const headers = this.collectHeaderInputs('new-openai-headers-wrapper');

    if (!this.validateOpenAIProviderInput(name, baseUrl, models)) {
        return;
    }

    try {
        const data = await this.makeRequest('/openai-compatibility');
        const currentProviders = data['openai-compatibility'] || [];

        const newProvider = {
            name,
            'base-url': baseUrl,
            'api-key-entries': apiKeyEntries,
            models
        };
        this.applyHeadersToConfig(newProvider, headers);

        currentProviders.push(newProvider);

        await this.makeRequest('/openai-compatibility', {
            method: 'PUT',
            body: JSON.stringify(currentProviders)
        });

        this.clearCache(); // 清除缓存
        this.closeModal();
        this.loadOpenAIProviders();
        this.showNotification(i18n.t('notification.openai_provider_added'), 'success');
    } catch (error) {
        this.showNotification(`${i18n.t('notification.add_failed')}: ${error.message}`, 'error');
    }
}

function editOpenAIProvider(index, provider) {
    const modal = document.getElementById('modal');
    const modalBody = document.getElementById('modal-body');

    // 处理两种API密钥格式：新的 api-key-entries 和旧的 api-keys
    let apiKeyEntries = [];
    if (Array.isArray(provider?.['api-key-entries'])) {
        // 新格式：{api-key: "...", proxy-url: "..."}
        apiKeyEntries = provider['api-key-entries'];
    } else if (Array.isArray(provider?.['api-keys'])) {
        // 旧格式：简单的字符串数组
        apiKeyEntries = provider['api-keys'].map(key => ({ 'api-key': key, 'proxy-url': '' }));
    }

    const models = Array.isArray(provider?.models) ? provider.models : [];

    modalBody.innerHTML = `
            <h3>${i18n.t('ai_providers.openai_edit_modal_title')}</h3>
            <div class="form-group">
                <label for="edit-provider-name">${i18n.t('ai_providers.openai_edit_modal_name_label')}</label>
                <input type="text" id="edit-provider-name" value="${provider?.name ? this.escapeHtml(provider.name) : ''}">
            </div>
            <div class="form-group">
                <label for="edit-provider-url">${i18n.t('ai_providers.openai_edit_modal_url_label')}</label>
                <input type="text" id="edit-provider-url" value="${provider?.['base-url'] ? this.escapeHtml(provider['base-url']) : ''}">
            </div>
            <div class="form-group">
                <label>${i18n.t('ai_providers.openai_edit_modal_keys_label')}</label>
                <p class="form-hint">${i18n.t('ai_providers.openai_keys_hint')}</p>
                <div id="edit-openai-keys-wrapper" class="api-key-input-list"></div>
                <button type="button" class="btn btn-secondary" onclick="manager.addApiKeyEntryField('edit-openai-keys-wrapper')">${i18n.t('ai_providers.openai_keys_add_btn')}</button>
            </div>
            <div class="form-group">
                <label>${i18n.t('common.custom_headers_label')}</label>
                <p class="form-hint">${i18n.t('common.custom_headers_hint')}</p>
                <div id="edit-openai-headers-wrapper" class="header-input-list"></div>
                <button type="button" class="btn btn-secondary" onclick="manager.addHeaderField('edit-openai-headers-wrapper')">${i18n.t('common.custom_headers_add')}</button>
            </div>
            <div class="form-group">
                <label>${i18n.t('ai_providers.openai_edit_modal_models_label')}</label>
                <p class="form-hint">${i18n.t('ai_providers.openai_models_hint')}</p>
                <div id="edit-provider-models-wrapper" class="model-input-list"></div>
                <div class="model-actions-inline">
                    <button type="button" class="btn btn-secondary" onclick="manager.addModelField('edit-provider-models-wrapper')">${i18n.t('ai_providers.openai_models_add_btn')}</button>
                    <button type="button" class="btn btn-secondary" onclick="manager.openOpenAIModelDiscovery('edit')">
                        <i class="fas fa-download"></i> ${i18n.t('ai_providers.openai_models_fetch_button')}
                    </button>
                </div>
            </div>
            <div class="form-group">
                <label>${i18n.t('ai_providers.openai_test_title')}</label>
                <p class="form-hint">${i18n.t('ai_providers.openai_test_hint')}</p>
                <div class="input-group openai-test-group">
                    <select id="openai-test-model-select" aria-label="${i18n.t('ai_providers.openai_test_model_placeholder')}"></select>
                    <input type="text" id="openai-test-model-input" placeholder="${i18n.t('ai_providers.openai_test_model_placeholder')}">
                    <button type="button" class="btn btn-secondary" id="openai-test-button" onclick="manager.testOpenAIProviderConnection()">
                        <i class="fas fa-stethoscope"></i> ${i18n.t('ai_providers.openai_test_action')}
                    </button>
                </div>
                <div id="openai-test-status" class="openai-test-status"></div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="manager.closeModal()">${i18n.t('common.cancel')}</button>
                <button class="btn btn-primary" onclick="manager.updateOpenAIProvider(${index})">${i18n.t('common.update')}</button>
            </div>
        `;

    modal.style.display = 'block';
    this.populateModelFields('edit-provider-models-wrapper', models);
    this.populateHeaderFields('edit-openai-headers-wrapper', provider?.headers || null);
    this.populateApiKeyEntryFields('edit-openai-keys-wrapper', apiKeyEntries);
    this.populateOpenAITestModelOptions(models);
    this.setOpenAITestStatus('', 'info');
    setOpenAITestButtonState('idle');

    const modelWrapper = document.getElementById('edit-provider-models-wrapper');
    if (modelWrapper) {
        modelWrapper.addEventListener('input', () => {
            const currentModels = this.collectModelInputs('edit-provider-models-wrapper');
            this.populateOpenAITestModelOptions(currentModels, { preserveInput: true });
        });
    }

    const modelSelect = document.getElementById('openai-test-model-select');
    if (modelSelect) {
        modelSelect.addEventListener('change', (event) => {
            const value = event?.target?.value || '';
            const input = document.getElementById('openai-test-model-input');
            if (input && value) {
                input.value = value;
            }
        });
    }
}

async function updateOpenAIProvider(index) {
    const name = document.getElementById('edit-provider-name').value.trim();
    const baseUrl = document.getElementById('edit-provider-url').value.trim();
    const apiKeyEntries = this.collectApiKeyEntryInputs('edit-openai-keys-wrapper');
    const models = this.collectModelInputs('edit-provider-models-wrapper');
    const headers = this.collectHeaderInputs('edit-openai-headers-wrapper');

    if (!this.validateOpenAIProviderInput(name, baseUrl, models)) {
        return;
    }

    try {
        const updatedProvider = {
            name,
            'base-url': baseUrl,
            'api-key-entries': apiKeyEntries,
            models
        };
        this.applyHeadersToConfig(updatedProvider, headers);

        await this.makeRequest('/openai-compatibility', {
            method: 'PATCH',
            body: JSON.stringify({ index, value: updatedProvider })
        });

        this.clearCache(); // 清除缓存
        this.closeModal();
        this.loadOpenAIProviders();
        this.showNotification(i18n.t('notification.openai_provider_updated'), 'success');
    } catch (error) {
        this.showNotification(`${i18n.t('notification.update_failed')}: ${error.message}`, 'error');
    }
}

async function deleteOpenAIProvider(name) {
    if (!confirm(i18n.t('ai_providers.openai_delete_confirm'))) return;

    try {
        await this.makeRequest(`/openai-compatibility?name=${encodeURIComponent(name)}`, { method: 'DELETE' });
        this.clearCache(); // 清除缓存
        this.loadOpenAIProviders();
        this.showNotification(i18n.t('notification.openai_provider_deleted'), 'success');
    } catch (error) {
        this.showNotification(`${i18n.t('notification.delete_failed')}: ${error.message}`, 'error');
    }
}

function addModelField(wrapperId, model = {}) {
    const wrapper = document.getElementById(wrapperId);
    if (!wrapper) return;

    const row = document.createElement('div');
    row.className = 'model-input-row';
    row.innerHTML = `
            <div class="input-group">
                <input type="text" class="model-name-input" placeholder="${i18n.t('common.model_name_placeholder')}" value="${model.name ? this.escapeHtml(model.name) : ''}">
                <input type="text" class="model-alias-input" placeholder="${i18n.t('common.model_alias_placeholder')}" value="${model.alias ? this.escapeHtml(model.alias) : ''}">
                <button type="button" class="btn btn-small btn-danger model-remove-btn"><i class="fas fa-trash"></i></button>
            </div>
        `;

    const removeBtn = row.querySelector('.model-remove-btn');
    if (removeBtn) {
        removeBtn.addEventListener('click', () => {
            wrapper.removeChild(row);
        });
    }

    wrapper.appendChild(row);
}

function populateModelFields(wrapperId, models = []) {
    const wrapper = document.getElementById(wrapperId);
    if (!wrapper) return;
    wrapper.innerHTML = '';

    if (!models.length) {
        this.addModelField(wrapperId);
        return;
    }

    models.forEach(model => this.addModelField(wrapperId, model));
}

function collectModelInputs(wrapperId) {
    const wrapper = document.getElementById(wrapperId);
    if (!wrapper) return [];

    const rows = Array.from(wrapper.querySelectorAll('.model-input-row'));
    const models = [];

    rows.forEach(row => {
        const nameInput = row.querySelector('.model-name-input');
        const aliasInput = row.querySelector('.model-alias-input');
        const name = nameInput ? nameInput.value.trim() : '';
        const alias = aliasInput ? aliasInput.value.trim() : '';

        if (name) {
            const model = { name };
            if (alias) {
                model.alias = alias;
            }
            models.push(model);
        }
    });

    return models;
}

function renderModelBadges(models) {
    if (!models || models.length === 0) {
        return '';
    }

    return `
            <div class="provider-models">
                ${models.map(model => `
                    <span class="provider-model-tag">
                        <span class="model-name">${this.escapeHtml(model.name || '')}</span>
                        ${model.alias ? `<span class="model-alias">${this.escapeHtml(model.alias)}</span>` : ''}
                    </span>
                `).join('')}
            </div>
        `;
}

function validateOpenAIProviderInput(name, baseUrl, models) {
    if (!name || !baseUrl) {
        this.showNotification(i18n.t('notification.openai_provider_required'), 'error');
        return false;
    }

    const invalidModel = models.find(model => !model.name);
    if (invalidModel) {
        this.showNotification(i18n.t('notification.openai_model_name_required'), 'error');
        return false;
    }

    return true;
}

const aiProvidersModule = {
    loadGeminiKeys,
    getGeminiKeysFromConfig,
    renderGeminiKeys,
    showAddGeminiKeyModal,
    addGeminiKey,
    addGeminiKeyField,
    populateGeminiKeyFields,
    collectGeminiKeyFieldInputs,
    editGeminiKey,
    updateGeminiKey,
    deleteGeminiKey,
    loadCodexKeys,
    renderCodexKeys,
    showAddCodexKeyModal,
    addCodexKey,
    editCodexKey,
    updateCodexKey,
    deleteCodexKey,
    loadClaudeKeys,
    renderClaudeKeys,
    showAddClaudeKeyModal,
    addClaudeKey,
    editClaudeKey,
    updateClaudeKey,
    deleteClaudeKey,
    loadOpenAIProviders,
    renderOpenAIProviders,
    showAddOpenAIProviderModal,
    addOpenAIProvider,
    editOpenAIProvider,
    updateOpenAIProvider,
    deleteOpenAIProvider,
    openOpenAIModelDiscovery,
    refreshOpenAIModelDiscovery,
    renderOpenAIModelDiscoveryList,
    setOpenAIModelDiscoveryStatus,
    setOpenAIModelDiscoverySearch,
    applyOpenAIModelDiscoverySelection,
    closeOpenAIModelDiscovery,
    populateOpenAITestModelOptions,
    setOpenAITestStatus,
    testOpenAIProviderConnection,
    addModelField,
    populateModelFields,
    collectModelInputs,
    renderModelBadges,
    renderExcludedModelBadges,
    collectExcludedModels,
    setExcludedModelsValue,
    validateOpenAIProviderInput
};



// ============ src/utils/html.js ============
/**
 * HTML 工具函数模块
 * 提供 HTML 字符串处理、XSS 防护等功能
 */

/**
 * HTML 转义，防止 XSS 攻击
 * @param {*} value - 需要转义的值
 * @returns {string} 转义后的字符串
 *
 * @example
 * escapeHtml('<script>alert("xss")<\/script>')
 * // 返回: '&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;'
 */
function escapeHtml(value) {
    if (value === null || value === undefined) return '';
    return String(value)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
}

/**
 * HTML 反转义
 * @param {string} html - 需要反转义的 HTML 字符串
 * @returns {string} 反转义后的字符串
 */
function unescapeHtml(html) {
    if (!html) return '';
    const textarea = document.createElement('textarea');
    textarea.innerHTML = html;
    return textarea.value;
}

/**
 * 去除 HTML 标签，只保留文本内容
 * @param {string} html - HTML 字符串
 * @returns {string} 纯文本内容
 *
 * @example
 * stripHtmlTags('<p>Hello <strong>World</strong></p>')
 * // 返回: 'Hello World'
 */
function stripHtmlTags(html) {
    if (!html) return '';
    const div = document.createElement('div');
    div.innerHTML = html;
    return div.textContent || div.innerText || '';
}

/**
 * 安全地设置元素的 HTML 内容
 * @param {HTMLElement} element - 目标元素
 * @param {string} html - HTML 内容
 * @param {boolean} escape - 是否转义（默认 true）
 */
function setSafeHtml(element, html, escape = true) {
    if (!element) return;
    element.innerHTML = escape ? escapeHtml(html) : html;
}



// ============ src/utils/string.js ============
/**
 * 字符串工具函数模块
 * 提供字符串处理、格式化、掩码等功能
 */

/**
 * 遮蔽 API 密钥显示，保护敏感信息
 * @param {*} key - API 密钥
 * @returns {string} 遮蔽后的密钥字符串
 *
 * @example
 * maskApiKey('sk-1234567890abcdef')
 * // 返回: 'sk-1...cdef'
 */
function maskApiKey(key) {
    if (key === null || key === undefined) {
        return '';
    }
    const normalizedKey = typeof key === 'string' ? key : String(key);
    if (normalizedKey.length > 8) {
        return normalizedKey.substring(0, 4) + '...' + normalizedKey.substring(normalizedKey.length - 4);
    } else if (normalizedKey.length > 4) {
        return normalizedKey.substring(0, 2) + '...' + normalizedKey.substring(normalizedKey.length - 2);
    } else if (normalizedKey.length > 2) {
        return normalizedKey.substring(0, 1) + '...' + normalizedKey.substring(normalizedKey.length - 1);
    }
    return normalizedKey;
}

/**
 * 截断字符串到指定长度，超出部分用省略号代替
 * @param {string} str - 原字符串
 * @param {number} maxLength - 最大长度
 * @param {string} suffix - 后缀（默认 '...'）
 * @returns {string} 截断后的字符串
 *
 * @example
 * truncateString('This is a very long string', 10)
 * // 返回: 'This is...'
 */
function truncateString(str, maxLength, suffix = '...') {
    if (!str || str.length <= maxLength) return str || '';
    return str.substring(0, maxLength - suffix.length) + suffix;
}

/**
 * 格式化文件大小
 * @param {number} bytes - 字节数
 * @param {number} decimals - 小数位数（默认 2）
 * @returns {string} 格式化后的大小字符串
 *
 * @example
 * formatFileSize(1536)
 * // 返回: '1.50 KB'
 */
function formatFileSize(bytes, decimals = 2) {
    if (bytes === 0) return '0 Bytes';
    if (!bytes || isNaN(bytes)) return '';

    const k = 1024;
    const dm = decimals < 0 ? 0 : decimals;
    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));

    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
}

/**
 * 首字母大写
 * @param {string} str - 原字符串
 * @returns {string} 首字母大写后的字符串
 */
function capitalize(str) {
    if (!str) return '';
    return str.charAt(0).toUpperCase() + str.slice(1);
}

/**
 * 生成随机字符串
 * @param {number} length - 字符串长度
 * @param {string} charset - 字符集（默认字母数字）
 * @returns {string} 随机字符串
 */
function randomString(length = 8, charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789') {
    let result = '';
    for (let i = 0; i < length; i++) {
        result += charset.charAt(Math.floor(Math.random() * charset.length));
    }
    return result;
}

/**
 * 检查字符串是否为空或仅包含空白字符
 * @param {string} str - 待检查的字符串
 * @returns {boolean} 是否为空
 */
function isBlank(str) {
    return !str || /^\s*$/.test(str);
}

/**
 * 将字符串转换为 kebab-case
 * @param {string} str - 原字符串
 * @returns {string} kebab-case 字符串
 *
 * @example
 * toKebabCase('helloWorld')
 * // 返回: 'hello-world'
 */
function toKebabCase(str) {
    if (!str) return '';
    return str
        .replace(/([a-z])([A-Z])/g, '$1-$2')
        .replace(/[\s_]+/g, '-')
        .toLowerCase();
}



// ============ src/utils/array.js ============
/**
 * 数组工具函数模块
 * 提供数组处理、规范化、排序等功能
 */

/**
 * 规范化 API 响应中的数组数据
 * 兼容多种服务端返回格式
 *
 * @param {*} data - API 响应数据
 * @param {string} [key] - 数组字段的键名
 * @returns {Array} 规范化后的数组
 *
 * @example
 * // 直接返回数组
 * normalizeArrayResponse([1, 2, 3])
 * // 返回: [1, 2, 3]
 *
 * // 从对象中提取数组
 * normalizeArrayResponse({ 'api-keys': ['key1', 'key2'] }, 'api-keys')
 * // 返回: ['key1', 'key2']
 *
 * // 从 items 字段提取
 * normalizeArrayResponse({ items: ['a', 'b'] })
 * // 返回: ['a', 'b']
 */
function normalizeArrayResponse(data, key) {
    // 如果本身就是数组，直接返回
    if (Array.isArray(data)) {
        return data;
    }
    // 如果指定了 key，尝试从对象中提取
    if (key && data && Array.isArray(data[key])) {
        return data[key];
    }
    // 尝试从 items 字段提取（通用分页格式）
    if (data && Array.isArray(data.items)) {
        return data.items;
    }
    // 默认返回空数组
    return [];
}

/**
 * 数组去重
 * @param {Array} arr - 原数组
 * @param {Function} [keyFn] - 提取键的函数，用于对象数组去重
 * @returns {Array} 去重后的数组
 *
 * @example
 * uniqueArray([1, 2, 2, 3])
 * // 返回: [1, 2, 3]
 *
 * uniqueArray([{id: 1}, {id: 2}, {id: 1}], item => item.id)
 * // 返回: [{id: 1}, {id: 2}]
 */
function uniqueArray(arr, keyFn) {
    if (!Array.isArray(arr)) return [];

    if (keyFn) {
        const seen = new Set();
        return arr.filter(item => {
            const key = keyFn(item);
            if (seen.has(key)) return false;
            seen.add(key);
            return true;
        });
    }

    return [...new Set(arr)];
}

/**
 * 数组分组
 * @param {Array} arr - 原数组
 * @param {Function} keyFn - 提取分组键的函数
 * @returns {Object} 分组后的对象
 *
 * @example
 * groupBy([{type: 'a', val: 1}, {type: 'b', val: 2}, {type: 'a', val: 3}], item => item.type)
 * // 返回: { a: [{type: 'a', val: 1}, {type: 'a', val: 3}], b: [{type: 'b', val: 2}] }
 */
function groupBy(arr, keyFn) {
    if (!Array.isArray(arr)) return {};

    return arr.reduce((groups, item) => {
        const key = keyFn(item);
        if (!groups[key]) {
            groups[key] = [];
        }
        groups[key].push(item);
        return groups;
    }, {});
}

/**
 * 数组分块
 * @param {Array} arr - 原数组
 * @param {number} size - 每块大小
 * @returns {Array<Array>} 分块后的二维数组
 *
 * @example
 * chunk([1, 2, 3, 4, 5], 2)
 * // 返回: [[1, 2], [3, 4], [5]]
 */
function chunk(arr, size) {
    if (!Array.isArray(arr) || size < 1) return [];

    const result = [];
    for (let i = 0; i < arr.length; i += size) {
        result.push(arr.slice(i, i + size));
    }
    return result;
}

/**
 * 数组排序（不改变原数组）
 * @param {Array} arr - 原数组
 * @param {Function} compareFn - 比较函数
 * @returns {Array} 排序后的新数组
 */
function sortArray(arr, compareFn) {
    if (!Array.isArray(arr)) return [];
    return [...arr].sort(compareFn);
}

/**
 * 按字段排序对象数组
 * @param {Array} arr - 对象数组
 * @param {string} key - 排序字段
 * @param {string} order - 排序顺序 'asc' 或 'desc'
 * @returns {Array} 排序后的新数组
 *
 * @example
 * sortByKey([{age: 25}, {age: 20}, {age: 30}], 'age', 'asc')
 * // 返回: [{age: 20}, {age: 25}, {age: 30}]
 */
function sortByKey(arr, key, order = 'asc') {
    if (!Array.isArray(arr)) return [];

    return [...arr].sort((a, b) => {
        const aVal = a[key];
        const bVal = b[key];

        if (aVal < bVal) return order === 'asc' ? -1 : 1;
        if (aVal > bVal) return order === 'asc' ? 1 : -1;
        return 0;
    });
}

/**
 * 安全地获取数组元素
 * @param {Array} arr - 数组
 * @param {number} index - 索引
 * @param {*} defaultValue - 默认值
 * @returns {*} 数组元素或默认值
 */
function safeGet(arr, index, defaultValue = undefined) {
    if (!Array.isArray(arr) || index < 0 || index >= arr.length) {
        return defaultValue;
    }
    return arr[index];
}

/**
 * 检查数组是否为空
 * @param {*} arr - 待检查的值
 * @returns {boolean} 是否为空数组
 */
function isEmptyArray(arr) {
    return !Array.isArray(arr) || arr.length === 0;
}



// ============ src/utils/dom.js ============
/**
 * DOM 操作工具函数模块
 * 提供高性能的 DOM 操作方法
 */

/**
 * 批量渲染列表项，使用 DocumentFragment 减少重绘
 * @param {HTMLElement} container - 容器元素
 * @param {Array} items - 数据项数组
 * @param {Function} renderItemFn - 渲染单个项目的函数，返回 HTML 字符串或 Element
 * @param {boolean} append - 是否追加模式（默认 false，清空后渲染）
 *
 * @example
 * renderList(container, files, (file) => `
 *     <div class="file-item">${file.name}</div>
 * `);
 */
function renderList(container, items, renderItemFn, append = false) {
    if (!container) return;

    const fragment = document.createDocumentFragment();

    items.forEach((item, index) => {
        const rendered = renderItemFn(item, index);

        if (typeof rendered === 'string') {
            // HTML 字符串，创建临时容器
            const temp = document.createElement('div');
            temp.innerHTML = rendered;
            // 将所有子元素添加到 fragment
            while (temp.firstChild) {
                fragment.appendChild(temp.firstChild);
            }
        } else if (rendered instanceof HTMLElement) {
            // DOM 元素，直接添加
            fragment.appendChild(rendered);
        }
    });

    if (!append) {
        container.innerHTML = '';
    }
    container.appendChild(fragment);
}

/**
 * 创建 DOM 元素的快捷方法
 * @param {string} tag - 标签名
 * @param {Object} attrs - 属性对象
 * @param {string|Array<HTMLElement>} content - 内容（文本或子元素数组）
 * @returns {HTMLElement}
 *
 * @example
 * const div = createElement('div', { class: 'item', 'data-id': '123' }, 'Hello');
 * const ul = createElement('ul', {}, [
 *     createElement('li', {}, 'Item 1'),
 *     createElement('li', {}, 'Item 2')
 * ]);
 */
function createElement(tag, attrs = {}, content = null) {
    const element = document.createElement(tag);

    // 设置属性
    Object.keys(attrs).forEach(key => {
        if (key === 'class') {
            element.className = attrs[key];
        } else if (key === 'style' && typeof attrs[key] === 'object') {
            Object.assign(element.style, attrs[key]);
        } else if (key.startsWith('on') && typeof attrs[key] === 'function') {
            const eventName = key.substring(2).toLowerCase();
            element.addEventListener(eventName, attrs[key]);
        } else {
            element.setAttribute(key, attrs[key]);
        }
    });

    // 设置内容
    if (content !== null && content !== undefined) {
        if (typeof content === 'string') {
            element.textContent = content;
        } else if (Array.isArray(content)) {
            content.forEach(child => {
                if (child instanceof HTMLElement) {
                    element.appendChild(child);
                }
            });
        } else if (content instanceof HTMLElement) {
            element.appendChild(content);
        }
    }

    return element;
}

/**
 * 批量更新元素属性，减少重绘
 * @param {HTMLElement} element - 目标元素
 * @param {Object} updates - 更新对象
 *
 * @example
 * batchUpdate(element, {
 *     className: 'active',
 *     style: { color: 'red', fontSize: '16px' },
 *     textContent: 'Updated'
 * });
 */
function batchUpdate(element, updates) {
    if (!element) return;

    // 使用 requestAnimationFrame 批量更新
    requestAnimationFrame(() => {
        Object.keys(updates).forEach(key => {
            if (key === 'style' && typeof updates[key] === 'object') {
                Object.assign(element.style, updates[key]);
            } else {
                element[key] = updates[key];
            }
        });
    });
}

/**
 * 延迟渲染大列表，避免阻塞 UI
 * @param {HTMLElement} container - 容器元素
 * @param {Array} items - 数据项数组
 * @param {Function} renderItemFn - 渲染函数
 * @param {number} batchSize - 每批渲染数量
 * @returns {Promise} 完成渲染的 Promise
 *
 * @example
 * await renderListAsync(container, largeArray, renderItem, 50);
 */
function renderListAsync(container, items, renderItemFn, batchSize = 50) {
    return new Promise((resolve) => {
        if (!container || !items.length) {
            resolve();
            return;
        }

        container.innerHTML = '';
        let index = 0;

        function renderBatch() {
            const fragment = document.createDocumentFragment();
            const end = Math.min(index + batchSize, items.length);

            for (let i = index; i < end; i++) {
                const rendered = renderItemFn(items[i], i);
                if (typeof rendered === 'string') {
                    const temp = document.createElement('div');
                    temp.innerHTML = rendered;
                    while (temp.firstChild) {
                        fragment.appendChild(temp.firstChild);
                    }
                } else if (rendered instanceof HTMLElement) {
                    fragment.appendChild(rendered);
                }
            }

            container.appendChild(fragment);
            index = end;

            if (index < items.length) {
                requestAnimationFrame(renderBatch);
            } else {
                resolve();
            }
        }

        requestAnimationFrame(renderBatch);
    });
}

/**
 * 虚拟滚动渲染（仅渲染可见区域）
 * @param {Object} config - 配置对象
 * @param {HTMLElement} config.container - 容器元素
 * @param {Array} config.items - 数据项数组
 * @param {Function} config.renderItemFn - 渲染函数
 * @param {number} config.itemHeight - 每项高度（像素）
 * @param {number} [config.overscan=5] - 额外渲染的项数（上下各）
 * @returns {Object} 包含 update 和 destroy 方法的对象
 */
function createVirtualScroll({ container, items, renderItemFn, itemHeight, overscan = 5 }) {
    if (!container) return { update: () => {}, destroy: () => {} };

    const totalHeight = items.length * itemHeight;
    const viewportHeight = container.clientHeight;

    // 创建占位容器
    const placeholder = document.createElement('div');
    placeholder.style.height = `${totalHeight}px`;
    placeholder.style.position = 'relative';

    const content = document.createElement('div');
    content.style.position = 'absolute';
    content.style.top = '0';
    content.style.width = '100%';

    placeholder.appendChild(content);
    container.innerHTML = '';
    container.appendChild(placeholder);

    function render() {
        const scrollTop = container.scrollTop;
        const startIndex = Math.max(0, Math.floor(scrollTop / itemHeight) - overscan);
        const endIndex = Math.min(
            items.length,
            Math.ceil((scrollTop + viewportHeight) / itemHeight) + overscan
        );

        const fragment = document.createDocumentFragment();

        for (let i = startIndex; i < endIndex; i++) {
            const element = renderItemFn(items[i], i);
            if (typeof element === 'string') {
                const temp = document.createElement('div');
                temp.innerHTML = element;
                while (temp.firstChild) {
                    fragment.appendChild(temp.firstChild);
                }
            } else if (element instanceof HTMLElement) {
                fragment.appendChild(element);
            }
        }

        content.style.top = `${startIndex * itemHeight}px`;
        content.innerHTML = '';
        content.appendChild(fragment);
    }

    const handleScroll = () => requestAnimationFrame(render);
    container.addEventListener('scroll', handleScroll);

    // 初始渲染
    render();

    return {
        update: (newItems) => {
            items = newItems;
            placeholder.style.height = `${newItems.length * itemHeight}px`;
            render();
        },
        destroy: () => {
            container.removeEventListener('scroll', handleScroll);
        }
    };
}

/**
 * 防抖包装器（用于搜索、输入等）
 * @param {Function} fn - 要防抖的函数
 * @param {number} delay - 延迟时间（毫秒）
 * @returns {Function} 防抖后的函数
 */
function debounce(fn, delay = 300) {
    let timer;
    return function (...args) {
        clearTimeout(timer);
        timer = setTimeout(() => fn.apply(this, args), delay);
    };
}

/**
 * 节流包装器（用于滚动、resize 等）
 * @param {Function} fn - 要节流的函数
 * @param {number} limit - 限制时间（毫秒）
 * @returns {Function} 节流后的函数
 */
function throttle(fn, limit = 100) {
    let inThrottle;
    return function (...args) {
        if (!inThrottle) {
            fn.apply(this, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
        }
    };
}



// ============ src/utils/constants.js ============
/**
 * 常量配置文件
 * 集中管理应用中的所有常量，避免魔法数字和硬编码字符串
 */

// ============================================================
// 时间相关常量（毫秒）
// ============================================================

/**
 * 配置缓存过期时间（30秒）
 * 用于减少服务器压力，避免频繁请求配置数据
 */
const CACHE_EXPIRY_MS = 30 * 1000;

/**
 * 通知显示持续时间（3秒）
 * 成功/错误/信息提示框的自动消失时间
 */
const NOTIFICATION_DURATION_MS = 3 * 1000;

/**
 * 状态更新定时器间隔（1秒）
 * 连接状态和系统信息的更新频率
 */
const STATUS_UPDATE_INTERVAL_MS = 1 * 1000;

/**
 * 日志刷新延迟（500毫秒）
 * 日志自动刷新的去抖延迟
 */
const LOG_REFRESH_DELAY_MS = 500;

/**
 * OAuth 状态轮询间隔（2秒）
 * 检查 OAuth 认证完成状态的轮询频率
 */
const OAUTH_POLL_INTERVAL_MS = 2 * 1000;

/**
 * OAuth 最大轮询时间（5分钟）
 * 超过此时间后停止轮询，认为授权超时
 */
const OAUTH_MAX_POLL_DURATION_MS = 5 * 60 * 1000;

// ============================================================
// 数据限制常量
// ============================================================

/**
 * 最大日志显示行数
 * 限制内存占用，避免大量日志导致页面卡顿
 */
const MAX_LOG_LINES = 2000;

/**
 * 日志接口获取数量上限
 * 限制后端返回的日志行数，避免一次拉取过多数据
 */
const LOG_FETCH_LIMIT = 2500;

/**
 * 认证文件列表默认每页显示数量
 */
const DEFAULT_AUTH_FILES_PAGE_SIZE = 9;

/**
 * 认证文件每页最小显示数量
 */
const MIN_AUTH_FILES_PAGE_SIZE = 3;

/**
 * 认证文件每页最大显示数量
 */
const MAX_AUTH_FILES_PAGE_SIZE = 60;

/**
 * 使用统计图表最大数据点数
 * 超过此数量将进行聚合，提高渲染性能
 */
const MAX_CHART_DATA_POINTS = 100;

// ============================================================
// 网络相关常量
// ============================================================

/**
 * 默认 API 服务器端口
 */
const DEFAULT_API_PORT = 8317;

/**
 * 默认 API 基础路径
 */
const DEFAULT_API_BASE = `http://localhost:${DEFAULT_API_PORT}`;

/**
 * 管理 API 路径前缀
 */
const MANAGEMENT_API_PREFIX = '/v0/management';

/**
 * 请求超时时间（30秒）
 */
const REQUEST_TIMEOUT_MS = 30 * 1000;

// ============================================================
// OAuth 相关常量
// ============================================================

/**
 * OAuth 卡片元素 ID 列表
 * 用于根据主机环境隐藏/显示不同的 OAuth 选项
 * 注意: iflow-oauth-card 不在此列表中,因为它包含Cookie登录功能,该功能可在远程使用
 */
const OAUTH_CARD_IDS = [
    'codex-oauth-card',
    'anthropic-oauth-card',
    'antigravity-oauth-card',
    'gemini-cli-oauth-card',
    'qwen-oauth-card'
];

/**
 * OAuth 提供商名称映射
 */
const OAUTH_PROVIDERS = {
    CODEX: 'codex',
    ANTHROPIC: 'anthropic',
    ANTIGRAVITY: 'antigravity',
    GEMINI_CLI: 'gemini-cli',
    QWEN: 'qwen',
    IFLOW: 'iflow'
};

// ============================================================
// 本地存储键名
// ============================================================

/**
 * 本地存储键名前缀
 */
const STORAGE_PREFIX = 'cliProxyApi_';

/**
 * 存储 API 基础地址的键名
 */
const STORAGE_KEY_API_BASE = `${STORAGE_PREFIX}apiBase`;

/**
 * 存储管理密钥的键名
 */
const STORAGE_KEY_MANAGEMENT_KEY = `${STORAGE_PREFIX}managementKey`;

/**
 * 存储主题偏好的键名
 */
const STORAGE_KEY_THEME = `${STORAGE_PREFIX}theme`;

/**
 * 存储语言偏好的键名
 */
const STORAGE_KEY_LANGUAGE = `${STORAGE_PREFIX}language`;

/**
 * 存储认证文件页大小的键名
 */
const STORAGE_KEY_AUTH_FILES_PAGE_SIZE = `${STORAGE_PREFIX}authFilesPageSize`;

// ============================================================
// UI 相关常量
// ============================================================

/**
 * 主题选项
 */
const THEMES = {
    LIGHT: 'light',
    DARK: 'dark'
};

/**
 * 支持的语言
 */
const LANGUAGES = {
    ZH_CN: 'zh-CN',
    EN_US: 'en-US'
};

/**
 * 通知类型
 */
const NOTIFICATION_TYPES = {
    SUCCESS: 'success',
    ERROR: 'error',
    INFO: 'info',
    WARNING: 'warning'
};

/**
 * 模态框尺寸
 */
const MODAL_SIZES = {
    SMALL: 'small',
    MEDIUM: 'medium',
    LARGE: 'large'
};

// ============================================================
// 正则表达式常量
// ============================================================

/**
 * URL 验证正则
 */
const URL_PATTERN = /^https?:\/\/.+/;

/**
 * Email 验证正则
 */
const EMAIL_PATTERN = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

/**
 * 端口号验证正则（1-65535）
 */
const PORT_PATTERN = /^([1-9][0-9]{0,3}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5])$/;

// ============================================================
// 文件类型常量
// ============================================================

/**
 * 支持的认证文件类型
 */
const AUTH_FILE_TYPES = {
    JSON: 'application/json',
    YAML: 'application/x-yaml'
};

/**
 * 认证文件最大大小（10MB）
 */
const MAX_AUTH_FILE_SIZE = 10 * 1024 * 1024;

// ============================================================
// API 端点常量
// ============================================================

/**
 * 常用 API 端点路径
 */
const API_ENDPOINTS = {
    CONFIG: '/config',
    DEBUG: '/debug',
    API_KEYS: '/api-keys',
    PROVIDERS: '/providers',
    AUTH_FILES: '/auth-files',
    LOGS: '/logs',
    USAGE_STATS: '/usage-stats',
    CONNECTION: '/connection',
    CODEX_API_KEY: '/codex-api-key',
    ANTHROPIC_API_KEY: '/anthropic-api-key',
    GEMINI_API_KEY: '/gemini-api-key',
    OPENAI_API_KEY: '/openai-api-key'
};

// ============================================================
// 错误消息常量
// ============================================================

/**
 * 通用错误消息
 */
const ERROR_MESSAGES = {
    NETWORK_ERROR: '网络连接失败，请检查服务器状态',
    TIMEOUT: '请求超时，请稍后重试',
    UNAUTHORIZED: '未授权，请检查管理密钥',
    NOT_FOUND: '资源不存在',
    SERVER_ERROR: '服务器错误，请联系管理员',
    INVALID_INPUT: '输入数据无效',
    OPERATION_FAILED: '操作失败，请稍后重试'
};



// ============ src/core/error-handler.js ============
/**
 * 错误处理器
 * 统一管理应用中的错误处理逻辑
 */



/**
 * 错误处理器类
 * 提供统一的错误处理接口，确保错误处理的一致性
 */
class ErrorHandler {
    /**
     * 构造错误处理器
     * @param {Object} notificationService - 通知服务对象
     * @param {Function} notificationService.show - 显示通知的方法
     */
    constructor(notificationService) {
        this.notificationService = notificationService;
    }

    /**
     * 处理更新操作失败
     * 包括显示错误通知和执行UI回滚操作
     *
     * @param {Error} error - 错误对象
     * @param {string} context - 操作上下文（如"调试模式"、"代理设置"）
     * @param {Function} [rollbackFn] - UI回滚函数
     *
     * @example
     * try {
     *     await this.makeRequest('/debug', { method: 'PATCH', body: JSON.stringify({ enabled: true }) });
     * } catch (error) {
     *     this.errorHandler.handleUpdateError(
     *         error,
     *         '调试模式',
     *         () => document.getElementById('debug-toggle').checked = false
     *     );
     * }
     */
    handleUpdateError(error, context, rollbackFn) {
        console.error(`更新${context}失败:`, error);
        const message = `更新${context}失败: ${error.message || ERROR_MESSAGES.OPERATION_FAILED}`;
        this.notificationService.show(message, 'error');

        // 执行回滚操作
        if (typeof rollbackFn === 'function') {
            try {
                rollbackFn();
            } catch (rollbackError) {
                console.error('UI回滚操作失败:', rollbackError);
            }
        }
    }

    /**
     * 处理加载操作失败
     *
     * @param {Error} error - 错误对象
     * @param {string} context - 加载内容的上下文（如"API密钥"、"使用统计"）
     *
     * @example
     * try {
     *     const data = await this.makeRequest('/api-keys');
     *     this.renderApiKeys(data);
     * } catch (error) {
     *     this.errorHandler.handleLoadError(error, 'API密钥');
     * }
     */
    handleLoadError(error, context) {
        console.error(`加载${context}失败:`, error);
        const message = `加载${context}失败，请检查连接`;
        this.notificationService.show(message, 'error');
    }

    /**
     * 处理删除操作失败
     *
     * @param {Error} error - 错误对象
     * @param {string} context - 删除内容的上下文
     */
    handleDeleteError(error, context) {
        console.error(`删除${context}失败:`, error);
        const message = `删除${context}失败: ${error.message || ERROR_MESSAGES.OPERATION_FAILED}`;
        this.notificationService.show(message, 'error');
    }

    /**
     * 处理添加操作失败
     *
     * @param {Error} error - 错误对象
     * @param {string} context - 添加内容的上下文
     */
    handleAddError(error, context) {
        console.error(`添加${context}失败:`, error);
        const message = `添加${context}失败: ${error.message || ERROR_MESSAGES.OPERATION_FAILED}`;
        this.notificationService.show(message, 'error');
    }

    /**
     * 处理网络错误
     * 检测常见的网络问题并提供友好的错误提示
     *
     * @param {Error} error - 错误对象
     */
    handleNetworkError(error) {
        console.error('网络请求失败:', error);

        let message = ERROR_MESSAGES.NETWORK_ERROR;

        // 检测特定错误类型
        if (error.name === 'TypeError' && error.message.includes('fetch')) {
            message = ERROR_MESSAGES.NETWORK_ERROR;
        } else if (error.message && error.message.includes('timeout')) {
            message = ERROR_MESSAGES.TIMEOUT;
        } else if (error.message && error.message.includes('401')) {
            message = ERROR_MESSAGES.UNAUTHORIZED;
        } else if (error.message && error.message.includes('404')) {
            message = ERROR_MESSAGES.NOT_FOUND;
        } else if (error.message && error.message.includes('500')) {
            message = ERROR_MESSAGES.SERVER_ERROR;
        } else if (error.message) {
            message = `网络错误: ${error.message}`;
        }

        this.notificationService.show(message, 'error');
    }

    /**
     * 处理验证错误
     *
     * @param {string} fieldName - 字段名称
     * @param {string} [message] - 自定义错误消息
     */
    handleValidationError(fieldName, message) {
        const errorMessage = message || `请输入有效的${fieldName}`;
        this.notificationService.show(errorMessage, 'error');
    }

    /**
     * 处理通用错误
     * 当错误类型不明确时使用
     *
     * @param {Error} error - 错误对象
     * @param {string} [defaultMessage] - 默认错误消息
     */
    handleGenericError(error, defaultMessage) {
        console.error('操作失败:', error);
        const message = error.message || defaultMessage || ERROR_MESSAGES.OPERATION_FAILED;
        this.notificationService.show(message, 'error');
    }

    /**
     * 创建带错误处理的异步函数包装器
     * 自动捕获并处理错误
     *
     * @param {Function} asyncFn - 异步函数
     * @param {string} context - 操作上下文
     * @param {Function} [rollbackFn] - 回滚函数
     * @returns {Function} 包装后的函数
     *
     * @example
     * const safeUpdate = this.errorHandler.withErrorHandling(
     *     () => this.makeRequest('/debug', { method: 'PATCH', body: '...' }),
     *     '调试模式',
     *     () => document.getElementById('debug-toggle').checked = false
     * );
     * await safeUpdate();
     */
    withErrorHandling(asyncFn, context, rollbackFn) {
        return async (...args) => {
            try {
                return await asyncFn(...args);
            } catch (error) {
                this.handleUpdateError(error, context, rollbackFn);
                throw error; // 重新抛出以便调用者处理
            }
        };
    }

    /**
     * 创建带重试机制的错误处理包装器
     *
     * @param {Function} asyncFn - 异步函数
     * @param {number} [maxRetries=3] - 最大重试次数
     * @param {number} [retryDelay=1000] - 重试延迟（毫秒）
     * @returns {Function} 包装后的函数
     *
     * @example
     * const retryableFetch = this.errorHandler.withRetry(
     *     () => this.makeRequest('/config'),
     *     3,
     *     2000
     * );
     * const config = await retryableFetch();
     */
    withRetry(asyncFn, maxRetries = 3, retryDelay = 1000) {
        return async (...args) => {
            let lastError;
            for (let attempt = 0; attempt < maxRetries; attempt++) {
                try {
                    return await asyncFn(...args);
                } catch (error) {
                    lastError = error;
                    console.warn(`尝试 ${attempt + 1}/${maxRetries} 失败:`, error);

                    if (attempt < maxRetries - 1) {
                        // 等待后重试
                        await new Promise(resolve => setTimeout(resolve, retryDelay));
                    }
                }
            }

            // 所有尝试都失败
            throw lastError;
        };
    }
}

/**
 * 创建错误处理器工厂函数
 * 便于在不同模块中创建错误处理器实例
 *
 * @param {Function} showNotification - 显示通知的函数
 * @returns {ErrorHandler} 错误处理器实例
 */
function createErrorHandler(showNotification) {
    return new ErrorHandler({
        show: showNotification
    });
}



// ============ src/core/connection.js ============
// 连接与配置缓存核心模块
// 提供 API 基础地址规范化、请求封装、配置缓存以及统一数据加载能力





const buildModelsEndpoint = (baseUrl) => {
    if (!baseUrl) return '';
    const trimmed = String(baseUrl).trim().replace(/\/+$/g, '');
    if (!trimmed) return '';
    return trimmed.endsWith('/v1') ? `${trimmed}/models` : `${trimmed}/v1/models`;
};

const normalizeApiKeyList = (input) => {
    if (!Array.isArray(input)) return [];
    const seen = new Set();
    const keys = [];

    input.forEach(item => {
        const value = typeof item === 'string'
            ? item
            : (item && item['api-key'] ? item['api-key'] : '');
        const trimmed = String(value || '').trim();
        if (!trimmed || seen.has(trimmed)) {
            return;
        }
        seen.add(trimmed);
        keys.push(trimmed);
    });

    return keys;
};

const connectionModule = {
    // 规范化基础地址，移除尾部斜杠与 /v0/management
    normalizeBase(input) {
        return this.apiClient.normalizeBase(input);
    },

    // 由基础地址生成完整管理 API 地址
    computeApiUrl(base) {
        return this.apiClient.computeApiUrl(base);
    },

    setApiBase(newBase) {
        this.apiClient.setApiBase(newBase);
        this.apiBase = this.apiClient.apiBase;
        this.apiUrl = this.apiClient.apiUrl;
        secureStorage.setItem('apiBase', this.apiBase);
        secureStorage.setItem('apiUrl', this.apiUrl); // 兼容旧字段
        this.updateLoginConnectionInfo();
    },

    setManagementKey(key, { persist = true } = {}) {
        this.managementKey = key || '';
        this.apiClient.setManagementKey(this.managementKey);
        if (persist) {
            secureStorage.setItem('managementKey', this.managementKey);
        }
    },

    // 加载设置（简化版，仅加载内部状态）
    loadSettings() {
        secureStorage.migratePlaintextKeys(['apiBase', 'apiUrl', 'managementKey']);

        const savedBase = secureStorage.getItem('apiBase');
        const savedUrl = secureStorage.getItem('apiUrl');
        const savedKey = secureStorage.getItem('managementKey');

        if (savedBase) {
            this.setApiBase(savedBase);
        } else if (savedUrl) {
            const base = (savedUrl || '').replace(/\/?v0\/management\/?$/i, '');
            this.setApiBase(base);
        } else {
            this.setApiBase(this.detectApiBaseFromLocation());
        }

        this.setManagementKey(savedKey || '', { persist: false });

        this.updateLoginConnectionInfo();
    },

    // 读取并填充管理中心版本号（可能来自构建时注入或占位符）
    initUiVersion() {
        const uiVersion = this.readUiVersionFromDom();
        this.uiVersion = uiVersion;
        this.renderVersionInfo();
    },

    // 从 DOM 获取版本占位符，并处理空值、引号或未替换的占位符
    readUiVersionFromDom() {
        const el = document.getElementById('ui-version');
        if (!el) return null;

        const raw = (el.dataset && el.dataset.uiVersion) ? el.dataset.uiVersion : el.textContent;
        if (typeof raw !== 'string') return null;

        const cleaned = raw.replace(/^"+|"+$/g, '').trim();
        if (!cleaned || cleaned === '__VERSION__') {
            return null;
        }
        return cleaned;
    },

    // 根据响应头更新版本与构建时间
    updateVersionFromHeaders(headers) {
        if (!headers || typeof headers.get !== 'function') {
            return;
        }

        const version = headers.get('X-CPA-VERSION');
        const buildDate = headers.get('X-CPA-BUILD-DATE');
        let updated = false;

        if (version && version !== this.serverVersion) {
            this.serverVersion = version;
            updated = true;
        }

        if (buildDate && buildDate !== this.serverBuildDate) {
            this.serverBuildDate = buildDate;
            updated = true;
        }

        if (updated) {
            this.renderVersionInfo();
        }
    },

    renderVersionCheckStatus({
        currentVersion,
        latestVersion,
        message,
        status
    } = {}) {
        const resolvedCurrent = (typeof currentVersion === 'undefined' || currentVersion === null)
            ? this.serverVersion
            : currentVersion;
        const resolvedLatest = (typeof latestVersion === 'undefined' || latestVersion === null)
            ? this.latestVersion
            : latestVersion;
        const resolvedMessage = (typeof message === 'undefined' || message === null)
            ? (this.versionCheckMessage || i18n.t('system_info.version_check_idle'))
            : message;
        const resolvedStatus = status || this.versionCheckStatus || 'muted';

        this.latestVersion = resolvedLatest || null;
        this.versionCheckMessage = resolvedMessage;
        this.versionCheckStatus = resolvedStatus;

        const currentEl = document.getElementById('version-check-current');
        if (currentEl) {
            currentEl.textContent = resolvedCurrent || i18n.t('system_info.version_unknown');
        }

        const latestEl = document.getElementById('version-check-latest');
        if (latestEl) {
            latestEl.textContent = resolvedLatest || '-';
        }

        const resultEl = document.getElementById('version-check-result');
        if (resultEl) {
            resultEl.textContent = resolvedMessage;
            resultEl.className = `version-check-result ${resolvedStatus}`.trim();
        }
    },

    resetVersionCheckStatus() {
        this.latestVersion = null;
        this.versionCheckMessage = i18n.t('system_info.version_check_idle');
        this.versionCheckStatus = 'muted';
        this.renderVersionCheckStatus({
            currentVersion: this.serverVersion,
            latestVersion: this.latestVersion,
            message: this.versionCheckMessage,
            status: this.versionCheckStatus
        });
    },

    // 渲染底栏的版本与构建时间
    renderVersionInfo() {
        const versionEl = document.getElementById('api-version');
        const buildDateEl = document.getElementById('api-build-date');
        const uiVersionEl = document.getElementById('ui-version');

        if (versionEl) {
            versionEl.textContent = this.serverVersion || '-';
        }

        if (buildDateEl) {
            buildDateEl.textContent = this.serverBuildDate
                ? this.formatBuildDate(this.serverBuildDate)
                : '-';
        }

        if (uiVersionEl) {
            const domVersion = this.readUiVersionFromDom();
            uiVersionEl.textContent = this.uiVersion || domVersion || 'v0.0.0-dev';
        }

        this.renderVersionCheckStatus({
            currentVersion: this.serverVersion,
            latestVersion: this.latestVersion,
            message: this.versionCheckMessage,
            status: this.versionCheckStatus
        });
    },

    // 清空版本信息（例如登出时）
    resetVersionInfo() {
        this.serverVersion = null;
        this.serverBuildDate = null;
        this.resetVersionCheckStatus();
        this.renderVersionInfo();
    },

    // 格式化构建时间，优先使用界面语言对应的本地格式
    formatBuildDate(buildDate) {
        if (!buildDate) return '-';

        const parsed = Date.parse(buildDate);
        if (!Number.isNaN(parsed)) {
            const locale = i18n?.currentLanguage || undefined;
            return new Date(parsed).toLocaleString(locale);
        }

        return buildDate;
    },

    parseVersionSegments(version) {
        if (!version || typeof version !== 'string') return null;
        const cleaned = version.trim().replace(/^v/i, '');
        if (!cleaned) return null;
        const parts = cleaned.split(/[^0-9]+/).filter(Boolean).map(segment => {
            const parsed = parseInt(segment, 10);
            return Number.isFinite(parsed) ? parsed : 0;
        });
        return parts.length ? parts : null;
    },

    compareVersions(latestVersion, currentVersion) {
        const latestParts = this.parseVersionSegments(latestVersion);
        const currentParts = this.parseVersionSegments(currentVersion);
        if (!latestParts || !currentParts) {
            return null;
        }

        const length = Math.max(latestParts.length, currentParts.length);
        for (let i = 0; i < length; i++) {
            const latest = latestParts[i] || 0;
            const current = currentParts[i] || 0;
            if (latest > current) return 1;
            if (latest < current) return -1;
        }

        return 0;
    },

    async checkLatestVersion() {
        if (!this.isConnected) {
            const message = i18n.t('notification.connection_required');
            this.renderVersionCheckStatus({
                currentVersion: this.serverVersion,
                latestVersion: this.latestVersion,
                message,
                status: 'warning'
            });
            this.showNotification(message, 'error');
            return;
        }

        const button = document.getElementById('version-check-btn');
        const originalLabel = button ? button.innerHTML : '';

        if (button) {
            button.disabled = true;
            button.innerHTML = `<div class="loading"></div> ${i18n.t('system_info.version_checking')}`;
        }

        this.renderVersionCheckStatus({
            currentVersion: this.serverVersion,
            latestVersion: this.latestVersion,
            message: i18n.t('system_info.version_checking'),
            status: 'info'
        });

        try {
            const data = await this.makeRequest('/latest-version');
            const latestVersion = data?.['latest-version'] || data?.latest_version || '';
            const latestParts = this.parseVersionSegments(latestVersion);
            const currentParts = this.parseVersionSegments(this.serverVersion);
            const comparison = (latestParts && currentParts)
                ? this.compareVersions(latestVersion, this.serverVersion)
                : null;
            let messageKey = 'system_info.version_check_error';
            let statusClass = 'error';

            if (!latestParts) {
                messageKey = 'system_info.version_check_error';
            } else if (!currentParts) {
                messageKey = 'system_info.version_current_missing';
                statusClass = 'warning';
            } else if (comparison > 0) {
                messageKey = 'system_info.version_update_available';
                statusClass = 'warning';
            } else {
                messageKey = 'system_info.version_is_latest';
                statusClass = 'success';
            }

            const message = i18n.t(messageKey, latestVersion ? { version: latestVersion } : undefined);
            this.renderVersionCheckStatus({
                currentVersion: this.serverVersion,
                latestVersion,
                message,
                status: statusClass
            });

            if (latestVersion && comparison !== null) {
                const notifyKey = comparison > 0
                    ? 'system_info.version_update_available'
                    : 'system_info.version_is_latest';
                const notifyType = comparison > 0 ? 'warning' : 'success';
                this.showNotification(i18n.t(notifyKey, { version: latestVersion }), notifyType);
            }
        } catch (error) {
            const message = `${i18n.t('system_info.version_check_error')}: ${error.message}`;
            this.renderVersionCheckStatus({
                currentVersion: this.serverVersion,
                latestVersion: this.latestVersion,
                message,
                status: 'error'
            });
            this.showNotification(message, 'error');
        } finally {
            if (button) {
                button.disabled = false;
                button.innerHTML = originalLabel;
            }
        }
    },

    // API 请求方法
    async makeRequest(endpoint, options = {}) {
        try {
            return await this.apiClient.request(endpoint, options);
        } catch (error) {
            console.error('API请求失败:', error);
            throw error;
        }
    },

    buildAvailableModelsEndpoint() {
        return buildModelsEndpoint(this.apiBase || this.apiClient?.apiBase || '');
    },

    setAvailableModelsStatus(message = '', type = 'info') {
        const statusEl = document.getElementById('available-models-status');
        if (!statusEl) return;
        statusEl.textContent = message || '';
        statusEl.className = `available-models-status ${type}`;
    },

    renderAvailableModels(models = []) {
        const listEl = document.getElementById('available-models-list');
        if (!listEl) return;

        if (!models.length) {
            listEl.innerHTML = `
                <div class="available-models-empty">
                    <i class="fas fa-inbox"></i>
                    <span>${i18n.t('system_info.models_empty')}</span>
                </div>
            `;
            return;
        }

        const language = (i18n?.currentLanguage || '').toLowerCase();
        const otherLabel = language.startsWith('zh') ? '其他' : 'Other';
        const groups = classifyModels(models, { otherLabel });

        const groupHtml = groups.map(group => {
            const pills = group.items.map(model => {
                const name = this.escapeHtml(model.name || '');
                const alias = model.alias ? `<span class="model-alias">${this.escapeHtml(model.alias)}</span>` : '';
                const description = model.description ? this.escapeHtml(model.description) : '';
                const titleAttr = description ? ` title="${description}"` : '';
                return `
                    <span class="provider-model-tag available-model-tag"${titleAttr}>
                        <span class="model-name">${name}</span>
                        ${alias}
                    </span>
                `;
            }).join('');

            const label = this.escapeHtml(group.label || group.id || '');
            return `
                <div class="available-model-group">
                    <div class="available-model-group-header">
                        <div class="available-model-group-title">
                            <span class="available-model-group-label">${label}</span>
                            <span class="available-model-group-count">${group.items.length}</span>
                        </div>
                    </div>
                    <div class="available-model-group-body">
                        ${pills}
                    </div>
                </div>
            `;
        }).join('');

        listEl.innerHTML = groupHtml;
    },

    clearAvailableModels(messageKey = 'system_info.models_empty') {
        this.availableModels = [];
        this.availableModelApiKeysCache = null;
        const listEl = document.getElementById('available-models-list');
        if (listEl) {
            listEl.innerHTML = '';
        }
        this.setAvailableModelsStatus(i18n.t(messageKey), 'warning');
    },

    async resolveApiKeysForModels({ config = null, forceRefresh = false } = {}) {
        if (!forceRefresh && Array.isArray(this.availableModelApiKeysCache) && this.availableModelApiKeysCache.length) {
            return this.availableModelApiKeysCache;
        }

        const configKeys = normalizeApiKeyList(config?.['api-keys'] || this.configCache?.['api-keys']);
        if (configKeys.length) {
            this.availableModelApiKeysCache = configKeys;
            return configKeys;
        }

        try {
            const data = await this.makeRequest('/api-keys');
            const keys = normalizeApiKeyList(data?.['api-keys']);
            if (keys.length) {
                this.availableModelApiKeysCache = keys;
            }
            return keys;
        } catch (error) {
            console.warn('自动获取 API Key 失败:', error);
            return [];
        }
    },

    async loadAvailableModels({ config = null, forceRefresh = false } = {}) {
        const listEl = document.getElementById('available-models-list');
        const statusEl = document.getElementById('available-models-status');

        if (!listEl || !statusEl) {
            return;
        }

        if (!this.isConnected) {
            this.setAvailableModelsStatus(i18n.t('common.disconnected'), 'warning');
            listEl.innerHTML = '';
            return;
        }

        const endpoint = this.buildAvailableModelsEndpoint();
        if (!endpoint) {
            this.setAvailableModelsStatus(i18n.t('system_info.models_error'), 'error');
            listEl.innerHTML = `
                <div class="available-models-empty">
                    <i class="fas fa-exclamation-circle"></i>
                    <span>${i18n.t('login.error_invalid')}</span>
                </div>
            `;
            return;
        }

        this.availableModelsLoading = true;
        this.setAvailableModelsStatus(i18n.t('system_info.models_loading'), 'info');
        listEl.innerHTML = '<div class="available-models-placeholder"><i class="fas fa-spinner fa-spin"></i></div>';

        try {
            const headers = {};
            const keys = await this.resolveApiKeysForModels({ config, forceRefresh });
            if (keys.length) {
                headers.Authorization = `Bearer ${keys[0]}`;
            }

            const response = await fetch(endpoint, { headers });
            if (!response.ok) {
                throw new Error(`${response.status} ${response.statusText}`);
            }

            let data;
            try {
                data = await response.json();
            } catch (err) {
                const text = await response.text();
                throw new Error(text || err.message || 'Invalid JSON');
            }

            const models = normalizeModelList(data, { dedupe: true });
            this.availableModels = models;

            if (!models.length) {
                this.setAvailableModelsStatus(i18n.t('system_info.models_empty'), 'warning');
                this.renderAvailableModels([]);
                return;
            }

            this.setAvailableModelsStatus(i18n.t('system_info.models_count', { count: models.length }), 'success');
            this.renderAvailableModels(models);
        } catch (error) {
            console.error('加载可用模型失败:', error);
            this.availableModels = [];
            this.setAvailableModelsStatus(`${i18n.t('system_info.models_error')}: ${error.message}`, 'error');
            listEl.innerHTML = `
                <div class="available-models-empty">
                    <i class="fas fa-exclamation-circle"></i>
                    <span>${this.escapeHtml(error.message || '')}</span>
                </div>
            `;
        } finally {
            this.availableModelsLoading = false;
        }
    },

    // 测试连接（简化版，用于内部调用）
    async testConnection() {
        try {
            await this.makeRequest('/debug');
            this.isConnected = true;
            this.updateConnectionStatus();
            this.startStatusUpdateTimer();
            await this.loadAllData();
            return true;
        } catch (error) {
            this.isConnected = false;
            this.updateConnectionStatus();
            this.stopStatusUpdateTimer();
            throw error;
        }
    },

    // 更新连接状态
    updateConnectionStatus() {
        const statusButton = document.getElementById('connection-status');
        const apiStatus = document.getElementById('api-status');
        const configStatus = document.getElementById('config-status');
        const lastUpdate = document.getElementById('last-update');

        if (this.isConnected) {
            statusButton.innerHTML = `<i class="fas fa-circle connection-indicator connected"></i> ${i18n.t('common.connected')}`;
            statusButton.className = 'btn btn-success';
            apiStatus.textContent = i18n.t('common.connected');

            // 更新配置状态
            if (this.isCacheValid()) {
                const fullTimestamp = this.cacheTimestamps && this.cacheTimestamps['__full__'];
                const cacheAge = fullTimestamp
                    ? Math.floor((Date.now() - fullTimestamp) / 1000)
                    : 0;
                configStatus.textContent = `${i18n.t('system_info.cache_data')} (${cacheAge}${i18n.t('system_info.seconds_ago')})`;
                configStatus.style.color = '#f59e0b'; // 橙色表示缓存
            } else if (this.configCache && this.configCache['__full__']) {
                configStatus.textContent = i18n.t('system_info.real_time_data');
                configStatus.style.color = '#10b981'; // 绿色表示实时
            } else {
                configStatus.textContent = i18n.t('system_info.not_loaded');
                configStatus.style.color = '#6b7280'; // 灰色表示未加载
            }
        } else {
            statusButton.innerHTML = `<i class="fas fa-circle connection-indicator disconnected"></i> ${i18n.t('common.disconnected')}`;
            statusButton.className = 'btn btn-danger';
            apiStatus.textContent = i18n.t('common.disconnected');
            configStatus.textContent = i18n.t('system_info.not_loaded');
            configStatus.style.color = '#6b7280';
            this.setAvailableModelsStatus(i18n.t('common.disconnected'), 'warning');
            const modelsList = document.getElementById('available-models-list');
            if (modelsList) {
                modelsList.innerHTML = '';
            }
        }

        lastUpdate.textContent = new Date().toLocaleString('zh-CN');

        if (this.lastEditorConnectionState !== this.isConnected) {
            this.updateConfigEditorAvailability();
        }

        // 更新连接信息显示
        this.updateConnectionInfo();

        if (this.events && typeof this.events.emit === 'function') {
            const shouldEmit = this.lastConnectionStatusEmitted !== this.isConnected;
            if (shouldEmit) {
                this.events.emit('connection:status-changed', {
                    isConnected: this.isConnected,
                    apiBase: this.apiBase
                });
                this.lastConnectionStatusEmitted = this.isConnected;
            }
        }
    },

    // 检查连接状态
    async checkConnectionStatus() {
        await this.testConnection();
    },

    // 刷新所有数据
    async refreshAllData() {
        if (!this.isConnected) {
            this.showNotification(i18n.t('notification.connection_required'), 'error');
            return;
        }

        const button = document.getElementById('refresh-all');
        const originalText = button.innerHTML;

        button.innerHTML = `<div class="loading"></div> ${i18n.t('common.loading')}`;
        button.disabled = true;

        try {
            // 强制刷新，清除缓存
            await this.loadAllData(true);
            this.showNotification(i18n.t('notification.data_refreshed'), 'success');
        } catch (error) {
            this.showNotification(`${i18n.t('notification.refresh_failed')}: ${error.message}`, 'error');
        } finally {
            button.innerHTML = originalText;
            button.disabled = false;
        }
    },

    // 检查缓存是否有效
    isCacheValid(section = null) {
        return this.configService.isCacheValid(section);
    },

    // 获取配置（优先使用缓存，支持按段获取）
    async getConfig(section = null, forceRefresh = false) {
        try {
            const config = await this.configService.getConfig(section, forceRefresh);
            this.configCache = this.configService.cache;
            this.cacheTimestamps = this.configService.cacheTimestamps;
            this.updateConnectionStatus();
            return config;
        } catch (error) {
            console.error('获取配置失败:', error);
            throw error;
        }
    },

    // 清除缓存（支持清除特定配置段）
    clearCache(section = null) {
        this.configService.clearCache(section);
        this.configCache = this.configService.cache;
        this.cacheTimestamps = this.configService.cacheTimestamps;
        if (!section || section === 'api-keys') {
            this.availableModelApiKeysCache = null;
        }
        if (!section) {
            this.configYamlCache = '';
            this.availableModels = [];
        }
    },

    // 启动状态更新定时器
    startStatusUpdateTimer() {
        if (this.statusUpdateTimer) {
            clearInterval(this.statusUpdateTimer);
        }
        this.statusUpdateTimer = setInterval(() => {
            if (this.isConnected) {
                this.updateConnectionStatus();
            }
        }, STATUS_UPDATE_INTERVAL_MS);
    },

    // 停止状态更新定时器
    stopStatusUpdateTimer() {
        if (this.statusUpdateTimer) {
            clearInterval(this.statusUpdateTimer);
            this.statusUpdateTimer = null;
        }
    },

    // 加载所有数据 - 使用新的 /config 端点一次性获取所有配置
    async loadAllData(forceRefresh = false) {
        try {
            console.log(i18n.t('system_info.real_time_data'));
            // 使用新的 /config 端点一次性获取所有配置
            // 注意：getConfig(section, forceRefresh)，不传 section 表示获取全部
            const config = await this.getConfig(null, forceRefresh);

            // 获取一次usage统计数据，供渲染函数和loadUsageStats复用
            let usageData = null;
            let keyStats = null;
            try {
                const response = await this.makeRequest('/usage');
                usageData = response?.usage || null;
                if (usageData) {
                    keyStats = await this.getKeyStats(usageData);
                }
            } catch (error) {
                console.warn('获取usage统计失败:', error);
            }

            // 从配置中提取并设置各个设置项（现在传递keyStats）
            await this.updateSettingsFromConfig(config, keyStats);

            await this.loadAvailableModels({ config, forceRefresh });

            if (this.events && typeof this.events.emit === 'function') {
                this.events.emit('data:config-loaded', {
                    config,
                    usageData,
                    keyStats,
                    forceRefresh
                });
            }

            console.log('配置加载完成，使用缓存:', !forceRefresh && this.isCacheValid());
        } catch (error) {
            console.error('加载配置失败:', error);
        }
    },

    // 从配置对象更新所有设置 —— 委派给 settings 模块，保持兼容旧调用
    async updateSettingsFromConfig(config, keyStats = null) {
        if (typeof this.applySettingsFromConfig === 'function') {
            return this.applySettingsFromConfig(config, keyStats);
        }
    },

    detectApiBaseFromLocation() {
        try {
            const { protocol, hostname, port } = window.location;
            const normalizedPort = port ? `:${port}` : '';
            return this.normalizeBase(`${protocol}//${hostname}${normalizedPort}`);
        } catch (error) {
            console.warn('无法从当前地址检测 API 基础地址，使用默认设置', error);
            return this.normalizeBase(this.apiBase || `http://localhost:${DEFAULT_API_PORT}`);
        }
    }
};



// ============ src/core/api-client.js ============
// API 客户端：负责规范化基础地址、构造完整 URL、发送请求并回传版本信息
class ApiClient {
    constructor({ apiBase = '', managementKey = '', onVersionUpdate = null } = {}) {
        this.apiBase = '';
        this.apiUrl = '';
        this.managementKey = managementKey || '';
        this.onVersionUpdate = onVersionUpdate;
        this.setApiBase(apiBase);
    }

    buildHeaders(options = {}) {
        const customHeaders = options.headers || {};
        const headers = {
            'Authorization': `Bearer ${this.managementKey}`,
            ...customHeaders
        };
        const hasContentType = Object.keys(headers).some(key => key.toLowerCase() === 'content-type');
        const body = options.body;
        const isFormData = typeof FormData !== 'undefined' && body instanceof FormData;
        if (!hasContentType && !isFormData) {
            headers['Content-Type'] = 'application/json';
        }
        return headers;
    }

    normalizeBase(input) {
        let base = (input || '').trim();
        if (!base) return '';
        base = base.replace(/\/?v0\/management\/?$/i, '');
        base = base.replace(/\/+$/i, '');
        if (!/^https?:\/\//i.test(base)) {
            base = 'http://' + base;
        }
        return base;
    }

    computeApiUrl(base) {
        const normalized = this.normalizeBase(base);
        if (!normalized) return '';
        return normalized.replace(/\/$/, '') + '/v0/management';
    }

    setApiBase(newBase) {
        this.apiBase = this.normalizeBase(newBase);
        this.apiUrl = this.computeApiUrl(this.apiBase);
        return this.apiUrl;
    }

    setManagementKey(key) {
        this.managementKey = key || '';
    }

    async request(endpoint, options = {}) {
        const url = `${this.apiUrl}${endpoint}`;
        const headers = this.buildHeaders(options);

        const response = await fetch(url, {
            ...options,
            headers
        });

        if (typeof this.onVersionUpdate === 'function') {
            this.onVersionUpdate(response.headers);
        }

        if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(errorData.error || `HTTP ${response.status}`);
        }

        return await response.json();
    }

    // 返回原始 Response，供下载/自定义解析使用
    async requestRaw(endpoint, options = {}) {
        const url = `${this.apiUrl}${endpoint}`;
        const headers = this.buildHeaders(options);
        const response = await fetch(url, {
            ...options,
            headers
        });
        if (typeof this.onVersionUpdate === 'function') {
            this.onVersionUpdate(response.headers);
        }
        return response;
    }
}



// ============ src/core/config-service.js ============
// 配置缓存服务：负责分段/全量读取配置与缓存控制，不涉及任何 DOM
class ConfigService {
    constructor({ apiClient, cacheExpiry }) {
        this.apiClient = apiClient;
        this.cacheExpiry = cacheExpiry;
        this.cache = {};
        this.cacheTimestamps = {};
    }

    isCacheValid(section = null) {
        if (section) {
            if (!(section in this.cache) || !(section in this.cacheTimestamps)) {
                return false;
            }
            return (Date.now() - this.cacheTimestamps[section]) < this.cacheExpiry;
        }
        if (!this.cache['__full__'] || !this.cacheTimestamps['__full__']) {
            return false;
        }
        return (Date.now() - this.cacheTimestamps['__full__']) < this.cacheExpiry;
    }

    clearCache(section = null) {
        if (section) {
            delete this.cache[section];
            delete this.cacheTimestamps[section];
            if (this.cache['__full__']) {
                delete this.cache['__full__'][section];
            }
            return;
        }
        Object.keys(this.cache).forEach(key => delete this.cache[key]);
        Object.keys(this.cacheTimestamps).forEach(key => delete this.cacheTimestamps[key]);
    }

    async getConfig(section = null, forceRefresh = false) {
        const now = Date.now();

        if (section && !forceRefresh && this.isCacheValid(section)) {
            return this.cache[section];
        }

        if (!section && !forceRefresh && this.isCacheValid()) {
            return this.cache['__full__'];
        }

        const config = await this.apiClient.request('/config');

        if (section) {
            this.cache[section] = config[section];
            this.cacheTimestamps[section] = now;
            if (this.cache['__full__']) {
                this.cache['__full__'][section] = config[section];
            } else {
                this.cache['__full__'] = config;
                this.cacheTimestamps['__full__'] = now;
            }
            return config[section];
        }

        this.cache['__full__'] = config;
        this.cacheTimestamps['__full__'] = now;
        Object.keys(config).forEach(key => {
            this.cache[key] = config[key];
            this.cacheTimestamps[key] = now;
        });

        return config;
    }
}



// ============ src/core/event-bus.js ============
// 轻量事件总线，避免模块之间的直接耦合
function createEventBus() {
    const target = new EventTarget();

    const on = (type, listener) => target.addEventListener(type, listener);
    const off = (type, listener) => target.removeEventListener(type, listener);
    const emit = (type, detail = {}) => target.dispatchEvent(new CustomEvent(type, { detail }));

    return { on, off, emit };
}


// ============ Main ============
// 模块导入













// 工具函数导入






// 核心服务导入






// CLI Proxy API 管理界面 JavaScript
class CLIProxyManager {
    constructor() {
        // 事件总线
        this.events = createEventBus();

        // API 客户端（规范化基础地址、封装请求）
        this.apiClient = new ApiClient({
            onVersionUpdate: (headers) => this.updateVersionFromHeaders(headers)
        });
        const detectedBase = this.detectApiBaseFromLocation();
        this.apiClient.setApiBase(detectedBase);
        this.apiBase = this.apiClient.apiBase;
        this.apiUrl = this.apiClient.apiUrl;
        this.managementKey = '';
        this.isConnected = false;
        this.isLoggedIn = false;
        this.uiVersion = null;
        this.serverVersion = null;
        this.serverBuildDate = null;
        this.latestVersion = null;
        this.versionCheckStatus = 'muted';
        this.versionCheckMessage = i18n.t('system_info.version_check_idle');

        // 配置缓存 - 改为分段缓存（交由 ConfigService 管理）
        this.cacheExpiry = CACHE_EXPIRY_MS;
        this.configService = new ConfigService({
            apiClient: this.apiClient,
            cacheExpiry: this.cacheExpiry
        });
        this.configCache = this.configService.cache;
        this.cacheTimestamps = this.configService.cacheTimestamps;
        this.availableModels = [];
        this.availableModelApiKeysCache = null;
        this.availableModelsLoading = false;

        // 状态更新定时器
        this.statusUpdateTimer = null;
        this.lastConnectionStatusEmitted = null;
        this.isGlobalRefreshInProgress = false;

        this.registerCoreEventHandlers();

        // 日志自动刷新定时器
        this.logsRefreshTimer = null;

        // 当前展示的日志行
        this.allLogLines = [];
        this.displayedLogLines = [];
        this.logSearchQuery = '';
        this.maxDisplayLogLines = MAX_LOG_LINES;
        this.logFetchLimit = LOG_FETCH_LIMIT;

        // 日志时间戳（用于增量加载）
        this.latestLogTimestamp = null;

        // Auth file filter state cache
        this.currentAuthFileFilter = 'all';
        this.cachedAuthFiles = [];
        this.authFilesPagination = {
            pageSize: DEFAULT_AUTH_FILES_PAGE_SIZE,
            currentPage: 1,
            totalPages: 1
        };
        this.authFileStatsCache = {};
        this.authFileSearchQuery = '';
        this.authFilesPageSizeKey = STORAGE_KEY_AUTH_FILES_PAGE_SIZE;
        this.loadAuthFilePreferences();

        // OAuth 模型排除列表状态
        this.oauthExcludedModels = {};
        this._oauthExcludedLoading = false;

        // Vertex AI credential import state
        this.vertexImportState = {
            file: null,
            loading: false,
            result: null
        };

        // 顶栏标题动画状态
        this.brandCollapseTimer = null;
        this.brandCollapseDelayMs = 5000;
        this.brandIsCollapsed = false;
        this.brandAnimationReady = false;
        this.brandElements = {
            toggle: null,
            wrapper: null,
            fullText: null,
            shortText: null
        };
        this.brandResizeHandler = null;
        this.brandToggleHandler = null;

        // 主题管理
        this.currentTheme = 'light';

        // 配置文件编辑器状态
        this.configYamlCache = '';
        this.isConfigEditorDirty = false;
        this.configEditorElements = {
            textarea: null,
            editorInstance: null,
            saveBtn: null,
            reloadBtn: null,
            statusEl: null
        };
        this.lastConfigFetchUrl = null;
        this.lastEditorConnectionState = null;

        // 初始化错误处理器
        this.errorHandler = createErrorHandler((message, type) => this.showNotification(message, type));

        this.init();
    }

    loadAuthFilePreferences() {
        try {
            if (typeof localStorage === 'undefined') {
                return;
            }
            const savedPageSize = parseInt(localStorage.getItem(this.authFilesPageSizeKey), 10);
            if (Number.isFinite(savedPageSize)) {
                this.authFilesPagination.pageSize = this.normalizeAuthFilesPageSize(savedPageSize);
            }
        } catch (error) {
            console.warn('Failed to restore auth file preferences:', error);
        }
    }

    normalizeAuthFilesPageSize(value) {
        const defaultSize = DEFAULT_AUTH_FILES_PAGE_SIZE;
        const minSize = MIN_AUTH_FILES_PAGE_SIZE;
        const maxSize = MAX_AUTH_FILES_PAGE_SIZE;
        const parsed = parseInt(value, 10);
        if (!Number.isFinite(parsed) || parsed <= 0) {
            return defaultSize;
        }
        return Math.min(maxSize, Math.max(minSize, parsed));
    }

    init() {
        this.initUiVersion();
        this.initializeTheme();
        this.registerCoreEventHandlers();
        this.registerSettingsListeners();
        this.registerUsageListeners();
        if (typeof this.registerLogsListeners === 'function') {
            this.registerLogsListeners();
        }
        if (typeof this.registerConfigEditorListeners === 'function') {
            this.registerConfigEditorListeners();
        }
        this.checkLoginStatus();
        this.bindEvents();
        this.setupNavigation();
        this.setupLanguageSwitcher();
        this.setupThemeSwitcher();
        this.setupConfigEditor();
        this.updateConfigEditorAvailability();
        // loadSettings 将在登录成功后调用
        this.updateLoginConnectionInfo();
        // 检查主机名，如果不是 localhost 或 127.0.0.1，则隐藏 OAuth 登录框
        this.checkHostAndHideOAuth();
        if (typeof this.registerAuthFilesListeners === 'function') {
            this.registerAuthFilesListeners();
        }
    }

    registerCoreEventHandlers() {
        if (!this.events || typeof this.events.on !== 'function') {
            return;
        }
        this.events.on('config:refresh-requested', async (event) => {
            const detail = event?.detail || {};
            const forceRefresh = detail.forceRefresh !== false;
            // 避免并发触发导致重复请求
            if (this.isGlobalRefreshInProgress) {
                return;
            }
            await this.runGlobalRefresh(forceRefresh);
        });
    }

    async runGlobalRefresh(forceRefresh = false) {
        this.isGlobalRefreshInProgress = true;
        try {
            await this.loadAllData(forceRefresh);
        } finally {
            this.isGlobalRefreshInProgress = false;
        }
    }

    isLocalHostname(hostname = (typeof window !== 'undefined' ? window.location.hostname : '')) {
        const host = (hostname || '').toLowerCase();
        return host === 'localhost' || host === '127.0.0.1' || host === '::1';
    }

    isIflowOAuthAllowed(hostname = (typeof window !== 'undefined' ? window.location.hostname : '')) {
        const host = (hostname || '').toLowerCase();
        // iFlow OAuth 仅允许在本机回环地址访问
        return host === '127.0.0.1' || host === 'localhost' || host === '::1';
    }

    // 检查主机名并隐藏 OAuth 登录框
    checkHostAndHideOAuth() {
        const hostname = window.location.hostname;
        const isLocalhost = this.isLocalHostname(hostname);
        const isIflowOAuthAllowed = this.isIflowOAuthAllowed(hostname);

        if (!isLocalhost) {
            // 隐藏所有 OAuth 登录卡片(除了 iFlow, 因为它有 Cookie 登录功能可远程使用)
            OAUTH_CARD_IDS.forEach(cardId => {
                const card = document.getElementById(cardId);
                if (card) {
                    card.style.display = 'none';
                }
            });

            // 如果找不到具体的卡片 ID，尝试通过类名查找
            const oauthCardElements = document.querySelectorAll('.card');
            oauthCardElements.forEach(card => {
                const cardText = card.textContent || '';
                // 不再隐藏包含 'iFlow' 的卡片
                if (cardText.includes('Codex OAuth') ||
                    cardText.includes('Anthropic OAuth') ||
                    cardText.includes('Antigravity OAuth') ||
                    cardText.includes('Gemini CLI OAuth') ||
                    cardText.includes('Qwen OAuth')) {
                    card.style.display = 'none';
                }
            });

            console.log(`当前主机名: ${hostname}，已隐藏 OAuth 登录框(保留 iFlow Cookie 登录)`);
        }

        if (!isIflowOAuthAllowed) {
            // 对于 iFlow card, 仅在本机允许 OAuth，其余情况只保留 Cookie 登录
            const iflowCard = document.getElementById('iflow-oauth-card');
            if (iflowCard) {
                const oauthContent = document.getElementById('iflow-oauth-content');
                const oauthButton = document.getElementById('iflow-oauth-btn');
                const oauthStatus = document.getElementById('iflow-oauth-status');
                const oauthUrlGroup = document.getElementById('iflow-oauth-url')?.closest('.form-group');
                const oauthHint = iflowCard.querySelector('[data-i18n="auth_login.iflow_oauth_hint"]');

                if (oauthContent) oauthContent.style.display = 'none';
                if (oauthButton) oauthButton.style.display = 'none';
                if (oauthStatus) {
                    oauthStatus.textContent = i18n.t('auth_login.iflow_oauth_local_only');
                    oauthStatus.style.display = 'block';
                    oauthStatus.style.color = 'var(--warning-text)';
                }
                if (oauthUrlGroup) oauthUrlGroup.style.display = 'none';
                if (oauthHint) oauthHint.style.display = 'none';

                // 保持整个 card 可见, 因为 Cookie 登录部分仍然可用
                iflowCard.style.display = 'block';
            }

            console.log(`当前主机名: ${hostname}，iFlow OAuth 已限制为本机访问，仅保留 Cookie 登录`);
        }
    }

    // 检查登录状态
    // 处理登录表单提交
    // 事件绑定
    bindEvents() {
        // 登录相关（安全绑定）
        const loginSubmit = document.getElementById('login-submit');
        const logoutBtn = document.getElementById('logout-btn');

        if (loginSubmit) {
            loginSubmit.addEventListener('click', () => this.handleLogin());
        }
        if (logoutBtn) {
            logoutBtn.addEventListener('click', () => this.logout());
        }

        // 密钥可见性切换事件
        this.setupKeyVisibilityToggle();

        // 主页面元素（延迟绑定，在显示主页面时绑定）
        this.bindMainPageEvents();
    }

    // 设置密钥可见性切换
    setupKeyVisibilityToggle() {
        const toggleButtons = document.querySelectorAll('.toggle-key-visibility');
        toggleButtons.forEach(button => {
            button.addEventListener('click', () => this.toggleLoginKeyVisibility(button));
        });
    }

    // 绑定主页面事件
    bindMainPageEvents() {
        // 连接状态检查
        const connectionStatus = document.getElementById('connection-status');
        const refreshAll = document.getElementById('refresh-all');
        const availableModelsRefresh = document.getElementById('available-models-refresh');
        const versionCheckBtn = document.getElementById('version-check-btn');

        if (connectionStatus) {
            connectionStatus.addEventListener('click', () => this.checkConnectionStatus());
        }
        if (refreshAll) {
            refreshAll.addEventListener('click', () => this.refreshAllData());
        }
        if (availableModelsRefresh) {
            availableModelsRefresh.addEventListener('click', () => this.loadAvailableModels({ forceRefresh: true }));
        }
        if (versionCheckBtn) {
            versionCheckBtn.addEventListener('click', () => this.checkLatestVersion());
        }

        // 基础设置
        const debugToggle = document.getElementById('debug-toggle');
        const updateProxy = document.getElementById('update-proxy');
        const clearProxy = document.getElementById('clear-proxy');
        const updateRetry = document.getElementById('update-retry');
        const switchProjectToggle = document.getElementById('switch-project-toggle');
        const switchPreviewToggle = document.getElementById('switch-preview-model-toggle');
        const usageStatisticsToggle = document.getElementById('usage-statistics-enabled-toggle');
        const requestLogToggle = document.getElementById('request-log-toggle');
        const wsAuthToggle = document.getElementById('ws-auth-toggle');

        if (debugToggle) {
            debugToggle.addEventListener('change', (e) => this.updateDebug(e.target.checked));
        }
        if (updateProxy) {
            updateProxy.addEventListener('click', () => this.updateProxyUrl());
        }
        if (clearProxy) {
            clearProxy.addEventListener('click', () => this.clearProxyUrl());
        }
        if (updateRetry) {
            updateRetry.addEventListener('click', () => this.updateRequestRetry());
        }
        if (switchProjectToggle) {
            switchProjectToggle.addEventListener('change', (e) => this.updateSwitchProject(e.target.checked));
        }
        if (switchPreviewToggle) {
            switchPreviewToggle.addEventListener('change', (e) => this.updateSwitchPreviewModel(e.target.checked));
        }
        if (usageStatisticsToggle) {
            usageStatisticsToggle.addEventListener('change', (e) => this.updateUsageStatisticsEnabled(e.target.checked));
        }
        if (requestLogToggle) {
            requestLogToggle.addEventListener('change', (e) => this.updateRequestLog(e.target.checked));
        }
        if (wsAuthToggle) {
            wsAuthToggle.addEventListener('change', (e) => this.updateWsAuth(e.target.checked));
        }

        // 日志记录设置
        const loggingToFileToggle = document.getElementById('logging-to-file-toggle');
        if (loggingToFileToggle) {
            loggingToFileToggle.addEventListener('change', (e) => this.updateLoggingToFile(e.target.checked));
        }

        // 日志查看
        const refreshLogs = document.getElementById('refresh-logs');
        const selectErrorLog = document.getElementById('select-error-log');
        const downloadLogs = document.getElementById('download-logs');
        const clearLogs = document.getElementById('clear-logs');
        const logsAutoRefreshToggle = document.getElementById('logs-auto-refresh-toggle');
        const logsSearchInput = document.getElementById('logs-search-input');

        if (refreshLogs) {
            refreshLogs.addEventListener('click', () => this.refreshLogs());
        }
        if (selectErrorLog) {
            selectErrorLog.addEventListener('click', () => this.openErrorLogsModal());
        }
        if (downloadLogs) {
            downloadLogs.addEventListener('click', () => this.downloadLogs());
        }
        if (clearLogs) {
            clearLogs.addEventListener('click', () => this.clearLogs());
        }
        if (logsAutoRefreshToggle) {
            logsAutoRefreshToggle.addEventListener('change', (e) => this.toggleLogsAutoRefresh(e.target.checked));
        }
        if (logsSearchInput) {
            const debouncedLogSearch = this.debounce((value) => {
                this.updateLogSearchQuery(value);
            }, 200);
            logsSearchInput.addEventListener('input', (e) => {
                debouncedLogSearch(e?.target?.value ?? '');
            });
        }

        // API 密钥管理
        const addApiKey = document.getElementById('add-api-key');
        const addGeminiKey = document.getElementById('add-gemini-key');
        const addCodexKey = document.getElementById('add-codex-key');
        const addClaudeKey = document.getElementById('add-claude-key');
        const addOpenaiProvider = document.getElementById('add-openai-provider');

        if (addApiKey) {
            addApiKey.addEventListener('click', () => this.showAddApiKeyModal());
        }
        if (addGeminiKey) {
            addGeminiKey.addEventListener('click', () => this.showAddGeminiKeyModal());
        }
        if (addCodexKey) {
            addCodexKey.addEventListener('click', () => this.showAddCodexKeyModal());
        }
        if (addClaudeKey) {
            addClaudeKey.addEventListener('click', () => this.showAddClaudeKeyModal());
        }
        if (addOpenaiProvider) {
            addOpenaiProvider.addEventListener('click', () => this.showAddOpenAIProviderModal());
        }


        // 认证文件管理
        const uploadAuthFile = document.getElementById('upload-auth-file');
        const deleteAllAuthFiles = document.getElementById('delete-all-auth-files');
        const authFileInput = document.getElementById('auth-file-input');

        if (uploadAuthFile) {
            uploadAuthFile.addEventListener('click', () => this.uploadAuthFile());
        }
        if (deleteAllAuthFiles) {
            deleteAllAuthFiles.addEventListener('click', () => this.deleteAllAuthFiles());
        }
        if (authFileInput) {
            authFileInput.addEventListener('change', (e) => this.handleFileUpload(e));
        }
        this.bindAuthFilesPaginationEvents();
        this.bindAuthFilesSearchControl();
        this.bindAuthFilesPageSizeControl();
        this.syncAuthFileControls();

        // OAuth 排除列表
        const oauthExcludedAdd = document.getElementById('oauth-excluded-add');
        const oauthExcludedRefresh = document.getElementById('oauth-excluded-refresh');

        if (oauthExcludedAdd) {
            oauthExcludedAdd.addEventListener('click', () => this.openOauthExcludedEditor());
        }
        if (oauthExcludedRefresh) {
            oauthExcludedRefresh.addEventListener('click', () => this.loadOauthExcludedModels(true));
        }

        // Vertex AI credential import
        const vertexSelectFile = document.getElementById('vertex-select-file');
        const vertexFileInput = document.getElementById('vertex-file-input');
        const vertexImportBtn = document.getElementById('vertex-import-btn');

        if (vertexSelectFile) {
            vertexSelectFile.addEventListener('click', () => this.openVertexFilePicker());
        }
        if (vertexFileInput) {
            vertexFileInput.addEventListener('change', (e) => this.handleVertexFileSelection(e));
        }
        if (vertexImportBtn) {
            vertexImportBtn.addEventListener('click', () => this.importVertexCredential());
        }
        this.updateVertexFileDisplay();
        this.updateVertexImportButtonState();
        this.renderVertexImportResult(this.vertexImportState.result);

        // Codex OAuth
        const codexOauthBtn = document.getElementById('codex-oauth-btn');
        const codexOpenLink = document.getElementById('codex-open-link');
        const codexCopyLink = document.getElementById('codex-copy-link');

        if (codexOauthBtn) {
            codexOauthBtn.addEventListener('click', () => this.startCodexOAuth());
        }
        if (codexOpenLink) {
            codexOpenLink.addEventListener('click', () => this.openCodexLink());
        }
        if (codexCopyLink) {
            codexCopyLink.addEventListener('click', () => this.copyCodexLink());
        }

        // Anthropic OAuth
        const anthropicOauthBtn = document.getElementById('anthropic-oauth-btn');
        const anthropicOpenLink = document.getElementById('anthropic-open-link');
        const anthropicCopyLink = document.getElementById('anthropic-copy-link');

        if (anthropicOauthBtn) {
            anthropicOauthBtn.addEventListener('click', () => this.startAnthropicOAuth());
        }
        if (anthropicOpenLink) {
            anthropicOpenLink.addEventListener('click', () => this.openAnthropicLink());
        }
        if (anthropicCopyLink) {
            anthropicCopyLink.addEventListener('click', () => this.copyAnthropicLink());
        }

        // Antigravity OAuth
        const antigravityOauthBtn = document.getElementById('antigravity-oauth-btn');
        const antigravityOpenLink = document.getElementById('antigravity-open-link');
        const antigravityCopyLink = document.getElementById('antigravity-copy-link');

        if (antigravityOauthBtn) {
            antigravityOauthBtn.addEventListener('click', () => this.startAntigravityOAuth());
        }
        if (antigravityOpenLink) {
            antigravityOpenLink.addEventListener('click', () => this.openAntigravityLink());
        }
        if (antigravityCopyLink) {
            antigravityCopyLink.addEventListener('click', () => this.copyAntigravityLink());
        }

        // Gemini CLI OAuth
        const geminiCliOauthBtn = document.getElementById('gemini-cli-oauth-btn');
        const geminiCliOpenLink = document.getElementById('gemini-cli-open-link');
        const geminiCliCopyLink = document.getElementById('gemini-cli-copy-link');

        if (geminiCliOauthBtn) {
            geminiCliOauthBtn.addEventListener('click', () => this.startGeminiCliOAuth());
        }
        if (geminiCliOpenLink) {
            geminiCliOpenLink.addEventListener('click', () => this.openGeminiCliLink());
        }
        if (geminiCliCopyLink) {
            geminiCliCopyLink.addEventListener('click', () => this.copyGeminiCliLink());
        }

        // Qwen OAuth
        const qwenOauthBtn = document.getElementById('qwen-oauth-btn');
        const qwenOpenLink = document.getElementById('qwen-open-link');
        const qwenCopyLink = document.getElementById('qwen-copy-link');

        if (qwenOauthBtn) {
            qwenOauthBtn.addEventListener('click', () => this.startQwenOAuth());
        }
        if (qwenOpenLink) {
            qwenOpenLink.addEventListener('click', () => this.openQwenLink());
        }
        if (qwenCopyLink) {
            qwenCopyLink.addEventListener('click', () => this.copyQwenLink());
        }

        // iFlow OAuth
        const iflowOauthBtn = document.getElementById('iflow-oauth-btn');
        const iflowOpenLink = document.getElementById('iflow-open-link');
        const iflowCopyLink = document.getElementById('iflow-copy-link');
        const iflowCookieSubmit = document.getElementById('iflow-cookie-submit');

        if (iflowOauthBtn) {
            iflowOauthBtn.addEventListener('click', () => this.startIflowOAuth());
        }
        if (iflowOpenLink) {
            iflowOpenLink.addEventListener('click', () => this.openIflowLink());
        }
        if (iflowCopyLink) {
            iflowCopyLink.addEventListener('click', () => this.copyIflowLink());
        }
        if (iflowCookieSubmit) {
            iflowCookieSubmit.addEventListener('click', () => this.submitIflowCookieLogin());
        }

        // 使用统计
        const refreshUsageStats = document.getElementById('refresh-usage-stats');
        const requestsHourBtn = document.getElementById('requests-hour-btn');
        const requestsDayBtn = document.getElementById('requests-day-btn');
        const tokensHourBtn = document.getElementById('tokens-hour-btn');
        const tokensDayBtn = document.getElementById('tokens-day-btn');
        const costHourBtn = document.getElementById('cost-hour-btn');
        const costDayBtn = document.getElementById('cost-day-btn');
        const addChartLineBtn = document.getElementById('add-chart-line');
        const chartLineSelects = document.querySelectorAll('.chart-line-select');
        const chartLineDeleteButtons = document.querySelectorAll('.chart-line-delete');
        const modelPriceForm = document.getElementById('model-price-form');
        const resetModelPricesBtn = document.getElementById('reset-model-prices');
        const modelPriceSelect = document.getElementById('model-price-model-select');

        if (refreshUsageStats) {
            refreshUsageStats.addEventListener('click', () => this.loadUsageStats());
        }
        if (requestsHourBtn) {
            requestsHourBtn.addEventListener('click', () => this.switchRequestsPeriod('hour'));
        }
        if (requestsDayBtn) {
            requestsDayBtn.addEventListener('click', () => this.switchRequestsPeriod('day'));
        }
        if (tokensHourBtn) {
            tokensHourBtn.addEventListener('click', () => this.switchTokensPeriod('hour'));
        }
        if (tokensDayBtn) {
            tokensDayBtn.addEventListener('click', () => this.switchTokensPeriod('day'));
        }
        if (costHourBtn) {
            costHourBtn.addEventListener('click', () => this.switchCostPeriod('hour'));
        }
        if (costDayBtn) {
            costDayBtn.addEventListener('click', () => this.switchCostPeriod('day'));
        }
        if (addChartLineBtn) {
            addChartLineBtn.addEventListener('click', () => this.changeChartLineCount(1));
        }
        if (chartLineSelects.length) {
            chartLineSelects.forEach(select => {
                select.addEventListener('change', (event) => {
                    const index = Number.parseInt(select.getAttribute('data-line-index'), 10);
                    this.handleChartLineSelectionChange(Number.isNaN(index) ? -1 : index, event.target.value);
                });
            });
        }
        if (chartLineDeleteButtons.length) {
            chartLineDeleteButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const index = Number.parseInt(button.getAttribute('data-line-index'), 10);
                    this.removeChartLine(Number.isNaN(index) ? -1 : index);
                });
            });
        }
        this.updateChartLineControlsUI();
        if (modelPriceForm) {
            modelPriceForm.addEventListener('submit', (event) => {
                event.preventDefault();
                this.handleModelPriceSubmit();
            });
        }
        if (resetModelPricesBtn) {
            resetModelPricesBtn.addEventListener('click', () => this.handleModelPriceReset());
        }
        if (modelPriceSelect) {
            modelPriceSelect.addEventListener('change', () => this.prefillModelPriceInputs());
        }

        // 模态框
        const closeBtn = document.querySelector('.close');
        if (closeBtn) {
            closeBtn.addEventListener('click', () => this.closeModal());
        }

        // 移动端菜单按钮
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        const sidebar = document.getElementById('sidebar');

        if (mobileMenuBtn) {
            mobileMenuBtn.addEventListener('click', () => this.toggleMobileSidebar());
        }

        if (sidebarOverlay) {
            sidebarOverlay.addEventListener('click', () => this.closeMobileSidebar());
        }

        // 侧边栏收起/展开按钮（桌面端）
        const sidebarToggleBtnDesktop = document.getElementById('sidebar-toggle-btn-desktop');
        if (sidebarToggleBtnDesktop) {
            sidebarToggleBtnDesktop.addEventListener('click', () => this.toggleSidebar());
        }

        // 从本地存储恢复侧边栏状态
        this.restoreSidebarState();

        // 监听窗口大小变化
        window.addEventListener('resize', () => {
            const sidebar = document.getElementById('sidebar');
            const layout = document.getElementById('layout-container');

            if (window.innerWidth <= 1024) {
                // 移动端：移除收起状态
                if (sidebar && layout) {
                    sidebar.classList.remove('collapsed');
                    layout.classList.remove('sidebar-collapsed');
                }
            } else {
                // 桌面端：恢复保存的状态
                this.restoreSidebarState();
            }
        });

        // 点击侧边栏导航项时在移动端关闭侧边栏
        const navItems = document.querySelectorAll('.nav-item');
        navItems.forEach(item => {
            item.addEventListener('click', () => {
                if (window.innerWidth <= 1024) {
                    this.closeMobileSidebar();
                }
            });
        });
    }

    // 顶栏标题动画与状态
    isMobileViewport() {
        return typeof window !== 'undefined' ? window.innerWidth <= 768 : false;
    }

    setupBrandTitleAnimation() {
        const mainPage = document.getElementById('main-page');
        if (mainPage && mainPage.style.display === 'none') {
            return;
        }

        const toggle = document.getElementById('brand-name-toggle');
        const wrapper = document.getElementById('brand-texts');
        const fullText = document.querySelector('.brand-text-full');
        const shortText = document.querySelector('.brand-text-short');

        if (!toggle || !wrapper || !fullText || !shortText) {
            return;
        }

        this.brandElements = { toggle, wrapper, fullText, shortText };

        if (!this.brandToggleHandler) {
            this.brandToggleHandler = () => this.handleBrandToggle();
            toggle.addEventListener('click', this.brandToggleHandler);
        }
        if (!this.brandResizeHandler) {
            this.brandResizeHandler = () => this.handleBrandResize();
            window.addEventListener('resize', this.brandResizeHandler);
        }

        if (this.isMobileViewport()) {
            this.applyMobileBrandState();
        } else {
            this.enableBrandAnimation();
        }
    }

    enableBrandAnimation() {
        const { toggle } = this.brandElements || {};
        if (toggle) {
            toggle.removeAttribute('aria-disabled');
            toggle.style.pointerEvents = '';
        }
        this.brandAnimationReady = true;
    }

    applyMobileBrandState() {
        const { toggle, wrapper, shortText } = this.brandElements || {};
        if (!toggle || !wrapper || !shortText) {
            return;
        }

        this.clearBrandCollapseTimer();
        this.brandIsCollapsed = true;
        this.brandAnimationReady = false;

        toggle.classList.add('collapsed');
        toggle.classList.remove('expanded');
        toggle.setAttribute('aria-disabled', 'true');
        toggle.style.pointerEvents = 'none';

        const targetWidth = this.getBrandTextWidth(shortText);
        this.applyBrandWidth(targetWidth, { animate: false });
    }

    getBrandTextWidth(element) {
        if (!element) {
            return 0;
        }
        const width = element.scrollWidth || element.getBoundingClientRect().width || 0;
        return Number.isFinite(width) ? Math.ceil(width) : 0;
    }

    applyBrandWidth(targetWidth, { animate = true } = {}) {
        const wrapper = this.brandElements?.wrapper;
        if (!wrapper || !Number.isFinite(targetWidth)) {
            return;
        }

        if (!animate) {
            const previousTransition = wrapper.style.transition;
            wrapper.style.transition = 'none';
            wrapper.style.width = `${targetWidth}px`;
            wrapper.getBoundingClientRect(); // 强制重绘以应用无动画的宽度
            wrapper.style.transition = previousTransition;
            return;
        }

        wrapper.style.width = `${targetWidth}px`;
    }

    updateBrandTextWidths(options = {}) {
        const { wrapper, fullText, shortText } = this.brandElements || {};
        if (!wrapper || !fullText || !shortText) {
            return;
        }

        const targetSpan = this.brandIsCollapsed ? shortText : fullText;
        const targetWidth = this.getBrandTextWidth(targetSpan);
        this.applyBrandWidth(targetWidth, { animate: !options.immediate });
    }

    setBrandCollapsed(collapsed, options = {}) {
        const { toggle, fullText, shortText } = this.brandElements || {};
        if (!toggle || !fullText || !shortText) {
            return;
        }

        this.brandIsCollapsed = collapsed;
        const targetSpan = collapsed ? shortText : fullText;
        const targetWidth = this.getBrandTextWidth(targetSpan);

        this.applyBrandWidth(targetWidth, { animate: options.animate !== false });
        toggle.classList.toggle('collapsed', collapsed);
        toggle.classList.toggle('expanded', !collapsed);
    }

    handleBrandResize() {
        if (!this.brandElements?.wrapper) {
            return;
        }

        if (this.isMobileViewport()) {
            this.applyMobileBrandState();
            return;
        }

        if (!this.brandAnimationReady) {
            this.enableBrandAnimation();
            this.brandIsCollapsed = false;
            this.setBrandCollapsed(false, { animate: false });
            this.scheduleBrandCollapse(this.brandCollapseDelayMs);
            return;
        }

        this.updateBrandTextWidths({ immediate: true });
    }

    scheduleBrandCollapse(delayMs = this.brandCollapseDelayMs) {
        this.clearBrandCollapseTimer();
        this.brandCollapseTimer = window.setTimeout(() => {
            this.setBrandCollapsed(true);
            this.brandCollapseTimer = null;
        }, delayMs);
    }

    clearBrandCollapseTimer() {
        if (this.brandCollapseTimer) {
            clearTimeout(this.brandCollapseTimer);
            this.brandCollapseTimer = null;
        }
    }

    startBrandCollapseCycle() {
        this.setupBrandTitleAnimation();

        if (this.isMobileViewport()) {
            this.applyMobileBrandState();
            return;
        }

        if (!this.brandAnimationReady) {
            return;
        }

        this.clearBrandCollapseTimer();
        this.brandIsCollapsed = false;
        this.setBrandCollapsed(false, { animate: false });
        this.scheduleBrandCollapse(this.brandCollapseDelayMs);
    }

    resetBrandTitleState() {
        this.clearBrandCollapseTimer();
        const mainPage = document.getElementById('main-page');

        if (this.isMobileViewport()) {
            this.applyMobileBrandState();
            return;
        }

        if (!this.brandAnimationReady || (mainPage && mainPage.style.display === 'none')) {
            this.brandIsCollapsed = false;
            return;
        }

        this.brandIsCollapsed = false;
        this.setBrandCollapsed(false, { animate: false });
    }

    refreshBrandTitleAfterTextChange() {
        if (this.isMobileViewport()) {
            this.applyMobileBrandState();
            return;
        }

        if (!this.brandAnimationReady) {
            return;
        }
        this.updateBrandTextWidths({ immediate: true });
        if (!this.brandIsCollapsed) {
            this.scheduleBrandCollapse(this.brandCollapseDelayMs);
        }
    }

    handleBrandToggle() {
        if (!this.brandAnimationReady) {
            return;
        }

        const nextCollapsed = !this.brandIsCollapsed;
        this.setBrandCollapsed(nextCollapsed);
        this.clearBrandCollapseTimer();

        if (!nextCollapsed) {
            // 展开后给用户留出一点时间阅读再收起
            this.scheduleBrandCollapse(this.brandCollapseDelayMs + 1500);
        }
    }


    // 显示通知
    showNotification(message, type = 'info') {
        const notification = document.getElementById('notification');
        notification.textContent = message;
        notification.className = `notification ${type}`;
        notification.classList.add('show');

        setTimeout(() => {
            notification.classList.remove('show');
        }, NOTIFICATION_DURATION_MS);
    }

    // 密钥可见性切换
    toggleKeyVisibility() {
        const keyInput = document.getElementById('management-key');
        const toggleButton = document.getElementById('toggle-key-visibility');

        if (keyInput.type === 'password') {
            keyInput.type = 'text';
            toggleButton.innerHTML = '<i class="fas fa-eye-slash"></i>';
        } else {
            keyInput.type = 'password';
            toggleButton.innerHTML = '<i class="fas fa-eye"></i>';
        }
    }

    // ===== 使用统计相关方法 =====

    // 使用统计状态
    requestsChart = null;
    tokensChart = null;
    costChart = null;
    currentUsageData = null;
    chartLineMaxCount = 9;
    chartLineVisibleCount = 3;
    chartLineSelections = Array(3).fill('none');
    chartLineSelectionsInitialized = false;
    chartLineSelectIds = Array.from({ length: 9 }, (_, idx) => `chart-line-select-${idx}`);
    chartLineStyles = [
        { borderColor: '#3b82f6', backgroundColor: 'rgba(59, 130, 246, 0.15)' },
        { borderColor: '#a855f7', backgroundColor: 'rgba(168, 85, 247, 0.15)' },
        { borderColor: '#10b981', backgroundColor: 'rgba(16, 185, 129, 0.15)' },
        { borderColor: '#f97316', backgroundColor: 'rgba(249, 115, 22, 0.15)' },
        { borderColor: '#ec4899', backgroundColor: 'rgba(236, 72, 153, 0.15)' },
        { borderColor: '#14b8a6', backgroundColor: 'rgba(20, 184, 166, 0.15)' },
        { borderColor: '#8b5cf6', backgroundColor: 'rgba(139, 92, 246, 0.15)' },
        { borderColor: '#f59e0b', backgroundColor: 'rgba(245, 158, 11, 0.15)' },
        { borderColor: '#22c55e', backgroundColor: 'rgba(34, 197, 94, 0.15)' }
    ];
    modelPriceStorageKey = 'cli-proxy-model-prices-v2';
    modelPrices = {};
    modelPriceInitialized = false;

    showModal() {
        const modal = document.getElementById('modal');
        if (modal) {
            modal.style.display = 'block';
        }
    }

    // 关闭模态框
    closeModal() {
        document.getElementById('modal').style.display = 'none';
        if (typeof this.closeOpenAIModelDiscovery === 'function') {
            this.closeOpenAIModelDiscovery();
        }
    }

}

Object.assign(
    CLIProxyManager.prototype,
    themeModule,
    navigationModule,
    languageModule,
    loginModule,
    configEditorModule,
    logsModule,
    apiKeysModule,
    authFilesModule,
    oauthModule,
    usageModule,
    settingsModule,
    aiProvidersModule,
    connectionModule
);

// 将工具函数绑定到原型上，供模块使用
CLIProxyManager.prototype.escapeHtml = escapeHtml;
CLIProxyManager.prototype.maskApiKey = maskApiKey;
CLIProxyManager.prototype.formatFileSize = formatFileSize;
CLIProxyManager.prototype.normalizeArrayResponse = normalizeArrayResponse;
CLIProxyManager.prototype.debounce = debounce;

// 全局管理器实例
let manager;

// 让内联事件处理器可以访问到 manager 实例
function exposeManagerInstance(instance) {
    if (typeof window !== 'undefined') {
        window.manager = instance;
    } else if (typeof globalThis !== 'undefined') {
        globalThis.manager = instance;
    }
}

// 尝试自动加载根目录 Logo（支持多种常见文件名/扩展名）
function setupSiteLogo() {
    const img = document.getElementById('site-logo');
    const loginImg = document.getElementById('login-logo');
    const favicon = document.getElementById('favicon-link');
    if (!img && !loginImg && !favicon) return;

    const inlineLogo = typeof window !== 'undefined' ? window.__INLINE_LOGO__ : null;
    if (inlineLogo) {
        if (img) {
            img.src = inlineLogo;
            img.style.display = 'inline-block';
        }
        if (loginImg) {
            loginImg.src = inlineLogo;
            loginImg.style.display = 'inline-block';
        }
        if (favicon) {
            favicon.href = inlineLogo;
        }
        return;
    }

    const candidates = [
        '../logo.svg', '../logo.png', '../logo.jpg', '../logo.jpeg', '../logo.webp', '../logo.gif',
        'logo.svg', 'logo.png', 'logo.jpg', 'logo.jpeg', 'logo.webp', 'logo.gif',
        '/logo.svg', '/logo.png', '/logo.jpg', '/logo.jpeg', '/logo.webp', '/logo.gif'
    ];
    let idx = 0;
    const tryNext = () => {
        if (idx >= candidates.length) return;
        const test = new Image();
        test.onload = () => {
            if (img) {
                img.src = test.src;
                img.style.display = 'inline-block';
            }
            if (loginImg) {
                loginImg.src = test.src;
                loginImg.style.display = 'inline-block';
            }
            if (favicon) {
                favicon.href = test.src;
            }
        };
        test.onerror = () => {
            idx++;
            tryNext();
        };
        test.src = candidates[idx];
    };
    tryNext();
}

// 页面加载完成后初始化
document.addEventListener('DOMContentLoaded', () => {
    // 初始化国际化
    i18n.init();

    setupSiteLogo();
    manager = new CLIProxyManager();
    exposeManagerInstance(manager);
});

</script>
<script>window.__INLINE_LOGO__ = "data:image/jpeg;base64,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";</script>
</body>

</html>
