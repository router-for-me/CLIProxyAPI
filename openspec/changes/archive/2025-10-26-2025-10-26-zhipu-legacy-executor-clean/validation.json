{
  "id": "2025-10-26-zhipu-legacy-executor-clean",
  "title": "Proposal: zhipu-legacy-executor-clarify",
  "deltaCount": 4,
  "deltas": [
    {
      "spec": "legacy-fallback",
      "operation": "REMOVED",
      "description": "Remove requirement: The system MUST remove the legacy fallback path that routed provider=\"zhipu\" requests to `OpenAICompatExecutor`. All requests MUST go through the Python Agent Bridge.",
      "requirement": {
        "text": "The system MUST remove the legacy fallback path that routed provider=\"zhipu\" requests to `OpenAICompatExecutor`. All requests MUST go through the Python Agent Bridge.",
        "scenarios": [
          {
            "rawText": "Given provider=\"zhipu\" and any model\nWhen the bridge is misconfigured or unavailable\nThen the system MUST return a diagnostic error rather than silently routing to a legacy executor."
          }
        ]
      },
      "requirements": [
        {
          "text": "The system MUST remove the legacy fallback path that routed provider=\"zhipu\" requests to `OpenAICompatExecutor`. All requests MUST go through the Python Agent Bridge.",
          "scenarios": [
            {
              "rawText": "Given provider=\"zhipu\" and any model\nWhen the bridge is misconfigured or unavailable\nThen the system MUST return a diagnostic error rather than silently routing to a legacy executor."
            }
          ]
        }
      ]
    },
    {
      "spec": "python-agent-bridge-routing",
      "operation": "MODIFIED",
      "description": "Modify requirement: The system MUST route provider=\"zhipu\" requests to a Python Agent Bridge (PAB) using Claude Agent SDK for Python to call GLM models. This MUST be the default behavior; configuration MUST NOT provide a legacy fallback path once cleanup is complete.",
      "requirement": {
        "text": "The system MUST route provider=\"zhipu\" requests to a Python Agent Bridge (PAB) using Claude Agent SDK for Python to call GLM models. This MUST be the default behavior; configuration MUST NOT provide a legacy fallback path once cleanup is complete.",
        "scenarios": [
          {
            "rawText": "Given provider=\"zhipu\" and model=\"glm-4.6\"\nWhen client POSTs /v1/chat/completions with stream=false\nThen request is translated to OpenAI format and forwarded to PAB, and JSON result is returned unchanged in OpenAI format."
          },
          {
            "rawText": "Given provider=\"zhipu\" and model=\"glm-4.6\" with stream=true\nWhen client POSTs /v1/chat/completions\nThen server relays SSE chunks from PAB and ends with [DONE]."
          }
        ]
      },
      "requirements": [
        {
          "text": "The system MUST route provider=\"zhipu\" requests to a Python Agent Bridge (PAB) using Claude Agent SDK for Python to call GLM models. This MUST be the default behavior; configuration MUST NOT provide a legacy fallback path once cleanup is complete.",
          "scenarios": [
            {
              "rawText": "Given provider=\"zhipu\" and model=\"glm-4.6\"\nWhen client POSTs /v1/chat/completions with stream=false\nThen request is translated to OpenAI format and forwarded to PAB, and JSON result is returned unchanged in OpenAI format."
            },
            {
              "rawText": "Given provider=\"zhipu\" and model=\"glm-4.6\" with stream=true\nWhen client POSTs /v1/chat/completions\nThen server relays SSE chunks from PAB and ends with [DONE]."
            }
          ]
        }
      ]
    },
    {
      "spec": "python-agent-bridge-routing",
      "operation": "MODIFIED",
      "description": "Modify requirement: The Go service MUST keep OpenAI-compatible endpoints unchanged (/v1/chat/completions), supporting streaming and non-streaming when routed through PAB.",
      "requirement": {
        "text": "The Go service MUST keep OpenAI-compatible endpoints unchanged (/v1/chat/completions), supporting streaming and non-streaming when routed through PAB.",
        "scenarios": [
          {
            "rawText": "Given provider=\"zhipu\"\nWhen client uses /v1/chat/completions (stream or non-stream)\nThen responses remain OpenAI-compatible in structure and semantics."
          }
        ]
      },
      "requirements": [
        {
          "text": "The Go service MUST keep OpenAI-compatible endpoints unchanged (/v1/chat/completions), supporting streaming and non-streaming when routed through PAB.",
          "scenarios": [
            {
              "rawText": "Given provider=\"zhipu\"\nWhen client uses /v1/chat/completions (stream or non-stream)\nThen responses remain OpenAI-compatible in structure and semantics."
            }
          ]
        }
      ]
    },
    {
      "spec": "python-agent-bridge-routing",
      "operation": "MODIFIED",
      "description": "Modify requirement: Bridge URL selection priority MUST be: (1) config.claude-agent-sdk-for-python.baseURL, (2) env CLAUDE_AGENT_SDK_URL, (3) ensureClaudePythonBridge() default.",
      "requirement": {
        "text": "Bridge URL selection priority MUST be: (1) config.claude-agent-sdk-for-python.baseURL, (2) env CLAUDE_AGENT_SDK_URL, (3) ensureClaudePythonBridge() default.",
        "scenarios": [
          {
            "rawText": "Given all three sources configured with different values\nWhen resolving the bridge URL\nThen config.claude-agent-sdk-for-python.baseURL is used; if empty, fallback to env; else use ensureClaudePythonBridge default."
          }
        ]
      },
      "requirements": [
        {
          "text": "Bridge URL selection priority MUST be: (1) config.claude-agent-sdk-for-python.baseURL, (2) env CLAUDE_AGENT_SDK_URL, (3) ensureClaudePythonBridge() default.",
          "scenarios": [
            {
              "rawText": "Given all three sources configured with different values\nWhen resolving the bridge URL\nThen config.claude-agent-sdk-for-python.baseURL is used; if empty, fallback to env; else use ensureClaudePythonBridge default."
            }
          ]
        }
      ]
    }
  ]
}
